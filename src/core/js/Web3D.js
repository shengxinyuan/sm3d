!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Bavlo={})}(this,function(e){"use strict";function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(n):t.value}})(e,t,n||e)}function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function o(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=i(n);return e=r?(e=i(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==W(e)&&"function"!=typeof e?u(t):e}}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t});var ne=0,re=1,ie=2,ae=0,oe=1,se=2,le=3,V=0,X=1,Y=2,L=1,A=2,O=3,q=0,Me=1,Q=2,s=0,Z=0,J=1,K=2,$=3,ee=4,te=5,ce=100,l=101,c=102,h=103,p=104,f=200,m=201,g=202,v=203,y=204,x=205,b=206,_=207,M=208,w=209,T=210,ue=0,he=1,de=2,pe=3,fe=4,me=5,ge=6,ve=7,C=0,P=1,I=2,R=0,we=1,F=2,N=3,D=4,k=5,U=301,B=302,z=303,H=304,G=305,j=306,ye=307,xe=1e3,be=1001,_e=1002,Te=1003,Se=1004,Ee=1005,Ae=1006,Ce=1007,Pe=1008,Le=1009,S=1010,E=1011,Oe=1012,Ie=1013,Re=1014,Fe=1015,Ne=1016,De=1017,ke=1018,Ue=1019,Be=1020,ze=1021,He=1022,Ge=1023,je=1024,We=1025,Ve=Ge,Xe=1026,Ye=1027,qe=1028,Qe=33776,Ze=33777,Je=33778,Ke=33779,$e=35840,et=35841,tt=35842,nt=35843,rt=36196,it=37808,at=37809,ot=37810,st=37811,lt=37812,ct=37813,ut=37814,ht=37815,dt=37816,pt=37817,ft=37818,mt=37819,gt=37820,vt=37821,yt=2300,xt=2301,bt=2400,_t=2401,Mt=0,wt=3e3,Tt=3001,St=3007,Et=3002,At=3003,Ct=3004,Pt=3005,Lt=3006,Ot=3200,It=3201,Rt=0,Ft=1,Nt=7680,Dt=519;function kt(){}Object.assign(kt.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){void 0!==this._listeners&&(void 0===(e=this._listeners[e])||-1!==(t=e.indexOf(t))&&e.splice(t,1))},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}});for(var Ut=[],Bt=0;Bt<256;Bt++)Ut[Bt]=(Bt<16?"0":"")+Bt.toString(16);var zt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Ut[255&e]+Ut[e>>8&255]+Ut[e>>16&255]+Ut[e>>24&255]+"-"+Ut[255&t]+Ut[t>>8&255]+"-"+Ut[t>>16&15|64]+Ut[t>>24&255]+"-"+Ut[63&n|128]+Ut[n>>8&255]+"-"+Ut[n>>16&255]+Ut[n>>24&255]+Ut[255&r]+Ut[r>>8&255]+Ut[r>>16&255]+Ut[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*zt.DEG2RAD},radToDeg:function(e){return e*zt.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function Ht(e,t){this.x=e||0,this.y=t||0}function Gt(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1}Object.defineProperties(Ht.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Ht.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,e=e.elements;return this.x=e[0]*t+e[3]*n+e[6],this.y=e[1]*t+e[4]*n+e[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e;return(e=Math.atan2(this.y,this.x))<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return this.x=e[t=void 0===t?0:t],this.y=e[t+1],this},toArray:function(e,t){return(e=void 0===e?[]:e)[t=void 0===t?0:t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,t=this.y-e.y;return this.x=i*n-t*r+e.x,this.y=i*r+t*n+e.y,this}}),Object.assign(Gt,{slerp:function(e,t,n,r){return n.copy(e).slerp(t,r)},slerpFlat:function(e,t,n,r,i,a,o){var s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],h=i[a+0],d=i[a+1],p=i[a+2],f=i[a+3];u===f&&s===h&&l===d&&c===p||(n=1-o,i=0<=(r=s*h+l*d+c*p+u*f)?1:-1,(a=1-r*r)>Number.EPSILON&&(a=Math.sqrt(a),r=Math.atan2(a,r*i),n=Math.sin(n*r)/a,o=Math.sin(o*r)/a),s=s*n+h*(i=o*i),l=l*n+d*i,c=c*n+p*i,u=u*n+f*i,n===1-o&&(s*=o=1/Math.sqrt(s*s+l*l+c*c+u*u),l*=o,c*=o,u*=o)),e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties(Gt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(Gt.prototype,{isQuaternion:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,a=e.order,o=Math.cos,s=Math.sin,l=o(n/2),e=o(r/2),o=o(i/2),n=s(n/2),r=s(r/2),i=s(i/2);return"XYZ"===a?(this._x=n*e*o+l*r*i,this._y=l*r*o-n*e*i,this._z=l*e*i+n*r*o,this._w=l*e*o-n*r*i):"YXZ"===a?(this._x=n*e*o+l*r*i,this._y=l*r*o-n*e*i,this._z=l*e*i-n*r*o,this._w=l*e*o+n*r*i):"ZXY"===a?(this._x=n*e*o-l*r*i,this._y=l*r*o+n*e*i,this._z=l*e*i+n*r*o,this._w=l*e*o-n*r*i):"ZYX"===a?(this._x=n*e*o-l*r*i,this._y=l*r*o+n*e*i,this._z=l*e*i-n*r*o,this._w=l*e*o+n*r*i):"YZX"===a?(this._x=n*e*o+l*r*i,this._y=l*r*o+n*e*i,this._z=l*e*i-n*r*o,this._w=l*e*o-n*r*i):"XZY"===a&&(this._x=n*e*o-l*r*i,this._y=l*r*o-n*e*i,this._z=l*e*i+n*r*o,this._w=l*e*o+n*r*i),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,t=Math.sin(n);return this._x=e.x*t,this._y=e.y*t,this._z=e.z*t,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,r=n[0],i=n[4],a=n[8],o=n[1],s=n[5],l=n[9],c=n[2],u=n[6],e=n[10],n=r+s+e;return 0<n?(t=.5/Math.sqrt(n+1),this._w=.25/t,this._x=(u-l)*t,this._y=(a-c)*t,this._z=(o-i)*t):s<r&&e<r?(t=2*Math.sqrt(1+r-s-e),this._w=(u-l)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(a+c)/t):e<s?(t=2*Math.sqrt(1+s-r-e),this._w=(a-c)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+e-r-s),this._w=(o-i)/t,this._x=(a+c)/t,this._y=(l+u)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=n,this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(zt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;n=Math.min(1,t/n);return this.slerp(e,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(e=1/e),this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,e=t._z,t=t._w;return this._x=n*t+a*o+r*e-i*s,this._y=r*t+a*s+i*o-n*e,this._z=i*t+a*e+n*s-r*o,this._w=a*t-n*o-r*s-i*e,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),1<=o)return this._w=a,this._x=n,this._y=r,this._z=i,this;e=1-o*o;if(e<=Number.EPSILON){var s=1-t;return this._w=s*a+t*this._w,this._x=s*n+t*this._x,this._y=s*r+t*this._y,this._z=s*i+t*this._z,this.normalize(),this._onChangeCallback(),this}s=Math.sqrt(e),e=Math.atan2(s,o),o=Math.sin((1-t)*e)/s,s=Math.sin(t*e)/s;return this._w=a*o+this._w*s,this._x=n*o+this._x*s,this._y=r*o+this._y*s,this._z=i*o+this._z*s,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return this._x=e[t=void 0===t?0:t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return(e=void 0===e?[]:e)[t=void 0===t?0:t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var jt=new Vt,Wt=new Gt;function Vt(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}Object.assign(Vt.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Wt.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(Wt.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[3]*n+e[6]*r,this.y=e[1]*t+e[4]*n+e[7]*r,this.z=e[2]*t+e[5]*n+e[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,e=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*e,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*e,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*e,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*n,c=s*n+o*t-i*r,e=s*r+i*n-a*t,r=-i*t-a*n-o*r;return this.x=l*s+r*-i+c*-o-e*-a,this.y=c*s+r*-a+e*-i-l*-o,this.z=e*s+r*-o+l*-a-c*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r,this.y=e[1]*t+e[5]*n+e[9]*r,this.z=e[2]*t+e[6]*n+e[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,e=t.y,t=t.z;return this.x=r*t-i*e,this.y=i*a-n*t,this.z=n*e-r*a,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(e){return jt.copy(this).projectOnVector(e),this.sub(jt)},reflect:function(e){return this.sub(jt.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());0===t&&console.error("THREE.Vector3: angleTo() can't handle zero length vectors.");t=this.dot(e)/t;return Math.acos(zt.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,e=this.z-e.z;return t*t+n*n+e*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){e=e.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),e=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=e,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return this.x=e[t=void 0===t?0:t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return(e=void 0===e?[]:e)[t=void 0===t?0:t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var Xt,Yt=new Vt;function qt(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(qt.prototype,{isMatrix3:!0,set:function(e,t,n,r,i,a,o,s,l){var c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},setFromMatrix4:function(e){e=e.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(e){for(var t=0,n=e.count;t<n;t++)Yt.x=e.getX(t),Yt.y=e.getY(t),Yt.z=e.getZ(t),Yt.applyMatrix3(this),e.setXYZ(t,Yt.x,Yt.y,Yt.z);return e},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],e=r[7],t=r[2],n=r[5],r=r[8];return i[0]=a*f+o*v+s*t,i[3]=a*m+o*y+s*n,i[6]=a*g+o*e+s*r,i[1]=l*f+c*v+u*t,i[4]=l*m+c*y+u*n,i[7]=l*g+c*e+u*r,i[2]=h*f+d*v+p*t,i[5]=h*m+d*y+p*n,i[8]=h*g+d*e+p*r,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],e=e[8];return t*a*e-t*o*l-n*i*e+n*o*s+r*i*l-r*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,r=this.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=d*l-c*h,f=c*u-d*s,m=h*s-l*u,e=i*p+a*f+o*m;if(0==e){n="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(n);return console.warn(n),this.identity()}e=1/e;return r[0]=p*e,r[1]=(o*h-d*a)*e,r[2]=(c*a-o*l)*e,r[3]=f*e,r[4]=(d*i-o*u)*e,r[5]=(o*s-c*i)*e,r[6]=m*e,r[7]=(a*u-h*i)*e,r[8]=(l*i-a*s)*e,this},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,r,i,a,o){var s=Math.cos(i),i=Math.sin(i);this.set(n*s,n*i,-n*(s*a+i*o)+a+e,-r*i,r*s,-r*(-i*a+s*o)+o+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],l=r[4],e=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*l,r[6]=t*o+n*e,r[1]=-n*i+t*s,r[4]=-n*a+t*l,r[7]=-n*o+t*e,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){var n=this.elements;return(e=void 0===e?[]:e)[t=void 0===t?0:t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var Qt={getDataURL:function(e){var t;return"undefined"==typeof HTMLCanvasElement?e.src:2048<(e=e instanceof HTMLCanvasElement?e:((Xt=void 0===Xt?document.createElementNS("http://www.w3.org/1999/xhtml","canvas"):Xt).width=e.width,Xt.height=e.height,t=Xt.getContext("2d"),e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),Xt)).width||2048<e.height?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},Zt=0;function Jt(e,t,n,r,i,a,o,s,l,c){Object.defineProperty(this,"id",{value:Zt++}),this.uuid=zt.generateUUID(),this.name="",this.image=void 0!==e?e:Jt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Jt.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:be,this.wrapT=void 0!==r?r:be,this.magFilter=void 0!==i?i:Ae,this.minFilter=void 0!==a?a:Pe,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:Ge,this.type=void 0!==s?s:Le,this.offset=new Ht(0,0),this.repeat=new Ht(1,1),this.center=new Ht(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new qt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:wt,this.version=0,this.onUpdate=null}function Kt(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1}function $t(e,t,n){this.width=e,this.height=t,this.scissor=new Kt(0,0,e,t),this.scissorTest=!1,this.viewport=new Kt(0,0,e,t),this.texture=new Jt(void 0,void 0,(n=n||{}).wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Ae,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function en(e,t,n){$t.call(this,e,t,n),this.samples=4}Jt.DEFAULT_IMAGE=void 0,Jt.DEFAULT_MAPPING=300,Jt.prototype=Object.assign(Object.create(kt.prototype),{constructor:Jt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=zt.generateUUID()),!t&&void 0===e.images[r.uuid]){if(Array.isArray(r))for(var i=[],a=0,o=r.length;a<o;a++)i.push(Qt.getDataURL(r[a]));else i=Qt.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case xe:e.x=e.x-Math.floor(e.x);break;case be:e.x=e.x<0?0:1;break;case _e:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case xe:e.y=e.y-Math.floor(e.y);break;case be:e.y=e.y<0?0:1;break;case _e:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Jt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(Kt.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(Kt.prototype,{isVector4:!0,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r+e[12]*i,this.y=e[1]*t+e[5]*n+e[9]*r+e[13]*i,this.z=e[2]*t+e[6]*n+e[10]*r+e[14]*i,this.w=e[3]*t+e[7]*n+e[11]*r+e[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i=e.elements,a=i[0],o=i[4],s=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];if(Math.abs(o-l)<.01&&Math.abs(s-h)<.01&&Math.abs(u-d)<.01){if(Math.abs(o+l)<.1&&Math.abs(s+h)<.1&&Math.abs(u+d)<.1&&Math.abs(a+c+p-3)<.1)return this.set(1,0,0,0),this;var f=Math.PI,m=(a+1)/2,g=(c+1)/2,v=(p+1)/2,y=(o+l)/4,e=(s+h)/4,i=(u+d)/4;return g<m&&v<m?r=m<.01?(t=0,n=.707106781):(n=y/(t=Math.sqrt(m)),e/t):v<g?r=g<.01?(n=0,t=.707106781):(t=y/(n=Math.sqrt(g)),i/n):v<.01?(n=t=.707106781,r=0):(t=e/(r=Math.sqrt(v)),n=i/r),this.set(t,n,r,f),this}f=Math.sqrt((d-u)*(d-u)+(s-h)*(s-h)+(l-o)*(l-o));return Math.abs(f)<.001&&(f=1),this.x=(d-u)/f,this.y=(s-h)/f,this.z=(l-o)/f,this.w=Math.acos((a+c+p-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return this.x=e[t=void 0===t?0:t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return(e=void 0===e?[]:e)[t=void 0===t?0:t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),$t.prototype=Object.assign(Object.create(kt.prototype),{constructor:$t,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),en.prototype=Object.assign(Object.create($t.prototype),{constructor:en,isWebGLMultisampleRenderTarget:!0,copy:function(e){return $t.prototype.copy.call(this,e),this.samples=e.samples,this}});var tn=new Vt,nn=new cn,rn=new Vt(0,0,0),an=new Vt(1,1,1),on=new Vt,sn=new Vt,ln=new Vt;function cn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(cn.prototype,{isMatrix4:!0,set:function(e,t,n,r,i,a,o,s,l,c,u,h,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new cn).fromArray(this.elements)},copy:function(e){var t=this.elements,e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this},copyPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,n=e.elements,r=1/tn.setFromMatrixColumn(e,0).length(),i=1/tn.setFromMatrixColumn(e,1).length(),e=1/tn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t,n,r,i,a,o,s,l,c,u,h,d,p=this.elements,f=e.x,m=e.y,g=e.z,v=Math.cos(f),y=Math.sin(f),x=Math.cos(m),f=Math.sin(m),m=Math.cos(g),g=Math.sin(g);return"XYZ"===e.order?(a=v*m,o=v*g,s=y*m,l=y*g,p[0]=x*m,p[4]=-x*g,p[8]=f,p[1]=o+s*f,p[5]=a-l*f,p[9]=-y*x,p[2]=l-a*f,p[6]=s+o*f,p[10]=v*x):"YXZ"===e.order?(n=x*g,r=f*m,p[0]=(t=x*m)+(i=f*g)*y,p[4]=r*y-n,p[8]=v*f,p[1]=v*g,p[5]=v*m,p[9]=-y,p[2]=n*y-r,p[6]=i+t*y,p[10]=v*x):"ZXY"===e.order?(n=x*g,r=f*m,p[0]=(t=x*m)-(i=f*g)*y,p[4]=-v*g,p[8]=r+n*y,p[1]=n+r*y,p[5]=v*m,p[9]=i-t*y,p[2]=-v*f,p[6]=y,p[10]=v*x):"ZYX"===e.order?(a=v*m,o=v*g,s=y*m,l=y*g,p[0]=x*m,p[4]=s*f-o,p[8]=a*f+l,p[1]=x*g,p[5]=l*f+a,p[9]=o*f-s,p[2]=-f,p[6]=y*x,p[10]=v*x):"YZX"===e.order?(c=v*x,u=v*f,h=y*x,d=y*f,p[0]=x*m,p[4]=d-c*g,p[8]=h*g+u,p[1]=g,p[5]=v*m,p[9]=-y*m,p[2]=-f*m,p[6]=u*g+h,p[10]=c-d*g):"XZY"===e.order&&(c=v*x,u=v*f,h=y*x,d=y*f,p[0]=x*m,p[4]=-g,p[8]=f*m,p[1]=c*g+d,p[5]=v*m,p[9]=u*g-h,p[2]=h*g-u,p[6]=y*m,p[10]=d*g+c),p[3]=0,p[7]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(rn,e,an)},lookAt:function(e,t,n){var r=this.elements;return ln.subVectors(e,t),0===ln.lengthSq()&&(ln.z=1),ln.normalize(),on.crossVectors(n,ln),0===on.lengthSq()&&(1===Math.abs(n.z)?ln.x+=1e-4:ln.z+=1e-4,ln.normalize(),on.crossVectors(n,ln)),on.normalize(),sn.crossVectors(ln,on),r[0]=on.x,r[4]=sn.x,r[8]=ln.x,r[1]=on.y,r[5]=sn.y,r[9]=ln.y,r[2]=on.z,r[6]=sn.z,r[10]=ln.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],_=r[0],M=r[4],w=r[8],T=r[12],S=r[1],E=r[5],A=r[9],C=r[13],P=r[2],L=r[6],O=r[10],I=r[14],e=r[3],t=r[7],n=r[11],r=r[15];return i[0]=a*_+o*S+s*P+l*e,i[4]=a*M+o*E+s*L+l*t,i[8]=a*w+o*A+s*O+l*n,i[12]=a*T+o*C+s*I+l*r,i[1]=c*_+u*S+h*P+d*e,i[5]=c*M+u*E+h*L+d*t,i[9]=c*w+u*A+h*O+d*n,i[13]=c*T+u*C+h*I+d*r,i[2]=p*_+f*S+m*P+g*e,i[6]=p*M+f*E+m*L+g*t,i[10]=p*w+f*A+m*O+g*n,i[14]=p*T+f*C+m*I+g*r,i[3]=v*_+y*S+x*P+b*e,i[7]=v*M+y*E+x*L+b*t,i[11]=v*w+y*A+x*O+b*n,i[15]=v*T+y*C+x*I+b*r,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(e){for(var t=0,n=e.count;t<n;t++)tn.x=e.getX(t),tn.y=e.getY(t),tn.z=e.getZ(t),tn.applyMatrix4(this),e.setXYZ(t,tn.x,tn.y,tn.z);return e},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*s*u-r*l*u-i*o*h+n*l*h+r*o*d-n*s*d)+e[7]*(+t*s*d-t*l*h+i*a*h-r*a*d+r*l*c-i*s*c)+e[11]*(+t*l*u-t*o*d-i*a*u+n*a*d+i*o*c-n*l*c)+e[15]*(-r*o*c-t*s*u+t*o*h+r*a*u-n*a*h+n*s*c)},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],x=r[15],b=p*y*h-v*f*h+v*u*m-c*y*m-p*u*x+c*f*x,_=g*f*h-d*y*h-g*u*m+l*y*m+d*u*x-l*f*x,M=d*v*h-g*p*h+g*c*m-l*v*m-d*c*x+l*p*x,w=g*p*u-d*v*u-g*c*f+l*v*f+d*c*y-l*p*y,e=i*b+a*_+o*M+s*w;if(0==e){r="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(r);return console.warn(r),this.identity()}e=1/e;return n[0]=b*e,n[1]=(v*f*s-p*y*s-v*o*m+a*y*m+p*o*x-a*f*x)*e,n[2]=(c*y*s-v*u*s+v*o*h-a*y*h-c*o*x+a*u*x)*e,n[3]=(p*u*s-c*f*s-p*o*h+a*f*h+c*o*m-a*u*m)*e,n[4]=_*e,n[5]=(d*y*s-g*f*s+g*o*m-i*y*m-d*o*x+i*f*x)*e,n[6]=(g*u*s-l*y*s-g*o*h+i*y*h+l*o*x-i*u*x)*e,n[7]=(l*f*s-d*u*s+d*o*h-i*f*h-l*o*m+i*u*m)*e,n[8]=M*e,n[9]=(g*p*s-d*v*s-g*a*m+i*v*m+d*a*x-i*p*x)*e,n[10]=(l*v*s-g*c*s+g*a*h-i*v*h-l*a*x+i*c*x)*e,n[11]=(d*c*s-l*p*s-d*a*h+i*p*h+l*a*m-i*c*m)*e,n[12]=w*e,n[13]=(d*v*o-g*p*o+g*a*f-i*v*f-d*a*y+i*p*y)*e,n[14]=(g*c*o-l*v*o-g*a*u+i*v*u+l*a*y-i*c*y)*e,n[15]=(l*p*o-d*c*o+d*a*u-i*p*u-l*a*f+i*c*f)*e,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,e=e.z;return t[0]*=n,t[4]*=r,t[8]*=e,t[1]*=n,t[5]*=r,t[9]*=e,t[2]*=n,t[6]*=r,t[10]*=e,t[3]*=n,t[7]*=r,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,e))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,t=i*a,e=i*o;return this.set(t*a+n,t*o-r*s,t*s+r*o,0,t*o+r*s,e*o+n,e*s-r*a,0,t*s-r*o,e*s+r*a,i*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,c=a+a,u=o+o,h=i*l,d=i*c,p=i*u,t=a*c,i=a*u,a=o*u,o=s*l,l=s*c,c=s*u,s=n.x,u=n.y,n=n.z;return r[0]=(1-(t+a))*s,r[1]=(d+c)*s,r[2]=(p-l)*s,r[3]=0,r[4]=(d-c)*u,r[5]=(1-(h+a))*u,r[6]=(i+o)*u,r[7]=0,r[8]=(p+l)*n,r[9]=(i-o)*n,r[10]=(1-(h+t))*n,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:function(e,t,n){var r=this.elements,i=tn.set(r[0],r[1],r[2]).length(),a=tn.set(r[4],r[5],r[6]).length(),o=tn.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],nn.copy(this);var s=1/i,e=1/a,r=1/o;return nn.elements[0]*=s,nn.elements[1]*=s,nn.elements[2]*=s,nn.elements[4]*=e,nn.elements[5]*=e,nn.elements[6]*=e,nn.elements[8]*=r,nn.elements[9]*=r,nn.elements[10]*=r,t.setFromRotationMatrix(nn),n.x=i,n.y=a,n.z=o,this},makePerspective:function(e,t,n,r,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(n-r),l=(t+e)/(t-e),n=(n+r)/(n-r),r=-(a+i)/(a-i),a=-2*a*i/(a-i);return o[0]=2*i/(t-e),o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=s,o[9]=n,o[13]=0,o[2]=0,o[6]=0,o[10]=r,o[14]=a,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,n,r,i,a){var o=this.elements,s=1/(t-e),l=1/(n-r),c=1/(a-i),e=(t+e)*s,r=(n+r)*l,i=(a+i)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-e,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-r,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-i,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){var n=this.elements;return(e=void 0===e?[]:e)[t=void 0===t?0:t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});var un=new cn,hn=new Gt;function dn(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||dn.DefaultOrder}function pn(){this.mask=1}dn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],dn.DefaultOrder="XYZ",Object.defineProperties(dn.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(dn.prototype,{isEuler:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=zt.clamp,i=e.elements,a=i[0],o=i[4],s=i[8],l=i[1],c=i[5],u=i[9],h=i[2],e=i[6],i=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,i),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(e,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(s,i),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(e,-1,1)),Math.abs(e)<.9999999?(this._y=Math.atan2(-h,i),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(e,i),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,c))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,i))):"XZY"===t?(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(e,c),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-u,i),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return un.makeRotationFromQuaternion(e),this.setFromRotationMatrix(un,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return hn.setFromEuler(this),this.setFromQuaternion(hn,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return(e=void 0===e?[]:e)[t=void 0===t?0:t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Vt(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(pn.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}});var fn=0,mn=new Vt,gn=new Gt,vn=new cn,yn=new Vt,xn=new Vt,bn=new Vt,_n=new Gt,Mn=new Vt(1,0,0),wn=new Vt(0,1,0),Tn=new Vt(0,0,1),Sn={type:"added"},En={type:"removed"};function An(){Object.defineProperty(this,"id",{value:fn++}),this.uuid=zt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=An.DefaultUp.clone();var e=new Vt,t=new dn,n=new Gt,r=new Vt(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new cn},normalMatrix:{value:new qt}}),this.matrix=new cn,this.matrixWorld=new cn,this.matrixAutoUpdate=An.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new pn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Cn(){An.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}An.DefaultUp=new Vt(0,1,0),An.DefaultMatrixAutoUpdate=!0,An.prototype=Object.assign(Object.create(kt.prototype),{constructor:An,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return gn.setFromAxisAngle(e,t),this.quaternion.multiply(gn),this},rotateOnWorldAxis:function(e,t){return gn.setFromAxisAngle(e,t),this.quaternion.premultiply(gn),this},rotateX:function(e){return this.rotateOnAxis(Mn,e)},rotateY:function(e){return this.rotateOnAxis(wn,e)},rotateZ:function(e){return this.rotateOnAxis(Tn,e)},translateOnAxis:function(e,t){return mn.copy(e).applyQuaternion(this.quaternion),this.position.add(mn.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Mn,e)},translateY:function(e){return this.translateOnAxis(wn,e)},translateZ:function(e){return this.translateOnAxis(Tn,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(vn.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?yn.copy(e):yn.set(e,t,n);n=this.parent;this.updateWorldMatrix(!0,!1),xn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?vn.lookAt(xn,yn,this.up):vn.lookAt(yn,xn,this.up),this.quaternion.setFromRotationMatrix(vn),n&&(vn.extractRotation(n.matrixWorld),gn.setFromRotationMatrix(vn),this.quaternion.premultiply(gn.inverse()))},add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(Sn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(En)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),vn.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),vn.multiply(e.parent.matrixWorld)),e.applyMatrix(vn),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vt),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Gt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(xn,e,bn),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Vt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(xn,_n,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,a=r.length;i<a;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(n){var e=void 0===n||"string"==typeof n,t={};e&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{}},t.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r,i,a={};function o(e,t){return void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(n)),t.uuid}if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),!0===this.castShadow&&(a.castShadow=!0),!0===this.receiveShadow&&(a.receiveShadow=!0),!1===this.visible&&(a.visible=!1),!1===this.frustumCulled&&(a.frustumCulled=!1),0!==this.renderOrder&&(a.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(a.userData=this.userData),a.layers=this.layers.mask,a.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(a.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==Mt&&(a.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){a.geometry=o(n.geometries,this.geometry);var s=this.geometry.parameters;if(void 0!==s&&void 0!==s.shapes){var l=s.shapes;if(Array.isArray(l))for(var c=0,u=l.length;c<u;c++){var h=l[c];o(n.shapes,h)}else o(n.shapes,l)}}if(void 0!==this.material)if(Array.isArray(this.material)){for(var d=[],c=0,u=this.material.length;c<u;c++)d.push(o(n.materials,this.material[c]));a.material=d}else a.material=o(n.materials,this.material);if(0<this.children.length){a.children=[];for(c=0;c<this.children.length;c++)a.children.push(this.children[c].toJSON(n).object)}return e&&(r=p(n.geometries),i=p(n.materials),s=p(n.textures),e=p(n.images),l=p(n.shapes),0<r.length&&(t.geometries=r),0<i.length&&(t.materials=i),0<s.length&&(t.textures=s),0<e.length&&(t.images=e),0<l.length&&(t.shapes=l)),t.object=a,t;function p(e){var t,n=[];for(t in e){var r=e[t];delete r.metadata,n.push(r)}return n}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}),Cn.prototype=Object.assign(Object.create(An.prototype),{constructor:Cn,isScene:!0,copy:function(e,t){return An.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=An.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Pn=[new Vt,new Vt,new Vt,new Vt,new Vt,new Vt,new Vt,new Vt],Ln=new Vt,On=new Vt,In=new Vt,Rn=new Vt,Fn=new Vt,Nn=new Vt,Dn=new Vt,kn=new Vt,Un=new Vt,Bn=new Vt,zn=new Vt;function Hn(e,t){this.min=void 0!==e?e:new Vt(1/0,1/0,1/0),this.max=void 0!==t?t:new Vt(-1/0,-1/0,-1/0)}function Gn(e,t,n,r,i){for(var a=0,o=e.length-3;a<=o;a+=3){zn.fromArray(e,a);var s=i.x*Math.abs(zn.x)+i.y*Math.abs(zn.y)+i.z*Math.abs(zn.z),l=t.dot(zn),c=n.dot(zn),u=r.dot(zn);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>s)return!1}return!0}Object.assign(Hn.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<n&&(n=u),h<r&&(r=h),i<c&&(i=c),a<u&&(a=u),o<h&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),h=e.getZ(s);c<t&&(t=c),u<n&&(n=u),h<r&&(r=h),i<c&&(i=c),a<u&&(a=u),o<h&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){t=Ln.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Vt),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Vt),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;if(void 0!==t)if(t.isGeometry)for(var n=t.vertices,r=0,i=n.length;r<i;r++)Ln.copy(n[r]),Ln.applyMatrix4(e.matrixWorld),this.expandByPoint(Ln);else if(t.isBufferGeometry){var a=t.attributes.position;if(void 0!==a)for(r=0,i=a.count;r<i;r++)Ln.fromBufferAttribute(a,r).applyMatrix4(e.matrixWorld),this.expandByPoint(Ln)}var o=e.children;for(r=0,i=o.length;r<i;r++)this.expandByObject(o[r]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Vt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,Ln),Ln.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,n=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x);return 0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(kn),Un.subVectors(this.max,kn),On.subVectors(e.a,kn),In.subVectors(e.b,kn),Rn.subVectors(e.c,kn),Fn.subVectors(In,On),Nn.subVectors(Rn,In),Dn.subVectors(On,Rn);e=[0,-Fn.z,Fn.y,0,-Nn.z,Nn.y,0,-Dn.z,Dn.y,Fn.z,0,-Fn.x,Nn.z,0,-Nn.x,Dn.z,0,-Dn.x,-Fn.y,Fn.x,0,-Nn.y,Nn.x,0,-Dn.y,Dn.x,0];return!!Gn(e,On,In,Rn,Un)&&(!!Gn(e=[1,0,0,0,1,0,0,0,1],On,In,Rn,Un)&&(Bn.crossVectors(Fn,Nn),Gn(e=[Bn.x,Bn.y,Bn.z],On,In,Rn,Un)))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Vt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Ln.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Ln).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(Pn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Pn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Pn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Pn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Pn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Pn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Pn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Pn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Pn)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var jn=new Hn;function Wn(e,t){this.center=void 0!==e?e:new Vt,this.radius=void 0!==t?t:0}Object.assign(Wn.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var n=this.center;void 0!==t?n.copy(t):jn.setFromPoints(e).getCenter(n);for(var r=0,i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Vt),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Hn),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var Vn=new Vt,Xn=new Vt,Yn=new Vt,qn=new Vt,Qn=new Vt,Zn=new Vt,Jn=new Vt;function Kn(e,t){this.origin=void 0!==e?e:new Vt,this.direction=void 0!==t?t:new Vt}Object.assign(Kn.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Vt),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,Vn)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Vt),t.subVectors(e,this.origin);e=t.dot(this.direction);return e<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=Vn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Vn.copy(this.direction).multiplyScalar(t).add(this.origin),Vn.distanceToSquared(e))},distanceSqToSegment:function(e,t,n,r){Xn.copy(e).add(t).multiplyScalar(.5),Yn.copy(t).sub(e).normalize(),qn.copy(this.origin).sub(Xn);var i,a,o=.5*e.distanceTo(t),s=-this.direction.dot(Yn),l=qn.dot(this.direction),c=-qn.dot(Yn),u=qn.lengthSq(),e=Math.abs(1-s*s);return u=0<e?(a=s*l-c,t=o*e,0<=(i=s*c-l)?-t<=a?a<=t?(i*=e=1/e)*(i+s*(a*=e)+2*l)+a*(s*i+a+2*c)+u:(a=o,-(i=Math.max(0,-(s*a+l)))*i+a*(a+2*c)+u):(a=-o,-(i=Math.max(0,-(s*a+l)))*i+a*(a+2*c)+u):a<=-t?-(i=Math.max(0,-(-s*o+l)))*i+(a=0<i?-o:Math.min(Math.max(-o,-c),o))*(a+2*c)+u:a<=t?(i=0,(a=Math.min(Math.max(-o,-c),o))*(a+2*c)+u):-(i=Math.max(0,-(s*o+l)))*i+(a=0<i?o:Math.min(Math.max(-o,-c),o))*(a+2*c)+u):(a=0<s?-o:o,-(i=Math.max(0,-(s*a+l)))*i+a*(a+2*c)+u),n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Yn).multiplyScalar(a).add(Xn),u},intersectSphere:function(e,t){Vn.subVectors(e.center,this.origin);var n=Vn.dot(this.direction),r=Vn.dot(Vn)-n*n,e=e.radius*e.radius;if(e<r)return null;e=Math.sqrt(e-r),r=n-e,e=n+e;return r<0&&e<0?null:r<0?this.at(e,t):this.at(r,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;t=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=t?t:null},intersectPlane:function(e,t){e=this.distanceToPlane(e);return null===e?null:this.at(e,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,r,i,a=1/this.direction.x,o=1/this.direction.y,s=1/this.direction.z,l=this.origin,a=0<=a?(n=(e.min.x-l.x)*a,(e.max.x-l.x)*a):(n=(e.max.x-l.x)*a,(e.min.x-l.x)*a),o=0<=o?(r=(e.min.y-l.y)*o,(e.max.y-l.y)*o):(r=(e.max.y-l.y)*o,(e.min.y-l.y)*o);return o<n||a<r?null:((o<a||a!=a)&&(a=o),(s=0<=s?(i=(e.min.z-l.z)*s,(e.max.z-l.z)*s):(i=(e.max.z-l.z)*s,(e.min.z-l.z)*s))<(n=n<r||n!=n?r:n)||a<i?null:((n<i||n!=n)&&(n=i),(a=s<a||a!=a?s:a)<0?null:this.at(0<=n?n:a,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,Vn)},intersectTriangle:function(e,t,n,r,i){Qn.subVectors(t,e),Zn.subVectors(n,e),Jn.crossVectors(Qn,Zn);n=this.direction.dot(Jn);if(0<n){if(r)return null;a=1}else{if(!(n<0))return null;a=-1,n=-n}qn.subVectors(this.origin,e);r=a*this.direction.dot(Zn.crossVectors(qn,Zn));if(r<0)return null;e=a*this.direction.dot(Qn.cross(qn));if(e<0)return null;if(n<r+e)return null;var a=-a*qn.dot(Jn);return a<0?null:this.at(a/n,i)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var $n=new Vt,er=new Vt,tr=new Vt,nr=new Vt,rr=new Vt,ir=new Vt,ar=new Vt,or=new Vt,sr=new Vt,lr=new Vt;function cr(e,t,n){this.a=void 0!==e?e:new Vt,this.b=void 0!==t?t:new Vt,this.c=void 0!==n?n:new Vt}Object.assign(cr,{getNormal:function(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Vt),r.subVectors(n,t),$n.subVectors(e,t),r.cross($n);t=r.lengthSq();return 0<t?r.multiplyScalar(1/Math.sqrt(t)):r.set(0,0,0)},getBarycoord:function(e,t,n,r,i){$n.subVectors(r,t),er.subVectors(n,t),tr.subVectors(e,t);var a=$n.dot($n),o=$n.dot(er),r=$n.dot(tr),n=er.dot(er),e=er.dot(tr),t=a*n-o*o;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Vt),0==t)return i.set(-2,-1,-1);t=1/t,n=(n*r-o*e)*t,t*=a*e-o*r;return i.set(1-n-t,t,n)},containsPoint:function(e,t,n,r){return cr.getBarycoord(e,t,n,r,nr),0<=nr.x&&0<=nr.y&&nr.x+nr.y<=1},getUV:function(e,t,n,r,i,a,o,s){return this.getBarycoord(e,t,n,r,nr),s.set(0,0),s.addScaledVector(i,nr.x),s.addScaledVector(a,nr.y),s.addScaledVector(o,nr.z),s},isFrontFacing:function(e,t,n,r){return $n.subVectors(n,t),er.subVectors(e,t),$n.cross(er).dot(r)<0}}),Object.assign(cr.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return $n.subVectors(this.c,this.b),er.subVectors(this.a,this.b),.5*$n.cross(er).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Vt),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return cr.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Vt),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return cr.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,r,i){return cr.getUV(e,this.a,this.b,this.c,t,n,r,i)},containsPoint:function(e){return cr.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return cr.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Vt);var n=this.a,r=this.b,i=this.c;rr.subVectors(r,n),ir.subVectors(i,n),or.subVectors(e,n);var a=rr.dot(or),o=ir.dot(or);if(a<=0&&o<=0)return t.copy(n);sr.subVectors(e,r);var s=rr.dot(sr),l=ir.dot(sr);if(0<=s&&l<=s)return t.copy(r);var c=a*l-s*o;if(c<=0&&0<=a&&s<=0)return h=a/(a-s),t.copy(n).addScaledVector(rr,h);lr.subVectors(e,i);var u=rr.dot(lr),e=ir.dot(lr);if(0<=e&&u<=e)return t.copy(i);a=u*o-a*e;if(a<=0&&0<=o&&e<=0)return d=o/(o-e),t.copy(n).addScaledVector(ir,d);o=s*e-u*l;if(o<=0&&0<=l-s&&0<=u-e)return ar.subVectors(i,r),d=(l-s)/(l-s+(u-e)),t.copy(r).addScaledVector(ar,d);var o=1/(o+a+c),h=a*o,d=c*o;return t.copy(n).addScaledVector(rr,h).addScaledVector(ir,d)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var ur={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},hr={h:0,s:0,l:0},dr={h:0,s:0,l:0};function pr(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}function fr(e,t,n){return n<0&&(n+=1),1<n&&--n,n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function mr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function gr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function vr(e,t,n,r,i,a){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new Vt,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new pr,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==a?a:0}Object.assign(pr.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){return e=zt.euclideanModulo(e,1),t=zt.clamp(t,0,1),n=zt.clamp(n,0,1),0===t?this.r=this.g=this.b=n:(this.r=fr(t=2*n-(n=n<=.5?n*(1+t):n+t-n*t),n,e+1/3),this.g=fr(t,n,e),this.b=fr(t,n,e-1/3)),this},setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,r=c[1],i=c[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){var a=parseFloat(n[1])/360,o=parseInt(n[2],10)/100,s=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(a,o,s)}}}else if(c=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l,c=(l=c[1]).length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return t&&0<t.length&&(void 0!==(l=ur[t])?this.setHex(l):console.warn("THREE.Color: Unknown color "+t)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){t=0<(t=void 0===t?2:t)?1/t:1;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=mr(e.r),this.g=mr(e.g),this.b=mr(e.b),this},copyLinearToSRGB:function(e){return this.r=gr(e.r),this.g=gr(e.g),this.b=gr(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n=this.r,r=this.g,i=this.b,a=Math.max(n,r,i),o=Math.min(n,r,i),s=(o+a)/2;if(o===a)c=t=0;else{var l=a-o,c=s<=.5?l/(a+o):l/(2-a-o);switch(a){case n:t=(r-i)/l+(r<i?6:0);break;case r:t=(i-n)/l+2;break;case i:t=(n-r)/l+4}t/=6}return e.h=t,e.s=c,e.l=s,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){return this.getHSL(hr),hr.h+=e,hr.s+=t,hr.l+=n,this.setHSL(hr.h,hr.s,hr.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(hr),e.getHSL(dr);var n=zt.lerp(hr.h,dr.h,t),e=zt.lerp(hr.s,dr.s,t),t=zt.lerp(hr.l,dr.l,t);return this.setHSL(n,e,t),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return this.r=e[t=void 0===t?0:t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return(e=void 0===e?[]:e)[t=void 0===t?0:t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Object.assign(vr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var yr=0;function xr(){Object.defineProperty(this,"id",{value:yr++}),this.uuid=zt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=J,this.side=q,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=s,this.opacity=1,this.transparent=!1,this.blendSrc=y,this.blendDst=x,this.blendEquation=ce,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=pe,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Dt,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Nt,this.stencilZFail=Nt,this.stencilZPass=Nt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.needsUpdate=!0}function br(e){xr.call(this),this.type="MeshBasicMaterial",this.color=new pr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=C,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}function _r(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Mr(e,t,n){_r.call(this,new Int8Array(e),t,n)}function wr(e,t,n){_r.call(this,new Uint8Array(e),t,n)}function Tr(e,t,n){_r.call(this,new Uint8ClampedArray(e),t,n)}function Sr(e,t,n){_r.call(this,new Int16Array(e),t,n)}function Er(e,t,n){_r.call(this,new Uint16Array(e),t,n)}function Ar(e,t,n){_r.call(this,new Int32Array(e),t,n)}function Cr(e,t,n){_r.call(this,new Uint32Array(e),t,n)}function Pr(e,t,n){_r.call(this,new Float32Array(e),t,n)}function Lr(e,t,n){_r.call(this,new Float64Array(e),t,n)}function Or(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Ir(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}xr.prototype=Object.assign(Object.create(kt.prototype),{constructor:xr,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n,r=e[t];void 0!==r?"shading"!==t?void 0!==(n=this[t])?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material."):(console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r):console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t,n=[];for(t in e){var r=e[t];delete r.metadata,n.push(r)}return n}return n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==J&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==q&&(n.side=this.side),this.vertexColors!==s&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),0<this.alphaTest&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t&&(t=r(e.textures),e=r(e.images),0<t.length&&(n.textures=t),0<e.length&&(n.images=e)),n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWrite=e.stencilWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,n=null;if(null!==t)for(var r=t.length,n=new Array(r),i=0;i!==r;++i)n[i]=t[i].clone();return this.clippingPlanes=n,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),((br.prototype=Object.create(xr.prototype)).constructor=br).prototype.isMeshBasicMaterial=!0,br.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.defineProperty(_r.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(_r.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new pr),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new Ht),t[n++]=a.x,t[n++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new Vt),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new Kt),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this},set:function(e,t){return this.array.set(e,t=void 0===t?0:t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),(Mr.prototype=Object.create(_r.prototype)).constructor=Mr,(wr.prototype=Object.create(_r.prototype)).constructor=wr,(Tr.prototype=Object.create(_r.prototype)).constructor=Tr,(Sr.prototype=Object.create(_r.prototype)).constructor=Sr,Er.prototype=Object.create(_r.prototype),Er.prototype.constructor=Er,(Ar.prototype=Object.create(_r.prototype)).constructor=Ar,Cr.prototype=Object.create(_r.prototype),Cr.prototype.constructor=Cr,(Pr.prototype=Object.create(_r.prototype)).constructor=Pr,(Lr.prototype=Object.create(_r.prototype)).constructor=Lr,Object.assign(Or.prototype,{computeGroups:function(e){for(var t,n=[],r=void 0,i=e.faces,a=0;a<i.length;a++){var o=i[a];o.materialIndex!==r&&(r=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,n.push(t)),t={start:3*a,materialIndex:r})}void 0!==t&&(t.count=3*a-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t=e.faces,n=e.vertices,r=e.faceVertexUvs,i=r[0]&&0<r[0].length,a=r[1]&&0<r[1].length,o=e.morphTargets,s=o.length;if(0<s){for(var l=[],c=0;c<s;c++)l[c]={name:o[c].name,data:[]};this.morphTargets.position=l}var u=e.morphNormals,h=u.length;if(0<h){for(var d=[],c=0;c<h;c++)d[c]={name:u[c].name,data:[]};this.morphTargets.normal=d}var p=e.skinIndices,f=e.skinWeights,m=p.length===n.length,g=f.length===n.length;0<n.length&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(c=0;c<t.length;c++){var v=t[c];this.vertices.push(n[v.a],n[v.b],n[v.c]);var y=v.vertexNormals;3===y.length?this.normals.push(y[0],y[1],y[2]):(b=v.normal,this.normals.push(b,b,b));var x,b=v.vertexColors;3===b.length?this.colors.push(b[0],b[1],b[2]):(b=v.color,this.colors.push(b,b,b)),!0===i&&(void 0!==(x=r[0][c])?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Ht,new Ht,new Ht))),!0===a&&(void 0!==(x=r[1][c])?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Ht,new Ht,new Ht)));for(var _=0;_<s;_++){var M=o[_].vertices;l[_].data.push(M[v.a],M[v.b],M[v.c])}for(_=0;_<h;_++){var w=u[_].vertexNormals[c];d[_].data.push(w.a,w.b,w.c)}m&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var Rr=1,Fr=new cn,Nr=new An,Dr=new Vt,kr=new Hn,Ur=new Hn,Br=new Vt;function zr(){Object.defineProperty(this,"id",{value:Rr+=2}),this.uuid=zt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}zr.prototype=Object.assign(Object.create(kt.prototype),{constructor:zr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(65535<Ir(e)?Cr:Er)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new _r(t,arguments[2])))},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);t=this.attributes.normal;void 0!==t&&((new qt).getNormalMatrix(e).applyToBufferAttribute(t),t.needsUpdate=!0);t=this.attributes.tangent;return void 0!==t&&((new qt).getNormalMatrix(e).applyToBufferAttribute(t),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Fr.makeRotationX(e),this.applyMatrix(Fr),this},rotateY:function(e){return Fr.makeRotationY(e),this.applyMatrix(Fr),this},rotateZ:function(e){return Fr.makeRotationZ(e),this.applyMatrix(Fr),this},translate:function(e,t,n){return Fr.makeTranslation(e,t,n),this.applyMatrix(Fr),this},scale:function(e,t,n){return Fr.makeScale(e,t,n),this.applyMatrix(Fr),this},lookAt:function(e){return Nr.lookAt(e),Nr.updateMatrix(),this.applyMatrix(Nr.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Dr).negate(),this.translate(Dr.x,Dr.y,Dr.z),this},setFromObject:function(e){var t,n,r=e.geometry;return e.isPoints||e.isLine?(t=new Pr(3*r.vertices.length,3),n=new Pr(3*r.colors.length,3),this.addAttribute("position",t.copyVector3sArray(r.vertices)),this.addAttribute("color",n.copyColorsArray(r.colors)),r.lineDistances&&r.lineDistances.length===r.vertices.length&&(n=new Pr(r.lineDistances.length,1),this.addAttribute("lineDistance",n.copyArray(r.lineDistances))),null!==r.boundingSphere&&(this.boundingSphere=r.boundingSphere.clone()),null!==r.boundingBox&&(this.boundingBox=r.boundingBox.clone())):e.isMesh&&r&&r.isGeometry&&this.fromGeometry(r),this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new Pr(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Or).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t,n,r,i,a=new Float32Array(3*e.vertices.length);for(r in this.addAttribute("position",new _r(a,3).copyVector3sArray(e.vertices)),0<e.normals.length&&(t=new Float32Array(3*e.normals.length),this.addAttribute("normal",new _r(t,3).copyVector3sArray(e.normals))),0<e.colors.length&&(t=new Float32Array(3*e.colors.length),this.addAttribute("color",new _r(t,3).copyColorsArray(e.colors))),0<e.uvs.length&&(n=new Float32Array(2*e.uvs.length),this.addAttribute("uv",new _r(n,2).copyVector2sArray(e.uvs))),0<e.uvs2.length&&(n=new Float32Array(2*e.uvs2.length),this.addAttribute("uv2",new _r(n,2).copyVector2sArray(e.uvs2))),this.groups=e.groups,e.morphTargets){for(var o=[],s=e.morphTargets[r],l=0,c=s.length;l<c;l++){var u=s[l],h=new Pr(3*u.data.length,3);h.name=u.name,o.push(h.copyVector3sArray(u.data))}this.morphAttributes[r]=o}return 0<e.skinIndices.length&&(i=new Pr(4*e.skinIndices.length,4),this.addAttribute("skinIndex",i.copyVector4sArray(e.skinIndices))),0<e.skinWeights.length&&(i=new Pr(4*e.skinWeights.length,4),this.addAttribute("skinWeight",i.copyVector4sArray(e.skinWeights))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Hn);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];kr.setFromBufferAttribute(i),this.boundingBox.expandByPoint(kr.min),this.boundingBox.expandByPoint(kr.max)}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Wn);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var n=this.boundingSphere.center;if(kr.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var a=t[r];Ur.setFromBufferAttribute(a),kr.expandByPoint(Ur.min),kr.expandByPoint(Ur.max)}kr.getCenter(n);for(var o=0,r=0,i=e.count;r<i;r++)Br.fromBufferAttribute(e,r),o=Math.max(o,n.distanceToSquared(Br));if(t)for(r=0,i=t.length;r<i;r++)for(var s=0,l=(a=t[r]).count;s<l;s++)Br.fromBufferAttribute(a,s),o=Math.max(o,n.distanceToSquared(Br));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new _r(new Float32Array(n.length),3));else for(var r=t.normal.array,i=0,a=r.length;i<a;i++)r[i]=0;var o,s,l,c=t.normal.array,u=new Vt,h=new Vt,d=new Vt,p=new Vt,f=new Vt;if(e)for(var m=e.array,i=0,a=e.count;i<a;i+=3)o=3*m[i+0],s=3*m[i+1],l=3*m[i+2],u.fromArray(n,o),h.fromArray(n,s),d.fromArray(n,l),p.subVectors(d,h),f.subVectors(u,h),p.cross(f),c[o]+=p.x,c[1+o]+=p.y,c[2+o]+=p.z,c[s]+=p.x,c[1+s]+=p.y,c[2+s]+=p.z,c[l]+=p.x,c[1+l]+=p.y,c[2+l]+=p.z;else for(i=0,a=n.length;i<a;i+=9)u.fromArray(n,i),h.fromArray(n,i+3),d.fromArray(n,i+6),p.subVectors(d,h),f.subVectors(u,h),p.cross(f),c[i]=p.x,c[i+1]=p.y,c[i+2]=p.z,c[i+3]=p.x,c[i+4]=p.y,c[i+5]=p.z,c[i+6]=p.x,c[i+7]=p.y,c[i+8]=p.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n,r=this.attributes;for(n in r)if(void 0!==e.attributes[n])for(var i=r[n].array,a=e.attributes[n],o=a.array,a=a.itemSize*t,s=Math.min(o.length,i.length-a),l=0,c=a;l<s;l++,c++)i[c]=o[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)Br.x=e.getX(t),Br.y=e.getY(t),Br.z=e.getZ(t),Br.normalize(),e.setXYZ(t,Br.x,Br.y,Br.z)},toNonIndexed:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=new n.constructor(t.length*r),a=0,o=0,s=0,l=t.length;s<l;s++)for(var a=t[s]*r,c=0;c<r;c++)i[o++]=n[a++];return new _r(i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t,n=new zr,r=this.index.array,i=this.attributes;for(t in i){var a=e(i[t],r);n.addAttribute(t,a)}var o=this.morphAttributes;for(t in o){for(var s=[],l=o[t],c=0,u=l.length;c<u;c++){a=e(l[c],r);s.push(a)}n.morphAttributes[t]=s}for(var h=this.groups,c=0,d=h.length;c<d;c++){var p=h[c];n.addGroup(p.start,p.count,p.materialIndex)}return n},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),0<Object.keys(this.userData).length&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(a in t)void 0!==t[a]&&(e[a]=t[a]);return e}e.data={attributes:{}};var n=this.index;null!==n&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var r=this.attributes;for(a in r){var i=(d=r[a]).toJSON();""!==d.name&&(i.name=d.name),e.data.attributes[a]=i}var a,o={},s=!1;for(a in this.morphAttributes){for(var l=this.morphAttributes[a],c=[],u=0,h=l.length;u<h;u++){var d,i=(d=l[u]).toJSON();""!==d.name&&(i.name=d.name),c.push(i)}0<c.length&&(o[a]=c,s=!0)}s&&(e.data.morphAttributes=o);n=this.groups;0<n.length&&(e.data.groups=JSON.parse(JSON.stringify(n)));n=this.boundingSphere;return null!==n&&(e.data.boundingSphere={center:n.center.toArray(),radius:n.radius}),e},clone:function(){return(new zr).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var t=e.index;null!==t&&this.setIndex(t.clone());var n=e.attributes;for(var r in n){var i=n[r];this.addAttribute(r,i.clone())}var a=e.morphAttributes;for(r in a){for(var o=[],s=a[r],l=0,c=s.length;l<c;l++)o.push(s[l].clone());this.morphAttributes[r]=o}var u=e.groups;for(l=0,c=u.length;l<c;l++){var h=u[l];this.addGroup(h.start,h.count,h.materialIndex)}t=e.boundingBox;null!==t&&(this.boundingBox=t.clone());t=e.boundingSphere;return null!==t&&(this.boundingSphere=t.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Hr=new cn,Gr=new Kn,jr=new Wn,Wr=new Vt,Vr=new Vt,Xr=new Vt,Yr=new Vt,qr=new Vt,Qr=new Vt,Zr=new Vt,Jr=new Vt,Kr=new Vt,$r=new Ht,ei=new Ht,ti=new Ht,ni=new Vt,ri=new Vt;function ii(e,t){An.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new zr,this.material=void 0!==t?t:new br({color:16777215*Math.random()}),this.drawMode=Mt,this.updateMorphTargets()}function ai(e,t,n,r,i,a,o,s){t=t.side===Me?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,t.side!==Q,s);if(null===t)return null;ri.copy(s),ri.applyMatrix4(e.matrixWorld);s=n.ray.origin.distanceTo(ri);return s<n.near||s>n.far?null:{distance:s,point:ri.clone(),object:e}}function oi(e,t,n,r,i,a,o,s,l,c,u){Wr.fromBufferAttribute(i,l),Vr.fromBufferAttribute(i,c),Xr.fromBufferAttribute(i,u);var h=e.morphTargetInfluences;if(t.morphTargets&&a&&h){Zr.set(0,0,0),Jr.set(0,0,0),Kr.set(0,0,0);for(var d=0,p=a.length;d<p;d++){var f=h[d],m=a[d];0!==f&&(Yr.fromBufferAttribute(m,l),qr.fromBufferAttribute(m,c),Qr.fromBufferAttribute(m,u),Zr.addScaledVector(Yr.sub(Wr),f),Jr.addScaledVector(qr.sub(Vr),f),Kr.addScaledVector(Qr.sub(Xr),f))}Wr.add(Zr),Vr.add(Jr),Xr.add(Kr)}r=ai(e,t,n,r,Wr,Vr,Xr,ni);return r&&(o&&($r.fromBufferAttribute(o,l),ei.fromBufferAttribute(o,c),ti.fromBufferAttribute(o,u),r.uv=cr.getUV(ni,Wr,Vr,Xr,$r,ei,ti,new Ht)),s&&($r.fromBufferAttribute(s,l),ei.fromBufferAttribute(s,c),ti.fromBufferAttribute(s,u),r.uv2=cr.getUV(ni,Wr,Vr,Xr,$r,ei,ti,new Ht)),s=new vr(l,c,u),cr.getNormal(Wr,Vr,Xr,s.normal),r.face=s),r}ii.prototype=Object.assign(Object.create(An.prototype),{constructor:ii,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return An.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,a=Object.keys(i);if(0<a.length){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{r=r.morphTargets;void 0!==r&&0<r.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),jr.copy(n.boundingSphere),jr.applyMatrix4(i),!1!==e.ray.intersectsSphere(jr)&&(Hr.getInverse(i),Gr.copy(e.ray).applyMatrix4(Hr),null===n.boundingBox||!1!==Gr.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var a,o,s,l,c,u,h,d,p,f=n.index,m=n.attributes.position,g=n.morphAttributes.position,v=n.attributes.uv,y=n.attributes.uv2,x=n.groups,b=n.drawRange;if(null!==f)if(Array.isArray(r))for(l=0,u=x.length;l<u;l++)for(p=r[(d=x[l]).materialIndex],c=Math.max(d.start,b.start),h=Math.min(d.start+d.count,b.start+b.count);c<h;c+=3)a=f.getX(c),o=f.getX(c+1),s=f.getX(c+2),(L=oi(this,p,e,Gr,m,g,v,y,a,o,s))&&(L.faceIndex=Math.floor(c/3),L.face.materialIndex=d.materialIndex,t.push(L));else for(l=Math.max(0,b.start),u=Math.min(f.count,b.start+b.count);l<u;l+=3)a=f.getX(l),o=f.getX(l+1),s=f.getX(l+2),(L=oi(this,r,e,Gr,m,g,v,y,a,o,s))&&(L.faceIndex=Math.floor(l/3),t.push(L));else if(void 0!==m)if(Array.isArray(r))for(l=0,u=x.length;l<u;l++)for(p=r[(d=x[l]).materialIndex],c=Math.max(d.start,b.start),h=Math.min(d.start+d.count,b.start+b.count);c<h;c+=3)(L=oi(this,p,e,Gr,m,g,v,y,a=c,o=c+1,s=c+2))&&(L.faceIndex=Math.floor(c/3),L.face.materialIndex=d.materialIndex,t.push(L));else for(l=Math.max(0,b.start),u=Math.min(m.count,b.start+b.count);l<u;l+=3)(L=oi(this,r,e,Gr,m,g,v,y,a=l,o=l+1,s=l+2))&&(L.faceIndex=Math.floor(l/3),t.push(L))}else if(n.isGeometry){var _,M=Array.isArray(r),w=n.vertices,T=n.faces,n=n.faceVertexUvs[0];0<n.length&&(_=n);for(var S=0,E=T.length;S<E;S++){var A,C,P,L,O=T[S],I=M?r[O.materialIndex]:r;void 0!==I&&(A=w[O.a],C=w[O.b],P=w[O.c],(L=ai(this,I,e,Gr,A,C,P,ni))&&(_&&_[S]&&(I=_[S],$r.copy(I[0]),ei.copy(I[1]),ti.copy(I[2]),L.uv=cr.getUV(ni,A,C,P,$r,ei,ti,new Ht)),L.face=O,L.faceIndex=S,t.push(L)))}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var si=0,li=new cn,ci=new An,ui=new Vt;function hi(){Object.defineProperty(this,"id",{value:si+=2}),this.uuid=zt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}hi.prototype=Object.assign(Object.create(kt.prototype),{constructor:hi,isGeometry:!0,applyMatrix:function(e){for(var t=(new qt).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(e);for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(t).normalize();for(var a=0,o=i.vertexNormals.length;a<o;a++)i.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return li.makeRotationX(e),this.applyMatrix(li),this},rotateY:function(e){return li.makeRotationY(e),this.applyMatrix(li),this},rotateZ:function(e){return li.makeRotationZ(e),this.applyMatrix(li),this},translate:function(e,t,n){return li.makeTranslation(e,t,n),this.applyMatrix(li),this},scale:function(e,t,n){return li.makeScale(e,t,n),this.applyMatrix(li),this},lookAt:function(e){return ci.lookAt(e),ci.updateMatrix(),this.applyMatrix(ci.matrix),this},fromBufferGeometry:function(e){var a=this,t=null!==e.index?e.index.array:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var r=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,l=void 0!==n.uv?n.uv.array:void 0,c=void 0!==n.uv2?n.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var i=0;i<r.length;i+=3)a.vertices.push((new Vt).fromArray(r,i)),void 0!==s&&a.colors.push((new pr).fromArray(s,i));function u(e,t,n,r){var i=void 0===s?[]:[a.colors[e].clone(),a.colors[t].clone(),a.colors[n].clone()],r=new vr(e,t,n,void 0===o?[]:[(new Vt).fromArray(o,3*e),(new Vt).fromArray(o,3*t),(new Vt).fromArray(o,3*n)],i,r);a.faces.push(r),void 0!==l&&a.faceVertexUvs[0].push([(new Ht).fromArray(l,2*e),(new Ht).fromArray(l,2*t),(new Ht).fromArray(l,2*n)]),void 0!==c&&a.faceVertexUvs[1].push([(new Ht).fromArray(c,2*e),(new Ht).fromArray(c,2*t),(new Ht).fromArray(c,2*n)])}var h=e.groups;if(0<h.length)for(i=0;i<h.length;i++)for(var d=h[i],p=d.start,f=p,m=p+d.count;f<m;f+=3)void 0!==t?u(t[f],t[f+1],t[f+2],d.materialIndex):u(f,f+1,f+2,d.materialIndex);else if(void 0!==t)for(i=0;i<t.length;i+=3)u(t[i],t[i+1],t[i+2]);else for(i=0;i<r.length/3;i+=3)u(i,i+1,i+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ui).negate(),this.translate(ui.x,ui.y,ui.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,t=new cn;return t.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(t),this},computeFaceNormals:function(){for(var e=new Vt,t=new Vt,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r;for(void 0===e&&(e=!0),r=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)r[t]=new Vt;if(e)for(var i,a,o,s=new Vt,l=new Vt,c=0,u=this.faces.length;c<u;c++)h=this.faces[c],i=this.vertices[h.a],a=this.vertices[h.b],o=this.vertices[h.c],s.subVectors(o,a),l.subVectors(i,a),s.cross(l),r[h.a].add(s),r[h.b].add(s),r[h.c].add(s);else for(this.computeFaceNormals(),c=0,u=this.faces.length;c<u;c++)r[(h=this.faces[c]).a].add(h.normal),r[h.b].add(h.normal),r[h.c].add(h.normal);for(t=0,n=this.vertices.length;t<n;t++)r[t].normalize();for(c=0,u=this.faces.length;c<u;c++){var h,d=(h=this.faces[c]).vertexNormals;3===d.length?(d[0].copy(r[h.a]),d[1].copy(r[h.b]),d[2].copy(r[h.c])):(d[0]=r[h.a].clone(),d[1]=r[h.b].clone(),d[2]=r[h.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n,r=(n=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n;for(o=0,s=this.faces.length;o<s;o++)for((n=this.faces[o]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var r=new hi;for(r.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];for(var i=this.morphNormals[e].faceNormals,a=this.morphNormals[e].vertexNormals,o=0,s=this.faces.length;o<s;o++)l=new Vt,c={a:new Vt,b:new Vt,c:new Vt},i.push(l),a.push(c)}var l,c,u=this.morphNormals[e];for(r.vertices=this.morphTargets[e].vertices,r.computeFaceNormals(),r.computeVertexNormals(),o=0,s=this.faces.length;o<s;o++)n=this.faces[o],l=u.faceNormals[o],c=u.vertexNormals[o],l.copy(n.normal),c.a.copy(n.vertexNormals[0]),c.b.copy(n.vertexNormals[1]),c.c.copy(n.vertexNormals[2])}for(o=0,s=this.faces.length;o<s;o++)(n=this.faces[o]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Hn),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Wn),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var r,i=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,c=this.colors,u=e.colors;void 0===n&&(n=0),void 0!==t&&(r=(new qt).getNormalMatrix(t));for(var h=0,d=o.length;h<d;h++){var p=o[h].clone();void 0!==t&&p.applyMatrix4(t),a.push(p)}for(h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(h=0,d=l.length;h<d;h++){var f,m,g=l[h],v=g.vertexNormals,y=g.vertexColors,x=new vr(g.a+i,g.b+i,g.c+i);x.normal.copy(g.normal),void 0!==r&&x.normal.applyMatrix3(r).normalize();for(var b=0,_=v.length;b<_;b++)f=v[b].clone(),void 0!==r&&f.applyMatrix3(r).normalize(),x.vertexNormals.push(f);x.color.copy(g.color);for(b=0,_=y.length;b<_;b++)m=y[b],x.vertexColors.push(m.clone());x.materialIndex=g.materialIndex+n,s.push(x)}for(h=0,d=e.faceVertexUvs.length;h<d;h++){var M=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(b=0,_=M.length;b<_;b++){for(var w=M[b],T=[],S=0,E=w.length;S<E;S++)T.push(w[S].clone());this.faceVertexUvs[h].push(T)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){for(var e,t,n,r,i={},a=[],o=[],s=Math.pow(10,4),l=0,c=this.vertices.length;l<c;l++)e=this.vertices[l],void 0===i[e=Math.round(e.x*s)+"_"+Math.round(e.y*s)+"_"+Math.round(e.z*s)]?(i[e]=l,a.push(this.vertices[l]),o[l]=a.length-1):o[l]=o[i[e]];var u=[];for(l=0,c=this.faces.length;l<c;l++){(t=this.faces[l]).a=o[t.a],t.b=o[t.b],t.c=o[t.c];for(var h=[t.a,t.b,t.c],d=0;d<3;d++)if(h[d]===h[(d+1)%3]){u.push(l);break}}for(l=u.length-1;0<=l;l--){var p=u[l];for(this.faces.splice(p,1),n=0,r=this.faceVertexUvs.length;n<r;n++)this.faceVertexUvs[n].splice(p,1)}var f=this.vertices.length-a.length;return this.vertices=a,f},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new Vt(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var r,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(r=[]),o&&o.length===t&&(i=[]);for(n=0;n<t;n++){var s=e[n]._id;r&&r.push(a[s]),i&&i.push(o[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t,n=this.parameters;for(t in n)void 0!==n[t]&&(e[t]=n[t]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];r.push(a.x,a.y,a.z)}for(var o=[],s=[],l={},c=[],u={},h=[],d={},i=0;i<this.faces.length;i++){var p,f=this.faces[i],m=void 0!==this.faceVertexUvs[0][i],g=0<f.normal.length(),v=0<f.vertexNormals.length,y=1!==f.color.r||1!==f.color.g||1!==f.color.b,x=0<f.vertexColors.length;p=b(2,3,m),p=b(p,4,g),p=b(p,5,v),p=b(p,6,y),p=b(p,7,x),o.push(p),o.push(f.a,f.b,f.c),o.push(f.materialIndex),m&&(m=this.faceVertexUvs[0][i],o.push(w(m[0]),w(m[1]),w(m[2]))),g&&o.push(_(f.normal)),v&&(v=f.vertexNormals,o.push(_(v[0]),_(v[1]),_(v[2]))),y&&o.push(M(f.color)),x&&(f=f.vertexColors,o.push(M(f[0]),M(f[1]),M(f[2])))}function b(e,t,n){return n?e|1<<t:e&~(1<<t)}function _(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function M(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]||(u[t]=c.length,c.push(e.getHex())),u[t]}function w(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=h.length/2,h.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=r,e.data.normals=s,0<c.length&&(e.data.colors=c),0<h.length&&(e.data.uvs=[h]),e.data.faces=o,e},clone:function(){return(new hi).copy(this)},copy:function(e){var t,n;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;for(var r=e.vertices,i=0,a=r.length;i<a;i++)this.vertices.push(r[i].clone());var o=e.colors;for(i=0,a=o.length;i<a;i++)this.colors.push(o[i].clone());var s=e.faces;for(i=0,a=s.length;i<a;i++)this.faces.push(s[i].clone());for(i=0,a=e.faceVertexUvs.length;i<a;i++){var l=e.faceVertexUvs[i];for(void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]),t=0,n=l.length;t<n;t++){for(var c=l[t],u=[],h=0,d=c.length;h<d;h++){var p=c[h];u.push(p.clone())}this.faceVertexUvs[i].push(u)}}var f=e.morphTargets;for(i=0,a=f.length;i<a;i++){var m={};if(m.name=f[i].name,void 0!==f[i].vertices)for(m.vertices=[],t=0,n=f[i].vertices.length;t<n;t++)m.vertices.push(f[i].vertices[t].clone());if(void 0!==f[i].normals)for(m.normals=[],t=0,n=f[i].normals.length;t<n;t++)m.normals.push(f[i].normals[t].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(i=0,a=g.length;i<a;i++){var v={};if(void 0!==g[i].vertexNormals)for(v.vertexNormals=[],t=0,n=g[i].vertexNormals.length;t<n;t++){var y=g[i].vertexNormals[t],x={};x.a=y.a.clone(),x.b=y.b.clone(),x.c=y.c.clone(),v.vertexNormals.push(x)}if(void 0!==g[i].faceNormals)for(v.faceNormals=[],t=0,n=g[i].faceNormals.length;t<n;t++)v.faceNormals.push(g[i].faceNormals[t].clone());this.morphNormals.push(v)}var b=e.skinWeights;for(i=0,a=b.length;i<a;i++)this.skinWeights.push(b[i].clone());var _=e.skinIndices;for(i=0,a=_.length;i<a;i++)this.skinIndices.push(_[i].clone());var M=e.lineDistances;for(i=0,a=M.length;i<a;i++)this.lineDistances.push(M[i]);var w=e.boundingBox;null!==w&&(this.boundingBox=w.clone());w=e.boundingSphere;return null!==w&&(this.boundingSphere=w.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var di=function(){t(l,hi);var s=o(l);function l(e,t,n,r,i,a){var o;return d(this,l),(o=s.call(this)).type="BoxGeometry",o.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a},o.fromBufferGeometry(new pi(e,t,n,r,i,a)),o.mergeVertices(),o}return l}(),pi=function(){t(c,zr);var l=o(c);function c(e,t,n,r,i,a){var o;d(this,c),(o=l.call(this)).type="BoxBufferGeometry",o.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};var A=u(o);e=e||1,t=t||1,n=n||1,r=Math.floor(r)||1,i=Math.floor(i)||1,a=Math.floor(a)||1;var C=[],P=[],L=[],O=[],I=0,R=0;function s(e,t,n,r,i,a,o,s,l,c,u){for(var h=a/l,d=o/c,p=a/2,f=o/2,m=s/2,g=l+1,v=c+1,y=0,x=0,b=new Vt,_=0;_<v;_++)for(var M=_*d-f,w=0;w<g;w++)b[e]=(w*h-p)*r,b[t]=M*i,b[n]=m,P.push(b.x,b.y,b.z),b[e]=0,b[t]=0,b[n]=0<s?1:-1,L.push(b.x,b.y,b.z),O.push(w/l),O.push(1-_/c),y+=1;for(_=0;_<c;_++)for(w=0;w<l;w++){var T=I+w+g*(_+1),S=I+(w+1)+g*(_+1),E=I+(w+1)+g*_;C.push(I+w+g*_,T,E),C.push(T,S,E),x+=6}A.addGroup(R,x,u),R+=x,I+=y}return s("z","y","x",-1,-1,n,t,e,a,i,0),s("z","y","x",1,-1,n,t,-e,a,i,1),s("x","z","y",1,1,e,n,t,r,a,2),s("x","z","y",1,-1,e,n,-t,r,a,3),s("x","y","z",1,-1,e,t,n,r,i,4),s("x","y","z",-1,-1,e,t,-n,r,i,5),o.setIndex(C),o.addAttribute("position",new Pr(P,3)),o.addAttribute("normal",new Pr(L,3)),o.addAttribute("uv",new Pr(O,2)),o}return c}();function fi(e){var t,n={};for(t in e)for(var r in n[t]={},e[t]){var i=e[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?n[t][r]=i.clone():Array.isArray(i)?n[t][r]=i.slice():n[t][r]=i}return n}function mi(e){for(var t={},n=0;n<e.length;n++){var r,i=fi(e[n]);for(r in i)t[r]=i[r]}return t}var gi={clone:fi,merge:mi},vi="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",yi="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function xi(e){xr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=vi,this.fragmentShader=yi,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function bi(){An.call(this),this.type="Camera",this.matrixWorldInverse=new cn,this.projectionMatrix=new cn,this.projectionMatrixInverse=new cn}function _i(e,t,n,r){bi.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}((xi.prototype=Object.create(xr.prototype)).constructor=xi).prototype.isShaderMaterial=!0,xi.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=fi(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},xi.prototype.toJSON=function(e){var t,n=xr.prototype.toJSON.call(this,e);for(t in n.uniforms={},this.uniforms){var r=this.uniforms[t].value;r&&r.isTexture?n.uniforms[t]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?n.uniforms[t]={type:"c",value:r.getHex()}:r&&r.isVector2?n.uniforms[t]={type:"v2",value:r.toArray()}:r&&r.isVector3?n.uniforms[t]={type:"v3",value:r.toArray()}:r&&r.isVector4?n.uniforms[t]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?n.uniforms[t]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?n.uniforms[t]={type:"m4",value:r.toArray()}:n.uniforms[t]={value:r}}0<Object.keys(this.defines).length&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader;var i,a={};for(i in this.extensions)!0===this.extensions[i]&&(a[i]=!0);return 0<Object.keys(a).length&&(n.extensions=a),n},bi.prototype=Object.assign(Object.create(An.prototype),{constructor:bi,isCamera:!0,copy:function(e,t){return An.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){An.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),_i.prototype=Object.assign(Object.create(bi.prototype),{constructor:_i,isPerspectiveCamera:!0,copy:function(e,t){return bi.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){e=.5*this.getFilmHeight()/e;this.fov=2*zt.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*zt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*zt.RAD2DEG*Math.atan(Math.tan(.5*zt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e,t=this.near,n=t*Math.tan(.5*zt.DEG2RAD*this.fov)/this.zoom,r=2*n,i=this.aspect*r,a=-.5*i,o=this.view;null!==this.view&&this.view.enabled&&(e=o.fullWidth,s=o.fullHeight,a+=o.offsetX*i/e,n-=o.offsetY*r/s,i*=o.width/e,r*=o.height/s);var s=this.filmOffset;0!==s&&(a+=t*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+i,n,n-r,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){e=An.prototype.toJSON.call(this,e);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});function Mi(e,t,n,r){An.call(this),this.type="CubeCamera";var a=new _i(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new Vt(1,0,0)),this.add(a);var o=new _i(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new Vt(-1,0,0)),this.add(o);var s=new _i(90,1,e,t);s.up.set(0,0,1),s.lookAt(new Vt(0,1,0)),this.add(s);var l=new _i(90,1,e,t);l.up.set(0,0,-1),l.lookAt(new Vt(0,-1,0)),this.add(l);var c=new _i(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new Vt(0,0,1)),this.add(c);var u=new _i(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new Vt(0,0,-1)),this.add(u),this.renderTarget=new wi(n,n,r=r||{format:He,magFilter:Ae,minFilter:Ae}),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=e.getRenderTarget(),r=this.renderTarget,i=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,a),e.setRenderTarget(r,1),e.render(t,o),e.setRenderTarget(r,2),e.render(t,s),e.setRenderTarget(r,3),e.render(t,l),e.setRenderTarget(r,4),e.render(t,c),r.texture.generateMipmaps=i,e.setRenderTarget(r,5),e.render(t,u),e.setRenderTarget(n)},this.clear=function(e,t,n,r){for(var i=e.getRenderTarget(),a=this.renderTarget,o=0;o<6;o++)e.setRenderTarget(a,o),e.clear(t,n,r);e.setRenderTarget(i)}}function wi(e,t,n){$t.call(this,e,t,n)}function Ti(e,t,n,r,i,a,o,s,l,c,u,h){Jt.call(this,null,a,o,s,l,c,r,i,u,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:Te,this.minFilter=void 0!==c?c:Te,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}(Mi.prototype=Object.create(An.prototype)).constructor=Mi,((wi.prototype=Object.create($t.prototype)).constructor=wi).prototype.isWebGLRenderTargetCube=!0,wi.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var n=new Cn,r={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},r=new xi({type:"CubemapFromEquirect",uniforms:fi(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Me,blending:Z});r.uniforms.tEquirect.value=t;t=new ii(new pi(5,5,5),r);n.add(t);r=new Mi(1,10,1);return r.renderTarget=this,r.renderTarget.texture.name="CubeCameraTexture",r.update(e,n),t.geometry.dispose(),t.material.dispose(),this},((Ti.prototype=Object.create(Jt.prototype)).constructor=Ti).prototype.isDataTexture=!0;var Si=new Vt,Ei=new Vt,Ai=new qt;function Ci(e,t){this.normal=void 0!==e?e:new Vt(1,0,0),this.constant=void 0!==t?t:0}Object.assign(Ci.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,n){t=Si.subVectors(n,t).cross(Ei.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(t,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Vt),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Vt);var n=e.delta(Si),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;r=-(e.start.dot(this.normal)+this.constant)/r;return r<0||1<r?void 0:t.copy(n).multiplyScalar(r).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return t<0&&0<e||e<0&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Vt),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){t=t||Ai.getNormalMatrix(e),e=this.coplanarPoint(Si).applyMatrix4(e),t=this.normal.applyMatrix3(t).normalize();return this.constant=-e.dot(t),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var Pi=new Wn,Li=new Vt;function Oi(e,t,n,r,i,a){this.planes=[void 0!==e?e:new Ci,void 0!==t?t:new Ci,void 0!==n?n:new Ci,void 0!==r?r:new Ci,void 0!==i?i:new Ci,void 0!==a?a:new Ci]}Object.assign(Oi.prototype,{set:function(e,t,n,r,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],e=n[14],n=n[15];return t[0].setComponents(o-r,u-s,f-h,n-m).normalize(),t[1].setComponents(o+r,u+s,f+h,n+m).normalize(),t[2].setComponents(o+i,u+l,f+d,n+g).normalize(),t[3].setComponents(o-i,u-l,f-d,n-g).normalize(),t[4].setComponents(o-a,u-c,f-p,n-e).normalize(),t[5].setComponents(o+a,u+c,f+p,n+e).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Pi.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Pi)},intersectsSprite:function(e){return Pi.center.set(0,0,0),Pi.radius=.7071067811865476,Pi.applyMatrix4(e.matrixWorld),this.intersectsSphere(Pi)},intersectsSphere:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++)if(t[i].distanceToPoint(n)<r)return!1;return!0},intersectsBox:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(Li.x=(0<r.normal.x?e.max:e.min).x,Li.y=(0<r.normal.y?e.max:e.min).y,Li.z=(0<r.normal.z?e.max:e.min).z,r.distanceToPoint(Li)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});var Ii={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = clamp( clearcoatRoughness, 0.04, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 1.0 ? log2( vFragDepth ) * logDepthBufFC * 0.5 : gl_FragCoord.z;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 normalBKColor = vec3(128.0/255.0,128.0/255.0,1.0);\n\tvec4 normalColor1 = texture2D(normalMap,vUv);\n\t#ifdef NORMALMAP2\n\tvec4 normalColor2 = texture2D(normalMap2,vUv);\n\t#endif\n\t#ifdef NORMALMAP3\n\tvec4 normalColor3 = texture2D(normalMap3,vUv);\n\t#endif\n\t#ifdef NORMALMAP4\n\tvec4 normalColor4 = texture2D(normalMap4,vUv);\n\t#endif\n\t#ifdef NORMALMAP5\n\tvec4 normalColor5 = texture2D(normalMap5,vUv);\n\t#endif\n\tif(normalColor1.a < 0.01)\n\t{\n\t\tnormalColor1.rgb = normalBKColor;\n\t}\n\tvec4 normalColor = normalColor1;\n\t#ifdef NORMALMAP2\n\tif(normalColor2.a > 0.01)\n\t{\n\t\tnormalColor = normalColor2;\n\t}\n\t#endif\n\t#ifdef NORMALMAP3\t\n\tif(normalColor3.a > 0.01)\n\t{\n\t\tnormalColor = normalColor3;\n\t}\n\t#endif\n\t#ifdef NORMALMAP4\n\tif(normalColor4.a > 0.01)\n\t{\n\t\tnormalColor = normalColor4;\n\t}\n\t#endif\n\t#ifdef NORMALMAP5\n\tif(normalColor5.a > 0.01)\n\t{\n\t\tnormalColor = normalColor5;\n\t}\n\t#endif\n\t\t\n\tvec3 mapN = normalize(normalColor.rgb * 2.0 - 1.0);\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2ArbMultiNormalmaps( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef NORMALMAP2\n\tuniform sampler2D normalMap2;\n\t#endif\n\t#ifdef NORMALMAP3\n\tuniform sampler2D normalMap3;\n\t#endif\n\t#ifdef NORMALMAP4\n\tuniform sampler2D normalMap4;\n\t#endif\n\t#ifdef NORMALMAP5\n\tuniform sampler2D normalMap5;\n    #endif\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\t\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 normalScale, in sampler2D normalMap ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy *= normalScale;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tbool frontFacing = dot( cross( S, T ), N ) > 0.0;\n\t\t\tmapN.xy *= ( float( frontFacing ) * 2.0 - 1.0 );\n\t\t#else\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n\tvec3 perturbNormal2ArbMultiNormalmaps( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 vTBN = mat3( tangent, bitangent, clearcoatNormal );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = clearcoatNormalScale * mapN.xy;\n\t\tclearcoatNormal = normalize( vTBN * mapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatNormalScale, clearcoatNormalMap );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 encodeHalfRGBA ( vec2 v ) {\n\tvec4 encoded = vec4( 0.0 );\n\tconst vec2 offset = vec2( 1.0 / 255.0, 0.0 );\n\tencoded.xy = vec2( v.x, fract( v.x * 255.0 ) );\n\tencoded.xy = encoded.xy - ( encoded.yy * offset );\n\tencoded.zw = vec2( v.y, fract( v.y * 255.0 ) );\n\tencoded.zw = encoded.zw - ( encoded.ww * offset );\n\treturn encoded;\n}\nvec2 decodeHalfRGBA( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn decodeHalfRGBA( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Ri={common:{diffuse:{value:new pr(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new qt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ht(1,1)}},normalmap2:{normalMap2:{value:null}},normalmap3:{normalMap3:{value:null}},normalmap4:{normalMap4:{value:null}},normalmap5:{normalMap5:{value:null}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new pr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new pr(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new qt}},sprite:{diffuse:{value:new pr(15658734)},opacity:{value:1},center:{value:new Ht(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new qt}}},Fi={basic:{uniforms:mi([Ri.common,Ri.specularmap,Ri.envmap,Ri.aomap,Ri.lightmap,Ri.fog]),vertexShader:Ii.meshbasic_vert,fragmentShader:Ii.meshbasic_frag},lambert:{uniforms:mi([Ri.common,Ri.specularmap,Ri.envmap,Ri.aomap,Ri.lightmap,Ri.emissivemap,Ri.fog,Ri.lights,{emissive:{value:new pr(0)}}]),vertexShader:Ii.meshlambert_vert,fragmentShader:Ii.meshlambert_frag},phong:{uniforms:mi([Ri.common,Ri.specularmap,Ri.envmap,Ri.aomap,Ri.lightmap,Ri.emissivemap,Ri.bumpmap,Ri.normalmap,Ri.displacementmap,Ri.gradientmap,Ri.fog,Ri.lights,{emissive:{value:new pr(0)},specular:{value:new pr(1118481)},shininess:{value:30}}]),vertexShader:Ii.meshphong_vert,fragmentShader:Ii.meshphong_frag},standard:{uniforms:mi([Ri.common,Ri.envmap,Ri.aomap,Ri.lightmap,Ri.emissivemap,Ri.bumpmap,Ri.normalmap,Ri.normalmap2,Ri.normalmap3,Ri.normalmap4,Ri.normalmap5,Ri.displacementmap,Ri.roughnessmap,Ri.metalnessmap,Ri.fog,Ri.lights,{emissive:{value:new pr(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Ii.meshphysical_vert,fragmentShader:Ii.meshphysical_frag},matcap:{uniforms:mi([Ri.common,Ri.bumpmap,Ri.normalmap,Ri.displacementmap,Ri.fog,{matcap:{value:null}}]),vertexShader:Ii.meshmatcap_vert,fragmentShader:Ii.meshmatcap_frag},points:{uniforms:mi([Ri.points,Ri.fog]),vertexShader:Ii.points_vert,fragmentShader:Ii.points_frag},dashed:{uniforms:mi([Ri.common,Ri.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ii.linedashed_vert,fragmentShader:Ii.linedashed_frag},depth:{uniforms:mi([Ri.common,Ri.displacementmap]),vertexShader:Ii.depth_vert,fragmentShader:Ii.depth_frag},normal:{uniforms:mi([Ri.common,Ri.bumpmap,Ri.normalmap,Ri.displacementmap,{opacity:{value:1}}]),vertexShader:Ii.normal_vert,fragmentShader:Ii.normal_frag},sprite:{uniforms:mi([Ri.sprite,Ri.fog]),vertexShader:Ii.sprite_vert,fragmentShader:Ii.sprite_frag},background:{uniforms:{uvTransform:{value:new qt},t2D:{value:null}},vertexShader:Ii.background_vert,fragmentShader:Ii.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ii.cube_vert,fragmentShader:Ii.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ii.equirect_vert,fragmentShader:Ii.equirect_frag},distanceRGBA:{uniforms:mi([Ri.common,Ri.displacementmap,{referencePosition:{value:new Vt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ii.distanceRGBA_vert,fragmentShader:Ii.distanceRGBA_frag},shadow:{uniforms:mi([Ri.lights,Ri.fog,{color:{value:new pr(0)},opacity:{value:1}}]),vertexShader:Ii.shadow_vert,fragmentShader:Ii.shadow_frag}};function Ni(){var n=null,r=!1,i=null;function a(e,t){!1!==r&&(i(e,t),n.requestAnimationFrame(a))}return{start:function(){!0!==r&&null!==i&&(n.requestAnimationFrame(a),r=!0)},stop:function(){r=!1},setAnimationLoop:function(e){i=e},setContext:function(e){n=e}}}function Di(l){var c=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),c.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=c.get(e);t&&(l.deleteBuffer(t.buffer),c.delete(e))},update:function(e,t){e.isInterleavedBufferAttribute&&(e=e.data);var n,r,i,a,o,s=c.get(e);void 0===s?c.set(e,(r=t,i=(n=e).array,a=n.dynamic?35048:35044,o=l.createBuffer(),l.bindBuffer(r,o),l.bufferData(r,i,a),n.onUploadCallback(),a=5126,i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:n.version})):s.version<e.version&&(o=s.buffer,a=t,n=(i=e).array,t=i.updateRange,l.bindBuffer(a,o),!1===i.dynamic?l.bufferData(a,n,35044):-1===t.count?l.bufferSubData(a,0,n):0===t.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(l.bufferSubData(a,t.offset*n.BYTES_PER_ELEMENT,n.subarray(t.offset,t.offset+t.count)),t.count=-1),s.version=e.version)}}}function ki(e,t,n,r){hi.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new Ui(e,t,n,r)),this.mergeVertices()}function Ui(e,t,n,r){zr.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};for(var i=(e=e||1)/2,a=(t=t||1)/2,o=Math.floor(n)||1,s=Math.floor(r)||1,l=o+1,c=s+1,u=e/o,h=t/s,d=[],p=[],f=[],m=[],g=0;g<c;g++)for(var v=g*h-a,y=0;y<l;y++)p.push(y*u-i,-v,0),f.push(0,0,1),m.push(y/o),m.push(1-g/s);for(g=0;g<s;g++)for(y=0;y<o;y++){var x=y+l*(g+1),b=y+1+l*(g+1),_=y+1+l*g;d.push(y+l*g,x,_),d.push(x,b,_)}this.setIndex(d),this.addAttribute("position",new Pr(p,3)),this.addAttribute("normal",new Pr(f,3)),this.addAttribute("uv",new Pr(m,2))}function Bi(a,n,o,r){var s,l,c=new pr(0),u=0,h=null,d=0;function p(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return c},setClearColor:function(e,t){c.set(e),p(c,u=void 0!==t?t:1)},getClearAlpha:function(){return u},setClearAlpha:function(e){p(c,u=e)},render:function(e,t,n,r){var i=t.background,t=(t=a.vr).getSession&&t.getSession();null===(i=t&&"additive"===t.environmentBlendMode?null:i)?(p(c,u),h=null,d=0):i&&i.isColor&&(p(i,1),r=!0,h=null,d=0),(a.autoClear||r)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),i&&(i.isCubeTexture||i.isWebGLRenderTargetCube)?(void 0===l&&((l=new ii(new pi(1,1,1),new xi({type:"BackgroundCubeMaterial",uniforms:fi(Fi.cube.uniforms),vertexShader:Fi.cube.vertexShader,fragmentShader:Fi.cube.fragmentShader,side:Me,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),l.geometry.removeAttribute("uv"),l.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.tCube.value}}),o.update(l)),r=i.isWebGLRenderTargetCube?i.texture:i,l.material.uniforms.tCube.value=r,l.material.uniforms.tFlip.value=i.isWebGLRenderTargetCube?1:-1,h===i&&d===r.version||(l.material.needsUpdate=!0,h=i,d=r.version),e.unshift(l,l.geometry,l.material,0,0,null)):i&&i.isTexture&&(void 0===s&&((s=new ii(new Ui(2,2),new xi({type:"BackgroundMaterial",uniforms:fi(Fi.background.uniforms),vertexShader:Fi.background.vertexShader,fragmentShader:Fi.background.fragmentShader,side:q,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(s)),!0===(s.material.uniforms.t2D.value=i).matrixAutoUpdate&&i.updateMatrix(),s.material.uniforms.uvTransform.value.copy(i.matrix),h===i&&d===i.version||(s.material.needsUpdate=!0,d=(h=i).version),e.unshift(s,s.geometry,s.material,0,0,null))}}}function zi(o,s,l,c){var u;this.setMode=function(e){u=e},this.render=function(e,t){o.drawArrays(u,e,t),l.update(t,u)},this.renderInstances=function(e,t,n,r){if(0!==r){var i,a;if(c.isWebGL2)i=o,a="drawArraysInstanced";else if(a="drawArraysInstancedANGLE",null===(i=s.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");i[a](u,t,n,r),l.update(n,u,r)}}}function Hi(t,n,e){var r;function i(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,o=void 0!==e.precision?e.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===e.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),h=t.getParameter(3379),d=t.getParameter(34076),p=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),s=0<u,e=a||!!n.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==r)return r;var e=n.get("EXT_texture_filter_anisotropic");return r=null!==e?t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:s,floatFragmentTextures:e,floatVertexTextures:s&&e,maxSamples:a?t.getParameter(36183):0}}function Gi(){var c=this,u=null,h=0,d=!1,p=!1,f=new Ci,m=new qt,g={value:null,needsUpdate:!1};function v(){g.value!==u&&(g.value=u,g.needsUpdate=0<h),c.numPlanes=h,c.numIntersection=0}function y(e,t,n,r){var i=null!==e?e.length:0,a=null;if(0!==i){if(a=g.value,!0!==r||null===a){var r=n+4*i,o=t.matrixWorldInverse;m.getNormalMatrix(o),(null===a||a.length<r)&&(a=new Float32Array(r));for(var s=0,l=n;s!==i;++s,l+=4)f.copy(e[s]).applyMatrix4(o,m),f.normal.toArray(a,l),a[l+3]=f.constant}g.value=a,g.needsUpdate=!0}return c.numPlanes=i,a}this.uniform=g,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,n){var r=0!==e.length||t||0!==h||d;return d=t,u=y(e,n,0),h=e.length,r},this.beginShadows=function(){p=!0,y(null)},this.endShadows=function(){p=!1,v()},this.setState=function(e,t,n,r,i,a){if(!d||null===e||0===e.length||p&&!n)p?y(null):v();else{var n=p?0:h,o=4*n,s=i.clippingState||null;g.value=s;for(var s=y(e,r,o,a),l=0;l!==o;++l)s[l]=u[l];i.clippingState=s,this.numIntersection=t?this.numPlanes:0,this.numPlanes+=n}}}function ji(n){var r={};return{get:function(e){if(void 0!==r[e])return r[e];var t;switch(e){case"WEBGL_depth_texture":t=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=n.getExtension(e)}return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),r[e]=t}}}function Wi(e,h,r){var i=new WeakMap,d=new WeakMap;function a(e){var t,e=e.target,n=i.get(e);for(t in null!==n.index&&h.remove(n.index),n.attributes)h.remove(n.attributes[t]);e.removeEventListener("dispose",a),i.delete(e);e=d.get(n);e&&(h.remove(e),d.delete(n)),r.memory.geometries--}function o(e){var t=[],n=e.index,r=e.attributes.position,i=0;if(null!==n)for(var a=n.array,i=n.version,o=0,s=a.length;o<s;o+=3){var l=a[o+0],c=a[o+1],u=a[o+2];t.push(l,c,c,u,u,l)}else{a=r.array;i=r.version;for(o=0,s=a.length/3-1;o<s;o+=3)t.push(l=o+0,c=o+1,c,u=o+2,u,l)}r=new(65535<Ir(t)?Cr:Er)(t,1);r.version=i,h.update(r,34963);i=d.get(e);i&&h.remove(i),d.set(e,r)}return{get:function(e,t){var n=i.get(t);return n||(t.addEventListener("dispose",a),t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new zr).setFromObject(e)),n=t._bufferGeometry),i.set(t,n),r.memory.geometries++,n)},update:function(e){var t=e.index,n=e.attributes;for(r in null!==t&&h.update(t,34963),n)h.update(n[r],34962);var r,i=e.morphAttributes;for(r in i)for(var a=i[r],o=0,s=a.length;o<s;o++)h.update(a[o],34962)},getWireframeAttribute:function(e){var t,n=d.get(e);return(!n||null!==(t=e.index)&&n.version<t.version)&&o(e),d.get(e)}}}function Vi(o,s,l,c){var u,h,d;this.setMode=function(e){u=e},this.setIndex=function(e){h=e.type,d=e.bytesPerElement},this.render=function(e,t){o.drawElements(u,t,h,e*d),l.update(t,u)},this.renderInstances=function(e,t,n,r){if(0!==r){var i,a;if(c.isWebGL2)i=o,a="drawElementsInstanced";else if(a="drawElementsInstancedANGLE",null===(i=s.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");i[a](u,n,h,t*d,r),l.update(n,u,r)}}}function Xi(e){var r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:function(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:function(e,t,n){switch(n=n||1,r.calls++,t){case 4:r.triangles+=n*(e/3);break;case 5:case 6:r.triangles+=n*(e-2);break;case 1:r.lines+=n*(e/2);break;case 3:r.lines+=n*(e-1);break;case 2:r.lines+=n*e;break;case 0:r.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}}}function Yi(e,t){return Math.abs(t[1])-Math.abs(e[1])}function qi(p){var f={},m=new Float32Array(8);return{update:function(e,t,n,r){var i=e.morphTargetInfluences,a=i.length;if(void 0===(o=f[t.id])){for(var o=[],s=0;s<a;s++)o[s]=[s,0];f[t.id]=o}for(var l=n.morphTargets&&t.morphAttributes.position,c=n.morphNormals&&t.morphAttributes.normal,s=0;s<a;s++)0!==(u=o[s])[1]&&(l&&t.removeAttribute("morphTarget"+s),c&&t.removeAttribute("morphNormal"+s));for(s=0;s<a;s++)(u=o[s])[0]=s,u[1]=i[s];o.sort(Yi);for(var u,s=0;s<8;s++){if(u=o[s]){var h=u[0],d=u[1];if(d){l&&t.addAttribute("morphTarget"+s,l[h]),c&&t.addAttribute("morphNormal"+s,c[h]),m[s]=d;continue}}m[s]=0}r.getUniforms().setValue(p,"morphTargetInfluences",m)}}}function Qi(e,i,a,o){var s={};return{update:function(e){var t=o.render.frame,n=e.geometry,r=i.get(e,n);return s[r.id]!==t&&(n.isGeometry&&r.updateFromObject(e),i.update(r),s[r.id]=t),e.isInstancedMesh&&a.update(e.instanceMatrix,34962),r},dispose:function(){s={}}}}function Zi(e,t,n,r,i,a,o,s,l,c){Jt.call(this,e=void 0!==e?e:[],t=void 0!==t?t:U,n,r,i,a,o=void 0!==o?o:He,s,l,c),this.flipY=!1}function Ji(e,t,n,r){Jt.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:r||1},this.magFilter=Te,this.minFilter=Te,this.wrapR=be,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Ki(e,t,n,r){Jt.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:r||1},this.magFilter=Te,this.minFilter=Te,this.wrapR=be,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Fi.physical={uniforms:mi([Fi.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new pr(0)},clearcoatNormalScale:{value:new Ht(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:Ii.meshphysical_vert,fragmentShader:Ii.meshphysical_frag},(ki.prototype=Object.create(hi.prototype)).constructor=ki,(Ui.prototype=Object.create(zr.prototype)).constructor=Ui,((Zi.prototype=Object.create(Jt.prototype)).constructor=Zi).prototype.isCubeTexture=!0,Object.defineProperty(Zi.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),((Ji.prototype=Object.create(Jt.prototype)).constructor=Ji).prototype.isDataTexture2DArray=!0,((Ki.prototype=Object.create(Jt.prototype)).constructor=Ki).prototype.isDataTexture3D=!0;var $i=new Jt,ea=new Ji,ta=new Ki,na=new Zi,ra=[],ia=[],aa=new Float32Array(16),oa=new Float32Array(9),sa=new Float32Array(4);function la(e,t,n){var r=e[0];if(r<=0||0<r)return e;var i=t*n,a=ra[i];if(void 0===a&&(a=new Float32Array(i),ra[i]=a),0!==t){r.toArray(a,0);for(var o=1,s=0;o!==t;++o)e[o].toArray(a,s+=n)}return a}function ca(e,t){if(e.length===t.length){for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return;return 1}}function ua(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function ha(e,t){var n=ia[t];void 0===n&&(n=new Int32Array(t),ia[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function da(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function pa(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y):ca(n,t)||(e.uniform2fv(this.addr,t),ua(n,t))}function fa(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z):void 0!==t.r?n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b):ca(n,t)||(e.uniform3fv(this.addr,t),ua(n,t))}function ma(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w):ca(n,t)||(e.uniform4fv(this.addr,t),ua(n,t))}function ga(e,t){var n=this.cache,r=t.elements;void 0===r?ca(n,t)||(e.uniformMatrix2fv(this.addr,!1,t),ua(n,t)):ca(n,r)||(sa.set(r),e.uniformMatrix2fv(this.addr,!1,sa),ua(n,r))}function va(e,t){var n=this.cache,r=t.elements;void 0===r?ca(n,t)||(e.uniformMatrix3fv(this.addr,!1,t),ua(n,t)):ca(n,r)||(oa.set(r),e.uniformMatrix3fv(this.addr,!1,oa),ua(n,r))}function ya(e,t){var n=this.cache,r=t.elements;void 0===r?ca(n,t)||(e.uniformMatrix4fv(this.addr,!1,t),ua(n,t)):ca(n,r)||(aa.set(r),e.uniformMatrix4fv(this.addr,!1,aa),ua(n,r))}function xa(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||$i,i)}function ba(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||ea,i)}function _a(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||ta,i)}function Ma(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||na,i)}function wa(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ta(e,t){var n=this.cache;ca(n,t)||(e.uniform2iv(this.addr,t),ua(n,t))}function Sa(e,t){var n=this.cache;ca(n,t)||(e.uniform3iv(this.addr,t),ua(n,t))}function Ea(e,t){var n=this.cache;ca(n,t)||(e.uniform4iv(this.addr,t),ua(n,t))}function Aa(e,t){e.uniform1fv(this.addr,t)}function Ca(e,t){e.uniform1iv(this.addr,t)}function Pa(e,t){e.uniform2iv(this.addr,t)}function La(e,t){e.uniform3iv(this.addr,t)}function Oa(e,t){e.uniform4iv(this.addr,t)}function Ia(e,t){t=la(t,this.size,2);e.uniform2fv(this.addr,t)}function Ra(e,t){t=la(t,this.size,3);e.uniform3fv(this.addr,t)}function Fa(e,t){t=la(t,this.size,4);e.uniform4fv(this.addr,t)}function Na(e,t){t=la(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,t)}function Da(e,t){t=la(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,t)}function ka(e,t){t=la(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,t)}function Ua(e,t,n){var r=t.length,i=ha(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safeSetTexture2D(t[a]||$i,i[a])}function Ba(e,t,n){var r=t.length,i=ha(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safeSetTextureCube(t[a]||na,i[a])}function za(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return da;case 35664:return pa;case 35665:return fa;case 35666:return ma;case 35674:return ga;case 35675:return va;case 35676:return ya;case 35678:case 36198:return xa;case 35679:return _a;case 35680:return Ma;case 36289:return ba;case 5124:case 35670:return wa;case 35667:case 35671:return Ta;case 35668:case 35672:return Sa;case 35669:case 35673:return Ea}}(t.type)}function Ha(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Aa;case 35664:return Ia;case 35665:return Ra;case 35666:return Fa;case 35674:return Na;case 35675:return Da;case 35676:return ka;case 35678:return Ua;case 35680:return Ba;case 5124:case 35670:return Ca;case 35667:case 35671:return Pa;case 35668:case 35672:return La;case 35669:case 35673:return Oa}}(t.type)}function Ga(e){this.id=e,this.seq=[],this.map={}}Ha.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),ua(t,e)},Ga.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,a=r.length;i!==a;++i){var o=r[i];o.setValue(e,t[o.id],n)}};var ja=/([\w\d_]+)(\])?(\[|\.)?/g;function Wa(e,t){e.seq.push(t),e.map[t.id]=t}function Va(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),r=0;r<n;++r){var i=e.getActiveUniform(t,r);!function(e,t,n){var r=e.name,i=r.length;for(ja.lastIndex=0;;){var a=ja.exec(r),o=ja.lastIndex,s=a[1],l="]"===a[2],a=a[3];if(l&&(s|=0),void 0===a||"["===a&&o+2===i){Wa(n,new(void 0===a?za:Ha)(s,e,t));break}a=n.map[s];void 0===a&&Wa(n,a=new Ga(s)),n=a}}(i,e.getUniformLocation(t,i.name),this)}}function Xa(e,t,n){t=e.createShader(t);return e.shaderSource(t,n),e.compileShader(t),t}Va.prototype.setValue=function(e,t,n,r){t=this.map[t];void 0!==t&&t.setValue(e,n,r)},Va.prototype.setOptional=function(e,t,n){t=t[n];void 0!==t&&this.setValue(e,n,t)},Va.upload=function(e,t,n,r){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},Va.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var a=e[r];a.id in t&&n.push(a)}return n};var Ya=0;function qa(e){switch(e){case wt:return["Linear","( value )"];case Tt:return["sRGB","( value )"];case Et:return["RGBE","( value )"];case Ct:return["RGBM","( value, 7.0 )"];case Pt:return["RGBM","( value, 16.0 )"];case Lt:return["RGBD","( value, 256.0 )"];case St:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case At:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function Qa(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function Za(e,t){t=qa(t);return"vec4 "+e+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function Ja(e){return""!==e}function Ka(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function $a(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var eo=/^[ \t]*#include +<([\w\d./]+)>/gm;function to(e){return e.replace(eo,no)}function no(e,t){var n=Ii[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return to(n)}var ro=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function io(e){return e.replace(ro,ao)}function ao(e,t,n,r){for(var i="",a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[ i \]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function oo(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function so(e,t,n,r,i,a){var o,s,l,c,u=e.getContext(),h=r.defines,d=i.vertexShader,p=i.fragmentShader,f=(o="SHADOWMAP_TYPE_BASIC",(y=a).shadowMapType===L?o="SHADOWMAP_TYPE_PCF":y.shadowMapType===A?o="SHADOWMAP_TYPE_PCF_SOFT":y.shadowMapType===O&&(o="SHADOWMAP_TYPE_VSM"),o),m=function(e,t){var n="ENVMAP_TYPE_CUBE";if(e.envMap)switch(t.envMap.mapping){case U:case B:n="ENVMAP_TYPE_CUBE";break;case j:case ye:n="ENVMAP_TYPE_CUBE_UV";break;case z:case H:n="ENVMAP_TYPE_EQUIREC";break;case G:n="ENVMAP_TYPE_SPHERE"}return n}(a,r),g=function(e,t){var n="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(t.envMap.mapping){case B:case H:n="ENVMAP_MODE_REFRACTION"}return n}(a,r),v=function(e,t){var n="ENVMAP_BLENDING_MULTIPLY";if(e.envMap)switch(t.combine){case C:n="ENVMAP_BLENDING_MULTIPLY";break;case P:n="ENVMAP_BLENDING_MIX";break;case I:n="ENVMAP_BLENDING_ADD"}return n}(a,r),y=0<e.gammaFactor?e.gammaFactor:1,s=a.isWebGL2?"":(o=r.extensions,s=a,x=t,[(o=o||{}).derivatives||s.envMapCubeUV||s.bumpMap||s.tangentSpaceNormalMap||s.clearcoatNormalMap||s.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(o.fragDepth||s.logarithmicDepthBuffer)&&x.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",o.drawBuffers&&x.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(o.shaderTextureLOD||s.envMap)&&x.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ja).join("\n")),x=function(e){var t,n=[];for(t in e){var r=e[t];!1!==r&&n.push("#define "+t+" "+r)}return n.join("\n")}(h),b=u.createProgram(),h=e.getRenderTarget(),h=h&&h.isWebGLMultiviewRenderTarget?h.numViews:0;r.isRawShaderMaterial?(0<(l=[x].filter(Ja).join("\n")).length&&(l+="\n"),0<(c=[s,x].filter(Ja).join("\n")).length&&(c+="\n")):(l=[oo(a),"#define SHADER_NAME "+i.name,x,a.instancing?"#define USE_INSTANCING":"",a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+g:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.normalMap2?"#define NORMALMAP2":"",a.normalMap3?"#define NORMALMAP3":"",a.normalMap4?"#define NORMALMAP4":"",a.normalMap5?"#define NORMALMAP5":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexUvs?"#define USE_UV":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+f:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ja).join("\n"),c=[s,oo(a),"#define SHADER_NAME "+i.name,x,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+y,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+m:"",a.envMap?"#define "+g:"",a.envMap?"#define "+v:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.normalMap2?"#define NORMALMAP2":"",a.normalMap3?"#define NORMALMAP3":"",a.normalMap4?"#define NORMALMAP4":"",a.normalMap5?"#define NORMALMAP5":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.sheen?"#define USE_SHEEN":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexUvs?"#define USE_UV":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+f:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensions&&r.extensions.shaderTextureLOD||a.envMap)&&(a.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==R?"#define TONE_MAPPING":"",a.toneMapping!==R?Ii.tonemapping_pars_fragment:"",a.toneMapping!==R?function(e,t){var n;switch(t){case we:n="Linear";break;case F:n="Reinhard";break;case N:n="Uncharted2";break;case D:n="OptimizedCineon";break;case k:n="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?Ii.encodings_pars_fragment:"",a.mapEncoding?Za("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?Za("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?Za("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?Za("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?(S="linearToOutputTexel",E=qa(E=a.outputEncoding),"vec4 "+S+"( vec4 value ) { return LinearTo"+E[0]+E[1]+"; }"):"",a.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(Ja).join("\n")),d=$a(d=Ka(d=to(d),a),a),p=$a(p=Ka(p=to(p),a),a),d=io(d),p=io(p),a.isWebGL2&&!r.isRawShaderMaterial&&(M=!1,_=/^\s*#version\s+300\s+es\s*\n/,r.isShaderMaterial&&null!==d.match(_)&&null!==p.match(_)&&(M=!0,d=d.replace(_,""),p=p.replace(_,"")),l=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+l,c=["#version 300 es\n","#define varying in",M?"":"out highp vec4 pc_fragColor;",M?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+c,0<h&&(l=(l=l.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+h+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+h+"];","uniform mat4 projectionMatrices["+h+"];","uniform mat4 viewMatrices["+h+"];","uniform mat3 normalMatrices["+h+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),c=(c=c.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+h+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n"))));var _,M,w,T,t=c+p,S=Xa(u,35633,l+d),E=Xa(u,35632,t);return u.attachShader(b,S),u.attachShader(b,E),void 0!==r.index0AttributeName?u.bindAttribLocation(b,0,r.index0AttributeName):!0===a.morphTargets&&u.bindAttribLocation(b,0,"position"),u.linkProgram(b),e.debug.checkShaderErrors&&(_=u.getProgramInfoLog(b).trim(),M=u.getShaderInfoLog(S).trim(),p=u.getShaderInfoLog(E).trim(),!(t=d=!0)===u.getProgramParameter(b,35714)?(d=!1,a=Qa(u,S,"vertex"),e=Qa(u,E,"fragment"),console.error("THREE.WebGLProgram: shader error: ",u.getError(),"35715",u.getProgramParameter(b,35715),"gl.getProgramInfoLog",_,a,e)):""!==_?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",_):""!==M&&""!==p||(t=!1),t&&(this.diagnostics={runnable:d,material:r,programLog:_,vertexShader:{log:M,prefix:l},fragmentShader:{log:p,prefix:c}})),u.deleteShader(S),u.deleteShader(E),this.getUniforms=function(){return w=void 0===w?new Va(u,b):w},this.getAttributes=function(){return T=void 0===T?function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var a=e.getActiveAttrib(t,i).name;n[a]=e.getAttribLocation(t,a)}return n}(u,b):T},this.destroy=function(){u.deleteProgram(b),this.program=void 0},this.name=i.name,this.id=Ya++,this.code=n,this.usedTimes=1,this.program=b,this.vertexShader=S,this.fragmentShader=E,this.numMultiviewViews=h,this}function lo(h,l,d){var c=[],p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},a=["precision","supportsVertexTextures","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","normalMap2","normalMap3","normalMap4","normalMap5","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function f(e,t){var n;return e?e.isTexture?n=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=e.texture.encoding):n=wt,n=n===wt&&t?St:n}this.getParameters=function(e,t,n,r,i,a,o){var s=p[e.type],l=o.isSkinnedMesh?(c=(u=o).skeleton.bones,d.floatVertexTextures?1024:(u=d.maxVertexUniforms,u=Math.floor((u-20)/4),(u=Math.min(u,c.length))<c.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+c.length+" bones. This GPU supports "+u+"."),0):u)):0,c=d.precision;null!==e.precision&&(c=d.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",c,"instead.");var u=h.getRenderTarget();return{isWebGL2:d.isWebGL2,shaderID:s,precision:c,instancing:!0===o.isInstancedMesh,supportsVertexTextures:d.vertexTextures,outputEncoding:f(u?u.texture:null,h.gammaOutput),map:!!e.map,mapEncoding:f(e.map,h.gammaInput),matcap:!!e.matcap,matcapEncoding:f(e.matcap,h.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:f(e.envMap,h.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===j||e.envMap.mapping===ye),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:f(e.emissiveMap,h.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,normalMap2:!!e.normalMap2,normalMap3:!!e.normalMap3,normalMap4:!!e.normalMap4,normalMap5:!!e.normalMap5,objectSpaceNormalMap:e.normalMapType===Ft,tangentSpaceNormalMap:e.normalMapType===Rt,clearcoatNormalMap:!!e.clearcoatNormalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,sheen:!!e.sheen,combine:e.combine,vertexTangents:e.normalMap&&e.vertexTangents,vertexColors:e.vertexColors,vertexUvs:!!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap),fog:!!r,useFog:e.fog,fogExp2:r&&r.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:d.logarithmicDepthBuffer,skinning:e.skinning&&0<l,maxBones:l,useVertexTexture:d.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:h.maxMorphTargets,maxMorphNormals:h.maxMorphNormals,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numDirLightShadows:t.directionalShadowMap.length,numPointLightShadows:t.pointShadowMap.length,numSpotLightShadows:t.spotShadowMap.length,numClippingPlanes:i,numClipIntersection:a,dithering:e.dithering,shadowMapEnabled:h.shadowMap.enabled&&0<n.length,shadowMapType:h.shadowMap.type,toneMapping:e.toneMapped?h.toneMapping:R,physicallyCorrectLights:h.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===Q,flipSided:e.side===Me,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCode=function(e,t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var r in e.defines)n.push(r),n.push(e.defines[r]);for(var i=0;i<a.length;i++)n.push(t[a[i]]);return n.push(e.onBeforeCompile.toString()),n.push(h.gammaOutput),n.push(h.gammaFactor),n.join()},this.acquireProgram=function(e,t,n,r){for(var i,a=0,o=c.length;a<o;a++){var s=c[a];if(s.code===r){++(i=s).usedTimes;break}}return void 0===i&&(i=new so(h,l,r,e,t,n),c.push(i)),i},this.releaseProgram=function(e){var t;0==--e.usedTimes&&(t=c.indexOf(e),c[t]=c[c.length-1],c.pop(),e.destroy())},this.programs=c}function co(){var r=new WeakMap;return{get:function(e){var t=r.get(e);return void 0===t&&r.set(e,t={}),t},remove:function(e){r.delete(e)},update:function(e,t,n){r.get(e)[t]=n},dispose:function(){r=new WeakMap}}}function uo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ho(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function po(){var s=[],l=0,o=[],c=[],u={id:-1};function h(e,t,n,r,i,a){var o=s[l];return void 0===o?(o={id:e.id,object:e,geometry:t,material:n,program:n.program||u,groupOrder:r,renderOrder:e.renderOrder,z:i,group:a},s[l]=o):(o.id=e.id,o.object=e,o.geometry=t,o.material=n,o.program=n.program||u,o.groupOrder=r,o.renderOrder=e.renderOrder,o.z=i,o.group=a),l++,o}return{opaque:o,transparent:c,init:function(){l=0,o.length=0,c.length=0},push:function(e,t,n,r,i,a){a=h(e,t,n,r,i,a),(!0===n.transparent?c:o).push(a)},unshift:function(e,t,n,r,i,a){a=h(e,t,n,r,i,a),(!0===n.transparent?c:o).unshift(a)},sort:function(){1<o.length&&o.sort(uo),1<c.length&&c.sort(ho)}}}function fo(){var i=new WeakMap;function a(e){e=e.target;e.removeEventListener("dispose",a),i.delete(e)}return{get:function(e,t){var n,r=i.get(e);return void 0===r?(n=new po,i.set(e,new WeakMap),i.get(e).set(t,n),e.addEventListener("dispose",a)):void 0===(n=r.get(t))&&(n=new po,r.set(t,n)),n},dispose:function(){i=new WeakMap}}}function mo(){var n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];var t;switch(e.type){case"DirectionalLight":t={direction:new Vt,color:new pr,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ht};break;case"SpotLight":t={position:new Vt,direction:new Vt,color:new pr,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ht};break;case"PointLight":t={position:new Vt,color:new pr,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ht,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":t={direction:new Vt,skyColor:new pr,groundColor:new pr};break;case"RectAreaLight":t={color:new pr,position:new Vt,halfWidth:new Vt,halfHeight:new Vt}}return n[e.id]=t}}}var go=0;function vo(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function yo(){for(var S=new mo,E={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},e=0;e<9;e++)E.probe.push(new Vt);var A=new Vt,C=new cn,P=new cn;return{setup:function(e,t,n){for(var r=0,i=0,a=0,o=0;o<9;o++)E.probe[o].set(0,0,0);var s=0,l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=n.matrixWorldInverse;e.sort(vo);for(var o=0,g=e.length;o<g;o++){var v,y,x=e[o],b=x.color,_=x.intensity,M=x.distance,w=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)r+=b.r*_,i+=b.g*_,a+=b.b*_;else if(x.isLightProbe)for(var T=0;T<9;T++)E.probe[T].addScaledVector(x.sh.coefficients[T],_);else x.isDirectionalLight?((y=S.get(x)).color.copy(x.color).multiplyScalar(x.intensity),y.direction.setFromMatrixPosition(x.matrixWorld),A.setFromMatrixPosition(x.target.matrixWorld),y.direction.sub(A),y.direction.transformDirection(m),y.shadow=x.castShadow,x.castShadow&&(v=x.shadow,y.shadowBias=v.bias,y.shadowRadius=v.radius,y.shadowMapSize=v.mapSize,E.directionalShadowMap[s]=w,E.directionalShadowMatrix[s]=x.shadow.matrix,d++),E.directional[s]=y,s++):x.isSpotLight?((y=S.get(x)).position.setFromMatrixPosition(x.matrixWorld),y.position.applyMatrix4(m),y.color.copy(b).multiplyScalar(_),y.distance=M,y.direction.setFromMatrixPosition(x.matrixWorld),A.setFromMatrixPosition(x.target.matrixWorld),y.direction.sub(A),y.direction.transformDirection(m),y.coneCos=Math.cos(x.angle),y.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),y.decay=x.decay,y.shadow=x.castShadow,x.castShadow&&(v=x.shadow,y.shadowBias=v.bias,y.shadowRadius=v.radius,y.shadowMapSize=v.mapSize,E.spotShadowMap[c]=w,E.spotShadowMatrix[c]=x.shadow.matrix,f++),E.spot[c]=y,c++):x.isRectAreaLight?((y=S.get(x)).color.copy(b).multiplyScalar(_),y.position.setFromMatrixPosition(x.matrixWorld),y.position.applyMatrix4(m),P.identity(),C.copy(x.matrixWorld),C.premultiply(m),P.extractRotation(C),y.halfWidth.set(.5*x.width,0,0),y.halfHeight.set(0,.5*x.height,0),y.halfWidth.applyMatrix4(P),y.halfHeight.applyMatrix4(P),E.rectArea[u]=y,u++):x.isPointLight?((y=S.get(x)).position.setFromMatrixPosition(x.matrixWorld),y.position.applyMatrix4(m),y.color.copy(x.color).multiplyScalar(x.intensity),y.distance=x.distance,y.decay=x.decay,y.shadow=x.castShadow,x.castShadow&&(v=x.shadow,y.shadowBias=v.bias,y.shadowRadius=v.radius,y.shadowMapSize=v.mapSize,y.shadowCameraNear=v.camera.near,y.shadowCameraFar=v.camera.far,E.pointShadowMap[l]=w,E.pointShadowMatrix[l]=x.shadow.matrix,p++),E.point[l]=y,l++):x.isHemisphereLight&&((y=S.get(x)).direction.setFromMatrixPosition(x.matrixWorld),y.direction.transformDirection(m),y.direction.normalize(),y.skyColor.copy(x.color).multiplyScalar(_),y.groundColor.copy(x.groundColor).multiplyScalar(_),E.hemi[h]=y,h++)}E.ambient[0]=r,E.ambient[1]=i,E.ambient[2]=a,(n=E.hash).directionalLength===s&&n.pointLength===l&&n.spotLength===c&&n.rectAreaLength===u&&n.hemiLength===h&&n.numDirectionalShadows===d&&n.numPointShadows===p&&n.numSpotShadows===f||(E.directional.length=s,E.spot.length=c,E.rectArea.length=u,E.point.length=l,E.hemi.length=h,E.directionalShadowMap.length=d,E.pointShadowMap.length=p,E.spotShadowMap.length=f,E.directionalShadowMatrix.length=d,E.pointShadowMatrix.length=p,E.spotShadowMatrix.length=f,n.directionalLength=s,n.pointLength=l,n.spotLength=c,n.rectAreaLength=u,n.hemiLength=h,n.numDirectionalShadows=d,n.numPointShadows=p,n.numSpotShadows=f,E.version=go++)},state:E}}function xo(){var t=new yo,n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:t},setupLights:function(e){t.setup(n,r,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function bo(){var r=new WeakMap;function i(e){e=e.target;e.removeEventListener("dispose",i),r.delete(e)}return{get:function(e,t){var n;return!1===r.has(e)?(n=new xo,r.set(e,new WeakMap),r.get(e).set(t,n),e.addEventListener("dispose",i)):!1===r.get(e).has(t)?(n=new xo,r.get(e).set(t,n)):n=r.get(e).get(t),n},dispose:function(){r=new WeakMap}}}function _o(e){xr.call(this),this.type="MeshDepthMaterial",this.depthPacking=Ot,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function Mo(e){xr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}((_o.prototype=Object.create(xr.prototype)).constructor=_o).prototype.isMeshDepthMaterial=!0,_o.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},((Mo.prototype=Object.create(xr.prototype)).constructor=Mo).prototype.isMeshDistanceMaterial=!0,Mo.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var wo="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n  \n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = decodeHalfRGBA ( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = pow( squared_mean - mean * mean, 0.5 );\n  gl_FragColor = encodeHalfRGBA( vec2( mean, std_dev ) );\n}",To="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function So(y,x,b){var _=new Oi,M=new Ht,w=new Ht,T=new Kt,d=1,p=2,e=1+(d|p),f=new Array(e),m=new Array(e),g={},v={0:Me,1:q,2:Q},S=new xi({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ht},radius:{value:4}},vertexShader:To,fragmentShader:wo}),E=S.clone();E.defines.HORIZONAL_PASS=1;var t=new zr;t.addAttribute("position",new _r(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));for(var A=new ii(t,S),n=0;n!==e;++n){var r=0!=(n&d),i=0!=(n&p),a=new _o({depthPacking:It,morphTargets:r,skinning:i});f[n]=a;i=new Mo({morphTargets:r,skinning:i});m[n]=i}var C=this;function P(e,t,n,r,i,a){var o,s,l=e.geometry,c=null,u=f,h=e.customDepthMaterial;return n.isPointLight&&(u=m,h=e.customDistanceMaterial),c=h||(h=!1,t.morphTargets&&(l&&l.isBufferGeometry?h=l.morphAttributes&&l.morphAttributes.position&&0<l.morphAttributes.position.length:l&&l.isGeometry&&(h=l.morphTargets&&0<l.morphTargets.length)),e.isSkinnedMesh&&!1===t.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e),s=e.isSkinnedMesh&&t.skinning,o=0,h&&(o|=d),s&&(o|=p),u[o]),y.localClippingEnabled&&!0===t.clipShadows&&0!==t.clippingPlanes.length&&(s=c.uuid,u=t.uuid,void 0===(o=g[s])&&(g[s]=o={}),void 0===(s=o[u])&&(s=c.clone(),o[u]=s),c=s),c.visible=t.visible,c.wireframe=t.wireframe,c.side=a===O?null!=t.shadowSide?t.shadowSide:t.side:null!=t.shadowSide?t.shadowSide:v[t.side],c.clipShadows=t.clipShadows,c.clippingPlanes=t.clippingPlanes,c.clipIntersection=t.clipIntersection,c.wireframeLinewidth=t.wireframeLinewidth,c.linewidth=t.linewidth,n.isPointLight&&c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(n.matrixWorld),c.nearDistance=r,c.farDistance=i),c}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=L,this.render=function(e,t,n){if(!1!==C.enabled&&(!1!==C.autoUpdate||!1!==C.needsUpdate)&&0!==e.length){var r=y.getRenderTarget(),i=y.getActiveCubeFace(),a=y.getActiveMipmapLevel(),o=y.state;o.setBlending(Z),o.buffers.color.setClear(1,1,1,1),o.buffers.depth.setTest(!0),o.setScissorTest(!1);for(var s,l,c=0,u=e.length;c<u;c++){var h=e[c],d=h.shadow;if(void 0!==d){M.copy(d.mapSize);var p,f=d.getFrameExtents();M.multiply(f),w.copy(d.mapSize),(M.x>b||M.y>b)&&(console.warn("THREE.WebGLShadowMap:",h,"has shadow exceeding max texture size, reducing"),M.x>b&&(w.x=Math.floor(b/f.x),M.x=w.x*f.x,d.mapSize.x=w.x),M.y>b&&(w.y=Math.floor(b/f.y),M.y=w.y*f.y,d.mapSize.y=w.y)),null!==d.map||d.isPointLightShadow||this.type!==O||(d.map=new $t(M.x,M.y,p={minFilter:Ae,magFilter:Ae,format:Ge}),d.map.texture.name=h.name+".shadowMap",d.mapPass=new $t(M.x,M.y,p),d.camera.updateProjectionMatrix()),null===d.map&&(d.map=new $t(M.x,M.y,p={minFilter:Te,magFilter:Te,format:Ge}),d.map.texture.name=h.name+".shadowMap",d.camera.updateProjectionMatrix()),y.setRenderTarget(d.map),y.clear();for(var m=d.getViewportCount(),g=0;g<m;g++){var v=d.getViewport(g);T.set(w.x*v.x,w.y*v.y,w.x*v.z,w.y*v.w),o.viewport(T),d.updateMatrices(h,n,g),_=d.getFrustum(),function e(t,n,r,i,a){if(!1===t.visible)return;var o=t.layers.test(n.layers);if(o&&(t.isMesh||t.isLine||t.isPoints)&&(t.castShadow||t.receiveShadow&&a===O)&&(!t.frustumCulled||_.intersectsObject(t))){t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld);var s=x.update(t),l=t.material;if(Array.isArray(l))for(var c=s.groups,u=0,h=c.length;u<h;u++){var d,p=c[u],f=l[p.materialIndex];f&&f.visible&&(d=P(t,f,i,r.near,r.far,a),y.renderBufferDirect(r,null,s,d,t,p))}else l.visible&&(d=P(t,l,i,r.near,r.far,a),y.renderBufferDirect(r,null,s,d,t,null))}var m=t.children;for(var g=0,v=m.length;g<v;g++)e(m[g],n,r,i,a)}(t,n,d.camera,h,this.type)}d.isPointLightShadow||this.type!==O||(s=d,l=n,f=void 0,f=x.update(A),S.uniforms.shadow_pass.value=s.map.texture,S.uniforms.resolution.value=s.mapSize,S.uniforms.radius.value=s.radius,y.setRenderTarget(s.mapPass),y.clear(),y.renderBufferDirect(l,null,f,S,A,null),E.uniforms.shadow_pass.value=s.mapPass.texture,E.uniforms.resolution.value=s.mapSize,E.uniforms.radius.value=s.radius,y.setRenderTarget(s.map),y.clear(),y.renderBufferDirect(l,null,f,E,A,null))}else console.warn("THREE.WebGLShadowMap:",h,"has no shadow.")}C.needsUpdate=!1,y.setRenderTarget(r,i,a)}}}function Eo(u,n,l,r){var i=new function(){var t=!1,a=new Kt,n=null,o=new Kt(0,0,0,0);return{setMask:function(e){n===e||t||(u.colorMask(e,e,e,e),n=e)},setLocked:function(e){t=e},setClear:function(e,t,n,r,i){!0===i&&(e*=r,t*=r,n*=r),a.set(e,t,n,r),!1===o.equals(a)&&(u.clearColor(e,t,n,r),o.copy(a))},reset:function(){t=!1,n=null,o.set(-1,0,0,0)}}},a=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){(e?U:B)(2929)},setMask:function(e){n===e||t||(u.depthMask(e),n=e)},setFunc:function(e){if(r!==e){if(e)switch(e){case ue:u.depthFunc(512);break;case he:u.depthFunc(519);break;case de:u.depthFunc(513);break;case pe:u.depthFunc(515);break;case fe:u.depthFunc(514);break;case me:u.depthFunc(518);break;case ge:u.depthFunc(516);break;case ve:u.depthFunc(517);break;default:u.depthFunc(515)}else u.depthFunc(515);r=e}},setLocked:function(e){t=e},setClear:function(e){i!==e&&(u.clearDepth(e),i=e)},reset:function(){t=!1,i=r=n=null}}},o=new function(){var t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?U:B)(2960)},setMask:function(e){n===e||t||(u.stencilMask(e),n=e)},setFunc:function(e,t,n){r===e&&i===t&&a===n||(u.stencilFunc(e,t,n),r=e,i=t,a=n)},setOp:function(e,t,n){o===e&&s===t&&l===n||(u.stencilOp(e,t,n),o=e,s=t,l=n)},setLocked:function(e){t=e},setClear:function(e){c!==e&&(u.clearStencil(e),c=e)},reset:function(){t=!1,c=l=s=o=a=i=r=n=null}}},e=u.getParameter(34921),s=new Uint8Array(e),c=new Uint8Array(e),h=new Uint8Array(e),t={},d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=null,b=null,_=null,M=!1,w=null,T=null,S=null,E=null,A=null,C=u.getParameter(35661),P=!1,L=0,e=u.getParameter(7938);-1!==e.indexOf("WebGL")?(L=parseFloat(/^WebGL\ ([0-9])/.exec(e)[1]),P=1<=L):-1!==e.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(e)[1]),P=2<=L);var O=null,I={},R=new Kt,F=new Kt;function N(e,t,n){var r=new Uint8Array(4),i=u.createTexture();u.bindTexture(e,i),u.texParameteri(e,10241,9728),u.texParameteri(e,10240,9728);for(var a=0;a<n;a++)u.texImage2D(t+a,0,6408,1,1,0,6408,5121,r);return i}var D={};function k(e,t){s[e]=1,0===c[e]&&(u.enableVertexAttribArray(e),c[e]=1),h[e]!==t&&((r.isWebGL2?u:n.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](e,t),h[e]=t)}function U(e){!0!==t[e]&&(u.enable(e),t[e]=!0)}function B(e){!1!==t[e]&&(u.disable(e),t[e]=!1)}function z(e,t,n,r,i,a,o,s){if(e!==Z){if(f||(U(3042),f=!0),e===te)i=i||t,a=a||n,o=o||r,t===g&&i===x||(u.blendEquationSeparate(l.convert(t),l.convert(i)),g=t,x=i),n===v&&r===y&&a===b&&o===_||(u.blendFuncSeparate(l.convert(n),l.convert(r),l.convert(a),l.convert(o)),v=n,y=r,b=a,_=o),m=e,M=null;else if(e!==m||s!==M){if(g===ce&&x===ce||(u.blendEquation(32774),x=g=ce),s)switch(e){case J:u.blendFuncSeparate(1,771,1,771);break;case K:u.blendFunc(1,1);break;case $:u.blendFuncSeparate(0,0,769,771);break;case ee:u.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case J:u.blendFuncSeparate(770,771,1,771);break;case K:u.blendFunc(770,1);break;case $:u.blendFunc(0,769);break;case ee:u.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}_=b=y=v=null,m=e,M=s}}else f&&(B(3042),f=!1)}function H(e){w!==e&&(e?u.frontFace(2304):u.frontFace(2305),w=e)}function G(e){e!==V?(U(2884),e!==T&&(e===X?u.cullFace(1029):e===Y?u.cullFace(1028):u.cullFace(1032))):B(2884),T=e}function j(e,t,n){e?(U(32823),E===t&&A===n||(u.polygonOffset(t,n),E=t,A=n)):B(32823)}function W(e){O!==(e=void 0===e?33984+C-1:e)&&(u.activeTexture(e),O=e)}return D[3553]=N(3553,3553,1),D[34067]=N(34067,34069,6),i.setClear(0,0,0,1),a.setClear(1),o.setClear(0),U(2929),a.setFunc(pe),H(!1),G(X),U(2884),z(Z),{buffers:{color:i,depth:a,stencil:o},initAttributes:function(){for(var e=0,t=s.length;e<t;e++)s[e]=0},enableAttribute:function(e){k(e,0)},enableAttributeAndDivisor:k,disableUnusedAttributes:function(){for(var e=0,t=c.length;e!==t;++e)c[e]!==s[e]&&(u.disableVertexAttribArray(e),c[e]=0)},enable:U,disable:B,getCompressedTextureFormats:function(){if(null===d&&(d=[],n.get("WEBGL_compressed_texture_pvrtc")||n.get("WEBGL_compressed_texture_s3tc")||n.get("WEBGL_compressed_texture_etc1")||n.get("WEBGL_compressed_texture_astc")))for(var e=u.getParameter(34467),t=0;t<e.length;t++)d.push(e[t]);return d},useProgram:function(e){return p!==e&&(u.useProgram(e),p=e,!0)},setBlending:z,setMaterial:function(e,t){(e.side===Q?B:U)(2884);var n=e.side===Me;H(n=t?!n:n),e.blending===J&&!1===e.transparent?z(Z):z(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),i.setMask(e.colorWrite),n=e.stencilWrite,o.setTest(n),n&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),j(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:H,setCullFace:G,setLineWidth:function(e){e!==S&&(P&&u.lineWidth(e),S=e)},setPolygonOffset:j,setScissorTest:function(e){(e?U:B)(3089)},activeTexture:W,bindTexture:function(e,t){null===O&&W();var n=I[O];void 0===n&&(I[O]=n={type:void 0,texture:void 0}),n.type===e&&n.texture===t||(u.bindTexture(e,t||D[e]),n.type=e,n.texture=t)},compressedTexImage2D:function(){try{u.compressedTexImage2D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{u.texImage2D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{u.texImage3D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===R.equals(e)&&(u.scissor(e.x,e.y,e.z,e.w),R.copy(e))},viewport:function(e){!1===F.equals(e)&&(u.viewport(e.x,e.y,e.z,e.w),F.copy(e))},reset:function(){for(var e=0;e<c.length;e++)1===c[e]&&(u.disableVertexAttribArray(e),c[e]=0);t={},I={},T=w=m=p=O=d=null,i.reset(),a.reset(),o.reset()}}}function Ao(g,f,v,y,x,b,m){var a,o=new WeakMap,n="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d");function s(e,t){return n?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function _(e,t,n,r){var i=1;if((i=e.width>r||e.height>r?r/Math.max(e.width,e.height):i)<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){r=t?zt.floorPowerOfTwo:Math.floor,t=r(i*e.width),i=r(i*e.height);void 0===a&&(a=s(t,i));n=n?s(t,i):a;return n.width=t,n.height=i,n.getContext("2d").drawImage(e,0,0,t,i),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+t+"x"+i+")."),n}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function M(e){return zt.isPowerOfTwo(e.width)&&zt.isPowerOfTwo(e.height)}function w(e,t){return e.generateMipmaps&&t&&e.minFilter!==Te&&e.minFilter!==Ae}function T(e,t,n,r){g.generateMipmap(e),y.get(t).__maxMipLevel=Math.log(Math.max(n,r))*Math.LOG2E}function S(e,t){if(!x.isWebGL2)return e;var n=e;return 6403===e&&(5126===t&&(n=33326),5131===t&&(n=33325),5121===t&&(n=33321)),6407===e&&(5126===t&&(n=34837),5131===t&&(n=34843),5121===t&&(n=32849)),6408===e&&(5126===t&&(n=34836),5131===t&&(n=34842),5121===t&&(n=32856)),33325===n||33326===n||34842===n||34836===n?f.get("EXT_color_buffer_float"):34843!==n&&34837!==n||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),n}function r(e){return e===Te||e===Se||e===Ee?9728:9729}function i(e){var t,n=e.target;n.removeEventListener("dispose",i),t=n,void 0!==(e=y.get(t)).__webglInit&&(g.deleteTexture(e.__webglTexture),y.remove(t)),n.isVideoTexture&&o.delete(n),m.memory.textures--}function E(e){e=e.target;e.removeEventListener("dispose",E),function(e){var t=y.get(e),n=y.get(e.texture);if(e){if(void 0!==n.__webglTexture&&g.deleteTexture(n.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLRenderTargetCube)for(var r=0;r<6;r++)g.deleteFramebuffer(t.__webglFramebuffer[r]),t.__webglDepthbuffer&&g.deleteRenderbuffer(t.__webglDepthbuffer[r]);else g.deleteFramebuffer(t.__webglFramebuffer),t.__webglDepthbuffer&&g.deleteRenderbuffer(t.__webglDepthbuffer);if(e.isWebGLMultiviewRenderTarget){g.deleteTexture(t.__webglColorTexture),g.deleteTexture(t.__webglDepthStencilTexture),m.memory.textures-=2;for(var r=0,i=t.__webglViewFramebuffers.length;r<i;r++)g.deleteFramebuffer(t.__webglViewFramebuffers[r])}y.remove(e.texture),y.remove(e)}}(e),m.memory.textures--}var t=0;function l(e,t){var n,r=y.get(e);if(e.isVideoTexture&&(i=e,n=m.render.frame,o.get(i)!==n&&(o.set(i,n),i.update())),0<e.version&&r.__version!==e.version){var i=e.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void h(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}v.activeTexture(33984+t),v.bindTexture(3553,r.__webglTexture)}function c(e,t){if(6===e.image.length){var n=y.get(e);if(0<e.version&&n.__version!==e.version){C(n,e),v.activeTexture(33984+t),v.bindTexture(34067,n.__webglTexture),g.pixelStorei(37440,e.flipY);for(var r=e&&e.isCompressedTexture,i=e.image[0]&&e.image[0].isDataTexture,a=[],o=0;o<6;o++)a[o]=r||i?i?e.image[o].image:e.image[o]:_(e.image[o],!1,!0,x.maxCubemapSize);var s=a[0],l=M(s)||x.isWebGL2,c=b.convert(e.format),u=b.convert(e.type),h=S(c,u);if(A(34067,e,l),r){for(o=0;o<6;o++)for(var d=a[o].mipmaps,p=0;p<d.length;p++){var f=d[p];e.format!==Ge&&e.format!==He?-1<v.getCompressedTextureFormats().indexOf(c)?v.compressedTexImage2D(34069+o,p,h,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):v.texImage2D(34069+o,p,h,f.width,f.height,0,c,u,f.data)}n.__maxMipLevel=d.length-1}else{d=e.mipmaps;for(o=0;o<6;o++)if(i){v.texImage2D(34069+o,0,h,a[o].width,a[o].height,0,c,u,a[o].data);for(p=0;p<d.length;p++){var m=(f=d[p]).image[o].image;v.texImage2D(34069+o,p+1,h,m.width,m.height,0,c,u,m.data)}}else{v.texImage2D(34069+o,0,h,c,u,a[o]);for(p=0;p<d.length;p++){f=d[p];v.texImage2D(34069+o,p+1,h,c,u,f.image[o])}}n.__maxMipLevel=d.length}w(e,l)&&T(34067,e,s.width,s.height),n.__version=e.version,e.onUpdate&&e.onUpdate(e)}else v.activeTexture(33984+t),v.bindTexture(34067,n.__webglTexture)}}function u(e,t){v.activeTexture(33984+t),v.bindTexture(34067,y.get(e).__webglTexture)}function A(e,t,n){n?(g.texParameteri(e,10242,b.convert(t.wrapS)),g.texParameteri(e,10243,b.convert(t.wrapT)),32879!==e&&35866!==e||g.texParameteri(e,32882,b.convert(t.wrapR)),g.texParameteri(e,10240,b.convert(t.magFilter)),g.texParameteri(e,10241,b.convert(t.minFilter))):(g.texParameteri(e,10242,33071),g.texParameteri(e,10243,33071),32879!==e&&35866!==e||g.texParameteri(e,32882,33071),t.wrapS===be&&t.wrapT===be||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),g.texParameteri(e,10240,r(t.magFilter)),g.texParameteri(e,10241,r(t.minFilter)),t.minFilter!==Te&&t.minFilter!==Ae&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),(n=f.get("EXT_texture_filter_anisotropic"))&&(t.type===Fe&&null===f.get("OES_texture_float_linear")||t.type===Ne&&null===(x.isWebGL2||f.get("OES_texture_half_float_linear"))||(1<t.anisotropy||y.get(t).__currentAnisotropy)&&(g.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,x.getMaxAnisotropy())),y.get(t).__currentAnisotropy=t.anisotropy))}function C(e,t){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",i),e.__webglTexture=g.createTexture(),m.memory.textures++)}function h(e,t,n){var r=3553;t.isDataTexture2DArray&&(r=35866),t.isDataTexture3D&&(r=32879),C(e,t),v.activeTexture(33984+n),v.bindTexture(r,e.__webglTexture),g.pixelStorei(37440,t.flipY),g.pixelStorei(37441,t.premultiplyAlpha),g.pixelStorei(3317,t.unpackAlignment);var n=(i=t,!x.isWebGL2&&(i.wrapS!==be||i.wrapT!==be||i.minFilter!==Te&&i.minFilter!==Ae)&&!1===M(t.image)),i=_(t.image,n,!1,x.maxTextureSize),n=M(i)||x.isWebGL2,a=b.convert(t.format),o=b.convert(t.type),s=S(a,o);A(r,t,n);var l,c=t.mipmaps;if(t.isDepthTexture){if(s=6402,t.type===Fe){if(!x.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");s=36012}else x.isWebGL2&&(s=33189);t.format===Xe&&6402===s&&t.type!==Oe&&t.type!==Re&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),t.type=Oe,o=b.convert(t.type)),t.format===Ye&&(s=34041,t.type!==Be&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),t.type=Be,o=b.convert(t.type))),v.texImage2D(3553,0,s,i.width,i.height,0,a,o,null)}else if(t.isDataTexture)if(0<c.length&&n){for(var u=0,h=c.length;u<h;u++)l=c[u],v.texImage2D(3553,u,s,l.width,l.height,0,a,o,l.data);t.generateMipmaps=!1,e.__maxMipLevel=c.length-1}else v.texImage2D(3553,0,s,i.width,i.height,0,a,o,i.data),e.__maxMipLevel=0;else if(t.isCompressedTexture){for(u=0,h=c.length;u<h;u++)l=c[u],t.format!==Ge&&t.format!==He?-1<v.getCompressedTextureFormats().indexOf(a)?v.compressedTexImage2D(3553,u,s,l.width,l.height,0,l.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):v.texImage2D(3553,u,s,l.width,l.height,0,a,o,l.data);e.__maxMipLevel=c.length-1}else if(t.isDataTexture2DArray)v.texImage3D(35866,0,s,i.width,i.height,i.depth,0,a,o,i.data),e.__maxMipLevel=0;else if(t.isDataTexture3D)v.texImage3D(32879,0,s,i.width,i.height,i.depth,0,a,o,i.data),e.__maxMipLevel=0;else if(0<c.length&&n){for(u=0,h=c.length;u<h;u++)l=c[u],v.texImage2D(3553,u,s,a,o,l);t.generateMipmaps=!1,e.__maxMipLevel=c.length-1}else v.texImage2D(3553,0,s,a,o,i),e.__maxMipLevel=0;w(t,n)&&T(3553,t,i.width,i.height),e.__version=t.version,t.onUpdate&&t.onUpdate(t)}function P(e,t,n,r){var i=b.convert(t.texture.format),a=b.convert(t.texture.type),o=S(i,a);v.texImage2D(r,0,o,t.width,t.height,0,i,a,null),g.bindFramebuffer(36160,e),g.framebufferTexture2D(36160,n,r,y.get(t.texture).__webglTexture,0),g.bindFramebuffer(36160,null)}function L(e,t,n){var r;g.bindRenderbuffer(36161,e),t.depthBuffer&&!t.stencilBuffer?(n?(r=I(t),g.renderbufferStorageMultisample(36161,r,33189,t.width,t.height)):g.renderbufferStorage(36161,33189,t.width,t.height),g.framebufferRenderbuffer(36160,36096,36161,e)):t.depthBuffer&&t.stencilBuffer?(n?(r=I(t),g.renderbufferStorageMultisample(36161,r,35056,t.width,t.height)):g.renderbufferStorage(36161,34041,t.width,t.height),g.framebufferRenderbuffer(36160,33306,36161,e)):(e=S(b.convert(t.texture.format),b.convert(t.texture.type)),n?(r=I(t),g.renderbufferStorageMultisample(36161,r,e,t.width,t.height)):g.renderbufferStorage(36161,e,t.width,t.height)),g.bindRenderbuffer(36161,null)}function O(e){var t=y.get(e),n=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,t){if(t&&t.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(g.bindFramebuffer(36160,e),!t.depthTexture||!t.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(y.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),l(t.depthTexture,0),e=y.get(t.depthTexture).__webglTexture,t.depthTexture.format===Xe)g.framebufferTexture2D(36160,36096,3553,e,0);else{if(t.depthTexture.format!==Ye)throw new Error("Unknown depthTexture format");g.framebufferTexture2D(36160,33306,3553,e,0)}}(t.__webglFramebuffer,e)}else if(n){t.__webglDepthbuffer=[];for(var r=0;r<6;r++)g.bindFramebuffer(36160,t.__webglFramebuffer[r]),t.__webglDepthbuffer[r]=g.createRenderbuffer(),L(t.__webglDepthbuffer[r],e)}else g.bindFramebuffer(36160,t.__webglFramebuffer),t.__webglDepthbuffer=g.createRenderbuffer(),L(t.__webglDepthbuffer,e);g.bindFramebuffer(36160,null)}function I(e){return x.isWebGL2&&e.isWebGLMultisampleRenderTarget?Math.min(x.maxSamples,e.samples):0}var d=!1,p=!1;this.allocateTextureUnit=function(){var e=t;return e>=x.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+x.maxTextures),t+=1,e},this.resetTextureUnits=function(){t=0},this.setTexture2D=l,this.setTexture2DArray=function(e,t){var n=y.get(e);0<e.version&&n.__version!==e.version?h(n,e,t):(v.activeTexture(33984+t),v.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(e,t){var n=y.get(e);0<e.version&&n.__version!==e.version?h(n,e,t):(v.activeTexture(33984+t),v.bindTexture(32879,n.__webglTexture))},this.setTextureCube=c,this.setTextureCubeDynamic=u,this.setupRenderTarget=function(e){var t=y.get(e),n=y.get(e.texture);e.addEventListener("dispose",E),n.__webglTexture=g.createTexture(),m.memory.textures++;var r=!0===e.isWebGLRenderTargetCube,i=!0===e.isWebGLMultisampleRenderTarget,a=!0===e.isWebGLMultiviewRenderTarget,o=M(e)||x.isWebGL2;if(r){t.__webglFramebuffer=[];for(var s=0;s<6;s++)t.__webglFramebuffer[s]=g.createFramebuffer()}else if(t.__webglFramebuffer=g.createFramebuffer(),i)x.isWebGL2?(t.__webglMultisampledFramebuffer=g.createFramebuffer(),t.__webglColorRenderbuffer=g.createRenderbuffer(),g.bindRenderbuffer(36161,t.__webglColorRenderbuffer),d=S(b.convert(e.texture.format),b.convert(e.texture.type)),u=I(e),g.renderbufferStorageMultisample(36161,u,d,e.width,e.height),g.bindFramebuffer(36160,t.__webglMultisampledFramebuffer),g.framebufferRenderbuffer(36160,36064,36161,t.__webglColorRenderbuffer),g.bindRenderbuffer(36161,null),e.depthBuffer&&(t.__webglDepthRenderbuffer=g.createRenderbuffer(),L(t.__webglDepthRenderbuffer,e,!0)),g.bindFramebuffer(36160,null)):console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(a){var l=e.width,i=e.height,c=e.numViews;g.bindFramebuffer(36160,t.__webglFramebuffer);var u=f.get("OVR_multiview2");m.memory.textures+=2;var h=g.createTexture();g.bindTexture(35866,h),g.texParameteri(35866,10240,9728),g.texParameteri(35866,10241,9728),g.texImage3D(35866,0,32856,l,i,c,0,6408,5121,null),u.framebufferTextureMultiviewOVR(36160,36064,h,0,0,c);var d=g.createTexture();g.bindTexture(35866,d),g.texParameteri(35866,10240,9728),g.texParameteri(35866,10241,9728),g.texImage3D(35866,0,35056,l,i,c,0,34041,34042,null),u.framebufferTextureMultiviewOVR(36160,33306,d,0,0,c);for(var p=new Array(c),s=0;s<c;++s)p[s]=g.createFramebuffer(),g.bindFramebuffer(36160,p[s]),g.framebufferTextureLayer(36160,36064,h,0,s);t.__webglColorTexture=h,t.__webglDepthStencilTexture=d,t.__webglViewFramebuffers=p,g.bindFramebuffer(36160,null),g.bindTexture(35866,null)}if(r){v.bindTexture(34067,n.__webglTexture),A(34067,e.texture,o);for(s=0;s<6;s++)P(t.__webglFramebuffer[s],e,36064,34069+s);w(e.texture,o)&&T(34067,e.texture,e.width,e.height),v.bindTexture(34067,null)}else a||(v.bindTexture(3553,n.__webglTexture),A(3553,e.texture,o),P(t.__webglFramebuffer,e,36064,3553),w(e.texture,o)&&T(3553,e.texture,e.width,e.height),v.bindTexture(3553,null));e.depthBuffer&&O(e)},this.updateRenderTargetMipmap=function(e){var t,n,r=e.texture;w(r,M(e)||x.isWebGL2)&&(t=e.isWebGLRenderTargetCube?34067:3553,n=y.get(r).__webglTexture,v.bindTexture(t,n),T(t,r,e.width,e.height),v.bindTexture(t,null))},this.updateMultisampleRenderTarget=function(e){var t,n,r;e.isWebGLMultisampleRenderTarget&&(x.isWebGL2?(r=y.get(e),g.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),g.bindFramebuffer(36009,r.__webglFramebuffer),t=e.width,n=e.height,r=16384,e.depthBuffer&&(r|=256),e.stencilBuffer&&(r|=1024),g.blitFramebuffer(0,0,t,n,0,0,t,n,r,9728)):console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2."))},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===d&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),d=!0),e=e.texture),l(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===p&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),p=!0),e=e.texture),(e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?c:u)(e,t)}}function Co(e,n,r){return{convert:function(e){var t;if(e===xe)return 10497;if(e===be)return 33071;if(e===_e)return 33648;if(e===Te)return 9728;if(e===Se)return 9984;if(e===Ee)return 9986;if(e===Ae)return 9729;if(e===Ce)return 9985;if(e===Pe)return 9987;if(e===Le)return 5121;if(e===De)return 32819;if(e===ke)return 32820;if(e===Ue)return 33635;if(e===S)return 5120;if(e===E)return 5122;if(e===Oe)return 5123;if(e===Ie)return 5124;if(e===Re)return 5125;if(e===Fe)return 5126;if(e===Ne){if(r.isWebGL2)return 5131;if(null!==(t=n.get("OES_texture_half_float")))return t.HALF_FLOAT_OES}if(e===ze)return 6406;if(e===He)return 6407;if(e===Ge)return 6408;if(e===je)return 6409;if(e===We)return 6410;if(e===Xe)return 6402;if(e===Ye)return 34041;if(e===qe)return 6403;if(e===ce)return 32774;if(e===l)return 32778;if(e===c)return 32779;if(e===f)return 0;if(e===m)return 1;if(e===g)return 768;if(e===v)return 769;if(e===y)return 770;if(e===x)return 771;if(e===b)return 772;if(e===_)return 773;if(e===M)return 774;if(e===w)return 775;if(e===T)return 776;if((e===Qe||e===Ze||e===Je||e===Ke)&&null!==(t=n.get("WEBGL_compressed_texture_s3tc"))){if(e===Qe)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ze)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Je)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Ke)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===$e||e===et||e===tt||e===nt)&&null!==(t=n.get("WEBGL_compressed_texture_pvrtc"))){if(e===$e)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===et)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===tt)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===nt)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===rt&&null!==(t=n.get("WEBGL_compressed_texture_etc1")))return t.COMPRESSED_RGB_ETC1_WEBGL;if((e===it||e===at||e===ot||e===st||e===lt||e===ct||e===ut||e===ht||e===dt||e===pt||e===ft||e===mt||e===gt||e===vt)&&null!==(t=n.get("WEBGL_compressed_texture_astc")))return e;if(e===h||e===p){if(r.isWebGL2){if(e===h)return 32775;if(e===p)return 32776}if(null!==(t=n.get("EXT_blend_minmax"))){if(e===h)return t.MIN_EXT;if(e===p)return t.MAX_EXT}}if(e===Be){if(r.isWebGL2)return 34042;if(null!==(t=n.get("WEBGL_depth_texture")))return t.UNSIGNED_INT_24_8_WEBGL}return 0}}}function Po(e,t,n,r){$t.call(this,e,t,r),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}function Lo(n,h){var d,r,a,o,i,p,s,l=2,c=n.extensions,f=n.properties,u=0;function m(e){return e.isArrayCamera?e.cameras:(i[0]=e,i)}this.isAvailable=function(){if(void 0===s){var e=c.get("OVR_multiview2");if(s=null!==e&&!1===h.getContextAttributes().antialias){u=h.getParameter(e.MAX_VIEWS_OVR),d=new Po(0,0,l),p=new Ht,o=[],a=[],i=[];for(var t=0;t<u;t++)o[t]=new cn,a[t]=new qt}}return s},this.attachCamera=function(e){var t;!1!==function(e){if(void 0===e.isArrayCamera)return!0;var t=e.cameras;if(t.length>u)return!1;for(var n=1,r=t.length;n<r;n++)if(t[0].viewport.z!==t[n].viewport.z||t[0].viewport.w!==t[n].viewport.w)return!1;return!0}(e)&&(r=n.getRenderTarget(),t=e,r?p.set(r.width,r.height):n.getDrawingBufferSize(p),t.isArrayCamera?(e=t.cameras[0].viewport,d.setSize(e.z,e.w),d.setNumViews(t.cameras.length)):(d.setSize(p.x,p.y),d.setNumViews(l)),n.setRenderTarget(d))},this.detachCamera=function(e){d===n.getRenderTarget()&&(n.setRenderTarget(r),function(e){var t=d,n=t.numViews,r=f.get(t).__webglViewFramebuffers,i=t.width,a=t.height;if(e.isArrayCamera)for(var o=0;o<n;o++){var s=e.cameras[o].viewport,l=s.x,c=s.y,u=l+s.z,s=c+s.w;h.bindFramebuffer(36008,r[o]),h.blitFramebuffer(0,0,i,a,l,c,u,s,16384,9728)}else h.bindFramebuffer(36008,r[0]),h.blitFramebuffer(0,0,i,a,0,0,p.x,p.y,16384,9728)}(e))},this.updateCameraProjectionMatricesUniform=function(e,t){for(var n=m(e),r=0;r<n.length;r++)o[r].copy(n[r].projectionMatrix);t.setValue(h,"projectionMatrices",o)},this.updateCameraViewMatricesUniform=function(e,t){for(var n=m(e),r=0;r<n.length;r++)o[r].copy(n[r].matrixWorldInverse);t.setValue(h,"viewMatrices",o)},this.updateObjectMatricesUniforms=function(e,t,n){for(var r=m(t),i=0;i<r.length;i++)o[i].multiplyMatrices(r[i].matrixWorldInverse,e.matrixWorld),a[i].getNormalMatrix(o[i]);n.setValue(h,"modelViewMatrices",o),n.setValue(h,"normalMatrices",a)}}function Oo(){An.call(this),this.type="Group"}function Io(e){_i.call(this),this.cameras=e||[]}Po.prototype=Object.assign(Object.create($t.prototype),{constructor:Po,isWebGLMultiviewRenderTarget:!0,copy:function(e){return $t.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),Oo.prototype=Object.assign(Object.create(An.prototype),{constructor:Oo,isGroup:!0}),Io.prototype=Object.assign(Object.create(_i.prototype),{constructor:Io,isArrayCamera:!0});var Ro,Fo=new Vt,No=new Vt;function Do(e,t,n){Fo.setFromMatrixPosition(t.matrixWorld),No.setFromMatrixPosition(n.matrixWorld);var r=Fo.distanceTo(No),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],n=(a[8]+1)/a[0],i=o*u,a=o*n,n=r/(n-u),u=n*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(u),e.translateZ(n),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);o+=n,n=s+n;e.projectionMatrix.makePerspective(i-u,r-u+a,l*s/n*o,c*s/n*o,o,n)}function ko(t){var n,r,i=this,a=null,o=null,s=null,l=[],c=new cn,u=new cn,h=1,d="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(o=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",e,!1));var p=new cn,f=new Gt,m=new Vt,g=new _i;g.viewport=new Kt,g.layers.enable(1);var v=new _i;v.viewport=new Kt,v.layers.enable(2);var y=new Io([g,v]);function x(){return null!==a&&!0===a.isPresenting}y.layers.enable(1),y.layers.enable(2);var b,_=new Ht;function e(){var e;x()?(e=a.getEyeParameters("left"),n=2*e.renderWidth*h,r=e.renderHeight*h,b=t.getPixelRatio(),t.getSize(_),t.setDrawingBufferSize(n,r,1),g.viewport.set(0,0,n/2,r),v.viewport.set(n/2,0,n/2,r),S.start(),i.dispatchEvent({type:"sessionstart"})):(i.enabled&&t.setDrawingBufferSize(_.width,_.height,b),S.stop(),i.dispatchEvent({type:"sessionend"}))}var M=[];function w(){for(var e=0;e<l.length;e++){var t=l[e],n=function(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),n=0,r=0,i=t.length;n<i;n++){var a=t[n];if(a&&("Daydream Controller"===a.id||"Gear VR Controller"===a.id||"Oculus Go Controller"===a.id||"OpenVR Gamepad"===a.id||a.id.startsWith("Oculus Touch")||a.id.startsWith("HTC Vive Focus")||a.id.startsWith("Spatial Controller"))){if(r===e)return a;r++}}}(e);if(void 0!==n&&void 0!==n.pose){if(null===n.pose)return;var r=n.pose;!1===r.hasPosition&&t.position.set(.2,-.6,-.05),null!==r.position&&t.position.fromArray(r.position),null!==r.orientation&&t.quaternion.fromArray(r.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(c),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;r="Daydream Controller"===n.id?0:1;void 0===M[e]&&(M[e]=!1),M[e]!==n.buttons[r].pressed&&(M[e]=n.buttons[r].pressed,!0===M[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}function T(e,t){null!==t&&4===t.length&&e.set(t[0]*n,t[1]*r,t[2]*n,t[3]*r)}this.enabled=!1,this.getController=function(e){var t=l[e];return void 0===t&&((t=new Oo).matrixAutoUpdate=!1,t.visible=!1,l[e]=t),t},this.getDevice=function(){return a},this.setDevice=function(e){void 0!==e&&(a=e),S.setContext(e)},this.setFramebufferScaleFactor=function(e){h=e},this.setReferenceSpaceType=function(e){d=e},this.setPoseTarget=function(e){void 0!==e&&(s=e)},this.getCamera=function(e){var t="local-floor"===d?1.6:0;if(!1===x())return e.position.set(0,t,0),e.rotation.set(0,0,0),e;a.depthNear=e.near,a.depthFar=e.far,a.getFrameData(o),"local-floor"===d&&((n=a.stageParameters)?c.fromArray(n.sittingToStandingTransform):c.makeTranslation(0,t,0));var n=o.pose,t=null!==s?s:e;t.matrix.copy(c),t.matrix.decompose(t.position,t.quaternion,t.scale),null!==n.orientation&&(f.fromArray(n.orientation),t.quaternion.multiply(f)),null!==n.position&&(f.setFromRotationMatrix(c),m.fromArray(n.position),m.applyQuaternion(f),t.position.add(m)),t.updateMatrixWorld(),g.near=e.near,v.near=e.near,g.far=e.far,v.far=e.far,g.matrixWorldInverse.fromArray(o.leftViewMatrix),v.matrixWorldInverse.fromArray(o.rightViewMatrix),u.getInverse(c),"local-floor"===d&&(g.matrixWorldInverse.multiply(u),v.matrixWorldInverse.multiply(u));t=t.parent;null!==t&&(p.getInverse(t.matrixWorld),g.matrixWorldInverse.multiply(p),v.matrixWorldInverse.multiply(p)),g.matrixWorld.getInverse(g.matrixWorldInverse),v.matrixWorld.getInverse(v.matrixWorldInverse),g.projectionMatrix.fromArray(o.leftProjectionMatrix),v.projectionMatrix.fromArray(o.rightProjectionMatrix),Do(y,g,v);t=a.getLayers();return t.length&&(t=t[0],T(g.viewport,t.leftBounds),T(v.viewport,t.rightBounds)),w(),y},this.getStandingMatrix=function(){return c},this.isPresenting=x;var S=new Ni;this.setAnimationLoop=function(e){S.setAnimationLoop(e),x()&&S.start()},this.submitFrame=function(){x()&&a.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",e)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function Uo(h,t){var n=this,d=null,p=null,r="local-floor",f=null,m=[],g=[];function o(){return null!==d&&null!==p}var s=new _i;s.layers.enable(1),s.viewport=new Kt;var l=new _i;l.layers.enable(2),l.viewport=new Kt;var v=new Io([s,l]);function i(e){for(var t=0;t<m.length;t++)g[t]===e.inputSource&&m[t].dispatchEvent({type:e.type})}function a(){h.setFramebuffer(null),h.setRenderTarget(h.getRenderTarget()),x.stop(),n.dispatchEvent({type:"sessionend"})}function c(e){p=e,x.setContext(d),x.start(),n.dispatchEvent({type:"sessionstart"})}function u(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}v.layers.enable(1),v.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=m[e];return void 0===t&&((t=new Oo).matrixAutoUpdate=!1,t.visible=!1,m[e]=t),t},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(e){r=e},this.getSession=function(){return d},this.setSession=function(e){null!==(d=e)&&(d.addEventListener("select",i),d.addEventListener("selectstart",i),d.addEventListener("selectend",i),d.addEventListener("end",a),d.updateRenderState({baseLayer:new XRWebGLLayer(d,t)}),d.requestReferenceSpace(r).then(c),g=d.inputSources,d.addEventListener("inputsourceschange",function(){g=d.inputSources,console.log(g);for(var e=0;e<m.length;e++)m[e].userData.inputSource=g[e]}))},this.getCamera=function(e){if(o()){var t=e.parent,n=v.cameras;u(v,t);for(var r=0;r<n.length;r++)u(n[r],t);e.matrixWorld.copy(v.matrixWorld);for(var i=e.children,r=0,a=i.length;r<a;r++)i[r].updateMatrixWorld(!0);return Do(v,s,l),v}return e},this.isPresenting=o;var y=null;var x=new Ni;x.setAnimationLoop(function(e,t){if(null!==(f=t.getViewerPose(p))){var n=f.views,r=d.renderState.baseLayer;h.setFramebuffer(r.framebuffer);for(var i=0;i<n.length;i++){var a=n[i],o=r.getViewport(a),s=a.transform.inverse.matrix,l=v.cameras[i];l.matrix.fromArray(s).getInverse(l.matrix),l.projectionMatrix.fromArray(a.projectionMatrix),l.viewport.set(o.x,o.y,o.width,o.height),0===i&&v.matrix.copy(l.matrix)}}for(i=0;i<m.length;i++){var c=m[i],u=g[i];if(u){u=t.getPose(u.targetRaySpace,p);if(null!==u){c.matrix.fromArray(u.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.visible=!0;continue}}c.visible=!1}y&&y(e)}),this.setAnimationLoop=function(e){y=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new cn},this.getDevice=function(){console.warn("THREE.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("THREE.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("THREE.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function Bo(e){var r=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,f=null,_=null;this.domElement=r,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=we,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var M,b,w,T,m,S,E,A,h,g,d,p,v,y,x,C,P,L,O=this,I=!1,R=null,F=0,N=0,D=null,k=null,U=-1,B={geometry:null,program:null,wireframe:!1},z=null,H=null,G=new Kt,j=new Kt,W=null,V=r.width,X=r.height,Y=1,q=new Kt(0,0,V,X),Q=new Kt(0,0,V,X),Z=!1,J=new Oi,K=new Gi,$=!1,ee=!1,te=new cn,ne=new Vt;function re(){return null===D?Y:1}try{var ie={alpha:n,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u,xrCompatible:!0};if(r.addEventListener("webglcontextlost",ce,!1),r.addEventListener("webglcontextrestored",ue,!1),null===(M=t||r.getContext("webgl",ie)||r.getContext("experimental-webgl",ie)))throw null!==r.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===M.getShaderPrecisionFormat&&(M.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ae(){b=new ji(M),!1===(w=new Hi(M,b,e)).isWebGL2&&(b.get("WEBGL_depth_texture"),b.get("OES_texture_float"),b.get("OES_texture_half_float"),b.get("OES_texture_half_float_linear"),b.get("OES_standard_derivatives"),b.get("OES_element_index_uint"),b.get("ANGLE_instanced_arrays")),b.get("OES_texture_float_linear"),L=new Co(0,b,w),(T=new Eo(M,b,L,w)).scissor(j.copy(Q).multiplyScalar(Y).floor()),T.viewport(G.copy(q).multiplyScalar(Y).floor()),m=new Xi,S=new co,E=new Ao(M,b,T,S,w,L,m),A=new Di(M),h=new Wi(0,A,m),g=new Qi(0,h,A,m),x=new qi(M),d=new lo(O,b,w),p=new fo,v=new bo,y=new Bi(O,T,g,s),C=new zi(M,b,m,w),P=new Vi(M,b,m,w),m.programs=d.programs,O.capabilities=w,O.extensions=b,O.properties=S,O.renderLists=p,O.state=T,O.info=m}ae();var oe="undefined"!=typeof navigator&&"xr"in navigator&&"supportsSession"in navigator.xr?new Uo(O,M):new ko(O);this.vr=oe;var se=new Lo(O,M),le=new So(O,g,w.maxTextureSize);function ce(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function ue(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1,ae()}function he(e){e=e.target;e.removeEventListener("dispose",he),de(e=e),S.remove(e)}function de(e){var t=S.get(e).program;(e.program=void 0)!==t&&d.releaseProgram(t)}this.shadowMap=le,this.getContext=function(){return M},this.getContextAttributes=function(){return M.getContextAttributes()},this.forceContextLoss=function(){var e=b.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=b.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(e){void 0!==e&&(Y=e,this.setSize(V,X,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Ht),e.set(V,X)},this.setSize=function(e,t,n){oe.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(V=e,X=t,r.width=Math.floor(e*Y),r.height=Math.floor(t*Y),!1!==n&&(r.style.width=e+"px",r.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Ht),e.set(V*Y,X*Y).floor()},this.setDrawingBufferSize=function(e,t,n){V=e,X=t,Y=n,r.width=Math.floor(e*n),r.height=Math.floor(t*n),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Kt),e.copy(G)},this.getViewport=function(e){return e.copy(q)},this.setViewport=function(e,t,n,r){e.isVector4?q.set(e.x,e.y,e.z,e.w):q.set(e,t,n,r),T.viewport(G.copy(q).multiplyScalar(Y).floor())},this.getScissor=function(e){return e.copy(Q)},this.setScissor=function(e,t,n,r){e.isVector4?Q.set(e.x,e.y,e.z,e.w):Q.set(e,t,n,r),T.scissor(j.copy(Q).multiplyScalar(Y).floor())},this.getScissorTest=function(){return Z},this.setScissorTest=function(e){T.setScissorTest(Z=e)},this.getClearColor=function(){return y.getClearColor()},this.setClearColor=function(){y.setClearColor.apply(y,arguments)},this.getClearAlpha=function(){return y.getClearAlpha()},this.setClearAlpha=function(){y.setClearAlpha.apply(y,arguments)},this.clear=function(e,t,n){var r=0;void 0!==e&&!e||(r|=16384),void 0!==t&&!t||(r|=256),void 0!==n&&!n||(r|=1024),M.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){r.removeEventListener("webglcontextlost",ce,!1),r.removeEventListener("webglcontextrestored",ue,!1),p.dispose(),v.dispose(),S.dispose(),g.dispose(),oe.dispose(),fe.stop()},this.renderBufferImmediate=function(e,t){T.initAttributes();var n=S.get(e);e.hasPositions&&!n.position&&(n.position=M.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=M.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=M.createBuffer()),e.hasColors&&!n.color&&(n.color=M.createBuffer());t=t.getAttributes();e.hasPositions&&(M.bindBuffer(34962,n.position),M.bufferData(34962,e.positionArray,35048),T.enableAttribute(t.position),M.vertexAttribPointer(t.position,3,5126,!1,0,0)),e.hasNormals&&(M.bindBuffer(34962,n.normal),M.bufferData(34962,e.normalArray,35048),T.enableAttribute(t.normal),M.vertexAttribPointer(t.normal,3,5126,!1,0,0)),e.hasUvs&&(M.bindBuffer(34962,n.uv),M.bufferData(34962,e.uvArray,35048),T.enableAttribute(t.uv),M.vertexAttribPointer(t.uv,2,5126,!1,0,0)),e.hasColors&&(M.bindBuffer(34962,n.color),M.bufferData(34962,e.colorArray,35048),T.enableAttribute(t.color),M.vertexAttribPointer(t.color,3,5126,!1,0,0)),T.disableUnusedAttributes(),M.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,a){var o=i.isMesh&&i.matrixWorld.determinant()<0;T.setMaterial(r,o);var s=ye(e,t,r,i),l=!1;B.geometry===n.id&&B.program===s.id&&B.wireframe===(!0===r.wireframe)||(B.geometry=n.id,B.program=s.id,B.wireframe=!0===r.wireframe,l=!0),i.morphTargetInfluences&&(x.update(i,n,r,s),l=!0);o=n.index,e=n.attributes.position,t=1;!0===r.wireframe&&(o=h.getWireframeAttribute(n),t=2);var c=C;null!==o&&(u=A.get(o),(c=P).setIndex(u)),l&&(function(e,t,n,r){if(!1===w.isWebGL2&&(e.isInstancedMesh||t.isInstancedBufferGeometry)&&null===b.get("ANGLE_instanced_arrays"))return;T.initAttributes();var i,a=t.attributes,o=r.getAttributes(),s=n.defaultAttributeValues;for(i in o){var l=o[i];if(0<=l){var c=a[i];if(void 0!==c){var u,h,d,p,f,m,g,v=c.normalized,y=c.itemSize;void 0!==(u=A.get(c))&&(h=u.buffer,d=u.type,p=u.bytesPerElement,c.isInterleavedBufferAttribute?(f=c.data,m=f.stride,g=c.offset,f&&f.isInstancedInterleavedBuffer?(T.enableAttributeAndDivisor(l,f.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=f.meshPerAttribute*f.count)):T.enableAttribute(l),M.bindBuffer(34962,h),M.vertexAttribPointer(l,y,d,v,m*p,g*p)):(c.isInstancedBufferAttribute?(T.enableAttributeAndDivisor(l,c.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=c.meshPerAttribute*c.count)):T.enableAttribute(l),M.bindBuffer(34962,h),M.vertexAttribPointer(l,y,d,v,0,0)))}else if("instanceMatrix"===i)void 0!==(u=A.get(e.instanceMatrix))&&(h=u.buffer,d=u.type,T.enableAttributeAndDivisor(l+0,1),T.enableAttributeAndDivisor(l+1,1),T.enableAttributeAndDivisor(l+2,1),T.enableAttributeAndDivisor(l+3,1),M.bindBuffer(34962,h),M.vertexAttribPointer(l+0,4,d,!1,64,0),M.vertexAttribPointer(l+1,4,d,!1,64,16),M.vertexAttribPointer(l+2,4,d,!1,64,32),M.vertexAttribPointer(l+3,4,d,!1,64,48));else if(void 0!==s){var x=s[i];if(void 0!==x)switch(x.length){case 2:M.vertexAttrib2fv(l,x);break;case 3:M.vertexAttrib3fv(l,x);break;case 4:M.vertexAttrib4fv(l,x);break;default:M.vertexAttrib1fv(l,x)}}}}T.disableUnusedAttributes()}(i,n,r,s),null!==o&&M.bindBuffer(34963,u.buffer));s=1/0;null!==o?s=o.count:void 0!==e&&(s=e.count);var u=n.drawRange.start*t,o=n.drawRange.count*t,e=null!==a?a.start*t:0,a=null!==a?a.count*t:1/0,t=Math.max(u,e),a=Math.min(s,u+o,e+a)-1,a=Math.max(0,a-t+1);if(0!==a){if(i.isMesh)if(!0===r.wireframe)T.setLineWidth(r.wireframeLinewidth*re()),c.setMode(1);else switch(i.drawMode){case Mt:c.setMode(4);break;case 1:c.setMode(5);break;case 2:c.setMode(6)}else i.isLine?(r=r.linewidth,T.setLineWidth((r=void 0===r?1:r)*re()),i.isLineSegments?c.setMode(1):i.isLineLoop?c.setMode(2):c.setMode(3)):i.isPoints?c.setMode(0):i.isSprite&&c.setMode(4);i.isInstancedMesh?c.renderInstances(n,t,a,i.count):n.isInstancedBufferGeometry?c.renderInstances(n,t,a,n.maxInstancedCount):c.render(t,a)}},this.compile=function(n,e){(_=v.get(n,e)).init(),n.traverse(function(e){e.isLight&&(_.pushLight(e),e.castShadow&&_.pushShadow(e))}),_.setupLights(e),n.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var t=0;t<e.material.length;t++)ve(e.material[t],n.fog,e);else ve(e.material,n.fog,e)})};var pe=null;var fe=new Ni;function me(e,t,n,r){for(var i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,l=o.geometry,c=void 0===r?o.material:r,u=o.group;if(n.isArrayCamera)if(H=n,oe.enabled&&se.isAvailable())ge(s,t,n,l,c,u);else for(var h=n.cameras,d=0,p=h.length;d<p;d++){var f=h[d];s.layers.test(f.layers)&&(T.viewport(G.copy(f.viewport)),_.setupLights(f),ge(s,t,f,l,c,u))}else H=null,ge(s,t,n,l,c,u)}}function ge(e,t,n,r,i,a){var o,s;e.onBeforeRender(O,t,n,r,i,a),_=v.get(t,H||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject?(T.setMaterial(i),o=ye(n,t.fog,i,e),B.geometry=null,B.program=null,B.wireframe=!1,s=o,e.render(function(e){O.renderBufferImmediate(e,s)})):O.renderBufferDirect(n,t.fog,r,i,e,a),e.onAfterRender(O,t,n,r,i,a),_=v.get(t,H||n)}function ve(e,t,n){var r=S.get(e),i=_.state.lights,a=_.state.shadowsArray,o=i.state.version,s=d.getParameters(e,i.state,a,t,K.numPlanes,K.numIntersection,n),l=d.getProgramCode(e,s),a=r.program,n=!0;if(void 0===a)e.addEventListener("dispose",he);else if(a.code!==l)de(e);else if(r.lightsStateVersion!==o)r.lightsStateVersion=o,n=!1;else{if(void 0!==s.shaderID)return;n=!1}n&&(s.shaderID?(n=Fi[s.shaderID],r.shader={name:e.type,uniforms:fi(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}):r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader},e.onBeforeCompile(r.shader,O),l=d.getProgramCode(e,s),a=d.acquireProgram(e,r.shader,s,l),r.program=a,e.program=a);var c=a.getAttributes();if(e.morphTargets)for(var u=e.numSupportedMorphTargets=0;u<O.maxMorphTargets;u++)0<=c["morphTarget"+u]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(u=e.numSupportedMorphNormals=0;u<O.maxMorphNormals;u++)0<=c["morphNormal"+u]&&e.numSupportedMorphNormals++;a=r.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=K.numPlanes,r.numIntersection=K.numIntersection,a.clippingPlanes=K.uniform),r.fog=t,r.needsLights=(t=e).isMeshLambertMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights,r.lightsStateVersion=o,r.needsLights&&(a.ambientLightColor.value=i.state.ambient,a.lightProbe.value=i.state.probe,a.directionalLights.value=i.state.directional,a.spotLights.value=i.state.spot,a.rectAreaLights.value=i.state.rectArea,a.pointLights.value=i.state.point,a.hemisphereLights.value=i.state.hemi,a.directionalShadowMap.value=i.state.directionalShadowMap,a.directionalShadowMatrix.value=i.state.directionalShadowMatrix,a.spotShadowMap.value=i.state.spotShadowMap,a.spotShadowMatrix.value=i.state.spotShadowMatrix,a.pointShadowMap.value=i.state.pointShadowMap,a.pointShadowMatrix.value=i.state.pointShadowMatrix);i=r.program.getUniforms(),a=Va.seqWithValue(i.seq,a);r.uniformsList=a}function ye(e,t,n,r){E.resetTextureUnits();var i=S.get(n),a=_.state.lights;$&&(!ee&&e===z||(o=e===z&&n.id===U,K.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,i,o))),!1===n.needsUpdate&&(void 0===i.program||n.fog&&i.fog!==t||i.needsLights&&i.lightsStateVersion!==a.state.version||void 0!==i.numClippingPlanes&&(i.numClippingPlanes!==K.numPlanes||i.numIntersection!==K.numIntersection))&&(n.needsUpdate=!0),n.needsUpdate&&(ve(n,t,r),n.needsUpdate=!1);var o,s,l,c,u,h,d,p,f,m=!1,g=!1,v=!1,y=i.program,x=y.getUniforms(),b=i.shader.uniforms;return T.useProgram(y.program)&&(v=g=m=!0),n.id!==U&&(U=n.id,g=!0),!m&&z===e||(0<y.numMultiviewViews?se.updateCameraProjectionMatricesUniform(e,x):x.setValue(M,"projectionMatrix",e.projectionMatrix),w.logarithmicDepthBuffer&&x.setValue(M,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),z!==e&&(z=e,v=g=!0),!(n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.envMap)||void 0!==(s=x.map.cameraPosition)&&s.setValue(M,ne.setFromMatrixPosition(e.matrixWorld)),(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&(0<y.numMultiviewViews?se.updateCameraViewMatricesUniform(e,x):x.setValue(M,"viewMatrix",e.matrixWorldInverse))),n.skinning&&(x.setOptional(M,r,"bindMatrix"),x.setOptional(M,r,"bindMatrixInverse"),(o=r.skeleton)&&(a=o.bones,w.floatVertexTextures?(void 0===o.boneTexture&&(m=Math.sqrt(4*a.length),m=zt.ceilPowerOfTwo(m),m=Math.max(m,4),(s=new Float32Array(m*m*4)).set(o.boneMatrices),a=new Ti(s,m,m,Ge,Fe),o.boneMatrices=s,o.boneTexture=a,o.boneTextureSize=m),x.setValue(M,"boneTexture",o.boneTexture,E),x.setValue(M,"boneTextureSize",o.boneTextureSize)):x.setOptional(M,o,"boneMatrices"))),!g&&i.receiveShadow===r.receiveShadow||(i.receiveShadow=r.receiveShadow,x.setValue(M,"receiveShadow",r.receiveShadow)),g&&(x.setValue(M,"toneMappingExposure",O.toneMappingExposure),x.setValue(M,"toneMappingWhitePoint",O.toneMappingWhitePoint),i.needsLights&&(f=v,(v=b).ambientLightColor.needsUpdate=f,v.lightProbe.needsUpdate=f,v.directionalLights.needsUpdate=f,v.pointLights.needsUpdate=f,v.spotLights.needsUpdate=f,v.rectAreaLights.needsUpdate=f,v.hemisphereLights.needsUpdate=f),t&&n.fog&&(f=t,(t=b).fogColor.value.copy(f.color),f.isFog?(t.fogNear.value=f.near,t.fogFar.value=f.far):f.isFogExp2&&(t.fogDensity.value=f.density)),n.isMeshBasicMaterial?xe(b,n):n.isMeshLambertMaterial?(xe(b,n),d=b,(p=n).emissiveMap&&(d.emissiveMap.value=p.emissiveMap)):n.isMeshPhongMaterial?(xe(b,n),n.isMeshToonMaterial?(be(d=b,p=n),p.gradientMap&&(d.gradientMap.value=p.gradientMap)):be(b,n)):n.isMeshStandardMaterial?(xe(b,n),(n.isMeshPhysicalMaterial?function(e,t){_e(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===Me&&e.clearcoatNormalScale.value.negate());e.transparency.value=t.transparency}:_e)(b,n)):n.isMeshMatcapMaterial?(xe(b,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Me&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Me&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(b,n)):n.isMeshDepthMaterial?(xe(b,n),u=b,(h=n).displacementMap&&(u.displacementMap.value=h.displacementMap,u.displacementScale.value=h.displacementScale,u.displacementBias.value=h.displacementBias)):n.isMeshDistanceMaterial?(xe(b,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(b,n)):n.isMeshNormalMaterial?(xe(b,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Me&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Me&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(b,n)):n.isLineBasicMaterial?(u=n,(h=b).diffuse.value.copy(u.color),h.opacity.value=u.opacity,n.isLineDashedMaterial&&(h=n,(u=b).dashSize.value=h.dashSize,u.totalSize.value=h.dashSize+h.gapSize,u.scale.value=h.scale)):n.isPointsMaterial?(c=n,(l=b).diffuse.value.copy(c.color),l.opacity.value=c.opacity,l.size.value=c.size*Y,l.scale.value=.5*X,l.map.value=c.map,null!==c.map&&(!0===c.map.matrixAutoUpdate&&c.map.updateMatrix(),l.uvTransform.value.copy(c.map.matrix))):n.isSpriteMaterial?(l=n,(c=b).diffuse.value.copy(l.color),c.opacity.value=l.opacity,c.rotation.value=l.rotation,c.map.value=l.map,null!==l.map&&(!0===l.map.matrixAutoUpdate&&l.map.updateMatrix(),c.uvTransform.value.copy(l.map.matrix))):n.isShadowMaterial&&(b.color.value.copy(n.color),b.opacity.value=n.opacity),void 0!==b.ltc_1&&(b.ltc_1.value=Ri.LTC_1),void 0!==b.ltc_2&&(b.ltc_2.value=Ri.LTC_2),Va.upload(M,i.uniformsList,b,E)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Va.upload(M,i.uniformsList,b,E),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&x.setValue(M,"center",r.center),0<y.numMultiviewViews?se.updateObjectMatricesUniforms(r,e,x):(x.setValue(M,"modelViewMatrix",r.modelViewMatrix),x.setValue(M,"normalMatrix",r.normalMatrix)),x.setValue(M,"modelMatrix",r.matrixWorld),y}function xe(e,t){var n;e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=S.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.normalMap2?n=t.normalMap2:t.normalMap3?n=t.normalMap3:t.normalMap4?n=t.normalMap4:t.normalMap5?n=t.normalMap5:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n&&(!0===(n=n.isWebGLRenderTarget?n.texture:n).matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function be(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Me&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Me&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function _e(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Me&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Me&&e.normalScale.value.negate()),t.normalMap2&&(e.normalMap2.value=t.normalMap2),t.normalMap3&&(e.normalMap3.value=t.normalMap3),t.normalMap4&&(e.normalMap4.value=t.normalMap4),t.normalMap5&&(e.normalMap5.value=t.normalMap5),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}fe.setAnimationLoop(function(e){oe.isPresenting()||pe&&pe(e)}),"undefined"!=typeof window&&fe.setContext(window),this.setAnimationLoop=function(e){pe=e,oe.setAnimationLoop(e),fe.start()},this.render=function(e,t){var n,r,i;void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),t&&t.isCamera?I||(B.geometry=null,B.program=null,B.wireframe=!1,U=-1,!(z=null)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),oe.enabled&&(t=oe.getCamera(t)),(_=v.get(e,t)).init(),e.onBeforeRender(O,e,t,r||D),te.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),J.setFromMatrix(te),ee=this.localClippingEnabled,$=K.init(this.clippingPlanes,ee,t),(f=p.get(e,t)).init(),function e(t,n,r,i){if(!1===t.visible)return;var a=t.layers.test(n.layers);if(a)if(t.isGroup)r=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(n);else if(t.isLight)_.pushLight(t),t.castShadow&&_.pushShadow(t);else if(t.isSprite)t.frustumCulled&&!J.intersectsSprite(t)||(i&&ne.setFromMatrixPosition(t.matrixWorld).applyMatrix4(te),o=g.update(t),(s=t.material).visible&&f.push(t,o,s,r,ne.z,null));else if(t.isImmediateRenderObject)i&&ne.setFromMatrixPosition(t.matrixWorld).applyMatrix4(te),f.push(t,null,t.material,r,ne.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==m.render.frame&&(t.skeleton.update(),t.skeleton.frame=m.render.frame),!t.frustumCulled||J.intersectsObject(t))){i&&ne.setFromMatrixPosition(t.matrixWorld).applyMatrix4(te);var o=g.update(t),s=t.material;if(Array.isArray(s))for(var l=o.groups,c=0,u=l.length;c<u;c++){var h=l[c],d=s[h.materialIndex];d&&d.visible&&f.push(t,o,d,r,ne.z,h)}else s.visible&&f.push(t,o,s,r,ne.z,null)}var p=t.children;for(var c=0,u=p.length;c<u;c++)e(p[c],n,r,i)}(e,t,0,O.sortObjects),!0===O.sortObjects&&f.sort(),$&&K.beginShadows(),n=_.state.shadowsArray,le.render(n,e,t),_.setupLights(t),$&&K.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),oe.enabled&&se.isAvailable()&&se.attachCamera(t),y.render(f,e,t,i),n=f.opaque,r=f.transparent,e.overrideMaterial?(i=e.overrideMaterial,n.length&&me(n,e,t,i),r.length&&me(r,e,t,i)):(n.length&&me(n,e,t),r.length&&me(r,e,t)),e.onAfterRender(O,e,t),null!==D&&(E.updateRenderTargetMipmap(D),E.updateMultisampleRenderTarget(D)),T.buffers.depth.setTest(!0),T.buffers.depth.setMask(!0),T.buffers.color.setMask(!0),T.setPolygonOffset(!1),oe.enabled&&(se.isAvailable()&&se.detachCamera(t),oe.submitFrame()),_=f=null):console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){R!==e&&M.bindFramebuffer(36160,e),R=e},this.getActiveCubeFace=function(){return F},this.getActiveMipmapLevel=function(){return N},this.getRenderTarget=function(){return D},this.setRenderTarget=function(e,t,n){F=t,N=n,(D=e)&&void 0===S.get(e).__webglFramebuffer&&E.setupRenderTarget(e);var r,i=R,a=!1;W=e?(r=S.get(e).__webglFramebuffer,e.isWebGLRenderTargetCube?(i=r[t||0],a=!0):i=e.isWebGLMultisampleRenderTarget?S.get(e).__webglMultisampledFramebuffer:r,G.copy(e.viewport),j.copy(e.scissor),e.scissorTest):(G.copy(q).multiplyScalar(Y).floor(),j.copy(Q).multiplyScalar(Y).floor(),Z),k!==i&&(M.bindFramebuffer(36160,i),k=i),T.viewport(G),T.scissor(j),T.setScissorTest(W),a&&(e=S.get(e.texture),M.framebufferTexture2D(36160,36064,34069+(t||0),e.__webglTexture,n||0))},this.readRenderTargetPixels=function(e,t,n,r,i,a,o){if(e&&e.isWebGLRenderTarget){var s=S.get(e).__webglFramebuffer;if(s=e.isWebGLRenderTargetCube&&void 0!==o?s[o]:s){o=!1;s!==k&&(M.bindFramebuffer(36160,s),o=!0);try{var l=e.texture,c=l.format,u=l.type;if(c!==Ge&&L.convert(c)!==M.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===Le||L.convert(u)===M.getParameter(35738)||u===Fe&&(w.isWebGL2||b.get("OES_texture_float")||b.get("WEBGL_color_buffer_float"))||u===Ne&&(w.isWebGL2?b.get("EXT_color_buffer_float"):b.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===M.checkFramebufferStatus(36160)?0<=t&&t<=e.width-r&&0<=n&&n<=e.height-i&&M.readPixels(t,n,r,i,L.convert(c),L.convert(u),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{o&&M.bindFramebuffer(36160,k)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){var r=t.image.width,i=t.image.height,a=L.convert(t.format);E.setTexture2D(t,0),M.copyTexImage2D(3553,n||0,a,e.x,e.y,r,i,0)},this.copyTextureToTexture=function(e,t,n,r){var i=t.image.width,a=t.image.height,o=L.convert(n.format),s=L.convert(n.type);E.setTexture2D(n,0),t.isDataTexture?M.texSubImage2D(3553,r||0,e.x,e.y,i,a,o,s,t.image.data):M.texSubImage2D(3553,r||0,e.x,e.y,o,s,t.image)},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function zo(e,t){this.name="",this.color=new pr(e),this.density=void 0!==t?t:25e-5}function Ho(e,t,n){this.name="",this.color=new pr(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function Go(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function jo(e,t,n,r){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function Wo(e){xr.call(this),this.type="SpriteMaterial",this.color=new pr(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.assign(ko.prototype,kt.prototype),Object.assign(Uo.prototype,kt.prototype),Object.assign(zo.prototype,{isFogExp2:!0,clone:function(){return new zo(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Ho.prototype,{isFog:!0,clone:function(){return new Ho(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Go.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Go.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t){return this.array.set(e,t=void 0===t?0:t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(jo.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(jo.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}}),((Wo.prototype=Object.create(xr.prototype)).constructor=Wo).prototype.isSpriteMaterial=!0,Wo.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var Vo=new Vt,Xo=new Vt,Yo=new Vt,qo=new Ht,Qo=new Ht,Zo=new cn,Jo=new Vt,Ko=new Vt,$o=new Vt,es=new Ht,ts=new Ht,ns=new Ht;function rs(e){var t;An.call(this),this.type="Sprite",void 0===Ro&&(Ro=new zr,t=new Go(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5),Ro.setIndex([0,1,2,0,2,3]),Ro.addAttribute("position",new jo(t,3,0,!1)),Ro.addAttribute("uv",new jo(t,2,3,!1))),this.geometry=Ro,this.material=void 0!==e?e:new Wo,this.center=new Ht(.5,.5)}function is(e,t,n,r,i,a){qo.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(Qo.x=a*qo.x-i*qo.y,Qo.y=i*qo.x+a*qo.y):Qo.copy(qo),e.copy(t),e.x+=Qo.x,e.y+=Qo.y,e.applyMatrix4(Zo)}rs.prototype=Object.assign(Object.create(An.prototype),{constructor:rs,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Xo.setFromMatrixScale(this.matrixWorld),Zo.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Yo.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Xo.multiplyScalar(-Yo.z);var n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));var a=this.center;is(Jo.set(-.5,-.5,0),Yo,a,Xo,n,r),is(Ko.set(.5,-.5,0),Yo,a,Xo,n,r),is($o.set(.5,.5,0),Yo,a,Xo,n,r),es.set(0,0),ts.set(1,0),ns.set(1,1);i=e.ray.intersectTriangle(Jo,Ko,$o,!1,Vo);null===i&&(is(Ko.set(-.5,.5,0),Yo,a,Xo,n,r),ts.set(0,1),null===(i=e.ray.intersectTriangle(Jo,$o,Ko,!1,Vo)))||((i=e.ray.origin.distanceTo(Vo))<e.near||i>e.far||t.push({distance:i,point:Vo.clone(),uv:cr.getUV(Vo,Jo,Ko,$o,es,ts,ns,new Ht),face:null,object:this}))},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return An.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var as=new Vt,os=new Vt;function ss(){An.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function ls(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),ii.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new cn,this.bindMatrixInverse=new cn}ss.prototype=Object.assign(Object.create(An.prototype),{constructor:ss,isLOD:!0,copy:function(e){An.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){for(var t=this.levels,n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object},raycast:function(e,t){as.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(as);this.getObjectForDistance(n).raycast(e,t)},update:function(e){var t=this.levels;if(1<t.length){as.setFromMatrixPosition(e.matrixWorld),os.setFromMatrixPosition(this.matrixWorld);var n=as.distanceTo(os);t[0].object.visible=!0;for(var r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(;r<i;r++)t[r].object.visible=!1}},toJSON:function(e){var t=An.prototype.toJSON.call(this,e);t.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var a=n[r];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),ls.prototype=Object.assign(Object.create(ii.prototype),{constructor:ls,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Kt,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var i=1/e.manhattanLength();i!=1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){ii.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var cs=new cn,us=new cn;function hs(e,t){if(this.bones=(e=e||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new cn)}}function ds(){An.call(this),this.type="Bone"}function ps(e,t,n){ii.call(this,e,t),this.instanceMatrix=new _r(new Float32Array(16*n),16),this.count=n}function fs(e){xr.call(this),this.type="LineBasicMaterial",this.color=new pr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}Object.assign(hs.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new cn;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){for(var e,t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,a=e.length;i<a;i++){var o=e[i]?e[i].matrixWorld:us;cs.multiplyMatrices(o,t[i]),cs.toArray(n,16*i)}void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new hs(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}}),ds.prototype=Object.assign(Object.create(An.prototype),{constructor:ds,isBone:!0}),ps.prototype=Object.assign(Object.create(ii.prototype),{constructor:ps,isInstancedMesh:!0,raycast:function(){},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),((fs.prototype=Object.create(xr.prototype)).constructor=fs).prototype.isLineBasicMaterial=!0,fs.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var ms=new Vt,gs=new Vt,vs=new cn,ys=new Kn,xs=new Wn;function bs(e,t,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),An.call(this),this.type="Line",this.geometry=void 0!==e?e:new zr,this.material=void 0!==t?t:new fs({color:16777215*Math.random()})}bs.prototype=Object.assign(Object.create(An.prototype),{constructor:bs,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,i=t.count;r<i;r++)ms.fromBufferAttribute(t,r-1),gs.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=ms.distanceTo(gs);e.addAttribute("lineDistance",new Pr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices;(n=e.lineDistances)[0]=0;for(r=1,i=a.length;r<i;r++)n[r]=n[r-1],n[r]+=a[r-1].distanceTo(a[r])}return this},raycast:function(e,t){var n=e.linePrecision,r=this.geometry,i=this.matrixWorld;if(null===r.boundingSphere&&r.computeBoundingSphere(),xs.copy(r.boundingSphere),xs.applyMatrix4(i),xs.radius+=n,!1!==e.ray.intersectsSphere(xs)){vs.getInverse(i),ys.copy(e.ray).applyMatrix4(vs);var n=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=n*n,o=new Vt,s=new Vt,l=new Vt,c=new Vt,u=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var n=r.index,h=r.attributes.position.array;if(null!==n)for(var d=n.array,p=0,f=d.length-1;p<f;p+=u){var m=d[p],g=d[p+1];o.fromArray(h,3*m),s.fromArray(h,3*g),a<ys.distanceSqToSegment(o,s,c,l)||(c.applyMatrix4(this.matrixWorld),(v=e.ray.origin.distanceTo(c))<e.near||v>e.far||t.push({distance:v,point:l.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this}))}else for(p=0,f=h.length/3-1;p<f;p+=u)o.fromArray(h,3*p),s.fromArray(h,3*p+3),a<ys.distanceSqToSegment(o,s,c,l)||(c.applyMatrix4(this.matrixWorld),(v=e.ray.origin.distanceTo(c))<e.near||v>e.far||t.push({distance:v,point:l.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this}))}else if(r.isGeometry)for(var v,y=r.vertices,x=y.length,p=0;p<x-1;p+=u)a<ys.distanceSqToSegment(y[p],y[p+1],c,l)||(c.applyMatrix4(this.matrixWorld),(v=e.ray.origin.distanceTo(c))<e.near||v>e.far||t.push({distance:v,point:l.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this}))}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var _s=new Vt,Ms=new Vt;function ws(e,t){bs.call(this,e,t),this.type="LineSegments"}function Ts(e,t){bs.call(this,e,t),this.type="LineLoop"}function Ss(e){xr.call(this),this.type="PointsMaterial",this.color=new pr(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}ws.prototype=Object.assign(Object.create(bs.prototype),{constructor:ws,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],r=0,i=t.count;r<i;r+=2)_s.fromBufferAttribute(t,r),Ms.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+_s.distanceTo(Ms);e.addAttribute("lineDistance",new Pr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry)for(var a=e.vertices,n=e.lineDistances,r=0,i=a.length;r<i;r+=2)_s.copy(a[r]),Ms.copy(a[r+1]),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+_s.distanceTo(Ms);return this}}),Ts.prototype=Object.assign(Object.create(bs.prototype),{constructor:Ts,isLineLoop:!0}),((Ss.prototype=Object.create(xr.prototype)).constructor=Ss).prototype.isPointsMaterial=!0,Ss.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var Es=new cn,As=new Kn,Cs=new Wn,Ps=new Vt;function Ls(e,t){An.call(this),this.type="Points",this.geometry=void 0!==e?e:new zr,this.material=void 0!==t?t:new Ss({color:16777215*Math.random()}),this.updateMorphTargets()}function Os(e,t,n,r,i,a,o){var s=As.distanceSqToPoint(e);s<n&&(n=new Vt,As.closestPointToPoint(e,n),n.applyMatrix4(r),(r=i.ray.origin.distanceTo(n))<i.near||r>i.far||a.push({distance:r,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:o}))}function Is(e,t,n,r,i,a,o,s,l){Jt.call(this,e,t,n,r,i,a,o,s,l),this.format=void 0!==o?o:He,this.minFilter=void 0!==a?a:Ae,this.magFilter=void 0!==i?i:Ae,this.generateMipmaps=!1}function Rs(e,t,n,r,i,a,o,s,l,c,u,h){Jt.call(this,null,a,o,s,l,c,r,i,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Fs(e,t,n,r,i,a,o,s,l){Jt.call(this,e,t,n,r,i,a,o,s,l),this.needsUpdate=!0}function Ns(e,t,n,r,i,a,o,s,l,c){if((c=void 0!==c?c:Xe)!==Xe&&c!==Ye)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");Jt.call(this,null,r,i,a,o,s,c,n=void 0===(n=void 0===n&&c===Xe?Oe:n)&&c===Ye?Be:n,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:Te,this.minFilter=void 0!==s?s:Te,this.flipY=!1,this.generateMipmaps=!1}function Ds(e){zr.call(this),this.type="WireframeGeometry";var t,n,r,i,a,o,s=[],l=[0,0],c={},u=["a","b","c"];if(e&&e.isGeometry){for(var h=e.faces,d=0,p=h.length;d<p;d++)for(var f=h[d],m=0;m<3;m++)i=f[u[m]],a=f[u[(m+1)%3]],l[0]=Math.min(i,a),l[1]=Math.max(i,a),void 0===c[o=l[0]+","+l[1]]&&(c[o]={index1:l[0],index2:l[1]});for(o in c)r=c[o],b=e.vertices[r.index1],s.push(b.x,b.y,b.z),b=e.vertices[r.index2],s.push(b.x,b.y,b.z)}else if(e&&e.isBufferGeometry){var g,v,y,x,b=new Vt;if(null!==e.index){for(g=e.attributes.position,v=e.index,n=(y=(t=0)===(y=e.groups).length?[{start:0,count:v.count,materialIndex:0}]:y).length;t<n;++t)for(p=(d=(x=y[t]).start)+x.count;d<p;d+=3)for(m=0;m<3;m++)i=v.getX(d+m),a=v.getX(d+(m+1)%3),l[0]=Math.min(i,a),l[1]=Math.max(i,a),void 0===c[o=l[0]+","+l[1]]&&(c[o]={index1:l[0],index2:l[1]});for(o in c)r=c[o],b.fromBufferAttribute(g,r.index1),s.push(b.x,b.y,b.z),b.fromBufferAttribute(g,r.index2),s.push(b.x,b.y,b.z)}else for(d=0,p=(g=e.attributes.position).count/3;d<p;d++)for(m=0;m<3;m++)b.fromBufferAttribute(g,3*d+m),s.push(b.x,b.y,b.z),b.fromBufferAttribute(g,3*d+(m+1)%3),s.push(b.x,b.y,b.z)}this.addAttribute("position",new Pr(s,3))}function ks(e,t,n){hi.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new Us(e,t,n)),this.mergeVertices()}function Us(e,t,n){zr.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var r=[],i=[],a=[],o=[],s=new Vt,l=new Vt,c=new Vt,u=new Vt,h=new Vt;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var d=t+1,p=0;p<=n;p++)for(var f=p/n,m=0;m<=t;m++){var g=m/t;e(g,f,l),i.push(l.x,l.y,l.z),0<=g-1e-5?(e(g-1e-5,f,c),u.subVectors(l,c)):(e(1e-5+g,f,c),u.subVectors(c,l)),0<=f-1e-5?(e(g,f-1e-5,c),h.subVectors(l,c)):(e(g,1e-5+f,c),h.subVectors(c,l)),s.crossVectors(u,h).normalize(),a.push(s.x,s.y,s.z),o.push(g,f)}for(p=0;p<n;p++)for(m=0;m<t;m++){var v=p*d+m+1,y=(p+1)*d+m+1,x=(p+1)*d+m;r.push(p*d+m,v,x),r.push(v,y,x)}this.setIndex(r),this.addAttribute("position",new Pr(i,3)),this.addAttribute("normal",new Pr(a,3)),this.addAttribute("uv",new Pr(o,2))}function Bs(e,t,n,r){hi.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},this.fromBufferGeometry(new zs(e,t,n,r)),this.mergeVertices()}function zs(n,a,e,t){zr.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:n,indices:a,radius:e,detail:t},e=e||1;var u=[],h=[];function d(e){u.push(e.x,e.y,e.z)}function o(e,t){e*=3;t.x=n[0+e],t.y=n[1+e],t.z=n[2+e]}function p(e,t,n,r){r<0&&1===e.x&&(h[t]=e.x-1),0===n.x&&0===n.z&&(h[t]=r/2/Math.PI+.5)}function f(e){return Math.atan2(e.z,-e.x)}!function(e){for(var t=new Vt,n=new Vt,r=new Vt,i=0;i<a.length;i+=3)o(a[i+0],t),o(a[i+1],n),o(a[i+2],r),function(e,t,n,r){var i,a,o=Math.pow(2,r),s=[];for(i=0;i<=o;i++){s[i]=[];var l=e.clone().lerp(n,i/o),c=t.clone().lerp(n,i/o),u=o-i;for(a=0;a<=u;a++)s[i][a]=0===a&&i===o?l:l.clone().lerp(c,a/u)}for(i=0;i<o;i++)for(a=0;a<2*(o-i)-1;a++){var h=Math.floor(a/2);a%2==0?(d(s[i][h+1]),d(s[i+1][h]),d(s[i][h])):(d(s[i][h+1]),d(s[i+1][h+1]),d(s[i+1][h]))}}(t,n,r,e)}(t=t||0),function(e){for(var t=new Vt,n=0;n<u.length;n+=3)t.x=u[n+0],t.y=u[n+1],t.z=u[n+2],t.normalize().multiplyScalar(e),u[n+0]=t.x,u[n+1]=t.y,u[n+2]=t.z}(e),function(){for(var e=new Vt,t=0;t<u.length;t+=3){e.x=u[t+0],e.y=u[t+1],e.z=u[t+2];var n=f(e)/2/Math.PI+.5,r=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;h.push(n,1-r)}(function(){for(var e=new Vt,t=new Vt,n=new Vt,r=new Vt,i=new Ht,a=new Ht,o=new Ht,s=0,l=0;s<u.length;s+=9,l+=6){e.set(u[s+0],u[s+1],u[s+2]),t.set(u[s+3],u[s+4],u[s+5]),n.set(u[s+6],u[s+7],u[s+8]),i.set(h[l+0],h[l+1]),a.set(h[l+2],h[l+3]),o.set(h[l+4],h[l+5]),r.copy(e).add(t).add(n).divideScalar(3);var c=f(r);p(i,l+0,e,c),p(a,l+2,t,c),p(o,l+4,n,c)}})(),function(){for(var e=0;e<h.length;e+=6){var t=h[e+0],n=h[e+2],r=h[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);.9<i&&a<.1&&(t<.2&&(h[e+0]+=1),n<.2&&(h[e+2]+=1),r<.2&&(h[e+4]+=1))}}()}(),this.addAttribute("position",new Pr(u,3)),this.addAttribute("normal",new Pr(u.slice(),3)),this.addAttribute("uv",new Pr(h,2)),0===t?this.computeVertexNormals():this.normalizeNormals()}function Hs(e,t){hi.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Gs(e,t)),this.mergeVertices()}function Gs(e,t){zs.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function js(e,t){hi.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ws(e,t)),this.mergeVertices()}function Ws(e,t){zs.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Vs(e,t){hi.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Xs(e,t)),this.mergeVertices()}function Xs(e,t){var n=(1+Math.sqrt(5))/2;zs.call(this,[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ys(e,t){hi.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new qs(e,t)),this.mergeVertices()}function qs(e,t){var n=(1+Math.sqrt(5))/2,r=1/n;zs.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Qs(e,t,n,r,i,a){hi.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");i=new Zs(e,t,n,r,i);this.tangents=i.tangents,this.normals=i.normals,this.binormals=i.binormals,this.fromBufferGeometry(i),this.mergeVertices()}function Zs(a,o,s,l,e){zr.call(this),this.type="TubeBufferGeometry",this.parameters={path:a,tubularSegments:o,radius:s,radialSegments:l,closed:e},s=s||1,l=l||8;var c=a.computeFrenetFrames(o=o||64,e=e||!1);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;var i,u,h=new Vt,d=new Vt,t=new Ht,p=new Vt,f=[],m=[],n=[],g=[];function r(e){p=a.getPointAt(e/o,p);var t=c.normals[e],n=c.binormals[e];for(u=0;u<=l;u++){var r=u/l*Math.PI*2,i=Math.sin(r),r=-Math.cos(r);d.x=r*t.x+i*n.x,d.y=r*t.y+i*n.y,d.z=r*t.z+i*n.z,d.normalize(),m.push(d.x,d.y,d.z),h.x=p.x+s*d.x,h.y=p.y+s*d.y,h.z=p.z+s*d.z,f.push(h.x,h.y,h.z)}}!function(){for(i=0;i<o;i++)r(i);r(!1===e?o:0),function(){for(i=0;i<=o;i++)for(u=0;u<=l;u++)t.x=i/o,t.y=u/l,n.push(t.x,t.y)}(),function(){for(u=1;u<=o;u++)for(i=1;i<=l;i++){var e=(l+1)*(u-1)+(i-1),t=(l+1)*u+(i-1),n=(l+1)*u+i,r=(l+1)*(u-1)+i;g.push(e,t,r),g.push(t,n,r)}}()}(),this.setIndex(g),this.addAttribute("position",new Pr(f,3)),this.addAttribute("normal",new Pr(m,3)),this.addAttribute("uv",new Pr(n,2))}function Js(e,t,n,r,i,a,o){hi.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Ks(e,t,n,r,i,a)),this.mergeVertices()}function Ks(e,t,n,r,i,a){zr.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:a},e=e||1,t=t||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,a=a||3;for(var o,s=[],l=[],c=[],u=[],h=new Vt,d=new Vt,p=new Vt,f=new Vt,m=new Vt,g=new Vt,v=new Vt,y=0;y<=n;++y){var x=y/n*i*Math.PI*2;for(S(x,i,a,e,p),S(.01+x,i,a,e,f),g.subVectors(f,p),v.addVectors(f,p),m.crossVectors(g,v),v.crossVectors(m,g),m.normalize(),v.normalize(),o=0;o<=r;++o){var b=o/r*Math.PI*2,_=-t*Math.cos(b),b=t*Math.sin(b);h.x=p.x+(_*v.x+b*m.x),h.y=p.y+(_*v.y+b*m.y),h.z=p.z+(_*v.z+b*m.z),l.push(h.x,h.y,h.z),d.subVectors(h,p).normalize(),c.push(d.x,d.y,d.z),u.push(y/n),u.push(o/r)}}for(o=1;o<=n;o++)for(y=1;y<=r;y++){var M=(r+1)*o+(y-1),w=(r+1)*o+y,T=(r+1)*(o-1)+y;s.push((r+1)*(o-1)+(y-1),M,T),s.push(M,w,T)}function S(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e),t=n/t*e,e=Math.cos(t);i.x=r*(2+e)*.5*a,i.y=r*(2+e)*o*.5,i.z=r*Math.sin(t)*.5}this.setIndex(s),this.addAttribute("position",new Pr(l,3)),this.addAttribute("normal",new Pr(c,3)),this.addAttribute("uv",new Pr(u,2))}function $s(e,t,n,r,i){hi.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new el(e,t,n,r,i)),this.mergeVertices()}function el(e,t,n,r,i){zr.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},e=e||1,t=t||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;for(var a,o=[],s=[],l=[],c=[],u=new Vt,h=new Vt,d=new Vt,p=0;p<=n;p++)for(a=0;a<=r;a++){var f=a/r*i,m=p/n*Math.PI*2;h.x=(e+t*Math.cos(m))*Math.cos(f),h.y=(e+t*Math.cos(m))*Math.sin(f),h.z=t*Math.sin(m),s.push(h.x,h.y,h.z),u.x=e*Math.cos(f),u.y=e*Math.sin(f),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(a/r),c.push(p/n)}for(p=1;p<=n;p++)for(a=1;a<=r;a++){var g=(r+1)*(p-1)+a-1,v=(r+1)*(p-1)+a,y=(r+1)*p+a;o.push((r+1)*p+a-1,g,y),o.push(g,v,y)}this.setIndex(o),this.addAttribute("position",new Pr(s,3)),this.addAttribute("normal",new Pr(l,3)),this.addAttribute("uv",new Pr(c,2))}Ls.prototype=Object.assign(Object.create(An.prototype),{constructor:Ls,isPoints:!0,raycast:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Cs.copy(n.boundingSphere),Cs.applyMatrix4(r),Cs.radius+=i,!1!==e.ray.intersectsSphere(Cs)){Es.getInverse(r),As.copy(e.ray).applyMatrix4(Es);var i=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=i*i;if(n.isBufferGeometry){var i=n.index,o=n.attributes.position.array;if(null!==i)for(var s=i.array,l=0,c=s.length;l<c;l++){var u=s[l];Ps.fromArray(o,3*u),Os(Ps,u,a,r,e,t,this)}else for(var l=0,h=o.length/3;l<h;l++)Ps.fromArray(o,3*l),Os(Ps,l,a,r,e,t,this)}else for(var d=n.vertices,l=0,h=d.length;l<h;l++)Os(d[l],l,a,r,e,t,this)}},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,a=Object.keys(i);if(0<a.length){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{r=r.morphTargets;void 0!==r&&0<r.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Is.prototype=Object.assign(Object.create(Jt.prototype),{constructor:Is,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),((Rs.prototype=Object.create(Jt.prototype)).constructor=Rs).prototype.isCompressedTexture=!0,((Fs.prototype=Object.create(Jt.prototype)).constructor=Fs).prototype.isCanvasTexture=!0,((Ns.prototype=Object.create(Jt.prototype)).constructor=Ns).prototype.isDepthTexture=!0,(Ds.prototype=Object.create(zr.prototype)).constructor=Ds,(ks.prototype=Object.create(hi.prototype)).constructor=ks,(Us.prototype=Object.create(zr.prototype)).constructor=Us,(Bs.prototype=Object.create(hi.prototype)).constructor=Bs,(zs.prototype=Object.create(zr.prototype)).constructor=zs,(Hs.prototype=Object.create(hi.prototype)).constructor=Hs,(Gs.prototype=Object.create(zs.prototype)).constructor=Gs,(js.prototype=Object.create(hi.prototype)).constructor=js,(Ws.prototype=Object.create(zs.prototype)).constructor=Ws,(Vs.prototype=Object.create(hi.prototype)).constructor=Vs,(Xs.prototype=Object.create(zs.prototype)).constructor=Xs,(Ys.prototype=Object.create(hi.prototype)).constructor=Ys,(qs.prototype=Object.create(zs.prototype)).constructor=qs,(Qs.prototype=Object.create(hi.prototype)).constructor=Qs,((Zs.prototype=Object.create(zr.prototype)).constructor=Zs).prototype.toJSON=function(){var e=zr.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},(Js.prototype=Object.create(hi.prototype)).constructor=Js,(Ks.prototype=Object.create(zr.prototype)).constructor=Ks,($s.prototype=Object.create(hi.prototype)).constructor=$s,(el.prototype=Object.create(zr.prototype)).constructor=el;var tl=function(e,t,n){n=n||2;var r,i,a,o,s,l=t&&t.length,c=l?t[0]*n:e.length,u=nl(e,0,c,n,!0),h=[];if(!u||u.next===u.prev)return h;if(l&&(u=function(e,t,n,r){var i,a,o,s,l=[];for(i=0,a=t.length;i<a;i++)o=t[i]*r,s=i<a-1?t[i+1]*r:e.length,(s=nl(e,o,s,r,!1))===s.next&&(s.steiner=!0),l.push(function(e){var t=e,n=e;for(;(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next,t!==e;);return n}(s));for(l.sort(al),i=0;i<l.length;i++)!function(e,t){(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&o<s){if((o=s)===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}}while(r=r.next,r!==t);if(!n)return null;if(i===o)return n.prev;var l,c=n,u=n.x,h=n.y,d=1/0;r=n.next;for(;r!==c;)i>=r.x&&r.x>=u&&i!==r.x&&sl(a<h?i:o,a,u,h,a<h?o:i,a,r.x,r.y)&&((l=Math.abs(a-r.y)/(i-r.x))<d||l===d&&r.x>n.x)&&hl(r,e)&&(n=r,d=l),r=r.next;return n}(e,t))&&rl(e=dl(t,e),e.next)}(l[i],n),n=rl(n,n.next);return n}(e,t,u,n)),e.length>80*n){for(var d=r=e[0],p=i=e[1],f=n;f<c;f+=n)(a=e[f])<d&&(d=a),(o=e[f+1])<p&&(p=o),r<a&&(r=a),i<o&&(i=o);s=0!==(s=Math.max(r-d,i-p))?1/s:0}return il(u,h,n,d,p,s),h};function nl(e,t,n,r,i){var a,o;if(i===0<function(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,n,r))for(a=t;a<n;a+=r)o=pl(a,e[a],e[a+1],o);else for(a=n-r;t<=a;a-=r)o=pl(a,e[a],e[a+1],o);return o&&cl(o,o.next)&&(fl(o),o=o.next),o}function rl(e,t){if(!e)return e;t=t||e;var n,r=e;do{if(n=!1,r.steiner||!cl(r,r.next)&&0!==ll(r.prev,r,r.next))r=r.next;else{if(fl(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function il(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;for(;null===i.z&&(i.z=ol(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,l,c=1;do{for(n=e,a=e=null,o=0;n;){for(o++,r=n,t=s=0;t<c&&(s++,r=r.nextZ);t++);for(l=c;0<s||0<l&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(n=(i=n).nextZ,s--):(r=(i=r).nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}}while(a.nextZ=null,c*=2,1<o)}(i)}(e,r,i,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?function(e,t,n,r){var i=e.prev,a=e,o=e.next;if(0<=ll(i,a,o))return!1;var s=(i.x<a.x?i.x<o.x?i:o:a.x<o.x?a:o).x,l=(i.y<a.y?i.y<o.y?i:o:a.y<o.y?a:o).y,c=(i.x>a.x?i.x>o.x?i:o:a.x>o.x?a:o).x,u=(i.y>a.y?i.y>o.y?i:o:a.y>o.y?a:o).y,h=ol(s,l,t,n,r),d=ol(c,u,t,n,r),p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&sl(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&0<=ll(p.prev,p,p.next))return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&sl(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&0<=ll(f.prev,f,f.next))return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&sl(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&0<=ll(p.prev,p,p.next))return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&sl(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&0<=ll(f.prev,f,f.next))return!1;f=f.nextZ}return!0}(e,r,i,a):function(e){var t=e.prev,n=e,r=e.next;if(0<=ll(t,n,r))return!1;var i=e.next.next;for(;i!==e.prev;){if(sl(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&0<=ll(i.prev,i,i.next))return!1;i=i.next}return!0}(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),fl(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?il(e=function(e,t,n){var r=e;do{var i=r.prev,a=r.next.next}while(!cl(i,a)&&ul(i,r,r.next,a)&&hl(i,a)&&hl(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),fl(r),fl(r.next),r=e=a),r=r.next,r!==e);return r}(e,t,n),t,n,r,i,a,2):2===o&&function(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&ul(n,n.next,e,t))return!0}while(n=n.next,n!==e);return!1}(e,t)&&hl(e,t)&&hl(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;for(;n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next,n!==e;);return r}(e,t)}(o,s)){var l=dl(o,s);return o=rl(o,o.next),l=rl(l,l.next),il(o,t,n,r,i,a),il(l,t,n,r,i,a)}s=s.next}}while(o=o.next,o!==e)}(e,t,n,r,i,a):il(rl(e),t,n,r,i,a,1);break}}}function al(e,t){return e.x-t.x}function ol(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function sl(e,t,n,r,i,a,o,s){return 0<=(i-o)*(t-s)-(e-o)*(a-s)&&0<=(e-o)*(r-s)-(n-o)*(t-s)&&0<=(n-o)*(a-s)-(i-o)*(r-s)}function ll(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function cl(e,t){return e.x===t.x&&e.y===t.y}function ul(e,t,n,r){return cl(e,n)&&cl(t,r)||cl(e,r)&&cl(n,t)||0<ll(e,t,n)!=0<ll(e,t,r)&&0<ll(n,r,e)!=0<ll(n,r,t)}function hl(e,t){return ll(e.prev,e,e.next)<0?0<=ll(e,t,e.next)&&0<=ll(e,e.prev,t):ll(e,t,e.prev)<0||ll(e,e.next,t)<0}function dl(e,t){var n=new ml(e.i,e.x,e.y),r=new ml(t.i,t.x,t.y),i=e.next,a=t.prev;return(e.next=t).prev=e,(n.next=i).prev=n,(r.next=n).prev=r,(a.next=r).prev=a,r}function pl(e,t,n,r){n=new ml(e,t,n);return r?(n.next=r.next,(n.prev=r).next.prev=n,r.next=n):(n.prev=n).next=n,n}function fl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ml(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var gl={area:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return gl.area(e)<0},triangulateShape:function(e,t){var n=[],r=[],i=[];vl(e),yl(n,e);var a=e.length;t.forEach(vl);for(var o=0;o<t.length;o++)r.push(a),a+=t[o].length,yl(n,t[o]);for(var s=tl(n,r),o=0;o<s.length;o+=3)i.push(s.slice(o,o+3));return i}};function vl(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function yl(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function xl(e,t){hi.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new bl(e,t)),this.mergeVertices()}function bl(e,Q){zr.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:Q},e=Array.isArray(e)?e:[e];for(var Z=this,J=[],K=[],t=0,n=e.length;t<n;t++)!function(e){var r=[],t=void 0!==Q.curveSegments?Q.curveSegments:12,l=void 0!==Q.steps?Q.steps:1,n=void 0!==Q.depth?Q.depth:100,i=void 0===Q.bevelEnabled||Q.bevelEnabled,a=void 0!==Q.bevelThickness?Q.bevelThickness:6,o=void 0!==Q.bevelSize?Q.bevelSize:a-2,s=void 0!==Q.bevelOffset?Q.bevelOffset:0,c=void 0!==Q.bevelSegments?Q.bevelSegments:3,u=Q.extrudePath,h=void 0!==Q.UVGenerator?Q.UVGenerator:_l;void 0!==Q.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),n=Q.amount);var d,p,f,m,g,v,y,x,b=!1;u&&(d=u.getSpacedPoints(l),i=!(b=!0),p=u.computeFrenetFrames(l,!1),f=new Vt,m=new Vt,g=new Vt);i||(s=o=a=c=0);var t=e.extractPoints(t),_=t.shape,M=t.holes;if(!gl.isClockWise(_))for(_=_.reverse(),y=0,x=M.length;y<x;y++)v=M[y],gl.isClockWise(v)&&(M[y]=v.reverse());var w=gl.triangulateShape(_,M),T=_;for(y=0,x=M.length;y<x;y++)v=M[y],_=_.concat(v);function S(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var E,A,C,P,L,O,I=_.length,R=w.length;function F(e,t,n){var r=e.x-t.x,i=e.y-t.y,a=n.x-e.x,o=n.y-e.y,s=r*r+i*i;if(Math.abs(r*o-i*a)>Number.EPSILON){var l=Math.sqrt(s),c=Math.sqrt(a*a+o*o),u=t.x-i/l,h=t.y+r/l,l=((n.x-o/c-u)*o-(n.y+a/c-h)*a)/(r*o-i*a),h=(c=u+r*l-e.x)*c+(u=h+i*l-e.y)*u;if(h<=2)return new Ht(c,u);l=Math.sqrt(h/2)}else{h=!1;r>Number.EPSILON?a>Number.EPSILON&&(h=!0):r<-Number.EPSILON?a<-Number.EPSILON&&(h=!0):Math.sign(i)===Math.sign(o)&&(h=!0),l=h?(c=-i,u=r,Math.sqrt(s)):(c=r,u=i,Math.sqrt(s/2))}return new Ht(c/l,u/l)}for(var N=[],D=0,k=T.length,U=k-1,B=D+1;D<k;D++,U++,B++)U===k&&(U=0),B===k&&(B=0),N[D]=F(T[D],T[U],T[B]);var z,H,G=[],j=N.concat();for(y=0,x=M.length;y<x;y++){for(v=M[y],z=[],D=0,k=v.length,U=k-1,B=D+1;D<k;D++,U++,B++)U===k&&(U=0),B===k&&(B=0),z[D]=F(v[D],v[U],v[B]);G.push(z),j=j.concat(z)}for(E=0;E<c;E++){for(C=E/c,P=a*Math.cos(C*Math.PI/2),A=o*Math.sin(C*Math.PI/2)+s,D=0,k=T.length;D<k;D++)V((L=S(T[D],N[D],A)).x,L.y,-P);for(y=0,x=M.length;y<x;y++)for(v=M[y],z=G[y],D=0,k=v.length;D<k;D++)V((L=S(v[D],z[D],A)).x,L.y,-P)}for(A=o+s,D=0;D<I;D++)L=i?S(_[D],j[D],A):_[D],b?(m.copy(p.normals[0]).multiplyScalar(L.x),f.copy(p.binormals[0]).multiplyScalar(L.y),g.copy(d[0]).add(m).add(f),V(g.x,g.y,g.z)):V(L.x,L.y,0);for(H=1;H<=l;H++)for(D=0;D<I;D++)L=i?S(_[D],j[D],A):_[D],b?(m.copy(p.normals[H]).multiplyScalar(L.x),f.copy(p.binormals[H]).multiplyScalar(L.y),g.copy(d[H]).add(m).add(f),V(g.x,g.y,g.z)):V(L.x,L.y,n/l*H);for(E=c-1;0<=E;E--){for(C=E/c,P=a*Math.cos(C*Math.PI/2),A=o*Math.sin(C*Math.PI/2)+s,D=0,k=T.length;D<k;D++)V((L=S(T[D],N[D],A)).x,L.y,n+P);for(y=0,x=M.length;y<x;y++)for(v=M[y],z=G[y],D=0,k=v.length;D<k;D++)L=S(v[D],z[D],A),b?V(L.x,L.y+d[l-1].y,d[l-1].x+P):V(L.x,L.y,n+P)}function W(e,t){var n,r;for(D=e.length;0<=--D;){(r=(n=D)-1)<0&&(r=e.length-1);for(var i=0,a=l+2*c,i=0;i<a;i++){var o=I*i,s=I*(i+1);!function(e,t,n,r){Y(e),Y(t),Y(r),Y(t),Y(n),Y(r);r=J.length/3,r=h.generateSideWallUV(Z,J,r-6,r-3,r-2,r-1);q(r[0]),q(r[1]),q(r[3]),q(r[1]),q(r[2]),q(r[3])}(t+n+o,t+r+o,t+r+s,t+n+s)}}}function V(e,t,n){r.push(e),r.push(t),r.push(n)}function X(e,t,n){Y(e),Y(t),Y(n);n=J.length/3,n=h.generateTopUV(Z,J,n-3,n-2,n-1);q(n[0]),q(n[1]),q(n[2])}function Y(e){J.push(r[3*e+0]),J.push(r[3*e+1]),J.push(r[3*e+2])}function q(e){K.push(e.x),K.push(e.y)}(function(){var e=J.length/3;if(i){var t=0*I;for(D=0;D<R;D++)X((O=w[D])[2]+t,O[1]+t,O[0]+t);for(t=I*(l+2*c),D=0;D<R;D++)X((O=w[D])[0]+t,O[1]+t,O[2]+t)}else{for(D=0;D<R;D++)X((O=w[D])[2],O[1],O[0]);for(D=0;D<R;D++)X((O=w[D])[0]+I*l,O[1]+I*l,O[2]+I*l)}Z.addGroup(e,J.length/3-e,0)})(),function(){var e=J.length/3,t=0;for(W(T,t),t+=T.length,y=0,x=M.length;y<x;y++)W(v=M[y],t),t+=v.length;Z.addGroup(e,J.length/3-e,1)}()}(e[t]);this.addAttribute("position",new Pr(J,3)),this.addAttribute("uv",new Pr(K,2)),this.computeVertexNormals()}((xl.prototype=Object.create(hi.prototype)).constructor=xl).prototype.toJSON=function(){var e=hi.prototype.toJSON.call(this);return Ml(this.parameters.shapes,this.parameters.options,e)},((bl.prototype=Object.create(zr.prototype)).constructor=bl).prototype.toJSON=function(){var e=zr.prototype.toJSON.call(this);return Ml(this.parameters.shapes,this.parameters.options,e)};var _l={generateTopUV:function(e,t,n,r,i){var a=t[3*n],o=t[3*n+1],s=t[3*r],n=t[3*r+1],r=t[3*i],i=t[3*i+1];return[new Ht(a,o),new Ht(s,n),new Ht(r,i)]},generateSideWallUV:function(e,t,n,r,i,a){var o=t[3*n],s=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],p=t[3*i+1],n=t[3*i+2],r=t[3*a],i=t[3*a+1],a=t[3*a+2];return Math.abs(s-u)<.01?[new Ht(o,1-l),new Ht(c,1-h),new Ht(d,1-n),new Ht(r,1-a)]:[new Ht(s,1-l),new Ht(u,1-h),new Ht(p,1-n),new Ht(i,1-a)]}};function Ml(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var a=e[r];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function wl(e,t){hi.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Tl(e,t)),this.mergeVertices()}function Tl(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new hi;e=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),bl.call(this,e,t),this.type="TextBufferGeometry"}function Sl(e,t,n,r,i,a,o){hi.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new El(e,t,n,r,i,a,o)),this.mergeVertices()}function El(e,t,n,r,i,a,o){zr.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;for(var s,l=Math.min(a+o,Math.PI),c=0,u=[],h=new Vt,d=new Vt,p=[],f=[],m=[],g=[],v=0;v<=n;v++){var y=[],x=v/n,b=0;for(0==v&&0==a?b=.5/t:v==n&&l==Math.PI&&(b=-.5/t),s=0;s<=t;s++){var _=s/t;h.x=-e*Math.cos(r+_*i)*Math.sin(a+x*o),h.y=e*Math.cos(a+x*o),h.z=e*Math.sin(r+_*i)*Math.sin(a+x*o),f.push(h.x,h.y,h.z),d.copy(h).normalize(),m.push(d.x,d.y,d.z),g.push(_+b,1-x),y.push(c++)}u.push(y)}for(v=0;v<n;v++)for(s=0;s<t;s++){var M=u[v][s+1],w=u[v][s],T=u[v+1][s],S=u[v+1][s+1];(0!==v||0<a)&&p.push(M,w,S),(v!==n-1||l<Math.PI)&&p.push(w,T,S)}this.setIndex(p),this.addAttribute("position",new Pr(f,3)),this.addAttribute("normal",new Pr(m,3)),this.addAttribute("uv",new Pr(g,2))}function Al(e,t,n,r,i,a){hi.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},this.fromBufferGeometry(new Cl(e,t,n,r,i,a)),this.mergeVertices()}function Cl(e,t,n,r,i,a){zr.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,n=void 0!==n?Math.max(3,n):8;for(var o=[],s=[],l=[],c=[],u=e,h=(t-e)/(r=void 0!==r?Math.max(1,r):1),d=new Vt,p=new Ht,f=0;f<=r;f++){for(g=0;g<=n;g++)v=i+g/n*a,d.x=u*Math.cos(v),d.y=u*Math.sin(v),s.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y);u+=h}for(f=0;f<r;f++)for(var m=f*(n+1),g=0;g<n;g++){var v,y=(v=g+m)+n+1,x=v+n+2,b=v+1;o.push(v,y,b),o.push(y,x,b)}this.setIndex(o),this.addAttribute("position",new Pr(s,3)),this.addAttribute("normal",new Pr(l,3)),this.addAttribute("uv",new Pr(c,2))}function Pl(e,t,n,r){hi.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},this.fromBufferGeometry(new Ll(e,t,n,r)),this.mergeVertices()}function Ll(e,t,n,r){zr.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t)||12,n=n||0,r=r||2*Math.PI,r=zt.clamp(r,0,2*Math.PI);for(var i=[],a=[],o=[],s=1/t,l=new Vt,c=new Ht,u=0;u<=t;u++)for(var h=n+u*s*r,d=Math.sin(h),p=Math.cos(h),f=0;f<=e.length-1;f++)l.x=e[f].x*d,l.y=e[f].y,l.z=e[f].x*p,a.push(l.x,l.y,l.z),c.x=u/t,c.y=f/(e.length-1),o.push(c.x,c.y);for(u=0;u<t;u++)for(f=0;f<e.length-1;f++){var m,g=(m=f+u*e.length)+e.length,v=m+e.length+1,y=m+1;i.push(m,g,y),i.push(g,v,y)}if(this.setIndex(i),this.addAttribute("position",new Pr(a,3)),this.addAttribute("uv",new Pr(o,2)),this.computeVertexNormals(),r===2*Math.PI){var x=this.attributes.normal.array,b=new Vt,_=new Vt,M=new Vt;for(m=t*e.length*3,f=u=0;u<e.length;u++,f+=3)b.x=x[f+0],b.y=x[f+1],b.z=x[f+2],_.x=x[m+f+0],_.y=x[m+f+1],_.z=x[m+f+2],M.addVectors(b,_).normalize(),x[f+0]=x[m+f+0]=M.x,x[f+1]=x[m+f+1]=M.y,x[f+2]=x[m+f+2]=M.z}}function Ol(e,t){hi.call(this),this.type="ShapeGeometry","object"===W(t)&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Il(e,t)),this.mergeVertices()}function Il(e,d){zr.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:d},d=d||12;var p=[],f=[],m=[],g=[],t=0,v=0;if(!1===Array.isArray(e))r(e);else for(var n=0;n<e.length;n++)r(e[n]),this.addGroup(t,v,n),t+=v,v=0;function r(e){var t,n=f.length/3,e=e.extractPoints(d),r=e.shape,i=e.holes;for(!1===gl.isClockWise(r)&&(r=r.reverse()),o=0,s=i.length;o<s;o++)t=i[o],!0===gl.isClockWise(t)&&(i[o]=t.reverse());for(var a=gl.triangulateShape(r,i),o=0,s=i.length;o<s;o++)t=i[o],r=r.concat(t);for(o=0,s=r.length;o<s;o++){var l=r[o];f.push(l.x,l.y,0),m.push(0,0,1),g.push(l.x,l.y)}for(o=0,s=a.length;o<s;o++){var c=a[o],u=c[0]+n,h=c[1]+n,c=c[2]+n;p.push(u,h,c),v+=3}}this.setIndex(p),this.addAttribute("position",new Pr(f,3)),this.addAttribute("normal",new Pr(m,3)),this.addAttribute("uv",new Pr(g,2))}function Rl(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function Fl(e,t){zr.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var n,r,i,a,o=[],s=Math.cos(zt.DEG2RAD*t),l=[0,0],c={},u=["a","b","c"];e.isBufferGeometry?(a=new hi).fromBufferGeometry(e):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();for(var h=a.vertices,d=a.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],g=0;g<3;g++)n=m[u[g]],r=m[u[(g+1)%3]],l[0]=Math.min(n,r),l[1]=Math.max(n,r),void 0===c[i=l[0]+","+l[1]]?c[i]={index1:l[0],index2:l[1],face1:p,face2:void 0}:c[i].face2=p;for(i in c){var v,y=c[i];(void 0===y.face2||d[y.face1].normal.dot(d[y.face2].normal)<=s)&&(v=h[y.index1],o.push(v.x,v.y,v.z),v=h[y.index2],o.push(v.x,v.y,v.z))}this.addAttribute("position",new Pr(o,3))}function Nl(e,t,n,r,i,a,o,s){hi.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Dl(e,t,n,r,i,a,o,s)),this.mergeVertices()}function Dl(g,v,y,x,b,e,_,M){zr.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:g,radiusBottom:v,height:y,radialSegments:x,heightSegments:b,openEnded:e,thetaStart:_,thetaLength:M};var w=this;g=void 0!==g?g:1,v=void 0!==v?v:1,y=y||1,x=Math.floor(x)||8,b=Math.floor(b)||1,e=void 0!==e&&e,_=void 0!==_?_:0,M=void 0!==M?M:2*Math.PI;var T=[],S=[],E=[],A=[],C=0,P=[],L=y/2,O=0;function t(e){for(var t,n=new Ht,r=new Vt,i=0,a=!0===e?g:v,o=!0===e?1:-1,s=C,l=1;l<=x;l++)S.push(0,L*o,0),E.push(0,o,0),A.push(.5,.5),C++;for(t=C,l=0;l<=x;l++){var c=l/x*M+_,u=Math.cos(c),c=Math.sin(c);r.x=a*c,r.y=L*o,r.z=a*u,S.push(r.x,r.y,r.z),E.push(0,o,0),n.x=.5*u+.5,n.y=.5*c*o+.5,A.push(n.x,n.y),C++}for(l=0;l<x;l++){var h=s+l,d=t+l;!0===e?T.push(d,d+1,h):T.push(d+1,d,h),i+=3}w.addGroup(O,i,!0===e?1:2),O+=i}!function(){var e,t,n=new Vt,r=new Vt,i=0,a=(v-g)/y;for(t=0;t<=b;t++){var o=[],s=t/b,l=s*(v-g)+g;for(e=0;e<=x;e++){var c=e/x,u=c*M+_,h=Math.sin(u),u=Math.cos(u);r.x=l*h,r.y=-s*y+L,r.z=l*u,S.push(r.x,r.y,r.z),n.set(h,a,u).normalize(),E.push(n.x,n.y,n.z),A.push(c,1-s),o.push(C++)}P.push(o)}for(e=0;e<x;e++)for(t=0;t<b;t++){var d=P[t][e],p=P[t+1][e],f=P[t+1][e+1],m=P[t][e+1];T.push(d,p,m),T.push(p,f,m),i+=6}w.addGroup(O,i,0),O+=i}(),!1===e&&(0<g&&t(!0),0<v&&t(!1)),this.setIndex(T),this.addAttribute("position",new Pr(S,3)),this.addAttribute("normal",new Pr(E,3)),this.addAttribute("uv",new Pr(A,2))}function kl(e,t,n,r,i,a,o){Nl.call(this,0,e,t,n,r,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:o}}function Ul(e,t,n,r,i,a,o){Dl.call(this,0,e,t,n,r,i,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:o}}function Bl(e,t,n,r){hi.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new zl(e,t,n,r)),this.mergeVertices()}function zl(e,t,n,r){zr.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,a,o=[],s=[],l=[],c=[],u=new Vt,h=new Ht;for(s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),a=0,i=3;a<=t;a++,i+=3){var d=n+a/t*r;u.x=e*Math.cos(d),u.y=e*Math.sin(d),s.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(s[i]/e+1)/2,h.y=(s[i+1]/e+1)/2,c.push(h.x,h.y)}for(i=1;i<=t;i++)o.push(i,i+1,0);this.setIndex(o),this.addAttribute("position",new Pr(s,3)),this.addAttribute("normal",new Pr(l,3)),this.addAttribute("uv",new Pr(c,2))}(wl.prototype=Object.create(hi.prototype)).constructor=wl,(Tl.prototype=Object.create(bl.prototype)).constructor=Tl,(Sl.prototype=Object.create(hi.prototype)).constructor=Sl,(El.prototype=Object.create(zr.prototype)).constructor=El,(Al.prototype=Object.create(hi.prototype)).constructor=Al,(Cl.prototype=Object.create(zr.prototype)).constructor=Cl,(Pl.prototype=Object.create(hi.prototype)).constructor=Pl,(Ll.prototype=Object.create(zr.prototype)).constructor=Ll,((Ol.prototype=Object.create(hi.prototype)).constructor=Ol).prototype.toJSON=function(){var e=hi.prototype.toJSON.call(this);return Rl(this.parameters.shapes,e)},((Il.prototype=Object.create(zr.prototype)).constructor=Il).prototype.toJSON=function(){var e=zr.prototype.toJSON.call(this);return Rl(this.parameters.shapes,e)},(Fl.prototype=Object.create(zr.prototype)).constructor=Fl,(Nl.prototype=Object.create(hi.prototype)).constructor=Nl,(Dl.prototype=Object.create(zr.prototype)).constructor=Dl,(kl.prototype=Object.create(Nl.prototype)).constructor=kl,(Ul.prototype=Object.create(Dl.prototype)).constructor=Ul,(Bl.prototype=Object.create(hi.prototype)).constructor=Bl,(zl.prototype=Object.create(zr.prototype)).constructor=zl;var Hl=Object.freeze({WireframeGeometry:Ds,ParametricGeometry:ks,ParametricBufferGeometry:Us,TetrahedronGeometry:Hs,TetrahedronBufferGeometry:Gs,OctahedronGeometry:js,OctahedronBufferGeometry:Ws,IcosahedronGeometry:Vs,IcosahedronBufferGeometry:Xs,DodecahedronGeometry:Ys,DodecahedronBufferGeometry:qs,PolyhedronGeometry:Bs,PolyhedronBufferGeometry:zs,TubeGeometry:Qs,TubeBufferGeometry:Zs,TorusKnotGeometry:Js,TorusKnotBufferGeometry:Ks,TorusGeometry:$s,TorusBufferGeometry:el,TextGeometry:wl,TextBufferGeometry:Tl,SphereGeometry:Sl,SphereBufferGeometry:El,RingGeometry:Al,RingBufferGeometry:Cl,PlaneGeometry:ki,PlaneBufferGeometry:Ui,LatheGeometry:Pl,LatheBufferGeometry:Ll,ShapeGeometry:Ol,ShapeBufferGeometry:Il,ExtrudeGeometry:xl,ExtrudeBufferGeometry:bl,EdgesGeometry:Fl,ConeGeometry:kl,ConeBufferGeometry:Ul,CylinderGeometry:Nl,CylinderBufferGeometry:Dl,CircleGeometry:Bl,CircleBufferGeometry:zl,BoxGeometry:di,BoxBufferGeometry:pi});function Gl(e){xr.call(this),this.type="ShadowMaterial",this.color=new pr(0),this.transparent=!0,this.setValues(e)}function jl(e){xi.call(this,e),this.type="RawShaderMaterial"}function Wl(e){xr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new pr(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rt,this.normalScale=new Ht(1,1),this.normalMap2=null,this.normalMap3=null,this.normalMap4=null,this.normalMap5=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Vl(e){Wl.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Ht(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function Xl(e){xr.call(this),this.type="MeshPhongMaterial",this.color=new pr(16777215),this.specular=new pr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rt,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=C,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Yl(e){Xl.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function ql(e){xr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rt,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ql(e){xr.call(this),this.type="MeshLambertMaterial",this.color=new pr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=C,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Zl(e){xr.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new pr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Rt,this.normalScale=new Ht(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Jl(e){fs.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}((Gl.prototype=Object.create(xr.prototype)).constructor=Gl).prototype.isShadowMaterial=!0,Gl.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.color.copy(e.color),this},((jl.prototype=Object.create(xi.prototype)).constructor=jl).prototype.isRawShaderMaterial=!0,((Wl.prototype=Object.create(xr.prototype)).constructor=Wl).prototype.isMeshStandardMaterial=!0,Wl.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.normalMap2=e.normalMap2,this.normalMap3=e.normalMap3,this.normalMap4=e.normalMap4,this.normalMap5=e.normalMap5,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Vl.prototype=Object.create(Wl.prototype)).constructor=Vl).prototype.isMeshPhysicalMaterial=!0,Vl.prototype.copy=function(e){return Wl.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new pr).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},((Xl.prototype=Object.create(xr.prototype)).constructor=Xl).prototype.isMeshPhongMaterial=!0,Xl.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Yl.prototype=Object.create(Xl.prototype)).constructor=Yl).prototype.isMeshToonMaterial=!0,Yl.prototype.copy=function(e){return Xl.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},((ql.prototype=Object.create(xr.prototype)).constructor=ql).prototype.isMeshNormalMaterial=!0,ql.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Ql.prototype=Object.create(xr.prototype)).constructor=Ql).prototype.isMeshLambertMaterial=!0,Ql.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Zl.prototype=Object.create(xr.prototype)).constructor=Zl).prototype.isMeshMatcapMaterial=!0,Zl.prototype.copy=function(e){return xr.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Jl.prototype=Object.create(fs.prototype)).constructor=Jl).prototype.isLineDashedMaterial=!0,Jl.prototype.copy=function(e){return fs.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Kl=Object.freeze({ShadowMaterial:Gl,SpriteMaterial:Wo,RawShaderMaterial:jl,ShaderMaterial:xi,PointsMaterial:Ss,MeshPhysicalMaterial:Vl,MeshStandardMaterial:Wl,MeshPhongMaterial:Xl,MeshToonMaterial:Yl,MeshNormalMaterial:ql,MeshLambertMaterial:Ql,MeshDepthMaterial:_o,MeshDistanceMaterial:Mo,MeshBasicMaterial:br,MeshMatcapMaterial:Zl,LineDashedMaterial:Jl,LineBasicMaterial:fs,Material:xr}),$l={arraySlice:function(e,t,n){return $l.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(n){for(var e=n.length,t=new Array(e),r=0;r!==e;++r)t[r]=r;return t.sort(function(e,t){return n[e]-n[t]}),t},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),a=0,o=0;o!==r;++a)for(var s=n[a]*t,l=0;l!==t;++l)i[o++]=e[s+l];return i},flattenJSON:function(e,t,n,r){for(var i=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[i++];if(void 0!==a){var o=a[r];if(void 0!==o)if(Array.isArray(o))for(;void 0!==(o=a[r])&&(t.push(a.time),n.push.apply(n,o)),void 0!==(a=e[i++]););else if(void 0!==o.toArray)for(;void 0!==(o=a[r])&&(t.push(a.time),o.toArray(n,n.length)),void 0!==(a=e[i++]););else for(;void 0!==(o=a[r])&&(t.push(a.time),n.push(o)),void 0!==(a=e[i++]););}}};function ec(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function tc(e,t,n,r){ec.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function nc(e,t,n,r){ec.call(this,e,t,n,r)}function rc(e,t,n,r){ec.call(this,e,t,n,r)}function ic(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=$l.convertArray(t,this.TimeBufferType),this.values=$l.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function ac(e,t,n){ic.call(this,e,t,n)}function oc(e,t,n,r){ic.call(this,e,t,n,r)}function sc(e,t,n,r){ic.call(this,e,t,n,r)}function lc(e,t,n,r){ec.call(this,e,t,n,r)}function cc(e,t,n,r){ic.call(this,e,t,n,r)}function uc(e,t,n,r){ic.call(this,e,t,n,r)}function hc(e,t,n,r){ic.call(this,e,t,n,r)}function dc(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=zt.generateUUID(),this.duration<0&&this.resetDuration()}function pc(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t,n,r=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return sc;case"vector":case"vector2":case"vector3":case"vector4":return hc;case"color":return oc;case"quaternion":return cc;case"bool":case"boolean":return ac;case"string":return uc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);return void 0===e.times&&($l.flattenJSON(e.keys,t=[],n=[],"value"),e.times=t,e.values=n),void 0!==r.parse?r.parse(e):new r(e.name,e.times,e.values,e.interpolation)}Object.assign(ec.prototype,{evaluate:function(e){var t,n=this.parameterPositions,r=this._cachedIndex,i=n[r],a=n[r-1];e:{t:{n:{r:if(!(e<i)){for(var o=r+2;;){if(void 0===i){if(e<a)break r;return r=n.length,this._cachedIndex=r,this.afterEnd_(r-1,e,a)}if(r===o)break;if(a=i,e<(i=n[++r]))break t}t=n.length;break n}if(a<=e)break e;var s=n[1];e<s&&(r=2,a=s);for(o=r-2;;){if(void 0===a)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(r===o)break;if(i=a,(a=n[--r-1])<=e)break t}t=r,r=0}for(;r<t;){var l=r+t>>>1;e<n[l]?t=l:r=1+l}if(i=n[r],void 0===(a=n[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return r=n.length,this._cachedIndex=r,this.afterEnd_(r-1,a,e)}this._cachedIndex=r,this.intervalChanged_(r,a,i)}return this.interpolate_(r,a,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,a=0;a!==r;++a)t[a]=n[i+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(ec.prototype,{beforeStart_:ec.prototype.copySampleValue_,afterEnd_:ec.prototype.copySampleValue_}),tc.prototype=Object.assign(Object.create(ec.prototype),{constructor:tc,DefaultSettings_:{endingStart:bt,endingEnd:bt},intervalChanged_:function(e,t,n){var r=this.parameterPositions,i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case _t:i=e,o=2*t-n;break;case 2402:o=t+r[i=r.length-2]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case _t:a=e,s=2*n-t;break;case 2402:s=n+r[a=1]-r[0];break;default:a=e-1,s=t}var l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=i*c,this._offsetNext=a*c},interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,e=this._weightNext,n=(n-t)/(r-t),r=n*n,t=r*n,d=-h*t+2*h*r-h*n,p=(1+h)*t+(-1.5-2*h)*r+(-.5+h)*n+1,f=(-1-e)*t+(1.5+e)*r+.5*n,m=e*t-e*r,g=0;g!==o;++g)i[g]=d*a[c+g]+p*a[l+g]+f*a[s+g]+m*a[u+g];return i}}),nc.prototype=Object.assign(Object.create(ec.prototype),{constructor:nc,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(n-t)/(r-t),u=1-c,h=0;h!==o;++h)i[h]=a[l+h]*u+a[s+h]*c;return i}}),rc.prototype=Object.assign(Object.create(ec.prototype),{constructor:rc,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(ic,{toJSON:function(e){var t,n=e.constructor;return void 0!==n.toJSON?t=n.toJSON(e):(t={name:e.name,times:$l.convertArray(e.times,Array),values:$l.convertArray(e.values,Array)},(n=e.getInterpolation())!==e.DefaultInterpolation&&(t.interpolation=n)),t.type=e.ValueTypeName,t}}),Object.assign(ic.prototype,{constructor:ic,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:xt,InterpolantFactoryMethodDiscrete:function(e){return new rc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new nc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new tc(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case yt:t=this.InterpolantFactoryMethodDiscrete;break;case xt:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)return this.createInterpolant=t,this;var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return yt;case this.InterpolantFactoryMethodLinear:return xt;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this},trim:function(e,t){for(var n,r=this.times,i=r.length,a=0,o=i-1;a!==i&&r[a]<e;)++a;for(;-1!==o&&r[o]>t;)--o;return++o,0===a&&o===i||(o<=a&&(a=(o=Math.max(o,1))-1),n=this.getValueSize(),this.times=$l.arraySlice(r,a,o),this.values=$l.arraySlice(this.values,a*n,o*n)),this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=n[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&s<a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==r&&$l.isTypedArray(r))for(var o=0,l=r.length;o!==l;++o){var c=r[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e},optimize:function(){for(var e=this.times,t=this.values,n=this.getValueSize(),r=2302===this.getInterpolation(),i=1,a=e.length-1,o=1;o<a;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==l[0]))if(r)s=!0;else for(var c=o*n,u=c-n,h=c+n,d=0;d!==n;++d){var p=t[c+d];if(p!==t[u+d]||p!==t[h+d]){s=!0;break}}if(s){if(o!==i){e[i]=e[o];for(var f=o*n,m=i*n,d=0;d!==n;++d)t[m+d]=t[f+d]}++i}}if(0<a){e[i]=e[a];for(f=a*n,m=i*n,d=0;d!==n;++d)t[m+d]=t[f+d];++i}return i!==e.length&&(this.times=$l.arraySlice(e,0,i),this.values=$l.arraySlice(t,0,i*n)),this},clone:function(){var e=$l.arraySlice(this.times,0),t=$l.arraySlice(this.values,0),t=new this.constructor(this.name,e,t);return t.createInterpolant=this.createInterpolant,t}}),ac.prototype=Object.assign(Object.create(ic.prototype),{constructor:ac,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:yt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),oc.prototype=Object.assign(Object.create(ic.prototype),{constructor:oc,ValueTypeName:"color"}),sc.prototype=Object.assign(Object.create(ic.prototype),{constructor:sc,ValueTypeName:"number"}),lc.prototype=Object.assign(Object.create(ec.prototype),{constructor:lc,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=(n-t)/(r-t),c=s+o;s!==c;s+=4)Gt.slerpFlat(i,0,a,s-o,a,s,l);return i}}),cc.prototype=Object.assign(Object.create(ic.prototype),{constructor:cc,ValueTypeName:"quaternion",DefaultInterpolation:xt,InterpolantFactoryMethodLinear:function(e){return new lc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),uc.prototype=Object.assign(Object.create(ic.prototype),{constructor:uc,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:yt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),hc.prototype=Object.assign(Object.create(ic.prototype),{constructor:hc,ValueTypeName:"vector"}),Object.assign(dc,{parse:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,a=n.length;i!==a;++i)t.push(pc(n[i]).scale(r));return new dc(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,e={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},r=0,i=n.length;r!==i;++r)t.push(ic.toJSON(n[r]));return e},CreateFromMorphTargetSequence:function(e,t,n,r){for(var i=t.length,a=[],o=0;o<i;o++){var s=[];(c=[]).push((o+i-1)%i,o,(o+1)%i),s.push(0,1,0);var l=$l.getKeyframeOrder(c),c=$l.sortedArray(c,1,l),s=$l.sortedArray(s,1,l);r||0!==c[0]||(c.push(i),s.push(s[0])),a.push(new sc(".morphTargetInfluences["+t[o].name+"]",c,s).scale(1/n))}return new dc(e,-1,a)},findByName:function(e,t){var n=e;Array.isArray(e)||(n=e.geometry&&e.geometry.animations||e.animations);for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(i);l&&1<l.length&&((l=r[c=l[1]])||(r[c]=l=[]),l.push(s))}var c,u=[];for(c in r)u.push(dc.CreateFromMorphTargetSequence(c,r[c],t,n));return u},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,i){var a;0!==n.length&&($l.flattenJSON(n,a=[],n=[],r),0!==a.length&&i.push(new e(t,a,n)))},r=[],i=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u,h={},d=0;d<c.length;d++)if(c[d].morphTargets)for(var p=0;p<c[d].morphTargets.length;p++)h[c[d].morphTargets[p]]=-1;for(u in h){for(var f=[],m=[],p=0;p!==c[d].morphTargets.length;++p){var g=c[d];f.push(g.time),m.push(g.morphTarget===u?1:0)}r.push(new sc(".morphTargetInfluence["+u+"]",f,m))}a=h.length*(o||1)}else{var v=".bones["+t[l].name+"]";n(hc,v+".position",c,"pos",r),n(cc,v+".quaternion",c,"rot",r),n(hc,v+".scale",c,"scl",r)}}return 0===r.length?null:new dc(i,a,r)}}),Object.assign(dc.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t)var r=this.tracks[t],e=Math.max(e,r.times[r.times.length-1]);return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new dc(this.name,this.duration,e)}});var fc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function mc(e,t,n){var r=this,i=!1,a=0,o=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===i&&void 0!==r.onStart&&r.onStart(e,a,o),i=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){e=l.indexOf(e);return-1!==e&&l.splice(e,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var r=l[t],i=l[t+1];if(r.test(e))return i}return null}}var gc=new mc;function vc(e){this.manager=void 0!==e?e:gc,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(vc.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var yc={};function xc(e){vc.call(this,e)}function bc(e){vc.call(this,e)}function _c(e){vc.call(this,e)}function Mc(e){vc.call(this,e)}function wc(e){vc.call(this,e)}function Tc(e){vc.call(this,e)}function Sc(e){vc.call(this,e)}function Ec(){this.type="Curve",this.arcLengthDivisions=200}function Ac(e,t,n,r,i,a,o,s){Ec.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function Cc(e,t,n,r,i,a){Ac.call(this,e,t,n,n,r,i,a),this.type="ArcCurve"}function Pc(){var i=0,a=0,o=0,s=0;function l(e,t,n,r){o=-3*(i=e)+3*t-2*(a=n)-r,s=2*e-2*t+n+r}return{initCatmullRom:function(e,t,n,r,i){l(t,n,i*(n-e),i*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,i,a,o){i=(t-e)/i-(n-e)/(i+a)+(n-t)/a,o=(n-t)/a-(r-t)/(a+o)+(r-n)/o;l(t,n,i*=a,o*=a)},calc:function(e){var t=e*e;return i+a*e+o*t+s*(t*e)}}}xc.prototype=Object.assign(Object.create(vc.prototype),{constructor:xc,load:function(o,e,t,n){void 0===o&&(o=""),void 0!==this.path&&(o=this.path+o),o=this.manager.resolveURL(o);var s=this,r=fc.get(o);if(void 0!==r)return s.manager.itemStart(o),setTimeout(function(){e&&e(r),s.manager.itemEnd(o)},0),r;if(void 0===yc[o]){var i=o.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){var a=i[1],l=!!i[2],c=i[3],c=decodeURIComponent(c);l&&(c=atob(c));try{var u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":for(var h=new Uint8Array(c.length),d=0;d<c.length;d++)h[d]=c.charCodeAt(d);p="blob"===u?new Blob([h.buffer],{type:a}):h.buffer;break;case"document":var p=(new DOMParser).parseFromString(c,a);break;case"json":p=JSON.parse(c);break;default:p=c}setTimeout(function(){e&&e(p),s.manager.itemEnd(o)},0)}catch(e){setTimeout(function(){n&&n(e),s.manager.itemError(o),s.manager.itemEnd(o)},0)}}else{yc[o]=[],yc[o].push({onLoad:e,onProgress:t,onError:n});var f,m=new XMLHttpRequest;for(f in m.open("GET",o,!0),m.addEventListener("load",function(e){var t=this.response;fc.add(o,t);var n=yc[o];if(delete yc[o],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var r=0,i=n.length;r<i;r++)(a=n[r]).onLoad&&a.onLoad(t);s.manager.itemEnd(o)}else{for(var a,r=0,i=n.length;r<i;r++)(a=n[r]).onError&&a.onError(e);s.manager.itemError(o),s.manager.itemEnd(o)}},!1),m.addEventListener("progress",function(e){for(var t=yc[o],n=0,r=t.length;n<r;n++){var i=t[n];i.onProgress&&i.onProgress(e)}},!1),m.addEventListener("error",function(e){var t=yc[o];delete yc[o];for(var n=0,r=t.length;n<r;n++){var i=t[n];i.onError&&i.onError(e)}s.manager.itemError(o),s.manager.itemEnd(o)},!1),m.addEventListener("abort",function(e){var t=yc[o];delete yc[o];for(var n=0,r=t.length;n<r;n++){var i=t[n];i.onError&&i.onError(e)}s.manager.itemError(o),s.manager.itemEnd(o)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(f,this.requestHeader[f]);m.send(null)}return s.manager.itemStart(o),m}yc[o].push({onLoad:e,onProgress:t,onError:n})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),bc.prototype=Object.assign(Object.create(vc.prototype),{constructor:bc,load:function(e,t,n,r){var i=this,a=new xc(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},n,r)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var r=dc.parse(e[n]);t.push(r)}return t}}),_c.prototype=Object.assign(Object.create(vc.prototype),{constructor:_c,load:function(e,a,n,r){var o=this,s=[],l=new Rs;l.image=s;var i=new xc(this.manager);if(i.setPath(this.path),i.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,t=0,u=e.length;t<u;++t)!function(t){i.load(e[t],function(e){e=o.parse(e,!0);s[t]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},6===(c+=1)&&(1===e.mipmapCount&&(l.minFilter=Ae),l.format=e.format,l.needsUpdate=!0,a&&a(l))},n,r)}(t);else i.load(e,function(e){var t=o.parse(e,!0);if(t.isCubemap)for(var n=t.mipmaps.length/t.mipmapCount,r=0;r<n;r++){s[r]={mipmaps:[]};for(var i=0;i<t.mipmapCount;i++)s[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+i]),s[r].format=t.format,s[r].width=t.width,s[r].height=t.height}else l.image.width=t.width,l.image.height=t.height,l.mipmaps=t.mipmaps;1===t.mipmapCount&&(l.minFilter=Ae),l.format=t.format,l.needsUpdate=!0,a&&a(l)},n,r);return l}}),Mc.prototype=Object.assign(Object.create(vc.prototype),{constructor:Mc,load:function(e,t,n,r){var i=this,a=new Ti,o=new xc(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,function(e){e=i.parse(e);e&&(void 0!==e.image?a.image=e.image:void 0!==e.data&&(a.image.width=e.width,a.image.height=e.height,a.image.data=e.data),a.wrapS=void 0!==e.wrapS?e.wrapS:be,a.wrapT=void 0!==e.wrapT?e.wrapT:be,a.magFilter=void 0!==e.magFilter?e.magFilter:Ae,a.minFilter=void 0!==e.minFilter?e.minFilter:Pe,a.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.format&&(a.format=e.format),void 0!==e.type&&(a.type=e.type),void 0!==e.mipmaps&&(a.mipmaps=e.mipmaps),1===e.mipmapCount&&(a.minFilter=Ae),a.needsUpdate=!0,t&&t(a,e))},n,r),a}}),wc.prototype=Object.assign(Object.create(vc.prototype),{constructor:wc,load:function(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,a=fc.get(t);if(void 0!==a)return i.manager.itemStart(t),setTimeout(function(){e&&e(a),i.manager.itemEnd(t)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),fc.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}}),Tc.prototype=Object.assign(Object.create(vc.prototype),{constructor:Tc,load:function(e,n,t,r){var i=new Zi,a=new wc(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;for(var s=0;s<e.length;++s)!function(t){a.load(e[t],function(e){i.images[t]=e,6===++o&&(i.needsUpdate=!0,n&&n(i))},void 0,r)}(s);return i}}),Sc.prototype=Object.assign(Object.create(vc.prototype),{constructor:Sc,load:function(t,n,e,r){var i=new Jt,a=new wc(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(e){i.image=e;e=0<t.search(/\.jpe?g($|\?)/i)||0===t.search(/^data\:image\/jpeg/);i.format=e?He:Ge,i.needsUpdate=!0,void 0!==n&&n(i)},e,r),i}}),Object.assign(Ec.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){e=this.getUtoTmapping(e);return this.getPoint(e,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,r=[],i=this.getPoint(0),a=0;for(r.push(0),n=1;n<=e;n++)a+=(t=this.getPoint(n/e)).distanceTo(i),r.push(a),i=t;return this.cacheArcLengths=r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){for(var n,r=this.getLengths(),i=0,a=r.length,o=t||e*r[a-1],s=0,l=a-1;s<=l;)if((n=r[i=Math.floor(s+(l-s)/2)]-o)<0)s=i+1;else{if(!(0<n)){l=i;break}l=i-1}if(r[i=l]===o)return i/(a-1);e=r[i];return(i+(o-e)/(r[i+1]-e))/(a-1)},getTangent:function(e){var t=e-1e-4,e=e+1e-4;1<e&&(e=1);t=this.getPoint(t=t<0?0:t);return this.getPoint(e).clone().sub(t).normalize()},getTangentAt:function(e){e=this.getUtoTmapping(e);return this.getTangent(e)},computeFrenetFrames:function(e,t){for(var n,r=new Vt,i=[],a=[],o=[],s=new Vt,l=new cn,c=0;c<=e;c++)i[c]=this.getTangentAt(c/e),i[c].normalize();a[0]=new Vt,o[0]=new Vt;var u=Number.MAX_VALUE,h=Math.abs(i[0].x),d=Math.abs(i[0].y),p=Math.abs(i[0].z);for(h<=u&&(u=h,r.set(1,0,0)),d<=u&&(u=d,r.set(0,1,0)),p<=u&&r.set(0,0,1),s.crossVectors(i[0],r).normalize(),a[0].crossVectors(i[0],s),o[0].crossVectors(i[0],a[0]),c=1;c<=e;c++)a[c]=a[c-1].clone(),o[c]=o[c-1].clone(),s.crossVectors(i[c-1],i[c]),s.length()>Number.EPSILON&&(s.normalize(),n=Math.acos(zt.clamp(i[c-1].dot(i[c]),-1,1)),a[c].applyMatrix4(l.makeRotationAxis(s,n))),o[c].crossVectors(i[c],a[c]);if(!0===t)for(n=Math.acos(zt.clamp(a[0].dot(a[e]),-1,1)),n/=e,0<i[0].dot(s.crossVectors(a[0],a[e]))&&(n=-n),c=1;c<=e;c++)a[c].applyMatrix4(l.makeRotationAxis(i[c],n*c)),o[c].crossVectors(i[c],a[c]);return{tangents:i,normals:a,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),((Ac.prototype=Object.create(Ec.prototype)).constructor=Ac).prototype.isEllipseCurve=!0,Ac.prototype.getPoint=function(e,t){for(var n=t||new Ht,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;r<i;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);return 0!==this.aRotation&&(t=Math.cos(this.aRotation),a=Math.sin(this.aRotation),s=(e=s-this.aX)*t-(o=l-this.aY)*a+this.aX,l=e*a+o*t+this.aY),n.set(s,l)},Ac.prototype.copy=function(e){return Ec.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ac.prototype.toJSON=function(){var e=Ec.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Ac.prototype.fromJSON=function(e){return Ec.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},((Cc.prototype=Object.create(Ac.prototype)).constructor=Cc).prototype.isArcCurve=!0;var Lc=new Vt,Oc=new Pc,Ic=new Pc,Rc=new Pc;function Fc(e,t,n,r){Ec.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=r||.5}function Nc(e,t,n,r,i){var a=.5*(r-t),t=.5*(i-n),i=e*e;return(2*n-2*r+a+t)*(e*i)+(-3*n+3*r-2*a-t)*i+a*e+n}function Dc(e,t,n,r){return(i=1-(i=e))*i*t+2*(1-(t=e))*t*n+(e=e)*e*r;var i}function kc(e,t,n,r,i){return(a=1-(a=e))*a*a*t+3*(t=1-(a=e))*t*a*n+3*(1-(n=e))*n*n*r+(e=e)*e*e*i;var a}function Uc(e,t,n,r){Ec.call(this),this.type="CubicBezierCurve",this.v0=e||new Ht,this.v1=t||new Ht,this.v2=n||new Ht,this.v3=r||new Ht}function Bc(e,t,n,r){Ec.call(this),this.type="CubicBezierCurve3",this.v0=e||new Vt,this.v1=t||new Vt,this.v2=n||new Vt,this.v3=r||new Vt}function zc(e,t){Ec.call(this),this.type="LineCurve",this.v1=e||new Ht,this.v2=t||new Ht}function Hc(e,t){Ec.call(this),this.type="LineCurve3",this.v1=e||new Vt,this.v2=t||new Vt}function Gc(e,t,n){Ec.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Ht,this.v1=t||new Ht,this.v2=n||new Ht}function jc(e,t,n){Ec.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Vt,this.v1=t||new Vt,this.v2=n||new Vt}function Wc(e){Ec.call(this),this.type="SplineCurve",this.points=e||[]}((Fc.prototype=Object.create(Ec.prototype)).constructor=Fc).prototype.isCatmullRomCurve3=!0,Fc.prototype.getPoint=function(e,t){var n,r=t||new Vt,i=this.points,a=i.length,o=(a-(this.closed?0:1))*e,s=Math.floor(o),l=o-s;return this.closed?s+=0<s?0:(Math.floor(Math.abs(s)/a)+1)*a:0===l&&s===a-1&&(s=a-2,l=1),n=this.closed||0<s?i[(s-1)%a]:(Lc.subVectors(i[0],i[1]).add(i[0]),Lc),t=i[s%a],e=i[(s+1)%a],o=this.closed||s+2<a?i[(s+2)%a]:(Lc.subVectors(i[a-1],i[a-2]).add(i[a-1]),Lc),"centripetal"===this.curveType||"chordal"===this.curveType?(s="chordal"===this.curveType?.5:.25,i=Math.pow(n.distanceToSquared(t),s),a=Math.pow(t.distanceToSquared(e),s),s=Math.pow(e.distanceToSquared(o),s),a<1e-4&&(a=1),Oc.initNonuniformCatmullRom(n.x,t.x,e.x,o.x,i=i<1e-4?a:i,a,s=s<1e-4?a:s),Ic.initNonuniformCatmullRom(n.y,t.y,e.y,o.y,i,a,s),Rc.initNonuniformCatmullRom(n.z,t.z,e.z,o.z,i,a,s)):"catmullrom"===this.curveType&&(Oc.initCatmullRom(n.x,t.x,e.x,o.x,this.tension),Ic.initCatmullRom(n.y,t.y,e.y,o.y,this.tension),Rc.initCatmullRom(n.z,t.z,e.z,o.z,this.tension)),r.set(Oc.calc(l),Ic.calc(l),Rc.calc(l)),r},Fc.prototype.copy=function(e){Ec.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Fc.prototype.toJSON=function(){var e=Ec.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Fc.prototype.fromJSON=function(e){Ec.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Vt).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},((Uc.prototype=Object.create(Ec.prototype)).constructor=Uc).prototype.isCubicBezierCurve=!0,Uc.prototype.getPoint=function(e,t){var n=t||new Ht,r=this.v0,i=this.v1,a=this.v2,t=this.v3;return n.set(kc(e,r.x,i.x,a.x,t.x),kc(e,r.y,i.y,a.y,t.y)),n},Uc.prototype.copy=function(e){return Ec.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Uc.prototype.toJSON=function(){var e=Ec.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Uc.prototype.fromJSON=function(e){return Ec.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((Bc.prototype=Object.create(Ec.prototype)).constructor=Bc).prototype.isCubicBezierCurve3=!0,Bc.prototype.getPoint=function(e,t){var n=t||new Vt,r=this.v0,i=this.v1,a=this.v2,t=this.v3;return n.set(kc(e,r.x,i.x,a.x,t.x),kc(e,r.y,i.y,a.y,t.y),kc(e,r.z,i.z,a.z,t.z)),n},Bc.prototype.copy=function(e){return Ec.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Bc.prototype.toJSON=function(){var e=Ec.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Bc.prototype.fromJSON=function(e){return Ec.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((zc.prototype=Object.create(Ec.prototype)).constructor=zc).prototype.isLineCurve=!0,zc.prototype.getPoint=function(e,t){t=t||new Ht;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},zc.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},zc.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},zc.prototype.copy=function(e){return Ec.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},zc.prototype.toJSON=function(){var e=Ec.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},zc.prototype.fromJSON=function(e){return Ec.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((Hc.prototype=Object.create(Ec.prototype)).constructor=Hc).prototype.isLineCurve3=!0,Hc.prototype.getPoint=function(e,t){t=t||new Vt;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},Hc.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Hc.prototype.copy=function(e){return Ec.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Hc.prototype.toJSON=function(){var e=Ec.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Hc.prototype.fromJSON=function(e){return Ec.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((Gc.prototype=Object.create(Ec.prototype)).constructor=Gc).prototype.isQuadraticBezierCurve=!0,Gc.prototype.getPoint=function(e,t){var n=t||new Ht,r=this.v0,i=this.v1,t=this.v2;return n.set(Dc(e,r.x,i.x,t.x),Dc(e,r.y,i.y,t.y)),n},Gc.prototype.copy=function(e){return Ec.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Gc.prototype.toJSON=function(){var e=Ec.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Gc.prototype.fromJSON=function(e){return Ec.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((jc.prototype=Object.create(Ec.prototype)).constructor=jc).prototype.isQuadraticBezierCurve3=!0,jc.prototype.getPoint=function(e,t){var n=t||new Vt,r=this.v0,i=this.v1,t=this.v2;return n.set(Dc(e,r.x,i.x,t.x),Dc(e,r.y,i.y,t.y),Dc(e,r.z,i.z,t.z)),n},jc.prototype.copy=function(e){return Ec.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},jc.prototype.toJSON=function(){var e=Ec.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},jc.prototype.fromJSON=function(e){return Ec.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((Wc.prototype=Object.create(Ec.prototype)).constructor=Wc).prototype.isSplineCurve=!0,Wc.prototype.getPoint=function(e,t){var n=t||new Ht,r=this.points,i=(r.length-1)*e,a=Math.floor(i),o=i-a,t=r[0===a?a:a-1],e=r[a],i=r[a>r.length-2?r.length-1:a+1],a=r[a>r.length-3?r.length-1:a+2];return n.set(Nc(o,t.x,e.x,i.x,a.x),Nc(o,t.y,e.y,i.y,a.y)),n},Wc.prototype.copy=function(e){Ec.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this},Wc.prototype.toJSON=function(){var e=Ec.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e},Wc.prototype.fromJSON=function(e){Ec.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Ht).fromArray(r))}return this};var Vc=Object.freeze({ArcCurve:Cc,CatmullRomCurve3:Fc,CubicBezierCurve:Uc,CubicBezierCurve3:Bc,EllipseCurve:Ac,LineCurve:zc,LineCurve3:Hc,QuadraticBezierCurve:Gc,QuadraticBezierCurve3:jc,SplineCurve:Wc});function Xc(){Ec.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Yc(e){Xc.call(this),this.type="Path",this.currentPoint=new Ht,e&&this.setFromPoints(e)}function qc(e){Yc.call(this,e),this.uuid=zt.generateUUID(),this.type="Shape",this.holes=[]}function Qc(e,t){An.call(this),this.type="Light",this.color=new pr(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Zc(e,t,n){Qc.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(An.DefaultUp),this.updateMatrix(),this.groundColor=new pr(t)}function Jc(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Ht(512,512),this.map=null,this.mapPass=null,this.matrix=new cn,this._frustum=new Oi,this._frameExtents=new Ht(1,1),this._viewportCount=1,this._viewports=[new Kt(0,0,1,1)]}function Kc(){Jc.call(this,new _i(50,1,.5,500))}function $c(e,t,n,r,i,a){Qc.call(this,e,t),this.type="SpotLight",this.position.copy(An.DefaultUp),this.updateMatrix(),this.target=new An,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,this.shadow=new Kc}function eu(){Jc.call(this,new _i(90,1,.5,500)),this._frameExtents=new Ht(4,2),this._viewportCount=6,this._viewports=[new Kt(2,1,1,1),new Kt(0,1,1,1),new Kt(3,1,1,1),new Kt(1,1,1,1),new Kt(3,0,1,1),new Kt(1,0,1,1)],this._cubeDirections=[new Vt(1,0,0),new Vt(-1,0,0),new Vt(0,0,1),new Vt(0,0,-1),new Vt(0,1,0),new Vt(0,-1,0)],this._cubeUps=[new Vt(0,1,0),new Vt(0,1,0),new Vt(0,1,0),new Vt(0,1,0),new Vt(0,0,1),new Vt(0,0,-1)]}function tu(e,t,n,r){Qc.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new eu}function nu(e,t,n,r,i,a){bi.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==i?i:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function ru(){Jc.call(this,new nu(-5,5,5,-5,.5,500))}function iu(e,t){Qc.call(this,e,t),this.type="DirectionalLight",this.position.copy(An.DefaultUp),this.updateMatrix(),this.target=new An,this.shadow=new ru}function au(e,t){Qc.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function ou(e,t,n,r){Qc.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function su(e){vc.call(this,e),this.textures={}}Xc.prototype=Object.assign(Object.create(Ec.prototype),{constructor:Xc,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new zc(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=t){var i=n[r]-t,a=this.curves[r],o=a.getLength();return a.getPointAt(0===o?0:1-i/o)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],r=0,i=this.curves;r<i.length;r++)for(var a=i[r],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(n.push(c),t=c)}return this.autoClose&&1<n.length&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){Ec.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Ec.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Ec.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new Vc[r.type]).fromJSON(r))}return this}}),Yc.prototype=Object.assign(Object.create(Xc.prototype),{constructor:Yc,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var n=new zc(this.currentPoint.clone(),new Ht(e,t));this.curves.push(n),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,n,r){t=new Gc(this.currentPoint.clone(),new Ht(e,t),new Ht(n,r));this.curves.push(t),this.currentPoint.set(n,r)},bezierCurveTo:function(e,t,n,r,i,a){r=new Uc(this.currentPoint.clone(),new Ht(e,t),new Ht(n,r),new Ht(i,a));this.curves.push(r),this.currentPoint.set(i,a)},splineThru:function(e){var t=new Wc([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,n,r,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,n,r,i,a)},absarc:function(e,t,n,r,i,a){this.absellipse(e,t,n,n,r,i,a)},ellipse:function(e,t,n,r,i,a,o,s){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+l,t+c,n,r,i,a,o,s)},absellipse:function(e,t,n,r,i,a,o,s){o=new Ac(e,t,n,r,i,a,o,s);0<this.curves.length&&((s=o.getPoint(0)).equals(this.currentPoint)||this.lineTo(s.x,s.y)),this.curves.push(o);o=o.getPoint(1);this.currentPoint.copy(o)},copy:function(e){return Xc.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Xc.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Xc.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),qc.prototype=Object.assign(Object.create(Yc.prototype),{constructor:qc,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Yc.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=Yc.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Yc.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new Yc).fromJSON(r))}return this}}),Qc.prototype=Object.assign(Object.create(An.prototype),{constructor:Qc,isLight:!0,copy:function(e){return An.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){e=An.prototype.toJSON.call(this,e);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Zc.prototype=Object.assign(Object.create(Qc.prototype),{constructor:Zc,isHemisphereLight:!0,copy:function(e){return Qc.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Jc.prototype,{_projScreenMatrix:new cn,_lightPositionWorld:new Vt,_lookTarget:new Vt,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(e.matrixWorld),t.position.copy(a),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Kc.prototype=Object.assign(Object.create(Jc.prototype),{constructor:Kc,isSpotLightShadow:!0,updateMatrices:function(e,t,n){var r=this.camera,i=2*zt.RAD2DEG*e.angle,a=this.mapSize.width/this.mapSize.height,o=e.distance||r.far;i===r.fov&&a===r.aspect&&o===r.far||(r.fov=i,r.aspect=a,r.far=o,r.updateProjectionMatrix()),Jc.prototype.updateMatrices.call(this,e,t,n)}}),$c.prototype=Object.assign(Object.create(Qc.prototype),{constructor:$c,isSpotLight:!0,copy:function(e){return Qc.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),eu.prototype=Object.assign(Object.create(Jc.prototype),{constructor:eu,isPointLightShadow:!0,updateMatrices:function(e,t,n){var r=this.camera,i=this.matrix,a=this._lightPositionWorld,o=this._lookTarget,s=this._projScreenMatrix;a.setFromMatrixPosition(e.matrixWorld),r.position.copy(a),o.copy(r.position),o.add(this._cubeDirections[n]),r.up.copy(this._cubeUps[n]),r.lookAt(o),r.updateMatrixWorld(),i.makeTranslation(-a.x,-a.y,-a.z),s.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromMatrix(s)}}),tu.prototype=Object.assign(Object.create(Qc.prototype),{constructor:tu,isPointLight:!0,copy:function(e){return Qc.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),nu.prototype=Object.assign(Object.create(bi.prototype),{constructor:nu,isOrthographicCamera:!0,copy:function(e,t){return bi.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,a=n+e,o=r+t,s=r-t;null!==this.view&&this.view.enabled&&(n=this.zoom/(this.view.width/this.view.fullWidth),e=this.zoom/(this.view.height/this.view.fullHeight),r=(this.right-this.left)/this.view.width,t=(this.top-this.bottom)/this.view.height,a=(i+=r*(this.view.offsetX/n))+r*(this.view.width/n),s=(o-=t*(this.view.offsetY/e))-t*(this.view.height/e)),this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){e=An.prototype.toJSON.call(this,e);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),ru.prototype=Object.assign(Object.create(Jc.prototype),{constructor:ru,isDirectionalLightShadow:!0,updateMatrices:function(e,t,n){Jc.prototype.updateMatrices.call(this,e,t,n)}}),iu.prototype=Object.assign(Object.create(Qc.prototype),{constructor:iu,isDirectionalLight:!0,copy:function(e){return Qc.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),au.prototype=Object.assign(Object.create(Qc.prototype),{constructor:au,isAmbientLight:!0}),ou.prototype=Object.assign(Object.create(Qc.prototype),{constructor:ou,isRectAreaLight:!0,copy:function(e){return Qc.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){e=Qc.prototype.toJSON.call(this,e);return e.object.width=this.width,e.object.height=this.height,e}}),su.prototype=Object.assign(Object.create(vc.prototype),{constructor:su,load:function(e,t,n,r){var i=this,a=new xc(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},n,r)},parse:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r,i=new Kl[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=(new pr).setHex(e.sheen)),void 0!==e.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.vertexColors&&(i.vertexColors=e.vertexColors),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(i.skinning=e.skinning),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(i.morphNormals=e.morphNormals),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.uniforms)for(var a in e.uniforms){var o=e.uniforms[a];switch(i.uniforms[a]={},o.type){case"t":i.uniforms[a].value=n(o.value);break;case"c":i.uniforms[a].value=(new pr).setHex(o.value);break;case"v2":i.uniforms[a].value=(new Ht).fromArray(o.value);break;case"v3":i.uniforms[a].value=(new Vt).fromArray(o.value);break;case"v4":i.uniforms[a].value=(new Kt).fromArray(o.value);break;case"m3":i.uniforms[a].value=(new qt).fromArray(o.value);case"m4":i.uniforms[a].value=(new cn).fromArray(o.value);break;default:i.uniforms[a].value=o.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var s in e.extensions)i.extensions[s]=e.extensions[s];return void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap),i.transparent=!0),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale&&(r=e.normalScale,!1===Array.isArray(r)&&(r=[r,r]),i.normalScale=(new Ht).fromArray(r)),void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Ht).fromArray(e.clearcoatNormalScale)),i},setTextures:function(e){return this.textures=e,this}});var lu=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},cu=function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)};function uu(){zr.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function hu(e,t,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),_r.call(this,e,t,n),this.meshPerAttribute=r||1}function du(e){vc.call(this,e)}uu.prototype=Object.assign(Object.create(zr.prototype),{constructor:uu,isInstancedBufferGeometry:!0,copy:function(e){return zr.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=zr.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),hu.prototype=Object.assign(Object.create(_r.prototype),{constructor:hu,isInstancedBufferAttribute:!0,copy:function(e){return _r.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=_r.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),du.prototype=Object.assign(Object.create(vc.prototype),{constructor:du,load:function(e,t,n,r){var i=this,a=new xc(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},n,r)},parse:function(e){var t=new(e.isInstancedBufferGeometry?uu:zr),n=e.data.index;void 0!==n&&(a=new pu[n.type](n.array),t.setIndex(new _r(a,1)));var r=e.data.attributes;for(l in r){var i=r[l],a=new pu[i.type](i.array),o=new(i.isInstancedBufferAttribute?hu:_r)(a,i.itemSize,i.normalized);void 0!==i.name&&(o.name=i.name),t.addAttribute(l,o)}var s=e.data.morphAttributes;if(s)for(var l in s){for(var c=s[l],u=[],h=0,d=c.length;h<d;h++){i=c[h],o=new _r(a=new pu[i.type](i.array),i.itemSize,i.normalized);void 0!==i.name&&(o.name=i.name),u.push(o)}t.morphAttributes[l]=u}var p=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==p)for(var h=0,f=p.length;h!==f;++h){var m=p[h];t.addGroup(m.start,m.count,m.materialIndex)}var g=e.data.boundingSphere;return void 0!==g&&(n=new Vt,void 0!==g.center&&n.fromArray(g.center),t.boundingSphere=new Wn(n,g.radius)),e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var pu={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function fu(e){vc.call(this,e)}fu.prototype=Object.assign(Object.create(vc.prototype),{constructor:fu,load:function(n,r,e,i){var a=this,t=""===this.path?cu(n):this.path;this.resourcePath=this.resourcePath||t;t=new xc(a.manager);t.setPath(this.path),t.load(n,function(e){var t=null;try{t=JSON.parse(e)}catch(e){return void 0!==i&&i(e),void console.error("THREE:ObjectLoader: Can't parse "+n+".",e.message)}e=t.metadata;void 0!==e&&void 0!==e.type&&"geometry"!==e.type.toLowerCase()?a.parse(t,r):console.error("THREE.ObjectLoader: Can't load "+n)},e,i)},parse:function(e,t){var n=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,n),n=this.parseImages(e.images,function(){void 0!==t&&t(i)}),n=this.parseTextures(e.textures,n),n=this.parseMaterials(e.materials,n),i=this.parseObject(e.object,r,n);return e.animations&&(i.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(i),i},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var i=(new qc).fromJSON(e[n]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var n={};if(void 0!==e)for(var r=new du,i=0,a=e.length;i<a;i++){var o,s=e[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Hl[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Hl[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Hl[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Hl[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Hl[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Hl[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Hl[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Hl[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Hl[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Hl[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new Hl[s.type]((new Vc[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Hl[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Hl[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],c=0,u=s.shapes.length;c<u;c++){var h=t[s.shapes[c]];l.push(h)}o=new Hl[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],c=0,u=s.shapes.length;c<u;c++){h=t[s.shapes[c]];l.push(h)}var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new Vc[d.type]).fromJSON(d)),o=new Hl[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(s);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?o=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}return n},parseMaterials:function(e,t){var n={},r={};if(void 0!==e){var i=new su;i.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var l=[],c=0;c<s.materials.length;c++){var u=s.materials[c];void 0===n[u.uuid]&&(n[u.uuid]=i.parse(u)),l.push(n[u.uuid])}r[s.uuid]=l}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],i=dc.parse(r);void 0!==r.uuid&&(i.uuid=r.uuid),t.push(i)}return t},parseImages:function(e,t){var n=this,r={};function i(e){return n.manager.itemStart(e),a.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemError(e),n.manager.itemEnd(e)})}if(void 0!==e&&0<e.length){var a=new wc(new mc(t));a.setCrossOrigin(this.crossOrigin);for(var o=0,s=e.length;o<s;o++){var l=e[o],c=l.url;if(Array.isArray(c)){r[l.uuid]=[];for(var u=0,h=c.length;u<h;u++){var d=c[u],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:n.resourcePath+d;r[l.uuid].push(i(p))}}else{p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:n.resourcePath+l.url;r[l.uuid]=i(p)}}}return r},parseTextures:function(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var i=0,a=e.length;i<a;i++){var o,s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=new(Array.isArray(t[s.image])?Zi:Jt)(t[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=n(s.mapping,gu)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=n(s.wrap[0],vu),o.wrapT=n(s.wrap[1],vu)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=n(s.minFilter,yu)),void 0!==s.magFilter&&(o.magFilter=n(s.magFilter,yu)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),r[s.uuid]=o}return r},parseObject:function(e,t,a){function n(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function r(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];void 0===a[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(a[i])}return t}return void 0===a[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),a[e]}}switch(e.type){case"Scene":s=new Cn,void 0!==e.background&&Number.isInteger(e.background)&&(s.background=new pr(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new Ho(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new zo(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":s=new _i(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new nu(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new au(e.color,e.intensity);break;case"DirectionalLight":s=new iu(e.color,e.intensity);break;case"PointLight":s=new tu(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new ou(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new $c(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new Zc(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var i=n(e.geometry),o=r(e.material),s=new(i.bones&&0<i.bones.length?ls:ii)(i,o);void 0!==e.drawMode&&s.setDrawMode(e.drawMode);break;case"LOD":s=new ss;break;case"Line":s=new bs(n(e.geometry),r(e.material),e.mode);break;case"LineLoop":s=new Ts(n(e.geometry),r(e.material));break;case"LineSegments":s=new ws(n(e.geometry),r(e.material));break;case"PointCloud":case"Points":s=new Ls(n(e.geometry),r(e.material));break;case"Sprite":s=new rs(r(e.material));break;case"Group":s=new Oo;break;default:s=new An}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children)for(var l=e.children,c=0;c<l.length;c++)s.add(this.parseObject(l[c],t,a));if("LOD"===e.type)for(var u=e.levels,h=0;h<u.length;h++){var d=u[h],p=s.getObjectByProperty("uuid",d.object);void 0!==p&&s.addLevel(p,d.distance)}return s}});var mu,gu={UVMapping:300,CubeReflectionMapping:U,CubeRefractionMapping:B,EquirectangularReflectionMapping:z,EquirectangularRefractionMapping:H,SphericalReflectionMapping:G,CubeUVReflectionMapping:j,CubeUVRefractionMapping:ye},vu={RepeatWrapping:xe,ClampToEdgeWrapping:be,MirroredRepeatWrapping:_e},yu={NearestFilter:Te,NearestMipmapNearestFilter:Se,NearestMipmapLinearFilter:Ee,LinearFilter:Ae,LinearMipmapNearestFilter:Ce,LinearMipmapLinearFilter:Pe};function xu(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),vc.call(this,e),this.options=void 0}function bu(){this.type="ShapePath",this.color=new pr,this.subPaths=[],this.currentPath=null}function _u(e){this.type="Font",this.data=e}function Mu(e){vc.call(this,e)}xu.prototype=Object.assign(Object.create(vc.prototype),{constructor:xu,setOptions:function(e){return this.options=e,this},load:function(t,n,e,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,a=fc.get(t);if(void 0!==a)return i.manager.itemStart(t),setTimeout(function(){n&&n(a),i.manager.itemEnd(t)},0),a;fetch(t).then(function(e){return e.blob()}).then(function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)}).then(function(e){fc.add(t,e),n&&n(e),i.manager.itemEnd(t)}).catch(function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}),i.manager.itemStart(t)}}),Object.assign(bu.prototype,{moveTo:function(e,t){this.currentPath=new Yc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,n,r){this.currentPath.quadraticCurveTo(e,t,n,r)},bezierCurveTo:function(e,t,n,r,i,a){this.currentPath.bezierCurveTo(e,t,n,r,i,a)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],a=new qc;a.curves=i.curves,t.push(a)}return t}var r=gl.isClockWise,i=this.subPaths;if(0===i.length)return[];if(!0===t)return n(i);var a,o,s,l=[];if(1===i.length)return o=i[0],(s=new qc).curves=o.curves,l.push(s),l;var c,u=!r(i[0].getPoints()),u=e?!u:u,h=[],d=[],p=[],f=0;d[f]=void 0,p[f]=[];for(var m=0,g=i.length;m<g;m++)a=r(c=(o=i[m]).getPoints()),(a=e?!a:a)?(!u&&d[f]&&f++,d[f]={s:new qc,p:c},d[f].s.curves=o.curves,u&&f++,p[f]=[]):p[f].push({h:o,p:c[0]});if(!d[0])return n(i);if(1<d.length){for(var v=!1,y=[],x=0,b=d.length;x<b;x++)h[x]=[];for(x=0,b=d.length;x<b;x++)for(var _=p[x],M=0;M<_.length;M++){for(var w=_[M],T=!0,S=0;S<d.length;S++)!function(e,t){for(var n=t.length,r=!1,i=n-1,a=0;a<n;i=a++){var o=t[i],s=t[a],l=s.x-o.x,c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(o=t[a],l=-l,s=t[i],c=-c),!(e.y<o.y||e.y>s.y))if(e.y===o.y){if(e.x===o.x)return 1}else{l=c*(e.x-o.x)-l*(e.y-o.y);if(0==l)return 1;l<0||(r=!r)}}else if(e.y===o.y&&(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x))return 1}return r}(w.p,d[S].p)||(x!==S&&y.push({froms:x,tos:S,hole:M}),T?(T=!1,h[S].push(w)):v=!0);T&&h[x].push(w)}0<y.length&&(v||(p=h))}for(var m=0,E=d.length;m<E;m++){s=d[m].s,l.push(s);for(var A,C=0,P=(A=p[m]).length;C<P;C++)s.holes.push(A[C].h)}return l}}),Object.assign(_u.prototype,{isFont:!0,generateShapes:function(e,t){for(var n=[],r=function(e,t,n){for(var r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,o=[],s=0,l=0,c=0;c<r.length;c++){var u=r[c];"\n"===u?(s=0,l-=a):(u=function(e,t,n,r,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var o,s,l,c,u,h,d,p,f=new bu;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,v=m.length;g<v;)switch(m[g++]){case"m":o=m[g++]*t+n,s=m[g++]*t+r,f.moveTo(o,s);break;case"l":o=m[g++]*t+n,s=m[g++]*t+r,f.lineTo(o,s);break;case"q":l=m[g++]*t+n,c=m[g++]*t+r,u=m[g++]*t+n,h=m[g++]*t+r,f.quadraticCurveTo(u,h,l,c);break;case"b":l=m[g++]*t+n,c=m[g++]*t+r,u=m[g++]*t+n,h=m[g++]*t+r,d=m[g++]*t+n,p=m[g++]*t+r,f.bezierCurveTo(u,h,d,p,l,c)}return{offsetX:a.ha*t,path:f}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}(u,i,s,l,n),s+=u.offsetX,o.push(u.path))}return o}(e,t=void 0===t?100:t,this.data),i=0,a=r.length;i<a;i++)Array.prototype.push.apply(n,r[i].toShapes());return n}}),Mu.prototype=Object.assign(Object.create(vc.prototype),{constructor:Mu,load:function(e,r,t,n){var i=this,a=new xc(this.manager);a.setPath(this.path),a.load(e,function(t){try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}var n=i.parse(n);r&&r(n)},t,n)},parse:function(e){return new _u(e)}});var wu=function(){return mu=void 0===mu?new(window.AudioContext||window.webkitAudioContext):mu};function Tu(e){vc.call(this,e)}function Su(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new Vt)}function Eu(e,t){Qc.call(this,void 0,t),this.sh=void 0!==e?e:new Su}function Au(e,t,n){Eu.call(this,void 0,n);var r=(new pr).set(e),n=(new pr).set(t),e=new Vt(r.r,r.g,r.b),t=new Vt(n.r,n.g,n.b),r=Math.sqrt(Math.PI),n=r*Math.sqrt(.75);this.sh.coefficients[0].copy(e).add(t).multiplyScalar(r),this.sh.coefficients[1].copy(e).sub(t).multiplyScalar(n)}function Cu(e,t){Eu.call(this,void 0,t);e=(new pr).set(e);this.sh.coefficients[0].set(e.r,e.g,e.b).multiplyScalar(2*Math.sqrt(Math.PI))}Tu.prototype=Object.assign(Object.create(vc.prototype),{constructor:Tu,load:function(e,t,n,r){var i=new xc(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,function(e){e=e.slice(0);wu().decodeAudioData(e,function(e){t(e)})},n,r)}}),Object.assign(Su.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var n=e.x,r=e.y,i=e.z,e=this.coefficients;return t.copy(e[0]).multiplyScalar(.282095),t.addScale(e[1],.488603*r),t.addScale(e[2],.488603*i),t.addScale(e[3],.488603*n),t.addScale(e[4],n*r*1.092548),t.addScale(e[5],r*i*1.092548),t.addScale(e[6],.315392*(3*i*i-1)),t.addScale(e[7],n*i*1.092548),t.addScale(e[8],.546274*(n*n-r*r)),t},getIrradianceAt:function(e,t){var n=e.x,r=e.y,i=e.z,e=this.coefficients;return t.copy(e[0]).multiplyScalar(.886227),t.addScale(e[1],1.023328*r),t.addScale(e[2],1.023328*i),t.addScale(e[3],1.023328*n),t.addScale(e[4],.858086*n*r),t.addScale(e[5],.858086*r*i),t.addScale(e[6],.743125*i*i-.247708),t.addScale(e[7],.858086*n*i),t.addScale(e[8],.429043*(n*n-r*r)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}),Object.assign(Su,{getBasisAt:function(e,t){var n=e.x,r=e.y,e=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*e,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*e,t[6]=.315392*(3*e*e-1),t[7]=1.092548*n*e,t[8]=.546274*(n*n-r*r)}}),Eu.prototype=Object.assign(Object.create(Qc.prototype),{constructor:Eu,isLightProbe:!0,copy:function(e){return Qc.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return Qc.prototype.toJSON.call(this,e)}}),Au.prototype=Object.assign(Object.create(Eu.prototype),{constructor:Au,isHemisphereLightProbe:!0,copy:function(e){return Eu.prototype.copy.call(this,e),this},toJSON:function(e){return Eu.prototype.toJSON.call(this,e)}}),Cu.prototype=Object.assign(Object.create(Eu.prototype),{constructor:Cu,isAmbientLightProbe:!0,copy:function(e){return Eu.prototype.copy.call(this,e),this},toJSON:function(e){return Eu.prototype.toJSON.call(this,e)}});var Pu=new cn,Lu=new cn;function Ou(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new _i,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new _i,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(e){var t,n,r,i,a,o=this._cache;o.focus===e.focus&&o.fov===e.fov&&o.aspect===e.aspect*this.aspect&&o.near===e.near&&o.far===e.far&&o.zoom===e.zoom&&o.eyeSep===this.eyeSep||(o.focus=e.focus,o.fov=e.fov,o.aspect=e.aspect*this.aspect,o.near=e.near,o.far=e.far,o.zoom=e.zoom,o.eyeSep=this.eyeSep,t=e.projectionMatrix.clone(),n=(a=o.eyeSep/2)*o.near/o.focus,r=o.near*Math.tan(zt.DEG2RAD*o.fov*.5)/o.zoom,Lu.elements[12]=-a,Pu.elements[12]=a,i=-r*o.aspect+n,a=r*o.aspect+n,t.elements[0]=2*o.near/(a-i),t.elements[8]=(a+i)/(a-i),this.cameraL.projectionMatrix.copy(t),i=-r*o.aspect-n,a=r*o.aspect-n,t.elements[0]=2*o.near/(a-i),t.elements[8]=(a+i)/(a-i),this.cameraR.projectionMatrix.copy(t)),this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Lu),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Pu)}}),Object.assign(Ou.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e,t=0;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(t=((e=("undefined"==typeof performance?Date:performance).now())-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t),t)}});var Iu=new Vt,Ru=new Gt,Fu=new Vt,Nu=new Vt;function Du(){An.call(this),this.type="AudioListener",this.context=wu(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Ou}function ku(e){An.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}Du.prototype=Object.assign(Object.create(An.prototype),{constructor:Du,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){An.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,n=this.up;this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Iu,Ru,Fu),Nu.set(0,0,-1).applyQuaternion(Ru),t.positionX?(e=this.context.currentTime+this.timeDelta,t.positionX.linearRampToValueAtTime(Iu.x,e),t.positionY.linearRampToValueAtTime(Iu.y,e),t.positionZ.linearRampToValueAtTime(Iu.z,e),t.forwardX.linearRampToValueAtTime(Nu.x,e),t.forwardY.linearRampToValueAtTime(Nu.y,e),t.forwardZ.linearRampToValueAtTime(Nu.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)):(t.setPosition(Iu.x,Iu.y,Iu.z),t.setOrientation(Nu.x,Nu.y,Nu.z,n.x,n.y,n.z))}}),ku.prototype=Object.assign(Object.create(An.prototype),{constructor:ku,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e=e||[],!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var Uu=new Vt,Bu=new Gt,zu=new Vt,Hu=new Vt;function Gu(e){ku.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function ju(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Wu(e,t,n){this.binding=e,this.valueSize=n;var r,i=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":i=Array,r=this._select;break;default:r=this._lerp}this.buffer=new i(4*n),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Gu.prototype=Object.assign(Object.create(ku.prototype),{constructor:Gu,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(e){var t;An.prototype.updateMatrixWorld.call(this,e),!0===this.hasPlaybackControl&&!1===this.isPlaying||(this.matrixWorld.decompose(Uu,Bu,zu),Hu.set(0,0,1).applyQuaternion(Bu),(t=this.panner).positionX?(e=this.context.currentTime+this.listener.timeDelta,t.positionX.linearRampToValueAtTime(Uu.x,e),t.positionY.linearRampToValueAtTime(Uu.y,e),t.positionZ.linearRampToValueAtTime(Uu.z,e),t.orientationX.linearRampToValueAtTime(Hu.x,e),t.orientationY.linearRampToValueAtTime(Hu.y,e),t.orientationZ.linearRampToValueAtTime(Hu.z,e)):(t.setPosition(Uu.x,Uu.y,Uu.z),t.setOrientation(Hu.x,Hu.y,Hu.z)))}}),Object.assign(ju.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(Wu.prototype,{accumulate:function(e,t){var n=this.buffer,r=this.valueSize,i=e*r+r,e=this.cumulativeWeight;if(0===e){for(var a=0;a!==r;++a)n[i+a]=n[a];e=t}else this._mixBufferRegion(n,i,0,t/(e+=t),r);this.cumulativeWeight=e},apply:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,e=this.cumulativeWeight,i=this.binding;this.cumulativeWeight=0,e<1&&this._mixBufferRegion(n,r,3*t,1-e,t);for(var a=t,o=t+t;a!==o;++a)if(n[a]!==n[a+t]){i.setValue(n,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=3*n;e.getValue(t,r);for(var i=n,a=r;i!==a;++i)t[i]=t[r+i%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,r,i){if(.5<=r)for(var a=0;a!==i;++a)e[t+a]=e[n+a]},_slerp:function(e,t,n,r){Gt.slerpFlat(e,t,e,t,e,n,r)},_lerp:function(e,t,n,r,i){for(var a=1-r,o=0;o!==i;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*r}}});var Vu="\\[\\]\\.:\\/",Xu=new RegExp("["+Vu+"]","g"),Yu="[^"+Vu+"]",qu="[^"+Vu.replace("\\.","")+"]",Qu=/((?:WC+[\/:])*)/.source.replace("WC",Yu),Vu=/(WCOD+)?/.source.replace("WCOD",qu),qu=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Yu),Yu=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Yu),Zu=new RegExp("^"+Qu+Vu+qu+Yu+"$"),Ju=["material","materials","bones"];function Ku(e,t,n){n=n||$u.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function $u(e,t,n){this.path=t,this.parsedPath=n||$u.parseTrackName(t),this.node=$u.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function eh(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var r=t.tracks,i=r.length,a=new Array(i),o={endingStart:bt,endingEnd:bt},s=0;s!==i;++s){var l=r[s].createInterpolant(null);(a[s]=l).settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function th(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function nh(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function rh(e,t,n){Go.call(this,e,t),this.meshPerAttribute=n||1}function ih(e,t,n,r){this.ray=new Kn(e,t),this.near=n||0,this.far=r||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ah(e,t){return e.distance-t.distance}function oh(e,t,n,r){if(!1!==e.visible&&(e.raycast(t,n),!0===r))for(var i=e.children,a=0,o=i.length;a<o;a++)oh(i[a],t,n,!0)}function sh(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}Object.assign(Ku.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,n=this._bindings[n];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign($u,{Composite:Ku,create:function(e,t,n){return new(e&&e.isAnimationObjectGroup?$u.Composite:$u)(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Xu,"")},parseTrackName:function(e){var t=Zu.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r&&(t=n.nodeName.substring(r+1),-1!==Ju.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)),null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,i){if(!i||""===i||"root"===i||"."===i||-1===i||i===e.name||i===e.uuid)return e;if(e.skeleton){var t=e.skeleton.getBoneByName(i);if(void 0!==t)return t}if(e.children){e=function e(t){for(var n=0;n<t.length;n++){var r=t[n];if(r.name===i||r.uuid===i)return r;r=e(r.children);if(r)return r}return null}(e.children);if(e)return e}return null}}),Object.assign($u.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;if(e||(e=$u.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var a=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(var e=e.skeleton.bones,o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[r];if(void 0!==s){var l=this.Versioning.None;void 0!==(this.targetObject=e).needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===i){i=o;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{t=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+t+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign($u.prototype,{_getValue_unbound:$u.prototype.getValue,_setValue_unbound:$u.prototype.setValue}),Object.assign(function(){this.uuid=zt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],d=h.uuid,p=r[d];if(void 0===p){p=t++,r[d]=p,e.push(h);for(var f=0,m=s;f!==m;++f)o[f].push(new $u(h,i[f],a[f]))}else if(p<n){var l=e[p],g=--n,v=e[g];e[r[v.uuid]=p]=v,e[r[d]=g]=h;for(f=0,m=s;f!==m;++f){var y=o[f],x=y[g],b=y[p];y[p]=x,void 0===b&&(b=new $u(h,i[f],a[f])),y[g]=b}}else e[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,i=r.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,c=n[l];if(void 0!==c&&t<=c){var u=t++,h=e[u];e[n[h.uuid]=c]=h,e[n[l]=u]=s;for(var d=0,p=i;d!==p;++d){var f=r[d],m=f[u],g=f[c];f[c]=m,f[u]=g}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,a=i.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o].uuid,c=r[l];if(void 0!==c)if(delete r[l],c<n){var u,h=--n,l=e[h],d=e[u=--t];e[r[l.uuid]=c]=l,e[r[d.uuid]=h]=d,e.pop();for(var p=0,f=a;p!==f;++p){var m=(v=i[p])[h],g=v[u];v[c]=m,v[h]=g,v.pop()}}else{e[r[(d=e[u=--t]).uuid]=c]=d,e.pop();for(var v,p=0,f=a;p!==f;++p)(v=i[p])[c]=v[u],v.pop()}}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],i=this._bindings;if(void 0!==r)return i[r];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l),r=i.length;n[e]=r,a.push(e),o.push(t),i.push(u);for(var h=c,d=s.length;h!==d;++h){var p=s[h];u[h]=new $u(p,e,t)}return u},unsubscribe_:function(e){var t,n,r,i,a,o=this._bindingsIndicesByPath,s=o[e];void 0!==s&&(t=this._paths,n=this._parsedPaths,a=(r=this._bindings)[i=r.length-1],r[o[e[i]]=s]=a,r.pop(),n[s]=n[i],n.pop(),t[s]=t[i],t.pop())}}),Object.assign(eh.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){var r,i;return e.fadeOut(t),this.fadeIn(t),n&&(n=(r=this._clip.duration)/(i=e._clip.duration),e.warp(1,i/r,t),this.warp(n,1,t)),this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var r=this._mixer,i=r.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);r=a.parameterPositions,a=a.sampleValues;return r[0]=i,r[1]=i+n,a[0]=e/o,a[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,r){if(this.enabled){var i=this._startTime;if(null!==i){i=(e-i)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);var a=this._updateTime(t),o=this._updateWeight(e);if(0<o)for(var s=this._interpolants,l=this._propertyBindings,c=0,u=s.length;c!==u;++c)s[c].evaluate(a),l[c].accumulate(r,o)}else this._updateWeight(e)},_updateWeight:function(e){var t,n,r=0;return this.enabled&&(r=this.weight,null!==(t=this._weightInterpolant)&&(r*=n=t.evaluate(e)[0],e>t.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1)))),this._effectiveWeight=r},_updateTimeScale:function(e){var t,n=0;return this.paused||(n=this.timeScale,null!==(t=this._timeScaleInterpolant)&&(n*=t.evaluate(e)[0],e>t.parameterPositions[1]&&(this.stopWarping(),0===n?this.paused=!0:this.timeScale=n))),this._effectiveTimeScale=n},_updateTime:function(e){var t,n=this.time+e,r=this._clip.duration,i=this.loop,a=this._loopCount,o=2202===i;if(0===e)return-1!==a&&o&&1==(1&a)?r-n:n;if(2200===i){-1===a&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r<=n)n=r;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else if(-1===a&&(0<=e?this._setEndings(!(a=0),0===this.repetitions,o):this._setEndings(0===this.repetitions,!0,o)),r<=n||n<0?(n-=r*(t=Math.floor(n/r)),a+=Math.abs(t),(i=this.repetitions-a)<=0?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n=0<e?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})):(1==i?this._setEndings(i=e<0,!i,o):this._setEndings(!1,!1,o),this._loopCount=a,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:t}))):this.time=n,o&&1==(1&a))return r-n;return n},_setEndings:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=_t,r.endingEnd=_t):(r.endingStart=e?this.zeroSlopeAtStart?_t:bt:2402,r.endingEnd=t?this.zeroSlopeAtEnd?_t:bt:2402)},_scheduleFading:function(e,t,n){var r=this._mixer,i=r.time,a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);r=a.parameterPositions,a=a.sampleValues;return r[0]=i,a[0]=t,r[1]=i+e,a[1]=n,this}}),th.prototype=Object.assign(Object.create(kt.prototype),{constructor:th,_bindAction:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,e=this._bindingsByRootAndName,l=e[s];void 0===l&&(e[s]=l={});for(var c=0;c!==i;++c){var u=r[c],h=u.name;if(void 0!==(d=l[h]))a[c]=d;else{if(void 0!==(d=a[c])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,h));continue}var d,p=t&&t._propertyBindings[c].binding.parsedPath;++(d=new Wu($u.create(n,h,p),u.ValueTypeName,u.getValueSize())).referenceCount,this._addInactiveBinding(d,s,h),a[c]=d}o[c].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){var t,n,r;null===e._cacheIndex&&(t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n],this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t));for(var i=e._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){e=e._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(e,t,n){var r=this._actions,i=this._actionsByClip,a=i[t];void 0===a?(a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a):(t=a.knownActions,e._byClipCacheIndex=t.length,t.push(e)),e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;t[n._cacheIndex=r]=n,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,a=this._actionsByClip,o=a[i],r=o.knownActions,n=r[r.length-1],t=e._byClipCacheIndex;r[n._byClipCacheIndex=t]=n,r.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===r.length&&delete a[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];t[e._cacheIndex=r]=e,t[i._cacheIndex=n]=i},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];t[e._cacheIndex=r]=e,t[i._cacheIndex=n]=i},_addInactiveBinding:function(e,t,n){var r=this._bindingsByRootAndName,i=r[t],a=this._bindings;void 0===i&&(r[t]=i={}),(i[n]=e)._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,o=a[r],n=t[t.length-1],e=e._cacheIndex;t[n._cacheIndex=e]=n,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[r]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];t[e._cacheIndex=r]=e,t[i._cacheIndex=n]=i},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];t[e._cacheIndex=r]=e,t[i._cacheIndex=n]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&(e[(n=new nc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];t[e.__cacheIndex=r]=e,t[i.__cacheIndex=n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"==typeof e?dc.findByName(n,e):e,a=null!==i?i.uuid:e,o=this._actionsByClip[a],n=null;if(void 0!==o){e=o.actionByRoot[r];if(void 0!==e)return e;n=o.knownActions[0],null===i&&(i=n._clip)}if(null===i)return null;t=new eh(this,i,t);return this._bindAction(t,n),this._addInactiveAction(t,a,r),t},existingAction:function(e,t){var n=t||this._root,t=n.uuid,n="string"==typeof e?dc.findByName(n,e):e,e=n?n.uuid:e,e=this._actionsByClip[e];return void 0!==e&&e.actionByRoot[t]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0;for(var i=this._nActiveBindings=0;i!==t;++i)e[i].reset();for(i=0;i!==r;++i)n[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o)t[o]._update(r,e,i,a);for(var s=this._bindings,l=this._nActiveBindings,o=0;o!==l;++o)s[o].apply(a);return this},setTime:function(e){for(var t=this.time=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,e=r[n];if(void 0!==e){for(var i=e.knownActions,a=0,o=i.length;a!==o;++a){var s=i[a];this._deactivateAction(s);var l=s._cacheIndex,c=t[t.length-1];s._cacheIndex=null,s._byClipCacheIndex=null,t[c._cacheIndex=l]=c,t.pop(),this._removeInactiveBindingsForAction(s)}delete r[n]}},uncacheRoot:function(e){var t,n=e.uuid,r=this._actionsByClip;for(t in r){var i=r[t].actionByRoot[n];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var a=this._bindingsByRootAndName[n];if(void 0!==a)for(var o in a){o=a[o];o.restoreOriginalState(),this._removeInactiveBinding(o)}},uncacheAction:function(e,t){t=this.existingAction(e,t);null!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}}),nh.prototype.clone=function(){return new nh(void 0===this.value.clone?this.value:this.value.clone())},rh.prototype=Object.assign(Object.create(Go.prototype),{constructor:rh,isInstancedInterleavedBuffer:!0,copy:function(e){return Go.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(ih.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){n=n||[];return oh(e,this,n,t),n.sort(ah),n},intersectObjects:function(e,t,n){var r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,a=e.length;i<a;i++)oh(e[i],this,r,t);return r.sort(ah),r}}),Object.assign(sh.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(zt.clamp(t/this.radius,-1,1))),this}}),Object.assign(function(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}});var lh=new Ht;function ch(e,t){this.min=void 0!==e?e:new Ht(1/0,1/0),this.max=void 0!==t?t:new Ht(-1/0,-1/0)}Object.assign(ch.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){t=lh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Ht),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Ht),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Ht),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Ht),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return lh.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var uh=new Vt,hh=new Vt;function dh(e,t){this.start=void 0!==e?e:new Vt,this.end=void 0!==t?t:new Vt}function ph(e){An.call(this),this.material=e,this.render=function(){}}Object.assign(dh.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Vt),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Vt),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Vt),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){uh.subVectors(e,this.start),hh.subVectors(this.end,this.start);e=hh.dot(hh),e=hh.dot(uh)/e;return e=t?zt.clamp(e,0,1):e},closestPointToPoint:function(e,t,n){t=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Vt),this.delta(n).multiplyScalar(t).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),((ph.prototype=Object.create(An.prototype)).constructor=ph).prototype.isImmediateRenderObject=!0;var fh=new Vt,mh=new Vt,gh=new qt,vh=["a","b","c"];function yh(e,t,n,r){this.object=e,this.size=void 0!==t?t:1;e=void 0!==n?n:16711680,t=void 0!==r?r:1,n=0,r=this.object.geometry;r&&r.isGeometry?n=3*r.faces.length:r&&r.isBufferGeometry&&(n=r.attributes.normal.count);r=new zr,n=new Pr(2*n*3,3);r.addAttribute("position",n),ws.call(this,r,new fs({color:e,linewidth:t})),this.matrixAutoUpdate=!1,this.update()}((yh.prototype=Object.create(ws.prototype)).constructor=yh).prototype.update=function(){this.object.updateMatrixWorld(!0),gh.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,t=this.geometry.attributes.position,n=this.object.geometry;if(n&&n.isGeometry)for(var r=n.vertices,i=n.faces,a=0,o=0,s=i.length;o<s;o++)for(var l=i[o],c=0,u=l.vertexNormals.length;c<u;c++){var h=r[l[vh[c]]],d=l.vertexNormals[c];fh.copy(h).applyMatrix4(e),mh.copy(d).applyMatrix3(gh).normalize().multiplyScalar(this.size).add(fh),t.setXYZ(a,fh.x,fh.y,fh.z),a+=1,t.setXYZ(a,mh.x,mh.y,mh.z),a+=1}else if(n&&n.isBufferGeometry)for(var p=n.attributes.position,f=n.attributes.normal,a=0,c=0,u=p.count;c<u;c++)fh.set(p.getX(c),p.getY(c),p.getZ(c)).applyMatrix4(e),mh.set(f.getX(c),f.getY(c),f.getZ(c)),mh.applyMatrix3(gh).normalize().multiplyScalar(this.size).add(fh),t.setXYZ(a,fh.x,fh.y,fh.z),t.setXYZ(a+=1,mh.x,mh.y,mh.z),a+=1;t.needsUpdate=!0};var xh=new Vt;function bh(e,t){An.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var e=new zr,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,i=1;r<32;r++,i++){var a=r/32*Math.PI*2,o=i/32*Math.PI*2;n.push(Math.cos(a),Math.sin(a),1,Math.cos(o),Math.sin(o),1)}e.addAttribute("position",new Pr(n,3));t=new fs({fog:!1});this.cone=new ws(e,t),this.add(this.cone),this.update()}((bh.prototype=Object.create(An.prototype)).constructor=bh).prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},bh.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance||1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),xh.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(xh),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var _h=new Vt,Mh=new cn,wh=new cn;function Th(e){for(var t=function e(t){var n=[];t&&t.isBone&&n.push(t);for(var r=0;r<t.children.length;r++)n.push.apply(n,e(t.children[r]));return n}(e),n=new zr,r=[],i=[],a=new pr(0,0,1),o=new pr(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}n.addAttribute("position",new Pr(r,3)),n.addAttribute("color",new Pr(i,3));var c=new fs({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});ws.call(this,n,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Sh(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;n=new El(t,4,2),t=new br({wireframe:!0,fog:!1});ii.call(this,n,t),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Eh(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;e=new zr;e.addAttribute("position",new Pr([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),e.computeBoundingSphere();t=new fs({fog:!1});bs.call(this,e,t);t=new zr;t.addAttribute("position",new Pr([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),t.computeBoundingSphere(),this.add(new ii(t,new br({side:Me,fog:!1}))),this.update()}((Th.prototype=Object.create(ws.prototype)).constructor=Th).prototype.updateMatrixWorld=function(e){var t=this.bones,n=this.geometry,r=n.getAttribute("position");wh.getInverse(this.root.matrixWorld);for(var i=0,a=0;i<t.length;i++){var o=t[i];o.parent&&o.parent.isBone&&(Mh.multiplyMatrices(wh,o.matrixWorld),_h.setFromMatrixPosition(Mh),r.setXYZ(a,_h.x,_h.y,_h.z),Mh.multiplyMatrices(wh,o.parent.matrixWorld),_h.setFromMatrixPosition(Mh),r.setXYZ(a+1,_h.x,_h.y,_h.z),a+=2)}n.getAttribute("position").needsUpdate=!0,An.prototype.updateMatrixWorld.call(this,e)},((Sh.prototype=Object.create(ii.prototype)).constructor=Sh).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Sh.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},((Eh.prototype=Object.create(bs.prototype)).constructor=Eh).prototype.update=function(){var e,t;this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color?(this.material.color.set(this.color),this.children[0].material.color.set(this.color)):(this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),e=this.material.color,1<(t=Math.max(e.r,e.g,e.b))&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color))},Eh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()};var Ah=new Vt,Ch=new pr,Ph=new pr;function Lh(e,t,n){An.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;n=new Ws(t);n.rotateY(.5*Math.PI),this.material=new br({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2);t=n.getAttribute("position"),t=new Float32Array(3*t.count);n.addAttribute("color",new _r(t,3)),this.add(new ii(n,this.material)),this.update()}function Oh(e,t){this.lightProbe=e,this.size=t;e={GAMMA_OUTPUT:""},t=new xi({defines:e,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),e=new El(1,32,16);ii.call(this,e,t),this.onBeforeRender()}function Ih(e,t,n,r){e=e||10,t=t||10,n=new pr(void 0!==n?n:4473924),r=new pr(void 0!==r?r:8947848);for(var i=t/2,a=e/t,o=e/2,s=[],l=[],c=0,u=0,h=-o;c<=t;c++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var d=c===i?n:r;d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3}var p=new zr;p.addAttribute("position",new Pr(s,3)),p.addAttribute("color",new Pr(l,3));e=new fs({vertexColors:2});ws.call(this,p,e)}function Rh(e,t,n,r,i,a){e=e||10,t=t||16,n=n||8,r=r||64,i=new pr(void 0!==i?i:4473924),a=new pr(void 0!==a?a:8947848);for(var o,s,l,c,u,h,d=[],p=[],f=0;f<=t;f++)l=f/t*(2*Math.PI),o=Math.sin(l)*e,s=Math.cos(l)*e,d.push(0,0,0),d.push(o,0,s),p.push((h=1&f?i:a).r,h.g,h.b),p.push(h.r,h.g,h.b);for(f=0;f<=n;f++)for(h=1&f?i:a,u=e-e/n*f,c=0;c<r;c++)l=c/r*(2*Math.PI),o=Math.sin(l)*u,s=Math.cos(l)*u,d.push(o,0,s),p.push(h.r,h.g,h.b),l=(c+1)/r*(2*Math.PI),o=Math.sin(l)*u,s=Math.cos(l)*u,d.push(o,0,s),p.push(h.r,h.g,h.b);var m=new zr;m.addAttribute("position",new Pr(d,3)),m.addAttribute("color",new Pr(p,3));var g=new fs({vertexColors:2});ws.call(this,m,g)}function Fh(e,t,n,r){this.audio=e,this.range=t||1,this.divisionsInnerAngle=n||16,this.divisionsOuterAngle=r||2;t=new zr,n=this.divisionsInnerAngle+2*this.divisionsOuterAngle,r=new Float32Array(3*(3*n+3));t.addAttribute("position",new _r(r,3));n=new fs({color:65280}),r=new fs({color:16776960});bs.call(this,t,[r,n]),this.update()}((Lh.prototype=Object.create(An.prototype)).constructor=Lh).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Lh.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");Ch.copy(this.light.color),Ph.copy(this.light.groundColor);for(var n=0,r=t.count;n<r;n++){var i=n<r/2?Ch:Ph;t.setXYZ(n,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(Ah.setFromMatrixPosition(this.light.matrixWorld).negate())},((Oh.prototype=Object.create(ii.prototype)).constructor=Oh).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Oh.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},Ih.prototype=Object.assign(Object.create(ws.prototype),{constructor:Ih,copy:function(e){return ws.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),(Rh.prototype=Object.create(ws.prototype)).constructor=Rh,((Fh.prototype=Object.create(bs.prototype)).constructor=Fh).prototype.update=function(){var a,o,e=this.audio,s=this.range,t=this.divisionsInnerAngle,n=this.divisionsOuterAngle,r=zt.degToRad(e.panner.coneInnerAngle),i=zt.degToRad(e.panner.coneOuterAngle),l=r/2,e=i/2,c=0,u=0,h=this.geometry,d=h.attributes.position;function p(e,t,n,r){var i=(t-e)/n;for(d.setXYZ(c,0,0,0),u++,a=e;a<t;a+=i)o=c+u,d.setXYZ(o,Math.sin(a)*s,0,Math.cos(a)*s),d.setXYZ(o+1,Math.sin(Math.min(a+i,t))*s,0,Math.cos(Math.min(a+i,t))*s),d.setXYZ(o+2,0,0,0),u+=3;h.addGroup(c,u,r),c+=u,u=0}h.clearGroups(),p(-e,-l,n,0),p(-l,l,t,1),p(l,e,n,0),d.needsUpdate=!0,r===i&&(this.material[0].visible=!1)},Fh.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()};var Nh=new Vt,Dh=new Vt,kh=new qt;function Uh(e,t,n,r){this.object=e,this.size=void 0!==t?t:1;e=void 0!==n?n:16776960,t=void 0!==r?r:1,n=0,r=this.object.geometry;r&&r.isGeometry?n=r.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");r=new zr,n=new Pr(2*n*3,3);r.addAttribute("position",n),ws.call(this,r,new fs({color:e,linewidth:t})),this.matrixAutoUpdate=!1,this.update()}((Uh.prototype=Object.create(ws.prototype)).constructor=Uh).prototype.update=function(){this.object.updateMatrixWorld(!0),kh.getNormalMatrix(this.object.matrixWorld);for(var e=this.object.matrixWorld,t=this.geometry.attributes.position,n=this.object.geometry,r=n.vertices,i=n.faces,a=0,o=0,s=i.length;o<s;o++){var l=i[o],c=l.normal;Nh.copy(r[l.a]).add(r[l.b]).add(r[l.c]).divideScalar(3).applyMatrix4(e),Dh.copy(c).applyMatrix3(kh).normalize().multiplyScalar(this.size).add(Nh),t.setXYZ(a,Nh.x,Nh.y,Nh.z),a+=1,t.setXYZ(a,Dh.x,Dh.y,Dh.z),a+=1}t.needsUpdate=!0};var Bh=new Vt,zh=new Vt,Hh=new Vt;function Gh(e,t,n){An.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);n=new zr;n.addAttribute("position",new Pr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));t=new fs({fog:!1});this.lightPlane=new bs(n,t),this.add(this.lightPlane),(n=new zr).addAttribute("position",new Pr([0,0,0,0,0,1],3)),this.targetLine=new bs(n,t),this.add(this.targetLine),this.update()}((Gh.prototype=Object.create(An.prototype)).constructor=Gh).prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Gh.prototype.update=function(){Bh.setFromMatrixPosition(this.light.matrixWorld),zh.setFromMatrixPosition(this.light.target.matrixWorld),Hh.subVectors(zh,Bh),this.lightPlane.lookAt(zh),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(zh),this.targetLine.scale.z=Hh.length()};var jh=new Vt,Wh=new bi;function Vh(e){var t=new zr,n=new fs({color:16777215,vertexColors:1}),r=[],i=[],a={},o=new pr(16755200),s=new pr(16711680),l=new pr(43775),c=new pr(16777215),u=new pr(3355443);function h(e,t,n){d(e,n),d(t,n)}function d(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(r.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.addAttribute("position",new Pr(r,3)),t.addAttribute("color",new Pr(i,3)),ws.call(this,t,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function Xh(e,t,n,r,i,a,o){jh.set(i,a,o).unproject(r);var s=t[e];if(void 0!==s)for(var l=n.getAttribute("position"),c=0,u=s.length;c<u;c++)l.setXYZ(s[c],jh.x,jh.y,jh.z)}((Vh.prototype=Object.create(ws.prototype)).constructor=Vh).prototype.update=function(){var e=this.geometry,t=this.pointMap;Wh.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Xh("c",t,e,Wh,0,0,-1),Xh("t",t,e,Wh,0,0,1),Xh("n1",t,e,Wh,-1,-1,-1),Xh("n2",t,e,Wh,1,-1,-1),Xh("n3",t,e,Wh,-1,1,-1),Xh("n4",t,e,Wh,1,1,-1),Xh("f1",t,e,Wh,-1,-1,1),Xh("f2",t,e,Wh,1,-1,1),Xh("f3",t,e,Wh,-1,1,1),Xh("f4",t,e,Wh,1,1,1),Xh("u1",t,e,Wh,.7,1.1,-1),Xh("u2",t,e,Wh,-.7,1.1,-1),Xh("u3",t,e,Wh,0,2,-1),Xh("cf1",t,e,Wh,-1,0,1),Xh("cf2",t,e,Wh,1,0,1),Xh("cf3",t,e,Wh,0,-1,1),Xh("cf4",t,e,Wh,0,1,1),Xh("cn1",t,e,Wh,-1,0,-1),Xh("cn2",t,e,Wh,1,0,-1),Xh("cn3",t,e,Wh,0,-1,-1),Xh("cn4",t,e,Wh,0,1,-1),e.getAttribute("position").needsUpdate=!0};var Yh=new Hn;function qh(e,t){this.object=e,void 0===t&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),e=new zr;e.setIndex(new _r(n,1)),e.addAttribute("position",new _r(r,3)),ws.call(this,e,new fs({color:t})),this.matrixAutoUpdate=!1,this.update()}function Qh(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),e=new zr;e.setIndex(new _r(n,1)),e.addAttribute("position",new Pr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),ws.call(this,e,new fs({color:t})),this.geometry.computeBoundingSphere()}function Zh(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;t=void 0!==n?n:16776960,n=new zr;n.addAttribute("position",new Pr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),bs.call(this,n,new fs({color:t}));n=new zr;n.addAttribute("position",new Pr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),n.computeBoundingSphere(),this.add(new ii(n,new br({color:t,opacity:.2,transparent:!0,depthWrite:!1})))}((qh.prototype=Object.create(ws.prototype)).constructor=qh).prototype.update=function(e){var t,n,r;void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Yh.setFromObject(this.object),Yh.isEmpty()||(t=Yh.min,n=Yh.max,(e=(r=this.geometry.attributes.position).array)[0]=n.x,e[1]=n.y,e[2]=n.z,e[3]=t.x,e[4]=n.y,e[5]=n.z,e[6]=t.x,e[7]=t.y,e[8]=n.z,e[9]=n.x,e[10]=t.y,e[11]=n.z,e[12]=n.x,e[13]=n.y,e[14]=t.z,e[15]=t.x,e[16]=n.y,e[17]=t.z,e[18]=t.x,e[19]=t.y,e[20]=t.z,e[21]=n.x,e[22]=t.y,e[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere())},qh.prototype.setFromObject=function(e){return this.object=e,this.update(),this},qh.prototype.copy=function(e){return ws.prototype.copy.call(this,e),this.object=e.object,this},qh.prototype.clone=function(){return(new this.constructor).copy(this)},((Qh.prototype=Object.create(ws.prototype)).constructor=Qh).prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),An.prototype.updateMatrixWorld.call(this,e))},((Zh.prototype=Object.create(bs.prototype)).constructor=Zh).prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?Me:q,this.lookAt(this.plane.normal),An.prototype.updateMatrixWorld.call(this,e)};var Jh,Kh,$h=new Vt;function ed(e,t,n,r,i,a){An.call(this),void 0===e&&(e=new Vt(0,0,1)),void 0===t&&(t=new Vt(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===a&&(a=.2*i),void 0===Jh&&((Jh=new zr).addAttribute("position",new Pr([0,0,0,0,1,0],3)),(Kh=new Dl(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new bs(Jh,new fs({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ii(Kh,new br({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,a)}function td(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],e=new zr;e.addAttribute("position",new Pr(t,3)),e.addAttribute("color",new Pr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));t=new fs({vertexColors:2});ws.call(this,e,t)}function nd(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Fc.call(this,e),this.type="catmullrom"}((ed.prototype=Object.create(An.prototype)).constructor=ed).prototype.setDirection=function(e){.99999<e.y?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):($h.set(e.z,0,-e.x).normalize(),e=Math.acos(e.y),this.quaternion.setFromAxisAngle($h,e))},ed.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},ed.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},ed.prototype.copy=function(e){return An.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},ed.prototype.clone=function(){return(new this.constructor).copy(this)},(td.prototype=Object.create(ws.prototype)).constructor=td,Ec.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Ec.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},Object.assign(Xc.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");e=this.getPoints(e);return this.createGeometry(e)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");e=this.getSpacedPoints(e);return this.createGeometry(e)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new hi,n=0,r=e.length;n<r;n++){var i=e[n];t.vertices.push(new Vt(i.x,i.y,i.z||0))}return t}}),Object.assign(Yc.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),nd.prototype=Object.create(Fc.prototype),Object.assign(nd.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Ih.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Th.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(vc.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),cu(e)}}),vc.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(fu.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(ch.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Hn.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),dh.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(zt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),zt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),zt.ceilPowerOfTwo(e)}}),Object.assign(qt.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(cn.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vt).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,a)}}),Ci.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Gt.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Kn.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(cr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(cr,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),cr.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),cr.getNormal(e,t,n,r)}}),Object.assign(qc.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new xl(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ol(this,e)}}),Object.assign(Ht.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vt.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Kt.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(hi.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(An.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(An.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(ss.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(hs.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),ls.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Ec.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),_i.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Qc.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(_r.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(_r.prototype,{copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(e){return console.warn("THREE.BufferAttribute: .setArray has been deprecated. Use BufferGeometry .setAttribute to replace/resize attribute buffers"),this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this}}),Object.assign(zr.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(zr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(Go.prototype,{setArray:function(e){return console.warn("THREE.InterleavedBuffer: .setArray has been deprecated. Use BufferGeometry .setAttribute to replace/resize attribute buffers"),this.count=void 0!==e?e.length/this.stride:0,this.array=e,this}}),Object.assign(bl.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(nh.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(xr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new pr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Xl.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(xi.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Bo.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Bo.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}}}),Object.defineProperties(So.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(wi.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties($t.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(ko.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),ku.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Tu).load(e,function(e){t.setBuffer(e)}),this},ju.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Mi.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Qt.crossOrigin=void 0,Qt.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Sc;i.setCrossOrigin(this.crossOrigin);r=i.load(e,n,void 0,r);return t&&(r.mapping=t),r},Qt.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Tc;i.setCrossOrigin(this.crossOrigin);r=i.load(e,n,void 0,r);return t&&(r.mapping=t),r},Qt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Qt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"109"}}));var rd=function(){function e(e){vc.call(this,e),this.dracoLoader=null,this.ddsLoader=null}function r(){var n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}e.prototype=Object.assign(Object.create(vc.prototype),{constructor:e,load:function(t,n,e,r){var i=this,a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:cu(t);i.manager.itemStart(t);function o(e){r?r(e):console.error(e),i.manager.itemError(t),i.manager.itemEnd(t)}var s=new xc(i.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===i.crossOrigin&&s.setWithCredentials(!0),s.load(t,function(e){try{i.parse(e,a,function(e){n(e),i.manager.itemEnd(t)},o)}catch(e){o(e)}},e,o)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,t,n,r){var i,a={};if("string"==typeof e)i=e;else if(lu(new Uint8Array(e,0,4))===f){try{a[p.KHR_BINARY_GLTF]=new m(e)}catch(e){return void(r&&r(e))}i=a[p.KHR_BINARY_GLTF].content}else i=lu(new Uint8Array(e));var o=JSON.parse(i);if(void 0===o.asset||o.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(o.extensionsUsed)for(var s=0;s<o.extensionsUsed.length;++s){var l=o.extensionsUsed[s],c=o.extensionsRequired||[];switch(l){case p.KHR_LIGHTS_PUNCTUAL:a[l]=new h(o);break;case p.KHR_MATERIALS_UNLIT:a[l]=new d;break;case p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[l]=new y;break;case p.KHR_DRACO_MESH_COMPRESSION:a[l]=new g(o,this.dracoLoader);break;case p.MSFT_TEXTURE_DDS:a[p.MSFT_TEXTURE_DDS]=new u(this.ddsLoader);break;case p.KHR_TEXTURE_TRANSFORM:a[p.KHR_TEXTURE_TRANSFORM]=new v;break;default:0<=c.indexOf(l)&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}new G(o,a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(n,r)}}});var p={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function u(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=p.MSFT_TEXTURE_DDS,this.ddsLoader=e}function h(e){this.name=p.KHR_LIGHTS_PUNCTUAL;e=e.extensions&&e.extensions[p.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=e.lights||[]}function d(){this.name=p.KHR_MATERIALS_UNLIT}h.prototype.loadLight=function(e){var t,n=this.lightDefs[e],r=new pr(16777215);void 0!==n.color&&r.fromArray(n.color);var i=void 0!==n.range?n.range:0;switch(n.type){case"directional":(t=new iu(r)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new tu(r)).distance=i;break;case"spot":(t=new $c(r)).distance=i,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,t.angle=n.spot.outerConeAngle,t.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==n.intensity&&(t.intensity=n.intensity),t.name=n.name||"light_"+e,Promise.resolve(t)},d.prototype.getMaterialType=function(){return br},d.prototype.extendParams=function(e,t,n){var r=[];e.color=new pr(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;return i&&(Array.isArray(i.baseColorFactor)&&(t=i.baseColorFactor,e.color.fromArray(t),e.opacity=t[3]),void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))),Promise.all(r)};var f="glTF",s=12,l={JSON:1313821514,BIN:5130562};function m(e){this.name=p.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,s);if(this.header={magic:lu(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==f)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var n=new DataView(e,s),r=0;r<n.byteLength;){var i=n.getUint32(r,!0);r+=4;var a,o=n.getUint32(r,!0);r+=4,o===l.JSON?(a=new Uint8Array(e,s+r,i),this.content=lu(a)):o===l.BIN&&(this.body=e.slice(o=s+r,o+i)),r+=i}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function g(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=p.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t}function v(){this.name=p.KHR_TEXTURE_TRANSFORM}function y(){return{name:p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return xi},extendParams:function(e,t,n){var r=t.extensions[this.name],i=Fi.standard,a=gi.clone(i.uniforms),o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),t=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),t=i.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",t);delete a.roughness,delete a.metalness,delete a.roughnessMap,delete a.metalnessMap,a.specular={value:(new pr).setHex(1118481)},a.glossiness={value:.5},a.specularMap={value:null},a.glossinessMap={value:null},e.vertexShader=i.vertexShader,e.fragmentShader=t,e.uniforms=a,e.defines={STANDARD:""},e.color=new pr(1,1,1),e.opacity=1;t=[];return Array.isArray(r.diffuseFactor)&&(a=r.diffuseFactor,e.color.fromArray(a),e.opacity=a[3]),void 0!==r.diffuseTexture&&t.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new pr(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new pr(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture&&(r=r.specularGlossinessTexture,t.push(n.assignTexture(e,"glossinessMap",r)),t.push(n.assignTexture(e,"specularMap",r))),Promise.all(t)},createMaterial:function(e){var t=new xi({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var n=this.specularGlossinessParams,r=0,i=n.length;r<i;r++){var a=e[n[r]];t[n[r]]=a&&a.isColor?a.clone():a}return t},refreshUniforms:function(e,t,n,r,i){var a,o,s;!0===i.isGLTFSpecularGlossinessMaterial&&(a=i.uniforms,o=i.defines,a.opacity.value=i.opacity,a.diffuse.value.copy(i.color),a.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),a.map.value=i.map,a.specularMap.value=i.specularMap,a.alphaMap.value=i.alphaMap,a.lightMap.value=i.lightMap,a.lightMapIntensity.value=i.lightMapIntensity,a.aoMap.value=i.aoMap,a.aoMapIntensity.value=i.aoMapIntensity,i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.glossinessMap?s=i.glossinessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap&&(s=i.emissiveMap),void 0!==s&&(!0===(s=s.isWebGLRenderTarget?s.texture:s).matrixAutoUpdate&&s.updateMatrix(),a.uvTransform.value.copy(s.matrix)),i.envMap&&(a.envMap.value=i.envMap,a.envMapIntensity.value=i.envMapIntensity,a.flipEnvMap.value=i.envMap.isCubeTexture?-1:1,a.reflectivity.value=i.reflectivity,a.refractionRatio.value=i.refractionRatio,a.maxMipLevel.value=e.properties.get(i.envMap).__maxMipLevel),a.specular.value.copy(i.specular),a.glossiness.value=i.glossiness,a.glossinessMap.value=i.glossinessMap,a.emissiveMap.value=i.emissiveMap,a.bumpMap.value=i.bumpMap,a.normalMap.value=i.normalMap,a.displacementMap.value=i.displacementMap,a.displacementScale.value=i.displacementScale,a.displacementBias.value=i.displacementBias,null!==a.glossinessMap.value&&void 0===o.USE_GLOSSINESSMAP&&(o.USE_GLOSSINESSMAP="",o.USE_ROUGHNESSMAP=""),null===a.glossinessMap.value&&void 0!==o.USE_GLOSSINESSMAP&&(delete o.USE_GLOSSINESSMAP,delete o.USE_ROUGHNESSMAP))}}}function E(e,t,n,r){ec.call(this,e,t,n,r)}g.prototype.decodePrimitive=function(e,t){var n,r=this.json,i=this.dracoLoader,a=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,s={},l={},c={};for(n in o){var u=O[n]||n.toLowerCase();s[u]=o[n]}for(n in e.attributes){var h,d,u=O[n]||n.toLowerCase();void 0!==o[n]&&(h=r.accessors[e.attributes[n]],d=A[h.componentType],c[u]=d,l[u]=!0===h.normalized)}return t.getDependency("bufferView",a).then(function(e){return new Promise(function(r){i.decodeDracoFile(e,function(e){for(var t in e.attributes){var n=e.attributes[t],t=l[t];void 0!==t&&(n.normalized=t)}r(e)},s,c)})})},v.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},((E.prototype=Object.create(ec.prototype)).constructor=E).prototype.beforeStart_=E.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r,a=0;a!==r;a++)t[a]=n[i+a];return t},E.prototype.afterEnd_=E.prototype.copySampleValue_,E.prototype.interpolate_=function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,c=r-t,r=(n-t)/c,n=r*r,t=n*r,u=e*l,h=u-l,d=-2*t+3*n,p=t-n,f=1-d,m=p-n+r,g=0;g!==o;g++){var v=a[h+g+o],y=a[h+g+s]*c,x=a[u+g+o],b=a[u+g]*c;i[g]=f*v+m*y+d*x+p*b}return i};var i,x=0,b=1,_=2,M=3,w=4,T=5,S=6,A={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},C={9728:Te,9729:Ae,9984:Se,9985:Ce,9986:Ee,9987:Pe},P={33071:be,33648:_e,10497:xe},L={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},O={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},I={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},R={CUBICSPLINE:void 0,LINEAR:xt,STEP:yt},c="OPAQUE",F="MASK",N="BLEND",D={"image/png":Ge,"image/jpeg":He};function k(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function U(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function B(e,t){void 0!==t.extras&&("object"===W(t.extras)?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function z(e){for(var t="",n=Object.keys(e).sort(),r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function H(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,n=e.itemSize,r=e.array.slice(0,t*n),i=0,a=0;i<t;++i)r[a++]=e.getX(i),2<=n&&(r[a++]=e.getY(i)),3<=n&&(r[a++]=e.getZ(i)),4<=n&&(r[a++]=e.getW(i));return new _r(r,n,e.normalized)}return e.clone()}function G(e,t,n){this.json=e||{},this.extensions=t||{},this.options=n||{},this.cache=new r,this.primitiveCache={},this.textureLoader=new Sc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new xc(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function j(n,e,r){var t,i,a=e.attributes,o=[];for(t in a){var s=O[t]||t.toLowerCase();s in n.attributes||o.push(function(e,t){return r.getDependency("accessor",e).then(function(e){n.addAttribute(t,e)})}(a[t],s))}return void 0===e.indices||n.index||(i=r.getDependency("accessor",e.indices).then(function(e){n.setIndex(e)}),o.push(i)),B(n,e),Promise.all(o).then(function(){return void 0!==e.targets?function(p,f,e){for(var m=!1,g=!1,t=0,n=f.length;t<n;t++)if(void 0!==(o=f[t]).POSITION&&(m=!0),void 0!==o.NORMAL&&(g=!0),m&&g)break;if(!m&&!g)return Promise.resolve(p);for(var r=[],i=[],t=0,n=f.length;t<n;t++){var a,o=f[t];m&&(a=void 0!==o.POSITION?e.getDependency("accessor",o.POSITION):p.attributes.position,r.push(a)),g&&(a=void 0!==o.NORMAL?e.getDependency("accessor",o.NORMAL):p.attributes.normal,i.push(a))}return Promise.all([Promise.all(r),Promise.all(i)]).then(function(e){for(var t=e[0],n=e[1],r=0,i=t.length;r<i;r++)p.attributes.position!==t[r]&&(t[r]=H(t[r]));for(r=0,i=n.length;r<i;r++)p.attributes.normal!==n[r]&&(n[r]=H(n[r]));for(r=0,i=f.length;r<i;r++){var a=f[r],o="morphTarget"+r;if(m&&void 0!==a.POSITION){var s=t[r];s.name=o;for(var l=p.attributes.position,c=0,u=s.count;c<u;c++)s.setXYZ(c,s.getX(c)+l.getX(c),s.getY(c)+l.getY(c),s.getZ(c)+l.getZ(c))}if(g&&void 0!==a.NORMAL){var h=n[r];h.name=o;for(var d=p.attributes.normal,c=0,u=h.count;c<u;c++)h.setXYZ(c,h.getX(c)+d.getX(c),h.getY(c)+d.getY(c),h.getZ(c)+d.getZ(c))}}return m&&(p.morphAttributes.position=t),g&&(p.morphAttributes.normal=n),p})}(n,e.targets,r):n})}return G.prototype.parse=function(t,e){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(e){e={scene:e[0][r.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:r.asset,parser:n,userData:{}};U(i,e,r),B(e,r),t(e)}).catch(e)},G.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r={},i={},a=0,o=t.length;a<o;a++)for(var s=t[a].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var u=0,h=e.length;u<h;u++){var d=e[u];void 0!==d.mesh&&(void 0===r[d.mesh]&&(r[d.mesh]=i[d.mesh]=0),r[d.mesh]++,void 0!==d.skin&&(n[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=i},G.prototype.getDependency=function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this.loadMesh(t);break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this.loadBufferView(t);break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this.loadMaterial(t);break;case"texture":r=this.loadTexture(t);break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;case"light":r=this.extensions[p.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r},G.prototype.getDependencies=function(n){var r,e,t=this.cache.get(n);return t||(e=(r=this).json[n+("mesh"===n?"es":"s")]||[],t=Promise.all(e.map(function(e,t){return r.getDependency(n,t)})),this.cache.add(n,t)),t},G.prototype.loadBuffer=function(e){var n=this.json.buffers[e],r=this.fileLoader;if(n.type&&"arraybuffer"!==n.type)throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(void 0===n.uri&&0===e)return Promise.resolve(this.extensions[p.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,t){r.load(k(n.uri,i.path),e,void 0,function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})},G.prototype.loadBufferView=function(e){var r=this.json.bufferViews[e];return this.getDependency("buffer",r.buffer).then(function(e){var t=r.byteLength||0,n=r.byteOffset||0;return e.slice(n,n+t)})},G.prototype.loadAccessor=function(e){var v=this,y=this.json,x=this.json.accessors[e];if(void 0===x.bufferView&&void 0===x.sparse)return Promise.resolve(null);e=[];return void 0!==x.bufferView?e.push(this.getDependency("bufferView",x.bufferView)):e.push(null),void 0!==x.sparse&&(e.push(this.getDependency("bufferView",x.sparse.indices.bufferView)),e.push(this.getDependency("bufferView",x.sparse.values.bufferView))),Promise.all(e).then(function(e){var t,n,r,i=e[0],a=L[x.type],o=A[x.componentType],s=o.BYTES_PER_ELEMENT,l=x.byteOffset||0,c=void 0!==x.bufferView?y.bufferViews[x.bufferView].byteStride:void 0,u=!0===x.normalized,h=c&&c!==s*a?(t=Math.floor(l/c),n="InterleavedBuffer:"+x.bufferView+":"+x.componentType+":"+t+":"+x.count,(r=v.cache.get(n))||(r=new Go(new o(i,t*c,x.count*c/s),c/s),v.cache.add(n,r)),new jo(r,a,l%c/s,u)):new _r(null===i?new o(x.count*a):new o(i,l,x.count*a),a,u);if(void 0!==x.sparse){var s=A[x.sparse.indices.componentType],l=x.sparse.indices.byteOffset||0,u=x.sparse.values.byteOffset||0,d=new s(e[1],l,x.sparse.count*L.SCALAR),p=new o(e[2],u,x.sparse.count*a);null!==i&&(h=new _r(h.array.slice(),h.itemSize,h.normalized));for(var f=0,m=d.length;f<m;f++){var g=d[f];if(h.setX(g,p[f*a]),2<=a&&h.setY(g,p[f*a+1]),3<=a&&h.setZ(g,p[f*a+2]),4<=a&&h.setW(g,p[f*a+3]),5<=a)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return h})},G.prototype.loadTexture=function(e){var t=this,n=this.json,i=this.options,a=this.textureLoader,r=window.URL||window.webkitURL,o=n.textures[e],s=o.extensions||{},l=s[p.MSFT_TEXTURE_DDS]?n.images[s[p.MSFT_TEXTURE_DDS].source]:n.images[o.source],c=l.uri,u=!1;return void 0!==l.bufferView&&(c=t.getDependency("bufferView",l.bufferView).then(function(e){u=!0;e=new Blob([e],{type:l.mimeType});return c=r.createObjectURL(e)})),Promise.resolve(c).then(function(n){var r=(r=i.manager.getHandler(n))||(s[p.MSFT_TEXTURE_DDS]?t.extensions[p.MSFT_TEXTURE_DDS].ddsLoader:a);return new Promise(function(e,t){r.load(k(n,i.path),e,void 0,t)})}).then(function(e){!0===u&&r.revokeObjectURL(c),e.flipY=!1,void 0!==o.name&&(e.name=o.name),l.mimeType in D&&(e.format=D[l.mimeType]);var t=(n.samplers||{})[o.sampler]||{};return e.magFilter=C[t.magFilter]||Ae,e.minFilter=C[t.minFilter]||Pe,e.wrapS=P[t.wrapS]||xe,e.wrapT=P[t.wrapT]||xe,e})},G.prototype.assignTexture=function(n,r,i){var a=this;return this.getDependency("texture",i.index).then(function(e){if(!e.isCompressedTexture)switch(r){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":e.format=He}var t;!a.extensions[p.KHR_TEXTURE_TRANSFORM]||(t=void 0!==i.extensions?i.extensions[p.KHR_TEXTURE_TRANSFORM]:void 0)&&(e=a.extensions[p.KHR_TEXTURE_TRANSFORM].extendTexture(e,t)),n[r]=e})},G.prototype.assignFinalMaterial=function(e){var t,n,r,i=e.geometry,a=e.material,o=this.extensions,s=void 0!==i.attributes.tangent,l=void 0!==i.attributes.color,c=void 0===i.attributes.normal,u=!0===e.isSkinnedMesh,h=0<Object.keys(i.morphAttributes).length,d=h&&void 0!==i.morphAttributes.normal;e.isPoints?(n="PointsMaterial:"+a.uuid,(t=this.cache.get(n))||(t=new Ss,xr.prototype.copy.call(t,a),t.color.copy(a.color),t.map=a.map,t.sizeAttenuation=!1,this.cache.add(n,t)),a=t):e.isLine&&(n="LineBasicMaterial:"+a.uuid,(r=this.cache.get(n))||(r=new fs,xr.prototype.copy.call(r,a),r.color.copy(a.color),this.cache.add(n,r)),a=r),(s||l||c||u||h)&&(n="ClonedMaterial:"+a.uuid+":",a.isGLTFSpecularGlossinessMaterial&&(n+="specular-glossiness:"),u&&(n+="skinning:"),s&&(n+="vertex-tangents:"),l&&(n+="vertex-colors:"),c&&(n+="flat-shading:"),h&&(n+="morph-targets:"),d&&(n+="morph-normals:"),(r=this.cache.get(n))||(r=a.isGLTFSpecularGlossinessMaterial?o[p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(a):a.clone(),u&&(r.skinning=!0),s&&(r.vertexTangents=!0),l&&(r.vertexColors=2),c&&(r.flatShading=!0),h&&(r.morphTargets=!0),d&&(r.morphNormals=!0),this.cache.add(n,r)),a=r),a.aoMap&&void 0===i.attributes.uv2&&void 0!==i.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),i.addAttribute("uv2",new _r(i.attributes.uv.array,2))),a.isGLTFSpecularGlossinessMaterial&&(e.onBeforeRender=o[p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),e.material=a},G.prototype.loadMaterial=function(e){var t,n,r=this.json,i=this.extensions,a=r.materials[e],o={},s=a.extensions||{},r=[];s[p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]?(e=i[p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],t=e.getMaterialType(),r.push(e.extendParams(o,a,this))):s[p.KHR_MATERIALS_UNLIT]?(n=i[p.KHR_MATERIALS_UNLIT],t=n.getMaterialType(),r.push(n.extendParams(o,a,this))):(t=Wl,l=a.pbrMetallicRoughness||{},o.color=new pr(1,1,1),o.opacity=1,Array.isArray(l.baseColorFactor)&&(n=l.baseColorFactor,o.color.fromArray(n),o.opacity=n[3]),void 0!==l.baseColorTexture&&r.push(this.assignTexture(o,"map",l.baseColorTexture)),o.metalness=void 0!==l.metallicFactor?l.metallicFactor:1,o.roughness=void 0!==l.roughnessFactor?l.roughnessFactor:1,void 0!==l.metallicRoughnessTexture&&(r.push(this.assignTexture(o,"metalnessMap",l.metallicRoughnessTexture)),r.push(this.assignTexture(o,"roughnessMap",l.metallicRoughnessTexture)))),!0===a.doubleSided&&(o.side=Q);var l=a.alphaMode||c;return l===N?o.transparent=!0:(o.transparent=!1,l===F&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==br&&(r.push(this.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new Ht(1,1),void 0!==a.normalTexture.scale&&o.normalScale.set(a.normalTexture.scale,a.normalTexture.scale)),void 0!==a.occlusionTexture&&t!==br&&(r.push(this.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==br&&(o.emissive=(new pr).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==br&&r.push(this.assignTexture(o,"emissiveMap",a.emissiveTexture)),Promise.all(r).then(function(){var e=t===xi?i[p.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o);return void 0!==a.name&&(e.name=a.name),e.map&&(e.map.encoding=Tt),e.emissiveMap&&(e.emissiveMap.encoding=Tt),e.specularMap&&(e.specularMap.encoding=Tt),B(e,a),a.extensions&&U(i,e,a),e})},G.prototype.loadGeometries=function(e){var n=this,r=this.extensions,t=this.primitiveCache;for(var i=[],a=0,o=e.length;a<o;a++){var s=e[a],l=(l=void 0,c=(l=(c=s).extensions&&c.extensions[p.KHR_DRACO_MESH_COMPRESSION])?"draco:"+l.bufferView+":"+l.indices+":"+z(l.attributes):c.indices+":"+z(c.attributes)+":"+c.mode),c=t[l];c?i.push(c.promise):(c=s.extensions&&s.extensions[p.KHR_DRACO_MESH_COMPRESSION]?function(t){return r[p.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,n).then(function(e){return j(e,t,n)})}(s):j(new zr,s,n),t[l]={primitive:s,promise:c},i.push(c))}return Promise.all(i)},G.prototype.loadMesh=function(u){for(var h=this,d=this.json.meshes[u],p=d.primitives,e=[],t=0,n=p.length;t<n;t++){var r=void 0===p[t].material?i=i||new Wl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:q}):this.getDependency("material",p[t].material);e.push(r)}return Promise.all(e).then(function(c){return h.loadGeometries(p).then(function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i,a=e[n],o=p[n],s=c[n];if(o.mode===w||o.mode===T||o.mode===S||void 0===o.mode)!0!==(i=new(!0===d.isSkinnedMesh?ls:ii)(a,s)).isSkinnedMesh||i.geometry.attributes.skinWeight.normalized||i.normalizeSkinWeights(),o.mode===T?i.drawMode=1:o.mode===S&&(i.drawMode=2);else if(o.mode===b)i=new ws(a,s);else if(o.mode===M)i=new bs(a,s);else if(o.mode===_)i=new Ts(a,s);else{if(o.mode!==x)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+o.mode);i=new Ls(a,s)}0<Object.keys(i.geometry.morphAttributes).length&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(n=0,r=i.length;n<r;n++)e.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(i,d),i.name=d.name||"mesh_"+u,1<e.length&&(i.name+="_"+n),B(i,d),h.assignFinalMaterial(i),t.push(i)}if(1===t.length)return t[0];for(var l=new Oo,n=0,r=t.length;n<r;n++)l.add(t[n]);return l})})},G.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],e=n[n.type];if(e)return"perspective"===n.type?t=new _i(zt.radToDeg(e.yfov),e.aspectRatio||1,e.znear||1,e.zfar||2e6):"orthographic"===n.type&&(t=new nu(e.xmag/-2,e.xmag/2,e.ymag/2,e.ymag/-2,e.znear,e.zfar)),void 0!==n.name&&(t.name=n.name),B(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},G.prototype.loadSkin=function(e){var e=this.json.skins[e],t={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(t):this.getDependency("accessor",e.inverseBindMatrices).then(function(e){return t.inverseBindMatrices=e,t})},G.prototype.loadAnimation=function(T){for(var S=this.json.animations[T],e=[],t=[],n=[],r=[],i=[],a=0,o=S.channels.length;a<o;a++){var s=S.channels[a],l=S.samplers[s.sampler],c=s.target,u=void 0!==c.node?c.node:c.id,h=void 0!==S.parameters?S.parameters[l.input]:l.input,s=void 0!==S.parameters?S.parameters[l.output]:l.output;e.push(this.getDependency("node",u)),t.push(this.getDependency("accessor",h)),n.push(this.getDependency("accessor",s)),r.push(l),i.push(c)}return Promise.all([Promise.all(e),Promise.all(t),Promise.all(n),Promise.all(r),Promise.all(i)]).then(function(e){for(var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=[],s=0,l=t.length;s<l;s++){var c,u=t[s],h=n[s],d=r[s],p=i[s],f=a[s];if(void 0!==u){switch(u.updateMatrix(),u.matrixAutoUpdate=!0,I[f.path]){case I.weights:c=sc;break;case I.rotation:c=cc;break;case I.position:case I.scale:default:c=hc}var m=u.name||u.uuid,g=void 0!==p.interpolation?R[p.interpolation]:xt,v=[];I[f.path]===I.weights?u.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&v.push(e.name||e.uuid)}):v.push(m);var y,x=d.array;if(d.normalized){if(x.constructor===Int8Array)y=1/127;else if(x.constructor===Uint8Array)y=1/255;else if(x.constructor==Int16Array)y=1/32767;else{if(x.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");y=1/65535}for(var b=new Float32Array(x.length),_=0,M=x.length;_<M;_++)b[_]=x[_]*y;x=b}for(_=0,M=v.length;_<M;_++){var w=new c(v[_]+"."+I[f.path],h.array,x,g);"CUBICSPLINE"===p.interpolation&&(w.createInterpolant=function(e){return new E(this.times,this.values,this.getValueSize()/3,e)},w.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),o.push(w)}}}return new dc(void 0!==S.name?S.name:"animation_"+T,void 0,o)})},G.prototype.loadNode=function(e){var t=this.json,a=this.extensions,n=this,o=t.meshReferences,s=t.meshUses,l=t.nodes[e];return e=[],void 0!==l.mesh&&e.push(n.getDependency("mesh",l.mesh).then(function(e){if(1<o[l.mesh]){var t,n=s[l.mesh]++;(t=e.clone()).name+="_instance_"+n,t.onBeforeRender=e.onBeforeRender;for(var r=0,i=t.children.length;r<i;r++)t.children[r].name+="_instance_"+n,t.children[r].onBeforeRender=e.children[r].onBeforeRender}else t=e;return void 0!==l.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,n=l.weights.length;t<n;t++)e.morphTargetInfluences[t]=l.weights[t]}),t})),void 0!==l.camera&&e.push(n.getDependency("camera",l.camera)),l.extensions&&l.extensions[p.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[p.KHR_LIGHTS_PUNCTUAL].light&&e.push(n.getDependency("light",l.extensions[p.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(e).then(function(e){var t,n=!0===l.isBone?new ds:1<e.length?new Oo:1===e.length?e[0]:new An;if(n!==e[0])for(var r=0,i=e.length;r<i;r++)n.add(e[r]);return void 0!==l.name&&(n.userData.name=l.name,n.name=$u.sanitizeNodeName(l.name)),B(n,l),l.extensions&&U(a,n,l),void 0!==l.matrix?((t=new cn).fromArray(l.matrix),n.applyMatrix(t)):(void 0!==l.translation&&n.position.fromArray(l.translation),void 0!==l.rotation&&n.quaternion.fromArray(l.rotation),void 0!==l.scale&&n.scale.fromArray(l.scale)),n})},G.prototype.loadScene=function(e){var t=this.json,n=this.extensions,e=this.json.scenes[e],r=new Cn;void 0!==e.name&&(r.name=e.name),B(r,e),e.extensions&&U(n,r,e);for(var i=e.nodes||[],a=[],o=0,s=i.length;o<s;o++)a.push(function o(e,s,l,c){var u=l.nodes[e];return c.getDependency("node",e).then(function(e){return void 0===u.skin?e:c.getDependency("skin",u.skin).then(function(e){for(var t=[],n=0,r=(s=e).joints.length;n<r;n++)t.push(c.getDependency("node",s.joints[n]));return Promise.all(t)}).then(function(o){return e.traverse(function(e){if(e.isMesh){for(var t=[],n=[],r=0,i=o.length;r<i;r++){var a=o[r];a?(t.push(a),a=new cn,void 0!==s.inverseBindMatrices&&a.fromArray(s.inverseBindMatrices.array,16*r),n.push(a)):console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[r])}e.bind(new hs(t,n),e.matrixWorld)}}),e});var s}).then(function(e){s.add(e);var t=[];if(u.children)for(var n=u.children,r=0,i=n.length;r<i;r++){var a=n[r];t.push(o(a,e,l,c))}return Promise.all(t)})}(i[o],r,t,this));return Promise.all(a).then(function(){return r})},e}(),id=function(e){_c.call(this,e)};id.prototype=Object.assign(Object.create(_c.prototype),{constructor:id,parse:function(e,t){var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var i,a=r("DXT1"),o=r("DXT3"),s=r("DXT5"),l=r("ETC1"),c=new Int32Array(e,0,31);if(542327876!==c[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;if(4&!c[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;var u,h=c[21],d=!1;switch(h){case a:i=8,n.format=Qe;break;case o:i=16,n.format=Je;break;case s:i=16,n.format=Ke;break;case l:i=8,n.format=rt;break;default:if(!(32===c[22]&&16711680&c[23]&&65280&c[24]&&255&c[25]&&4278190080&c[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(u=h,String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255))),n;d=!0,i=64,n.format=Ge}n.mipmapCount=1,131072&c[2]&&!1!==t&&(n.mipmapCount=Math.max(1,c[7]));t=c[28];if(n.isCubemap=!!(512&t),n.isCubemap&&(!(1024&t)||!(2048&t)||!(4096&t)||!(8192&t)||!(16384&t)||!(32768&t)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),n;n.width=c[4],n.height=c[3];for(var p=c[1]+4,f=n.isCubemap?6:1,m=0;m<f;m++)for(var g,v,y=n.width,x=n.height,b=0;b<n.mipmapCount;b++)d?g=(v=function(e,t,n,r){for(var i=n*r*4,a=new Uint8Array(e,t,i),o=new Uint8Array(i),s=0,l=0,c=0;c<r;c++)for(var u=0;u<n;u++){var h=a[l],d=a[++l],p=a[++l],f=a[++l];l++,o[s]=p,o[++s]=d,o[++s]=h,o[++s]=f,s++}return o}(e,p,y,x)).length:(g=Math.max(4,y)/4*Math.max(4,x)/4*i,v=new Uint8Array(e,p,g)),n.mipmaps.push({data:v,width:y,height:x}),p+=g,y=Math.max(y>>1,1),x=Math.max(x>>1,1);return n}});var ad=function(e){vc.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};ad.prototype=Object.assign(Object.create(vc.prototype),{constructor:ad,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,n,t,r){var i=this,a=new xc(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&a.setWithCredentials(!0),a.load(e,function(e){var t={attributeIDs:i.defaultAttributeIDs,attributeTypes:i.defaultAttributeTypes,useUniqueIDs:!1};i.decodeGeometry(e,t).then(n).catch(r)},t,r)},decodeDracoFile:function(e,t,n,r){n={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,n).then(t)},decodeGeometry:function(n,r){var i,e,t=this,a=this.workerNextTaskID++,o=n.byteLength;for(e in r.attributeTypes){var s=r.attributeTypes[e];void 0!==s.BYTES_PER_ELEMENT&&(r.attributeTypes[e]=s.name)}o=this._getWorker(a,o).then(function(e){return i=e,new Promise(function(e,t){i._callbacks[a]={resolve:e,reject:t},i.postMessage({type:"decode",id:a,taskConfig:r,buffer:n},[n])})}).then(function(e){return t._createGeometry(e.geometry)});return o.finally(function(){i&&a&&t._releaseTask(i,a)}),i&&a&&this._releaseTask(i,a),o},_createGeometry:function(e){var t=new zr;e.index&&t.setIndex(new _r(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var r=e.attributes[n],i=r.name,a=r.array,r=r.itemSize;t.addAttribute(i,new _r(a,r))}return t},_loadLibrary:function(n,e){var r=new xc(this.manager);return r.setPath(this.decoderPath),r.setResponseType(e),new Promise(function(e,t){r.load(n,e,void 0,t)})},_initDecoder:function(){var n=this;if(this.decoderPending)return this.decoderPending;var r="object"!==("undefined"==typeof WebAssembly?"undefined":W(WebAssembly))||"js"===this.decoderConfig.type,e=[];return r?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(function(e){var t=e[0];r||(n.decoderConfig.wasmBinary=e[1]);e=ad.DRACOWorker.toString(),e=["/* draco decoder */",t,"","/* worker */",e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))].join("\n");n.workerSourceURL=URL.createObjectURL(new Blob([e]))}),this.decoderPending},_getWorker:function(e,t){var r=this;return this._initDecoder().then(function(){var n;return r.workerPool.length<r.workerLimit?((n=new Worker(r.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:r.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},r.workerPool.push(n)):r.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1}),(n=r.workerPool[r.workerPool.length-1])._taskCosts[e]=t,n._taskLoad+=t,n})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(function(e){return e._taskLoad}))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),ad.DRACOWorker=function(){var n,t;onmessage=function(e){var a=e.data;switch(a.type){case"init":n=a.decoderConfig,t=new Promise(function(t){n.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(n)});break;case"decode":var o=a.buffer,s=a.taskConfig;t.then(function(e){var t=e.draco,n=new t.Decoder,e=new t.DecoderBuffer;e.Init(new Int8Array(o),o.byteLength);try{var r=function(e,t,n,r){var i,a,o=r.attributeIDs,s=r.attributeTypes,l=t.GetEncodedGeometryType(n);if(l===e.TRIANGULAR_MESH)i=new e.Mesh,a=t.DecodeBufferToMesh(n,i);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");i=new e.PointCloud,a=t.DecodeBufferToPointCloud(n,i)}if(!a.ok()||0===i.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());var c,u,h,d={index:null,attributes:[]};for(c in o){var p=self[s[c]];if(r.useUniqueIDs)h=o[c],u=t.GetAttributeByUniqueId(i,h);else{if(-1===(h=t.GetAttributeId(i,e[o[c]])))continue;u=t.GetAttribute(i,h)}d.attributes.push(function(e,t,n,r,i,a){var o,s,l=a.num_components(),c=n.num_points()*l;switch(i){case Float32Array:o=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(n,a,o),s=new Float32Array(c);break;case Int8Array:o=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(n,a,o),s=new Int8Array(c);break;case Int16Array:o=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(n,a,o),s=new Int16Array(c);break;case Int32Array:o=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(n,a,o),s=new Int32Array(c);break;case Uint8Array:o=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(n,a,o),s=new Uint8Array(c);break;case Uint16Array:o=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(n,a,o),s=new Uint16Array(c);break;case Uint32Array:o=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(n,a,o),s=new Uint32Array(c);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var u=0;u<c;u++)s[u]=o.GetValue(u);return e.destroy(o),{name:r,array:s,itemSize:l}}(e,t,i,c,p,u))}if(l===e.TRIANGULAR_MESH){for(var f=i.num_faces(),m=new Uint32Array(3*f),g=new e.DracoInt32Array,v=0;v<f;++v){t.GetFaceFromMesh(i,v,g);for(var y=0;y<3;++y)m[3*v+y]=g.GetValue(y)}d.index={array:m,itemSize:1},e.destroy(g)}return e.destroy(i),d}(t,n,e,s),i=r.attributes.map(function(e){return e.array.buffer});r.index&&i.push(r.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:r},i)}catch(e){console.error(e),self.postMessage({type:"error",id:a.id,error:e.message})}finally{t.destroy(e),t.destroy(n)}})}}},ad.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},ad.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},ad.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},ad.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};function od(e,t){var n,r,i,a,o;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new Vt,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:ne,MIDDLE:re,RIGHT:ie},this.touches={ONE:ae,TWO:se},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),d=h.NONE},this.update=(n=new Vt,r=(new Gt).setFromUnitVectors(e.up,new Vt(0,1,0)),i=r.clone().inverse(),a=new Vt,o=new Gt,function(){var e=s.object.position;return n.copy(e).sub(s.target),n.applyQuaternion(r),f.setFromVector3(n),s.autoRotate&&d===h.NONE&&P(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(f.theta+=m.theta*s.dampingFactor,f.phi+=m.phi*s.dampingFactor):(f.theta+=m.theta,f.phi+=m.phi),f.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,f.theta)),f.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=g,f.radius=Math.max(s.minDistance,Math.min(s.maxDistance,f.radius)),!0===s.enableDamping?s.target.addScaledVector(v,s.dampingFactor):s.target.add(v),n.setFromSpherical(f),n.applyQuaternion(i),e.copy(s.target).add(n),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,v.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),v.set(0,0,0)),g=1,!!(y||a.distanceToSquared(s.object.position)>p||8*(1-o.dot(s.object.quaternion))>p)&&(s.dispatchEvent(l),a.copy(s.object.position),o.copy(s.object.quaternion),!(y=!1))}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",te,!1),s.domElement.removeEventListener("mousedown",Y,!1),s.domElement.removeEventListener("wheel",Z,!1),s.domElement.removeEventListener("touchstart",K,!1),s.domElement.removeEventListener("touchend",ee,!1),s.domElement.removeEventListener("touchmove",$,!1),document.removeEventListener("mousemove",q,!1),document.removeEventListener("mouseup",Q,!1),window.removeEventListener("keydown",J,!1)};var s=this,l={type:"change"},c={type:"start"},u={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},d=h.NONE,p=1e-6,f=new sh,m=new sh,g=1,v=new Vt,y=!1,x=new Ht,b=new Ht,_=new Ht,M=new Ht,w=new Ht,T=new Ht,S=new Ht,E=new Ht,A=new Ht;function C(){return Math.pow(.95,s.zoomSpeed)}function P(e){m.theta-=e}function L(e){m.phi-=e}var O,I,R,F=(O=new Vt,function(e,t){O.setFromMatrixColumn(t,0),O.multiplyScalar(-e),v.add(O)}),N=(I=new Vt,function(e,t){!0===s.screenSpacePanning?I.setFromMatrixColumn(t,1):(I.setFromMatrixColumn(t,0),I.crossVectors(s.object.up,I)),I.multiplyScalar(e),v.add(I)}),D=(R=new Vt,function(e,t){var n,r=s.domElement===document?s.domElement.body:s.domElement;s.object.isPerspectiveCamera?(n=s.object.position,R.copy(n).sub(s.target),n=R.length(),n*=Math.tan(s.object.fov/2*Math.PI/180),F(2*e*n/r.clientHeight,s.object.matrix),N(2*t*n/r.clientHeight,s.object.matrix)):s.object.isOrthographicCamera?(F(e*(s.object.right-s.object.left)/s.object.zoom/r.clientWidth,s.object.matrix),N(t*(s.object.top-s.object.bottom)/s.object.zoom/r.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)});function k(e){s.object.isPerspectiveCamera?g/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function U(e){s.object.isPerspectiveCamera?g*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function B(e){x.set(e.clientX,e.clientY)}function z(e){M.set(e.clientX,e.clientY)}function H(e){var t;1==e.touches.length?x.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),x.set(t,e))}function G(e){var t;1==e.touches.length?M.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),M.set(t,e))}function j(e){var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,e=Math.sqrt(t*t+e*e);S.set(0,e)}function W(e){var t;1==e.touches.length?b.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY),b.set(t,n)),_.subVectors(b,x).multiplyScalar(2*s.rotateSpeed);var n=s.domElement===document?s.domElement.body:s.domElement;P(2*Math.PI*_.x/n.clientHeight),L(2*Math.PI*_.y/n.clientHeight),x.copy(b)}function V(e){var t;1==e.touches.length?w.set(e.touches[0].pageX,e.touches[0].pageY):(t=.5*(e.touches[0].pageX+e.touches[1].pageX),e=.5*(e.touches[0].pageY+e.touches[1].pageY),w.set(t,e)),T.subVectors(w,M).multiplyScalar(s.panSpeed),D(T.x,T.y),M.copy(w)}function X(e){var t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,e=Math.sqrt(t*t+e*e);E.set(0,e),A.set(0,Math.pow(E.y/S.y,s.zoomSpeed)),k(A.y),S.copy(E)}function Y(e){if(!1!==s.enabled){switch(e.preventDefault(),(s.domElement.focus?s.domElement:window).focus(),e.button){case 0:switch(s.mouseButtons.LEFT){case ne:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;z(e),d=h.PAN}else{if(!1===s.enableRotate)return;B(e),d=h.ROTATE}break;case ie:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enableRotate)return;B(e),d=h.ROTATE}else{if(!1===s.enablePan)return;z(e),d=h.PAN}break;default:d=h.NONE}break;case 1:if(s.mouseButtons.MIDDLE===re){if(!1===s.enableZoom)return;t=e,S.set(t.clientX,t.clientY),d=h.DOLLY}else d=h.NONE;break;case 2:switch(s.mouseButtons.RIGHT){case ne:if(!1===s.enableRotate)return;B(e),d=h.ROTATE;break;case ie:if(!1===s.enablePan)return;z(e),d=h.PAN;break;default:d=h.NONE}}var t;d!==h.NONE&&(document.addEventListener("mousemove",q,!1),document.addEventListener("mouseup",Q,!1),s.dispatchEvent(c))}}function q(e){var t,n;if(!1!==s.enabled)switch(e.preventDefault(),d){case h.ROTATE:if(!1===s.enableRotate)return;n=e,b.set(n.clientX,n.clientY),_.subVectors(b,x).multiplyScalar(s.rotateSpeed),n=s.domElement===document?s.domElement.body:s.domElement,P(2*Math.PI*_.x/n.clientHeight),L(2*Math.PI*_.y/n.clientHeight),x.copy(b),s.update();break;case h.DOLLY:if(!1===s.enableZoom)return;t=e,E.set(t.clientX,t.clientY),A.subVectors(E,S),0<A.y?k(C()):A.y<0&&U(C()),S.copy(E),s.update();break;case h.PAN:if(!1===s.enablePan)return;t=e,w.set(t.clientX,t.clientY),T.subVectors(w,M).multiplyScalar(s.panSpeed),D(T.x,T.y),M.copy(w),s.update()}}function Q(e){!1!==s.enabled&&(document.removeEventListener("mousemove",q,!1),document.removeEventListener("mouseup",Q,!1),s.dispatchEvent(u),d=h.NONE)}function Z(e){!1===s.enabled||!1===s.enableZoom||d!==h.NONE&&d!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(c),(e=e).deltaY<0?U(C()):0<e.deltaY&&k(C()),s.update(),s.dispatchEvent(u))}function J(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){var t=!1;switch(e.keyCode){case s.keys.UP:D(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:D(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:D(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:D(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}(e)}function K(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(s.touches.ONE){case ae:if(!1===s.enableRotate)return;H(e),d=h.TOUCH_ROTATE;break;case oe:if(!1===s.enablePan)return;G(e),d=h.TOUCH_PAN;break;default:d=h.NONE}break;case 2:switch(s.touches.TWO){case se:if(!1===s.enableZoom&&!1===s.enablePan)return;t=e,s.enableZoom&&j(t),s.enablePan&&G(t),d=h.TOUCH_DOLLY_PAN;break;case le:if(!1===s.enableZoom&&!1===s.enableRotate)return;t=e,s.enableZoom&&j(t),s.enableRotate&&H(t),d=h.TOUCH_DOLLY_ROTATE;break;default:d=h.NONE}break;default:d=h.NONE}var t;d!==h.NONE&&s.dispatchEvent(c)}}function $(e){var t;if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),d){case h.TOUCH_ROTATE:if(!1===s.enableRotate)return;W(e),s.update();break;case h.TOUCH_PAN:if(!1===s.enablePan)return;V(e),s.update();break;case h.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;t=e,s.enableZoom&&X(t),s.enablePan&&V(t),s.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;t=e,s.enableZoom&&X(t),s.enableRotate&&W(t),s.update();break;default:d=h.NONE}}function ee(e){!1!==s.enabled&&(s.dispatchEvent(u),d=h.NONE)}function te(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",te,!1),s.domElement.addEventListener("mousedown",Y,!1),s.domElement.addEventListener("wheel",Z,!1),s.domElement.addEventListener("touchstart",K,!1),s.domElement.addEventListener("touchend",ee,!1),s.domElement.addEventListener("touchmove",$,!1),window.addEventListener("keydown",J,!1),this.update()}(od.prototype=Object.create(kt.prototype)).constructor=od;Vu=function(e,t){od.call(this,e,t),this.mouseButtons.LEFT=ie,this.mouseButtons.RIGHT=ne,this.touches.ONE=oe,this.touches.TWO=le};(Vu.prototype=Object.create(kt.prototype)).constructor=Vu;var sd,ld,cd={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")};function ud(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}function hd(e){this._mesh=new ii(ld,e)}Object.assign(ud.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),ud.FullScreenQuad=(sd=new nu(-1,1,1,-1,0,1),ld=new Ui(2,2),Object.defineProperty(hd.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(hd.prototype,{render:function(e){e.render(this._mesh,sd)}}),hd);function dd(e,t){ud.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof xi?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=gi.clone(e.uniforms),this.material=new xi({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new ud.FullScreenQuad(this.material)}dd.prototype=Object.assign(Object.create(ud.prototype),{constructor:dd,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}});function pd(e,t){ud.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}pd.prototype=Object.assign(Object.create(ud.prototype),{constructor:pd,render:function(e,t,n){var r,i,a=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),i=this.inverse?(r=0,1):(r=1,0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.buffers.stencil.setFunc(a.ALWAYS,r,4294967295),o.buffers.stencil.setClear(i),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(a.EQUAL,1,4294967295),o.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.buffers.stencil.setLocked(!0)}});function fd(){ud.call(this),this.needsSwap=!1}fd.prototype=Object.create(ud.prototype),Object.assign(fd.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}});function md(e,t){var n,r;this.renderer=e,void 0===t?(n={minFilter:Ae,magFilter:Ae,format:Ge,stencilBuffer:!1},r=e.getSize(new Ht),this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,(t=new $t(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"):(this._pixelRatio=1,this._width=t.width,this._height=t.height),this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new dd(cd),this.clock=new Ou}Object.assign(md.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());for(var t,n,r,i=this.renderer.getRenderTarget(),a=!1,o=this.passes.length,s=0;s<o;s++)!1!==(r=this.passes[s]).enabled&&(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,a),r.needsSwap&&(a&&(t=this.renderer.getContext(),(n=this.renderer.state.buffers.stencil).setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)),this.swapBuffers()),r instanceof pd?a=!0:r instanceof fd&&(a=!1));this.renderer.setRenderTarget(i)},reset:function(e){var t;void 0===e&&(t=this.renderer.getSize(new Ht),this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)),this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(n,r)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}});var gd,vd,qu=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};function yd(e){this._mesh=new ii(vd,e)}Object.assign(qu.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),qu.FullScreenQuad=(gd=new nu(-1,1,1,-1,0,1),vd=new Ui(2,2),Object.defineProperty(yd.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(yd.prototype,{render:function(e){e.render(this._mesh,gd)}}),yd);function xd(e,t,n,r,i){ud.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1}xd.prototype=Object.assign(Object.create(ud.prototype),{constructor:xd,render:function(e,t,n){var r,i,a=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(r=e.getClearColor().getHex(),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(r,i),this.scene.overrideMaterial=null,e.autoClear=a}});function bd(e,t,n,r){this.renderScene=t,this.renderCamera=n,this.selectedObjects=void 0!==r?r:[],this.visibleEdgeColor=new pr(1,1,1),this.hiddenEdgeColor=new pr(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,ud.call(this),this.resolution=void 0!==e?new Ht(e.x,e.y):new Ht(256,256),n={minFilter:Ae,magFilter:Ae,format:Ge},r=Math.round(this.resolution.x/this.downSampleRatio),e=Math.round(this.resolution.y/this.downSampleRatio),this.maskBufferMaterial=new br({color:16777215}),this.maskBufferMaterial.side=Q,this.renderTargetMaskBuffer=new $t(this.resolution.x,this.resolution.y,n),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new _o,this.depthMaterial.side=Q,this.depthMaterial.depthPacking=It,this.depthMaterial.blending=Z,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=Q,this.prepareMaskMaterial.fragmentShader=function(e,t){t=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,t+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new $t(this.resolution.x,this.resolution.y,n),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new $t(r,e,n),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new $t(r,e,n),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new $t(Math.round(r/2),Math.round(e/2),n),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new $t(r,e,n),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new $t(Math.round(r/2),Math.round(e/2),n),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new Ht(r,e),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new Ht(Math.round(r/2),Math.round(e/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),e=cd,this.copyUniforms=gi.clone(e.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new xi({uniforms:this.copyUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,blending:Z,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new pr,this.oldClearAlpha=1,this.fsQuad=new ud.FullScreenQuad(null),this.tempPulseColor1=new pr,this.tempPulseColor2=new pr,this.textureMatrix=new cn}bd.prototype=Object.assign(Object.create(ud.prototype),{constructor:bd,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);e=Math.round(e/this.downSampleRatio),t=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(e,t),this.renderTargetBlurBuffer1.setSize(e,t),this.renderTargetEdgeBuffer1.setSize(e,t),this.separableBlurMaterial1.uniforms.texSize.value=new Ht(e,t),e=Math.round(e/2),t=Math.round(t/2),this.renderTargetBlurBuffer2.setSize(e,t),this.renderTargetEdgeBuffer2.setSize(e,t),this.separableBlurMaterial2.uniforms.texSize.value=new Ht(e,t)},changeVisibilityOfSelectedObjects:function(t){function e(e){e.isMesh&&(t?(e.visible=e.userData.oldVisible,delete e.userData.oldVisible):(e.userData.oldVisible=e.visible,e.visible=t))}for(var n=0;n<this.selectedObjects.length;n++)this.selectedObjects[n].traverse(e)},changeVisibilityOfNonSelectedObjects:function(i){var a=[];function e(e){e.isMesh&&a.push(e)}for(var t=0;t<this.selectedObjects.length;t++)this.selectedObjects[t].traverse(e);this.renderScene.traverse(function(e){if(e.isMesh||e.isLine||e.isSprite){for(var t,n=!1,r=0;r<a.length;r++)if(a[r].id===e.id){n=!0;break}n||(t=e.visible,i&&!e.bVisible||(e.visible=i),e.bVisible=t)}})},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,n,r,i){var a,o;0<this.selectedObjects.length&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),a=e.autoClear,e.autoClear=!1,i&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1),o=this.renderScene.background,this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value=new Ht(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),0<this.pulsePeriod&&(o=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2,this.tempPulseColor1.multiplyScalar(o),this.tempPulseColor2.multiplyScalar(o)),this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new Ht(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=bd.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=bd.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=bd.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=bd.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(n),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a),this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=n.texture,e.setRenderTarget(null),this.fsQuad.render(e))},getPrepareMaskMaterial:function(){return new xi({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Ht(.5,.5)},textureMatrix:{value:new cn}},vertexShader:["varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\tvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new xi({uniforms:{maskTexture:{value:null},texSize:{value:new Ht(.5,.5)},visibleEdgeColor:{value:new Vt(1,1,1)},hiddenEdgeColor:{value:new Vt(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new xi({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new Ht(.5,.5)},direction:{value:new Ht(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new xi({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:K,depthTest:!1,depthWrite:!1,transparent:!0})}}),bd.BlurDirectionX=new Ht(1,0),bd.BlurDirectionY=new Ht(0,1);function _d(e){ud.call(this);var t=cd;this.textureID="tDiffuse",this.uniforms=gi.clone(t.uniforms),this.material=new xi({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new $t(window.innerWidth,window.innerHeight,{minFilter:Ae,magFilter:Ae,format:He,stencilBuffer:!1}),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.fsQuad=new ud.FullScreenQuad(this.material)}_d.prototype=Object.assign(Object.create(ud.prototype),{constructor:_d,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),e.setRenderTarget(this.renderTarget),this.clear&&e.clear(),this.fsQuad.render(e)}});function Md(e){Mc.call(this,e),this.type=Le}Md.prototype=Object.assign(Object.create(Mc.prototype),{constructor:Md,parse:function(e){function y(e,t){switch(e){case 1:console.error("RGBELoader Read Error: "+(t||""));break;case 2:console.error("RGBELoader Write Error: "+(t||""));break;case 3:console.error("RGBELoader Bad File Format: "+(t||""));break;default:console.error("RGBELoader: Error: "+(t||""))}return-1}function l(e,t,n){t=t||1024;for(var r=e.pos,i=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));(i=s.indexOf("\n"))<0&&a<t&&r<e.byteLength;)o+=s,a+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<i&&(!1!==n&&(e.pos+=a+i+1),o+s.slice(0,i))}var i,a,t=(i=new Float32Array(1),a=new Int32Array(i.buffer),function(e,t,n,r){var i=e[t+3],i=Math.pow(2,i-128)/255;n[r+0]=o(e[t+0]*i),n[r+1]=o(e[t+1]*i),n[r+2]=o(e[t+2]*i)});function o(e){i[0]=e;var t=a[0],n=t>>16&32768,r=t>>12&2047,e=t>>23&255;return e<103?n:142<e?(n|=31744,n|=(255==e?0:1)&&8388607&t):e<113?n|=((r|=2048)>>114-e)+(r>>113-e&1):(n|=e-112<<10|r>>1,n+=1&r)}var n=new Uint8Array(e);n.pos=0;var r,s,c,u,h,d=function(e){var t,n,r=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(t=l(e)))return y(1,"no header found");if(!(n=t.match(/^#\?(\S+)$/)))return y(3,"bad initial token");for(s.valid|=1,s.programtype=n[1],s.string+=t+"\n";!1!==(t=l(e));)if(s.string+=t+"\n","#"!==t.charAt(0)){if((n=t.match(r))&&(s.gamma=parseFloat(n[1],10)),(n=t.match(i))&&(s.exposure=parseFloat(n[1],10)),(n=t.match(a))&&(s.valid|=2,s.format=n[1]),(n=t.match(o))&&(s.valid|=4,s.height=parseInt(n[1],10),s.width=parseInt(n[2],10)),2&s.valid&&4&s.valid)break}else s.comments+=t+"\n";return 2&s.valid?4&s.valid?s:y(3,"missing image size specifier"):y(3,"missing format specifier")}(n);if(-1!==d){var p=d.width,e=d.height,f=function(e,t,n){var r,i,a,o,s,l,c,u,h,d,p,f,m,g=t,v=n;if(g<8||32767<g||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(g!==(e[2]<<8|e[3]))return y(3,"wrong scanline width");if(!(r=new Uint8Array(4*t*n))||!r.length)return y(4,"unable to allocate buffer space");for(a=i=0,u=4*g,m=new Uint8Array(4),l=new Uint8Array(u);0<v&&a<e.byteLength;){if(a+4>e.byteLength)return y(1);if(m[0]=e[a++],m[1]=e[a++],m[2]=e[a++],m[3]=e[a++],2!=m[0]||2!=m[1]||(m[2]<<8|m[3])!=g)return y(3,"bad rgbe scanline format");for(c=0;c<u&&a<e.byteLength;){if((f=128<(o=e[a++]))&&(o-=128),0===o||u<c+o)return y(3,"bad scanline data");if(f)for(s=e[a++],h=0;h<o;h++)l[c++]=s;else l.set(e.subarray(a,a+o),c),c+=o,a+=o}for(d=g,h=0;h<d;h++)r[i]=l[h+(p=0)],p+=g,r[i+1]=l[h+p],p+=g,r[i+2]=l[h+p],p+=g,r[i+3]=l[h+p],i+=4;v--}return r}(n.subarray(n.pos),p,e);if(-1!==f){switch(this.type){case Le:var m=f,g=Ve,v=Le;break;case Fe:for(var x=f.length/4*3,b=new Float32Array(x),_=0;_<x;_++)c=b,u=3*_,h=h=void 0,h=(r=f)[(s=4*_)+3],h=Math.pow(2,h-128)/255,c[u+0]=r[s+0]*h,c[u+1]=r[s+1]*h,c[u+2]=r[s+2]*h;m=b,g=He,v=Fe;break;case Ne:for(var x=f.length/4*3,M=new Uint16Array(x),_=0;_<x;_++)t(f,4*_,M,3*_);m=M,g=He,v=Ne;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:p,height:e,data:m,header:d.string,gamma:d.gamma,exposure:d.exposure,format:g,type:v}}}return null},setDataType:function(e){return this.type=e,this},load:function(e,n,t,r){return Mc.prototype.load.call(this,e,function(e,t){switch(e.type){case Le:e.encoding=Et,e.minFilter=Te,e.magFilter=Te,e.generateMipmaps=!1,e.flipY=!0;break;case Fe:case Ne:e.encoding=wt,e.minFilter=Ae,e.magFilter=Ae,e.generateMipmaps=!1,e.flipY=!0}n&&n(e,t)},t,r)}});var wd=function(e){vc.call(this,e),this.hdrLoader=new Md,this.type=Le};wd.prototype=Object.assign(Object.create(vc.prototype),{constructor:wd,load:function(i,e,t,n){Array.isArray(i)||(console.warn("THREE.HDRCubeTextureLoader signature has changed. Use .setDataType() instead."),this.setDataType(i),i=e,e=t,t=n,n=arguments[4]);var a=new Zi;switch(a.type=this.type,a.type){case Le:a.encoding=Et,a.format=Ge,a.minFilter=Te,a.magFilter=Te,a.generateMipmaps=!1;break;case Fe:case Ne:a.encoding=wt,a.format=He,a.minFilter=Ae,a.magFilter=Ae,a.generateMipmaps=!1}var o=this,s=0;for(var r=0;r<i.length;r++)!function(t,n,e,r){new xc(o.manager).setPath(o.path).setResponseType("arraybuffer").load(i[t],function(e){s++;e=o.hdrLoader.parse(e);e&&(void 0!==e.data&&((e=new Ti(e.data,e.width,e.height)).type=a.type,e.encoding=a.encoding,e.format=a.format,e.minFilter=a.minFilter,e.magFilter=a.magFilter,e.generateMipmaps=a.generateMipmaps,a.images[t]=e),6===s&&(a.needsUpdate=!0,n&&n(a)))},e,r)}(r,e,t,n);return a},setDataType:function(e){return this.type=e,this.hdrLoader.setDataType(e),this}});var Td,Sd,Ed,Ad={uniforms:{tDiffuse:{value:null},resolution:{value:new Ht(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},Cd=function(){var e,c=((e=new xi({defines:{SAMPLES_PER_LEVEL:20},uniforms:{faceIndex:{value:0},roughness:{value:.5},mapSize:{value:.5},envMap:{value:null},tFlip:{value:-1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform int faceIndex;\n\t\t\t\tuniform float roughness;\n\t\t\t\tuniform samplerCube envMap;\n\t\t\t\tuniform float mapSize;\n\t\t\t\tuniform float tFlip;\n\t\t\t\t\n\t\t\t\tfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\t\t\t\t\tfloat a = ggxRoughness + 0.0001;\n\t\t\t\t\ta *= a;\n\t\t\t\t\treturn ( 2.0 / a - 2.0 );\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSamplePhong(vec2 uv, mat3 vecSpace, float specPow) {\n\t\t\t\t\tfloat phi = uv.y * 2.0 * PI;\n\t\t\t\t\tfloat cosTheta = pow(1.0 - uv.x, 1.0 / (specPow + 1.0));\n\t\t\t\t\tfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\t\t\t\t\tvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n\t\t\t\t\treturn vecSpace * sampleDir;\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSampleGGX( vec2 uv, mat3 vecSpace, float Roughness )\n\t\t\t\t{\n\t\t\t\t\tfloat a = Roughness * Roughness;\n\t\t\t\t\tfloat Phi = 2.0 * PI * uv.x;\n\t\t\t\t\tfloat CosTheta = sqrt( (1.0 - uv.y) / ( 1.0 + (a*a - 1.0) * uv.y ) );\n\t\t\t\t\tfloat SinTheta = sqrt( 1.0 - CosTheta * CosTheta );\n\t\t\t\t\treturn vecSpace * vec3(SinTheta * cos( Phi ), SinTheta * sin( Phi ), CosTheta);\n\t\t\t\t}\n\t\t\t\tmat3 matrixFromVector(vec3 n) {\n\t\t\t\t\tfloat a = 1.0 / (1.0 + n.z);\n\t\t\t\t\tfloat b = -n.x * n.y * a;\n\t\t\t\t\tvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n\t\t\t\t\tvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n\t\t\t\t\treturn mat3(b1, b2, n);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec4 testColorMap(float Roughness) {\n\t\t\t\t\tvec4 color;\n\t\t\t\t\tif(faceIndex == 0)\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 1)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 2)\n\t\t\t\t\t\tcolor = vec4(0.0,0.0,1.0,1.0);\n\t\t\t\t\telse if(faceIndex == 3)\n\t\t\t\t\t\tcolor = vec4(1.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 4)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,1.0,1.0);\n\t\t\t\t\telse\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,1.0,1.0);\n\t\t\t\t\tcolor *= ( 1.0 - Roughness );\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec3 sampleDirection;\n\t\t\t\t\tvec2 uv = vUv*2.0 - 1.0;\n\t\t\t\t\tfloat offset = -1.0/mapSize;\n\t\t\t\t\tconst float a = -1.0;\n\t\t\t\t\tconst float b = 1.0;\n\t\t\t\t\tfloat c = -1.0 + offset;\n\t\t\t\t\tfloat d = 1.0 - offset;\n\t\t\t\t\tfloat bminusa = b - a;\n\t\t\t\t\tuv.x = (uv.x - a)/bminusa * d - (uv.x - b)/bminusa * c;\n\t\t\t\t\tuv.y = (uv.y - a)/bminusa * d - (uv.y - b)/bminusa * c;\n\t\t\t\t\tif (faceIndex==0) {\n\t\t\t\t\t\tsampleDirection = vec3(1.0, -uv.y, -uv.x);\n\t\t\t\t\t} else if (faceIndex==1) {\n\t\t\t\t\t\tsampleDirection = vec3(-1.0, -uv.y, uv.x);\n\t\t\t\t\t} else if (faceIndex==2) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, 1.0, uv.y);\n\t\t\t\t\t} else if (faceIndex==3) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -1.0, -uv.y);\n\t\t\t\t\t} else if (faceIndex==4) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -uv.y, 1.0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsampleDirection = vec3(-uv.x, -uv.y, -1.0);\n\t\t\t\t\t}\n\t\t\t\t\tvec3 correctedDirection = vec3( tFlip * sampleDirection.x, sampleDirection.yz );\n\t\t\t\t\tmat3 vecSpace = matrixFromVector( normalize( correctedDirection ) );\n\t\t\t\t\tvec3 rgbColor = vec3(0.0);\n\t\t\t\t\tconst int NumSamples = SAMPLES_PER_LEVEL;\n\t\t\t\t\tvec3 vect;\n\t\t\t\t\tfloat weight = 0.0;\n\t\t\t\t\tfor( int i = 0; i < NumSamples; i ++ ) {\n\t\t\t\t\t\tfloat sini = sin(float(i));\n\t\t\t\t\t\tfloat cosi = cos(float(i));\n\t\t\t\t\t\tfloat r = rand(vec2(sini, cosi));\n\t\t\t\t\t\tvect = ImportanceSampleGGX(vec2(float(i) / float(NumSamples), r), vecSpace, roughness);\n\t\t\t\t\t\tfloat dotProd = dot(vect, normalize(sampleDirection));\n\t\t\t\t\t\tweight += dotProd;\n\t\t\t\t\t\tvec3 color = envMapTexelToLinear(textureCube(envMap, vect)).rgb;\n\t\t\t\t\t\trgbColor.rgb += color;\n\t\t\t\t\t}\n\t\t\t\t\trgbColor /= float(NumSamples);\n\t\t\t\t\t//rgbColor = testColorMap( roughness ).rgb;\n\t\t\t\t\tgl_FragColor = linearToOutputTexel( vec4( rgbColor, 1.0 ) );\n\t\t\t\t}",blending:Z})).type="PMREMGenerator",e),r=new nu(-1,1,1,-1,0,1e3),i=new Cn,t=new ii(new Ui(2,2,0),c);t.material.side=Q,i.add(t),i.add(r);t=function(e,t,n){this.sourceTexture=e,this.resolution=void 0!==n?n:256,this.samplesPerLevel=void 0!==t?t:32;t=this.sourceTexture.encoding===wt||this.sourceTexture.encoding===St||this.sourceTexture.encoding===Tt;this.sourceTexture.minFilter=t?Ae:Te,this.sourceTexture.magFilter=t?Ae:Te,this.sourceTexture.generateMipmaps=this.sourceTexture.generateMipmaps&&t,this.cubeLods=[];var r=this.resolution,i={format:this.sourceTexture.format,magFilter:this.sourceTexture.magFilter,minFilter:this.sourceTexture.minFilter,type:this.sourceTexture.type,generateMipmaps:this.sourceTexture.generateMipmaps,anisotropy:this.sourceTexture.anisotropy,encoding:this.sourceTexture.encoding};this.numLods=Math.log(r)/Math.log(2)-2;for(var a=0;a<this.numLods;a++){var o=new wi(r,r,i);o.texture.name="PMREMGenerator.cube"+a,this.cubeLods.push(o),r=Math.max(16,r/2)}};return t.prototype={constructor:t,update:function(e){var t=this.sourceTexture.isCubeTexture?-1:1;c.defines.SAMPLES_PER_LEVEL=this.samplesPerLevel,c.uniforms.faceIndex.value=0,c.uniforms.envMap.value=this.sourceTexture,c.envMap=this.sourceTexture,c.needsUpdate=!0;var n=e.gammaInput,r=e.gammaOutput,i=e.toneMapping,a=e.toneMappingExposure,o=e.getRenderTarget();e.toneMapping=we,e.toneMappingExposure=1,e.gammaInput=!1,e.gammaOutput=!1;for(var s=0;s<this.numLods;s++){var l=s/(this.numLods-1);c.uniforms.roughness.value=.9*l,c.uniforms.tFlip.value=0==s?t:1;l=this.cubeLods[s].width;c.uniforms.mapSize.value=l,this.renderToCubeMapTarget(e,this.cubeLods[s]),s<5&&(c.uniforms.envMap.value=this.cubeLods[s].texture)}e.setRenderTarget(o),e.toneMapping=i,e.toneMappingExposure=a,e.gammaInput=n,e.gammaOutput=r},renderToCubeMapTarget:function(e,t){for(var n=0;n<6;n++)this.renderToCubeMapTargetFace(e,t,n)},renderToCubeMapTargetFace:function(e,t,n){c.uniforms.faceIndex.value=n,e.setRenderTarget(t,n),e.clear(),e.render(i,r)},dispose:function(){for(var e=0,t=this.cubeLods.length;e<t;e++)this.cubeLods[e].dispose()}},t}(),Pd=(Td=new nu,Sd=new Cn,(Yu=new xi({uniforms:{faceIndex:{value:0},mapSize:{value:0},envMap:{value:null},testColor:{value:new Vt(1,1,1)}},vertexShader:"precision highp float;        varying vec2 vUv;        void main() {          vUv = uv;          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );        }",fragmentShader:"precision highp float;        varying vec2 vUv;        uniform samplerCube envMap;        uniform float mapSize;        uniform vec3 testColor;        uniform int faceIndex;                void main() {          vec3 sampleDirection;          vec2 uv = vUv;          uv = uv * 2.0 - 1.0;          uv.y *= -1.0;          if(faceIndex == 0) {            sampleDirection = normalize(vec3(1.0, uv.y, -uv.x));          } else if(faceIndex == 1) {            sampleDirection = normalize(vec3(uv.x, 1.0, uv.y));          } else if(faceIndex == 2) {            sampleDirection = normalize(vec3(uv.x, uv.y, 1.0));          } else if(faceIndex == 3) {            sampleDirection = normalize(vec3(-1.0, uv.y, uv.x));          } else if(faceIndex == 4) {            sampleDirection = normalize(vec3(uv.x, -1.0, -uv.y));          } else {            sampleDirection = normalize(vec3(-uv.x, uv.y, -1.0));          }          vec4 color = envMapTexelToLinear( textureCube( envMap, sampleDirection ) );          gl_FragColor = linearToOutputTexel( color );        }",blending:Z})).type="PMREMCubeUVPacker",Ed=Yu,Ld.prototype={constructor:Ld,update:function(e){var t=4*this.cubeLods[0].width;Td.left=.5*-t,Td.right=.5*t,Td.top=.5*-t,Td.bottom=.5*t,Td.near=0,Td.far=1,Td.updateProjectionMatrix();for(var n=0;n<this.objects.length;n++)Sd.add(this.objects[n]);var r=e.gammaInput,i=e.gammaOutput,a=e.toneMapping,o=e.toneMappingExposure,t=e.getRenderTarget();e.gammaInput=!1,e.gammaOutput=!1,e.toneMapping=we,e.toneMappingExposure=1,e.setRenderTarget(this.CubeUVRenderTarget),e.render(Sd,Td),e.setRenderTarget(t),e.toneMapping=a,e.toneMappingExposure=o,e.gammaInput=r,e.gammaOutput=i;for(n=0;n<this.objects.length;n++)Sd.remove(this.objects[n])},dispose:function(){for(var e=0,t=this.objects.length;e<t;e++)this.objects[e].material.dispose();this.objects[0].geometry.dispose()}},Ld);function Ld(e){var t=4*(this.cubeLods=e)[0].width,n=e[0].texture;(n={format:n.format,magFilter:n.magFilter,minFilter:n.minFilter,type:n.type,generateMipmaps:n.generateMipmaps,anisotropy:n.anisotropy,encoding:n.encoding===Et?Pt:n.encoding}).encoding===Pt&&(n.magFilter=Ae,n.minFilter=Ae),this.CubeUVRenderTarget=new $t(t,t,n),this.CubeUVRenderTarget.texture.name="PMREMCubeUVPacker.cubeUv",this.CubeUVRenderTarget.texture.mapping=j,this.objects=[];var r=new Ui(1,1),i=[];i.push(new Ht(0,0)),i.push(new Ht(1,0)),i.push(new Ht(2,0)),i.push(new Ht(0,1)),i.push(new Ht(1,1)),i.push(new Ht(2,1));var a=t,t=e[0].width,o=0,s=4;this.numLods=Math.log(e[0].width)/Math.log(2)-2;for(var l=0;l<this.numLods;l++){var c=.5*(a-a/s);16<t&&(s*=2);for(var u=16<t?6:1,h=0,d=0,p=t,f=0;f<u;f++){for(var m=0;m<6;m++){var g=Ed.clone();g.uniforms.envMap.value=this.cubeLods[l].texture,g.envMap=this.cubeLods[l].texture,g.uniforms.faceIndex.value=m,g.uniforms.mapSize.value=p;g=new ii(r,g);g.position.x=i[m].x*p-c+h,g.position.y=i[m].y*p-c+o+d,g.material.side=Me,g.scale.setScalar(p),this.objects.push(g)}d+=1.75*p,h+=1.25*p,p/=2}o+=2*t,16<t&&(t/=2)}}function Od(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),i=Math.round(e.g),a=Math.round(e.b),o=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+r+","+i+","+a+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+a+","+o+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+a+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+a+","+o+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+a+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+a+",a:"+o+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+o+"}":"unknown format"}var Id,Rd=Array.prototype.forEach,Fd=Array.prototype.slice,Nd={BREAK:{},extend:function(n){return this.each(Fd.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(n[e]=t[e])}.bind(this))},this),n},defaults:function(n){return this.each(Fd.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(n[e])&&(n[e]=t[e])}.bind(this))},this),n},compose:function(){var n=Fd.call(arguments);return function(){for(var e=Fd.call(arguments),t=n.length-1;0<=t;t--)e=[n[t].apply(this,e)];return e[0]}},each:function(e,t,n){if(e)if(Rd&&e.forEach&&e.forEach===Rd)e.forEach(t,n);else if(e.length===e.length+0){for(var r=void 0,r=0,i=e.length;r<i;r++)if(r in e&&t.call(n,e[r],r)===this.BREAK)return}else for(var a in e)if(t.call(n,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(r,i,a){var o=void 0;return function(){var e=this,t=arguments;var n=a||!o;clearTimeout(o),o=setTimeout(function(){o=null,a||r.apply(e,t)},i),n&&r.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():Fd.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(Id=function(e){return isNaN(e)},Dd.toString=function(){return Id.toString()},Dd),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function Dd(){return Id.apply(this,arguments)}var kd,Ud=[{litmus:Nd.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:Od},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:Od},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:Od},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:Od}}},{litmus:Nd.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Nd.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Nd.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(Nd.isNumber(e.r)&&Nd.isNumber(e.g)&&Nd.isNumber(e.b)&&Nd.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(Nd.isNumber(e.r)&&Nd.isNumber(e.g)&&Nd.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(Nd.isNumber(e.h)&&Nd.isNumber(e.s)&&Nd.isNumber(e.v)&&Nd.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(Nd.isNumber(e.h)&&Nd.isNumber(e.s)&&Nd.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Bd=void 0,zd=void 0,Hd=function(){zd=!1;var n=1<arguments.length?Nd.toArray(arguments):arguments[0];return Nd.each(Ud,function(e){if(e.litmus(n))return Nd.each(e.conversions,function(e,t){if(Bd=e.read(n),!1===zd&&!1!==Bd)return(zd=Bd).conversionName=t,Bd.conversion=e,Nd.BREAK}),Nd.BREAK}),zd},Gd={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),a=n*(1-t),e=n*(1-i*t),t=n*(1-(1-i)*t),r=[[n,t,a],[e,n,a],[a,n,t],[a,e,n],[t,a,n],[n,a,e]][r];return{r:255*r[0],g:255*r[1],b:255*r[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),a=i-r,r=void 0;return 0===i?{h:NaN,s:0,v:0}:(r=e===i?(t-n)/a:t===i?2+(n-e)/a:4+(e-t)/a,(r/=6)<0&&(r+=1),{h:360*r,s:a/i,v:i/255})},rgb_to_hex:function(e,t,n){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(kd=8*t)|e&~(255<<kd)}},jd="function"==typeof Symbol&&"symbol"===W(Symbol.iterator)?function(e){return W(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":W(e)},Wd=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Vu=function(e,t,n){return t&&Vd(e.prototype,t),n&&Vd(e,n),e};function Vd(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xd(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0!==r){if("value"in r)return r.value;r=r.get;return void 0!==r?r.call(n):void 0}if(null!==(e=Object.getPrototypeOf(e)))return Xd(e,t,n)}var qu=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+W(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Yd=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==W(t)&&"function"!=typeof t?e:t},qd=(Vu(Qd,[{key:"toString",value:function(){return Od(this)}},{key:"toHexString",value:function(){return Od(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),Qd);function Qd(){if(Wd(this,Qd),this.__state=Hd.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function Zd(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||qd.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(qd.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function Jd(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||qd.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(qd.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}qd.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=Gd.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");Nd.extend(e.__state,Gd.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},qd.recalculateHSV=function(e){var t=Gd.rgb_to_hsv(e.r,e.g,e.b);Nd.extend(e.__state,{s:t.s,v:t.v}),Nd.isNaN(t.h)?Nd.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},qd.COMPONENTS=["r","g","b","h","s","v","hex","a"],Zd(qd.prototype,"r",2),Zd(qd.prototype,"g",1),Zd(qd.prototype,"b",0),Jd(qd.prototype,"h"),Jd(qd.prototype,"s"),Jd(qd.prototype,"v"),Object.defineProperty(qd.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(qd.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=Gd.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Kd=(Vu($d,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),$d);function $d(e,t){Wd(this,$d),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var ep={};Nd.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){Nd.each(e,function(e){ep[e]=t})});var tp=/(\d+(\.\d+)?)px/;function np(e){if("0"===e||Nd.isUndefined(e))return 0;e=e.match(tp);return Nd.isNull(e)?0:parseFloat(e[1])}var rp={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){Nd.isUndefined(t)&&(t=!0),Nd.isUndefined(n)&&(n=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var i=n||{},n=ep[t];if(!n)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(n);switch(n){case"MouseEvents":var o=i.x||i.clientX||0,s=i.y||i.clientY||0;a.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,o,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=a.initKeyboardEvent||a.initKeyEvent;Nd.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:a.initEvent(t,i.bubbles||!1,i.cancelable||!0)}Nd.defaults(a,r),e.dispatchEvent(a)},bind:function(e,t,n,r){return e.addEventListener?e.addEventListener(t,n,r||!1):e.attachEvent&&e.attachEvent("on"+t,n),rp},unbind:function(e,t,n,r){return e.removeEventListener?e.removeEventListener(t,n,r||!1):e.detachEvent&&e.detachEvent("on"+t,n),rp},addClass:function(e,t){var n;return void 0===e.className?e.className=t:e.className===t||-1===(n=e.className.split(/ +/)).indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),rp},removeClass:function(e,t){var n;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(n=e.className.split(/ +/)).indexOf(t))&&(n.splice(t,1),e.className=n.join(" ")):e.className=void 0,rp},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return np(e["border-left-width"])+np(e["border-right-width"])+np(e["padding-left"])+np(e["padding-right"])+np(e.width)},getHeight:function(e){e=getComputedStyle(e);return np(e["border-top-width"])+np(e["border-bottom-width"])+np(e["padding-top"])+np(e["padding-bottom"])+np(e.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)for(;n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},ip=(qu(ap,Kd),Vu(ap,[{key:"setValue",value:function(e){e=Xd(ap.prototype.__proto__||Object.getPrototypeOf(ap.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Xd(ap.prototype.__proto__||Object.getPrototypeOf(ap.prototype),"updateDisplay",this).call(this)}}]),ap);function ap(e,t){Wd(this,ap);var t=Yd(this,(ap.__proto__||Object.getPrototypeOf(ap)).call(this,e,t)),n=t;return t.__prev=t.getValue(),t.__checkbox=document.createElement("input"),t.__checkbox.setAttribute("type","checkbox"),rp.bind(t.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),t.domElement.appendChild(t.__checkbox),t.updateDisplay(),t}var op=(qu(sp,Kd),Vu(sp,[{key:"setValue",value:function(e){e=Xd(sp.prototype.__proto__||Object.getPrototypeOf(sp.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return rp.isActive(this.__select)?this:(this.__select.value=this.getValue(),Xd(sp.prototype.__proto__||Object.getPrototypeOf(sp.prototype),"updateDisplay",this).call(this))}}]),sp);function sp(e,t,n){Wd(this,sp);var r,t=Yd(this,(sp.__proto__||Object.getPrototypeOf(sp)).call(this,e,t)),n=n,i=t;return t.__select=document.createElement("select"),Nd.isArray(n)&&(r={},Nd.each(n,function(e){r[e]=e}),n=r),Nd.each(n,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),i.__select.appendChild(n)}),t.updateDisplay(),rp.bind(t.__select,"change",function(){var e=this.options[this.selectedIndex].value;i.setValue(e)}),t.domElement.appendChild(t.__select),t}var lp=(qu(cp,Kd),Vu(cp,[{key:"updateDisplay",value:function(){return rp.isActive(this.__input)||(this.__input.value=this.getValue()),Xd(cp.prototype.__proto__||Object.getPrototypeOf(cp.prototype),"updateDisplay",this).call(this)}}]),cp);function cp(e,t){Wd(this,cp);var t=Yd(this,(cp.__proto__||Object.getPrototypeOf(cp)).call(this,e,t)),n=t;function r(){n.setValue(n.__input.value)}return t.__input=document.createElement("input"),t.__input.setAttribute("type","text"),rp.bind(t.__input,"keyup",r),rp.bind(t.__input,"change",r),rp.bind(t.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),rp.bind(t.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),t.updateDisplay(),t.domElement.appendChild(t.__input),t}function up(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}qu(hp,Kd),Vu(hp,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),Xd(hp.prototype.__proto__||Object.getPrototypeOf(hp.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=up(e),this}}]),Yu=hp;function hp(e,t,n){Wd(this,hp);t=Yd(this,(hp.__proto__||Object.getPrototypeOf(hp)).call(this,e,t)),n=n||{};return t.__min=n.min,t.__max=n.max,t.__step=n.step,Nd.isUndefined(t.__step)?0===t.initialValue?t.__impliedStep=1:t.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(t.initialValue))/Math.LN10))/10:t.__impliedStep=t.__step,t.__precision=up(t.__impliedStep),t}var dp=(qu(pp,Yu),Vu(pp,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),Xd(pp.prototype.__proto__||Object.getPrototypeOf(pp.prototype),"updateDisplay",this).call(this)}}]),pp);function pp(e,t,n){Wd(this,pp);n=Yd(this,(pp.__proto__||Object.getPrototypeOf(pp)).call(this,e,t,n));n.__truncationSuspended=!1;var r=n,i=void 0;function a(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function o(e){var t=i-e.clientY;r.setValue(r.getValue()+t*r.__impliedStep),i=e.clientY}function s(){rp.unbind(window,"mousemove",o),rp.unbind(window,"mouseup",s),a()}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),rp.bind(n.__input,"change",function(){var e=parseFloat(r.__input.value);Nd.isNaN(e)||r.setValue(e)}),rp.bind(n.__input,"blur",function(){a()}),rp.bind(n.__input,"mousedown",function(e){rp.bind(window,"mousemove",o),rp.bind(window,"mouseup",s),i=e.clientY}),rp.bind(n.__input,"keydown",function(e){13===e.keyCode&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,a())}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}function fp(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}var mp=(qu(gp,Yu),Vu(gp,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Xd(gp.prototype.__proto__||Object.getPrototypeOf(gp.prototype),"updateDisplay",this).call(this)}}]),gp);function gp(e,t,n,r,i){Wd(this,gp);var i=Yd(this,(gp.__proto__||Object.getPrototypeOf(gp)).call(this,e,t,{min:n,max:r,step:i})),a=i;function o(e){e.preventDefault();var t=a.__background.getBoundingClientRect();return a.setValue(fp(e.clientX,t.left,t.right,a.__min,a.__max)),!1}function s(){rp.unbind(window,"mousemove",o),rp.unbind(window,"mouseup",s),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function l(e){var t=e.touches[0].clientX,e=a.__background.getBoundingClientRect();a.setValue(fp(t,e.left,e.right,a.__min,a.__max))}function c(){rp.unbind(window,"touchmove",l),rp.unbind(window,"touchend",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),rp.bind(i.__background,"mousedown",function(e){document.activeElement.blur(),rp.bind(window,"mousemove",o),rp.bind(window,"mouseup",s),o(e)}),rp.bind(i.__background,"touchstart",function(e){1===e.touches.length&&(rp.bind(window,"touchmove",l),rp.bind(window,"touchend",c),l(e))}),rp.addClass(i.__background,"slider"),rp.addClass(i.__foreground,"slider-fg"),i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}var vp=(qu(yp,Kd),Vu(yp,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),yp);function yp(e,t,n){Wd(this,yp);var t=Yd(this,(yp.__proto__||Object.getPrototypeOf(yp)).call(this,e,t)),r=t;return t.__button=document.createElement("div"),t.__button.innerHTML=void 0===n?"Fire":n,rp.bind(t.__button,"click",function(e){return e.preventDefault(),r.fire(),!1}),rp.addClass(t.__button,"button"),t.domElement.appendChild(t.__button),t}var xp=(qu(bp,Kd),Vu(bp,[{key:"updateDisplay",value:function(){var t,n=Hd(this.getValue());!1!==n&&(t=!1,Nd.each(qd.COMPONENTS,function(e){if(!Nd.isUndefined(n[e])&&!Nd.isUndefined(this.__color.__state[e])&&n[e]!==this.__color.__state[e])return t=!0,{}},this),t&&Nd.extend(this.__color.__state,n)),Nd.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var e=this.__color.v<.5||.5<this.__color.s?255:0,r=255-e;Nd.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Mp(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Nd.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),bp);function bp(e,t){Wd(this,bp);var n=Yd(this,(bp.__proto__||Object.getPrototypeOf(bp)).call(this,e,t));n.__color=new qd(n.getValue()),n.__temp=new qd(0);var r=n;n.domElement=document.createElement("div"),rp.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",rp.bind(n.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),rp.bind(n.__input,"blur",l),rp.bind(n.__selector,"mousedown",function(){rp.addClass(this,"drag").bind(window,"mouseup",function(){rp.removeClass(r.__selector,"drag")})}),rp.bind(n.__selector,"touchstart",function(){rp.addClass(this,"drag").bind(window,"touchend",function(){rp.removeClass(r.__selector,"drag")})});e=document.createElement("div");function i(e){u(e),rp.bind(window,"mousemove",u),rp.bind(window,"touchmove",u),rp.bind(window,"mouseup",o),rp.bind(window,"touchend",o)}function a(e){h(e),rp.bind(window,"mousemove",h),rp.bind(window,"touchmove",h),rp.bind(window,"mouseup",s),rp.bind(window,"touchend",s)}function o(){rp.unbind(window,"mousemove",u),rp.unbind(window,"touchmove",u),rp.unbind(window,"mouseup",o),rp.unbind(window,"touchend",o),c()}function s(){rp.unbind(window,"mousemove",h),rp.unbind(window,"touchmove",h),rp.unbind(window,"mouseup",s),rp.unbind(window,"touchend",s),c()}function l(){var e=Hd(this.value);!1!==e?(r.__color.__state=e,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function c(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=r.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,e=n.clientX,n=n.clientY,e=(e-t.left)/(t.right-t.left),t=1-(n-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),1<e?e=1:e<0&&(e=0),r.__color.v=t,r.__color.s=e,r.setValue(r.__color.toOriginal()),!1}function h(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=r.__hue_field.getBoundingClientRect(),t=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<t?t=1:t<0&&(t=0),r.__color.h=360*t,r.setValue(r.__color.toOriginal()),!1}return Nd.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Nd.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Nd.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Nd.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Nd.extend(e.style,{width:"100%",height:"100%",background:"none"}),Mp(e,"top","rgba(0,0,0,0)","#000"),Nd.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(t=n.__hue_field).style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",Nd.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),rp.bind(n.__saturation_field,"mousedown",i),rp.bind(n.__saturation_field,"touchstart",i),rp.bind(n.__field_knob,"mousedown",i),rp.bind(n.__field_knob,"touchstart",i),rp.bind(n.__hue_field,"mousedown",a),rp.bind(n.__hue_field,"touchstart",a),n.__saturation_field.appendChild(e),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}var _p=["-moz-","-o-","-webkit-","-ms-",""];function Mp(t,n,r,i){t.style.background="",Nd.each(_p,function(e){t.style.cssText+="background: "+e+"linear-gradient("+n+", "+r+" 0%, "+i+" 100%); "})}var qu=function(e,t){var n=t||document,t=document.createElement("style");t.type="text/css",t.innerHTML=e;n=n.getElementsByTagName("head")[0];try{n.appendChild(t)}catch(e){}},wp=function(e,t){var n=e[t];return Nd.isArray(arguments[2])||Nd.isObject(arguments[2])?new op(e,t,arguments[2]):Nd.isNumber(n)?Nd.isNumber(arguments[2])&&Nd.isNumber(arguments[3])?Nd.isNumber(arguments[4])?new mp(e,t,arguments[2],arguments[3],arguments[4]):new mp(e,t,arguments[2],arguments[3]):Nd.isNumber(arguments[4])?new dp(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new dp(e,t,{min:arguments[2],max:arguments[3]}):Nd.isString(n)?new lp(e,t):Nd.isFunction(n)?new vp(e,t,""):Nd.isBoolean(n)?new ip(e,t):null};var Tp=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},Sp=(Vu(Ep,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Nd.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",rp.unbind(t.domElement,"webkitTransitionEnd",e),rp.unbind(t.domElement,"transitionend",e),rp.unbind(t.domElement,"oTransitionEnd",e)}var t=this;rp.bind(this.domElement,"webkitTransitionEnd",e),rp.bind(this.domElement,"transitionend",e),rp.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-rp.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-rp.getHeight(this.domElement)/2+"px"}}]),Ep);function Ep(){Wd(this,Ep),this.backgroundElement=document.createElement("div"),Nd.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),rp.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Nd.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;rp.bind(this.backgroundElement,"click",function(){e.hide()})}qu(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Ap="Default",Cp=function(){try{return!!window.localStorage}catch(e){return!1}}(),Pp=void 0,Lp=!0,Op=void 0,Ip=!1,Rp=[],Fp=function t(e){var n=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),rp.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=Nd.defaults(r,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),r=Nd.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),Nd.isUndefined(r.load)?r.load={preset:Ap}:r.preset&&(r.load.preset=r.preset),Nd.isUndefined(r.parent)&&r.hideable&&Rp.push(this),r.resizable=Nd.isUndefined(r.parent)&&r.resizable,r.autoPlace&&Nd.isUndefined(r.scrollable)&&(r.scrollable=!0);var i,a,o,s,l=Cp&&"true"===localStorage.getItem(zp(0,"isLocal")),c=void 0,u=void 0;function h(e){return e.preventDefault(),a.width+=o-e.clientX,a.onResize(),o=e.clientX,!1}function d(){rp.removeClass(a.__closeButton,Fp.CLASS_DRAG),rp.unbind(window,"mousemove",h),rp.unbind(window,"mouseup",d)}function p(e){return e.preventDefault(),o=e.clientX,rp.addClass(a.__closeButton,Fp.CLASS_DRAG),rp.bind(window,"mousemove",h),rp.bind(window,"mouseup",d),!1}Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return(n.parent?n.getRoot():r.load).preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,jp(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,u&&(u.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(e){r.closed=e,r.closed?rp.addClass(n.__ul,t.CLASS_CLOSED):rp.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return l},set:function(e){Cp&&((l=e)?rp.bind(window,"unload",c):rp.unbind(window,"unload",c),localStorage.setItem(zp(0,"isLocal"),e))}}}),Nd.isUndefined(r.parent)?(this.closed=r.closed||!1,rp.addClass(this.domElement,t.CLASS_MAIN),rp.makeSelectable(this.domElement,!1),Cp&&l&&(n.useLocalStorage=!0,(i=localStorage.getItem(zp(0,"gui")))&&(r.load=JSON.parse(i))),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,rp.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),r.closeOnTop?(rp.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(rp.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),rp.bind(this.__closeButton,"click",function(){n.closed=!n.closed})):(void 0===r.closed&&(r.closed=!0),i=document.createTextNode(r.name),rp.addClass(i,"controller-name"),u=Np(n,i),rp.addClass(this.__ul,t.CLASS_CLOSED),rp.addClass(u,"title"),rp.bind(u,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),r.closed||(this.closed=!1)),r.autoPlace&&(Nd.isUndefined(r.parent)&&(Lp&&(Op=document.createElement("div"),rp.addClass(Op,"dg"),rp.addClass(Op,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Op),Lp=!1),Op.appendChild(this.domElement),rp.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||jp(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},rp.bind(window,"resize",this.__resizeHandler),rp.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),rp.bind(this.__ul,"transitionend",this.__resizeHandler),rp.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&(o=void 0,(a=this).__resize_handle=document.createElement("div"),Nd.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),rp.bind(a.__resize_handle,"mousedown",p),rp.bind(a.__closeButton,"mousedown",p),a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)),this.saveToLocalStorageIfPossible=c=function(){Cp&&"true"===localStorage.getItem(zp(0,"isLocal"))&&localStorage.setItem(zp(0,"gui"),JSON.stringify(n.getSaveObject()))},r.parent||((s=n.getRoot()).width+=1,Nd.defer(function(){--s.width}))};function Np(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function Dp(e){rp.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&rp.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function kp(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function Up(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(n.__rememberedObjectIndecesToControllers[r]=i={}),i[t.property]=t,n.load&&n.load.remembered){i=n.load.remembered,n=void 0;if(i[e.preset])n=i[e.preset];else{if(!i[Ap])return;n=i[Ap]}n[r]&&void 0!==n[r][t.property]&&(r=n[r][t.property],t.initialValue=r,t.setValue(r))}}}function Bp(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;i=r.color?new xp(t,n):(a=[t,n].concat(r.factoryArgs),wp.apply(e,a)),r.before instanceof Kd&&(r.before=r.before.__li),Up(e,i),rp.addClass(i.domElement,"c");n=document.createElement("span");rp.addClass(n,"property-name"),n.innerHTML=i.property;var a=document.createElement("div");a.appendChild(n),a.appendChild(i.domElement);var o,s,l,c,r=Np(e,a,r.before);return rp.addClass(r,Fp.CLASS_CONTROLLER_ROW),i instanceof xp?rp.addClass(r,"color"):rp.addClass(r,jd(i.getValue())),o=e,s=r,(l=i).__li=s,l.__gui=o,Nd.extend(l,{options:function(e){if(1<arguments.length){var t=l.__li.nextElementSibling;return l.remove(),Bp(o,l.object,l.property,{before:t,factoryArgs:[Nd.toArray(arguments)]})}if(Nd.isArray(e)||Nd.isObject(e)){t=l.__li.nextElementSibling;return l.remove(),Bp(o,l.object,l.property,{before:t,factoryArgs:[e]})}},name:function(e){return l.__li.firstElementChild.firstElementChild.innerHTML=e,l},listen:function(){return l.__gui.listen(l),l},remove:function(){return l.__gui.remove(l),l}}),l instanceof mp?(c=new dp(l.object,l.property,{min:l.__min,max:l.__max,step:l.__step}),Nd.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=l[e],n=c[e];l[e]=c[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(c,e),t.apply(l,e)}}),rp.addClass(s,"has-slider"),l.domElement.insertBefore(c.domElement,l.domElement.firstElementChild)):l instanceof dp?(r=function(e){if(Nd.isNumber(l.__min)&&Nd.isNumber(l.__max)){var t=l.__li.firstElementChild.firstElementChild.innerHTML,n=-1<l.__gui.__listening.indexOf(l);l.remove();var r=Bp(o,l.object,l.property,{before:l.__li.nextElementSibling,factoryArgs:[l.__min,l.__max,l.__step]});return r.name(t),n&&r.listen(),r}return e},l.min=Nd.compose(r,l.min),l.max=Nd.compose(r,l.max)):l instanceof ip?(rp.bind(s,"click",function(){rp.fakeEvent(l.__checkbox,"click")}),rp.bind(l.__checkbox,"click",function(e){e.stopPropagation()})):l instanceof vp?(rp.bind(s,"click",function(){rp.fakeEvent(l.__button,"click")}),rp.bind(s,"mouseover",function(){rp.addClass(l.__button,"hover")}),rp.bind(s,"mouseout",function(){rp.removeClass(l.__button,"hover")})):l instanceof xp&&(rp.addClass(s,"color"),l.updateDisplay=Nd.compose(function(e){return s.style.borderLeftColor=l.__color.toString(),e},l.updateDisplay),l.updateDisplay()),l.setValue=Nd.compose(function(e){return o.getRoot().__preset_select&&l.isModified()&&kp(o.getRoot(),!0),e},l.setValue),e.__controllers.push(i),i}function zp(e,t){return document.location.href+"."+t}function Hp(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function Gp(e,t){t.style.display=e.useLocalStorage?"block":"none"}function jp(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function Wp(i,a){var o={};return Nd.each(i.__rememberedObjects,function(e,t){var n={},r=i.__rememberedObjectIndecesToControllers[t];Nd.each(r,function(e,t){n[t]=a?e.initialValue:e.getValue()}),o[t]=n}),o}Fp.toggleHide=function(){Ip=!Ip,Nd.each(Rp,function(e){e.domElement.style.display=Ip?"none":""})},Fp.CLASS_AUTO_PLACE="a",Fp.CLASS_AUTO_PLACE_CONTAINER="ac",Fp.CLASS_MAIN="main",Fp.CLASS_CONTROLLER_ROW="cr",Fp.CLASS_TOO_TALL="taller-than-window",Fp.CLASS_CLOSED="closed",Fp.CLASS_CLOSE_BUTTON="close-button",Fp.CLASS_CLOSE_TOP="close-top",Fp.CLASS_CLOSE_BOTTOM="close-bottom",Fp.CLASS_DRAG="drag",Fp.DEFAULT_WIDTH=245,Fp.TEXT_CLOSED="Close Controls",Fp.TEXT_OPEN="Open Controls",Fp._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Fp.toggleHide()},rp.bind(window,"keydown",Fp._keydownHandler,!1),Nd.extend(Fp.prototype,{add:function(e,t){return Bp(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Bp(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Nd.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Op.removeChild(this.domElement);var t=this;Nd.each(this.__folders,function(e){t.removeFolder(e)}),rp.unbind(window,"keydown",Fp._keydownHandler,!1),Dp(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);t=new Fp(t);this.__folders[e]=t;e=Np(this,t.domElement);return rp.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Dp(t);var e=this;Nd.each(t.__folders,function(e){t.removeFolder(e)}),Nd.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,n=this.getRoot();n.scrollable&&(e=rp.getOffset(n.__ul).top,t=0,Nd.each(n.__ul.childNodes,function(e){n.autoPlace&&e===n.__save_row||(t+=rp.getHeight(e))}),window.innerHeight-e-20<t?(rp.addClass(n.domElement,Fp.CLASS_TOO_TALL),n.__ul.style.height=window.innerHeight-e-20+"px"):(rp.removeClass(n.domElement,Fp.CLASS_TOO_TALL),n.__ul.style.height="auto")),n.__resize_handle&&Nd.defer(function(){n.__resize_handle.style.height=n.__ul.offsetHeight+"px"}),n.__closeButton&&(n.__closeButton.style.width=n.width+"px")},onResizeDebounced:Nd.debounce(function(){this.onResize()},50),remember:function(){if(Nd.isUndefined(Pp)&&((Pp=new Sp).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;Nd.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(n){var e=n.__save_row=document.createElement("li");rp.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),rp.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",rp.addClass(t,"button gears");var r=document.createElement("span");r.innerHTML="Save",rp.addClass(r,"button"),rp.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",rp.addClass(i,"button"),rp.addClass(i,"save-as");var a=document.createElement("span");a.innerHTML="Revert",rp.addClass(a,"button"),rp.addClass(a,"revert");var o=n.__preset_select=document.createElement("select");n.load&&n.load.remembered?Nd.each(n.load.remembered,function(e,t){Hp(n,t,t===n.preset)}):Hp(n,Ap,!1);{var s;rp.bind(o,"change",function(){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].innerHTML=n.__preset_select[e].value;n.preset=this.value}),e.appendChild(o),e.appendChild(t),e.appendChild(r),e.appendChild(i),e.appendChild(a),Cp&&(s=document.getElementById("dg-local-explain"),e=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(zp(0,"isLocal"))&&e.setAttribute("checked","checked"),Gp(n,s),rp.bind(e,"change",function(){n.useLocalStorage=!n.useLocalStorage,Gp(n,s)}))}var l=document.getElementById("dg-new-constructor");rp.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Pp.hide()}),rp.bind(t,"click",function(){l.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),Pp.show(),l.focus(),l.select()}),rp.bind(r,"click",function(){n.save()}),rp.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&n.saveAs(e)}),rp.bind(a,"click",function(){n.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&jp(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var n=this.load;return n.closed=this.closed,0<this.__rememberedObjects.length&&(n.preset=this.preset,n.remembered||(n.remembered={}),n.remembered[this.preset]=Wp(this)),n.folders={},Nd.each(this.__folders,function(e,t){n.folders[t]=e.getSaveObject()}),n},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Wp(this),kp(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Ap]=Wp(this,!0)),this.load.remembered[e]=Wp(this),this.preset=e,Hp(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){Nd.each(this.__controllers,function(e){this.getRoot().load.remembered?Up(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),Nd.each(this.__folders,function(e){e.revert(e)}),t||kp(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&Tp.call(window,function(){e(t)});Nd.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){Nd.each(this.__controllers,function(e){e.updateDisplay()}),Nd.each(this.__folders,function(e){e.updateDisplay()})}});function Vp(){var n=0,r=document.createElement("div");function e(e){return r.appendChild(e.dom),e}function t(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";n=e}r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(e){e.preventDefault(),t(++n%r.children.length)},!1);var i,a=(performance||Date).now(),o=a,s=0,l=e(new Vp.Panel("FPS","#0ff","#002")),c=e(new Vp.Panel("MS","#0f0","#020"));return self.performance&&self.performance.memory&&(i=e(new Vp.Panel("MB","#f08","#201"))),t(0),{REVISION:16,dom:r,addPanel:e,showPanel:t,begin:function(){a=(performance||Date).now()},end:function(){s++;var e,t=(performance||Date).now();return c.update(t-a,200),o+1e3<=t&&(l.update(1e3*s/(t-o),100),o=t,s=0,i&&(e=performance.memory,i.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576))),t},update:function(){a=this.end()},domElement:r,setMode:t}}var Xp=Fp;Vp.Panel=function(n,r,i){var a=1/0,o=0,s=Math.round,l=s(window.devicePixelRatio||1),c=80*l,e=48*l,u=3*l,h=2*l,d=3*l,p=15*l,f=74*l,m=30*l,g=document.createElement("canvas");g.width=c,g.height=e,g.style.cssText="width:80px;height:48px";var v=g.getContext("2d");return v.font="bold "+9*l+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=i,v.fillRect(0,0,c,e),v.fillStyle=r,v.fillText(n,u,h),v.fillRect(d,p,f,m),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(d,p,f,m),{dom:g,update:function(e,t){a=Math.min(a,e),o=Math.max(o,e),v.fillStyle=i,v.globalAlpha=1,v.fillRect(0,0,c,p),v.fillStyle=r,v.fillText(s(e)+" "+n+" ("+s(a)+"-"+s(o)+")",u,h),v.drawImage(g,d+l,p,f-l,m,d,p,f-l,m),v.fillRect(d+f-l,p,l,m),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(d+f-l,p,l,s((1-e/t)*m))}}};function Yp(){ud.call(this),this.shader=qp,this.uniforms=gi.clone(this.shader.uniforms),this.uniforms._BilaterFilterFactor.value=.86,this.textureComp=new $t(window.innerWidth,window.innerHeight,{minFilter:Ae,magFilter:Te,format:Ge}),this.textureResult=new $t(window.innerWidth,window.innerHeight,{minFilter:Ae,magFilter:Te,format:Ge}),this.shaderMaterial=new xi({uniforms:this.uniforms,vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader}),this.compFsQuad=new ud.FullScreenQuad(this.shaderMaterial);var e=new br;this.copyFsQuad=new ud.FullScreenQuad(e)}var qp={uniforms:{_MainTex:{value:null},_MainTex_TexelSize:{value:new Ht},_BlurRadius:{value:new Kt},_BilaterFilterFactor:{value:.5}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D _MainTex;","uniform vec2 _MainTex_TexelSize;","uniform vec4 _BlurRadius;","uniform float _BilaterFilterFactor;","float CompareColor(vec4 col1, vec4 col2)","{","float l1 = 0.2126729 * col1.r + 0.7151522 * col1.g + 0.0721750 * col1.b;","float l2 = 0.2126729 * col2.r + 0.7151522 * col2.g + 0.0721750 * col2.b;","return smoothstep(_BilaterFilterFactor, 1.0, 1.0 - abs(l1 - l2));","}","void main() {","vec2 delta = _MainTex_TexelSize.xy * _BlurRadius.xy;","vec4 col = texture2D(_MainTex, vUv);","vec4 col0a = texture2D(_MainTex, vUv - delta);","vec4 col0b = texture2D(_MainTex, vUv + delta);","vec4 col1a = texture2D(_MainTex, vUv - 2.0 * delta);","vec4 col1b = texture2D(_MainTex, vUv + 2.0 * delta);","vec4 col2a = texture2D(_MainTex, vUv - 3.0 * delta);","vec4 col2b = texture2D(_MainTex, vUv + 3.0 * delta);","float w = 0.37004405286;","float w0a = CompareColor(col, col0a) * 0.31718061674;","float w0b = CompareColor(col, col0b) * 0.31718061674;","float w1a = CompareColor(col, col1a) * 0.19823788546;","float w1b = CompareColor(col, col1b) * 0.19823788546;","float w2a = CompareColor(col, col2a) * 0.11453744493;","float w2b = CompareColor(col, col2b) * 0.11453744493;","vec3 result;","result = w * col.rgb;","result += w0a * col0a.rgb;","result += w0b * col0b.rgb;","result += w1a * col1a.rgb;","result += w1b * col1b.rgb;","result += w2a * col2a.rgb;","result += w2b * col2b.rgb;","result /= w + w0a + w0b + w1a + w1b + w2a + w2b;","gl_FragColor = vec4(result, 1.0);","}"].join("\n")};Yp.prototype=Object.assign(Object.create(ud.prototype),{constructor:Yp,render:function(e,t,n){this.uniforms._BilaterFilterFactor.value=.86,this.uniforms._MainTex_TexelSize.value=new Ht(1/window.innerWidth,1/window.innerHeight),this.uniforms._MainTex.value=n.texture,this.uniforms._BlurRadius.value=new Kt(2.5,0,0,0),e.setRenderTarget(this.textureComp),this.compFsQuad.render(e),this.uniforms._MainTex.value=this.textureComp.texture,this.uniforms._BlurRadius.value=new Kt(0,2.5,0,0),e.setRenderTarget(this.textureResult),this.compFsQuad.render(e),this.copyFsQuad.material.map=this.textureResult.texture,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.copyFsQuad.render(e)},setSize:function(e,t){this.textureComp.setSize(e,t),this.textureResult.setSize(e,t)}});function Qp(a,e,t){this.enabled=!0,this.domElement=void 0!==e?e:document,this.enableDamping=!1,this.styleType=1;var o,i,s=this,n=!1,l=new Vt(0,0,1),c=new Vt(0,0,1),r=window.innerWidth/2,u=window.innerHeight/2,h=3,d=50,p={x:0,y:0},f=0,m=0,g={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},v=g.NONE,y=0,x=.02,b=0,_=5;function M(e){!1!==s.enabled&&(void 0!==i&&(new Date).getTime()-i.getTime()>d&&(f=e.x-p.x,m=e.y-p.y),n=!1,s.domElement.removeEventListener("mousemove",T,!1),s.domElement.removeEventListener("mouseup",w,!1),s.domElement.removeEventListener("mouseout",M,!1))}function w(e){!1!==s.enabled&&(void 0!==i&&(new Date).getTime()-i.getTime()>d&&(f=e.x-p.x,m=e.y-p.y),n=!1,s.domElement.removeEventListener("mousemove",T,!1),s.domElement.removeEventListener("mouseup",w,!1),s.domElement.removeEventListener("mouseout",M,!1))}function T(e){!1!==s.enabled&&(e.preventDefault(),v===g.ROTATE&&(f=e.x-p.x,m=e.y-p.y,A(),p.x=e.x,p.y=e.y,i=new Date))}function S(e,t){var n=new THREE.Vector3;n.set(E(e/r,-1,1),E(-t/u,-1,1),0);t=n.length();return 1<t?n.normalize():n.z=Math.sqrt(1-t*t),n}function E(e,t,n){return Math.min(Math.max(e,t),n)}s.domElement.addEventListener("contextmenu",function(e){!1!==s.enabled&&e.preventDefault()},!1),s.domElement.addEventListener("mousedown",function(e){!1!==s.enabled&&(e.preventDefault(),(s.domElement.focus?s.domElement:window).focus(),s.domElement.addEventListener("mousemove",T,!1),s.domElement.addEventListener("mouseup",w,!1),s.domElement.addEventListener("mouseout",M,!1),n=!0,0===e.button?(v=g.ROTATE,p={x:e.clientX,y:e.clientY},l=c=S(0,0)):2===e.button&&(v=g.PAN))},!1),s.domElement.addEventListener("wheel",function(e){var t;!1!==s.enabled&&(e.preventDefault(),e.deltaY<0&&((t=a.scale.clone()).x+=5,t.y+=5,t.z+=5,t.x<300&&a.scale.set(t.x,t.y,t.z)),0<e.deltaY&&((e=a.scale.clone()).x-=5,e.y-=5,e.z-=5,20<e.x&&a.scale.set(e.x,e.y,e.z)))},!1),s.domElement.addEventListener("touchstart",function(e){var t,n;!1!==s.enabled&&(e.preventDefault(),1===e.touches.length?(p={x:e.touches[0].pageX,y:e.touches[0].pageY},l=c=S(0,0)):2===e.touches.length&&(t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,b=Math.sqrt(t*t+n*n),y=Math.atan2(e.touches[0].pageY-e.touches[1].pageY,e.touches[0].pageX-e.touches[1].pageX)))},!1),s.domElement.addEventListener("touchend",function(e){0<e.touches.length&&(p={x:e.touches[0].pageX,y:e.touches[0].pageY})},!1),s.domElement.addEventListener("touchmove",function(e){var t,n,r;!1!==s.enabled&&(e.preventDefault(),1===e.touches.length?(f=e.touches[0].pageX-p.x,m=e.touches[0].pageY-p.y,A(),p.x=e.touches[0].pageX,p.y=e.touches[0].pageY,i=new Date):2===e.touches.length&&(r=e.touches[0].pageX-e.touches[1].pageX,t=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(r*r+t*t),t=r-b,2<Math.abs(t)&&(b<r?((n=a.scale.clone()).x+=_,n.y+=_,n.z+=_,n.x<300&&a.scale.set(n.x,n.y,n.z)):((n=a.scale.clone()).x-=_,n.y-=_,n.z-=_,20<n.x&&a.scale.set(n.x,n.y,n.z))),b=r,r=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,e=Math.atan2(e,r),(r=180/Math.PI*(e-y))<-180?r+=360:180<r&&(r=360-r),1===s.styleType?a.rotateZ(-r*x):3!==s.styleType&&7!==s.styleType||a.rotateY(r*x),y=e))},!1);var A=function(){c=S(f,m);var e,t,n,r,i,r=(e=l,t=c,n=new THREE.Vector3,r=new THREE.Quaternion,(i=Math.acos(e.dot(t)/e.length()/t.length()))&&(n.crossVectors(e,t).normalize(),r.setFromAxisAngle(n,i*=h)),r);(o=a.quaternion).multiplyQuaternions(r,o),o.normalize(),a.setRotationFromQuaternion(o),c=l};this.update=function(){!n&&s.enableDamping&&(f<-.05||.05<f?f*=.95:f=0,m<-.05||.05<m?m*=.95:m=0,A())}}(Qp.prototype=Object.create(kt.prototype)).constructor=Qp;function Zp(a,o,s){var l=new Ci,c=new ih,u=new Ht,h=new Vt,d=new Vt,p=new Vt,f=new cn,m=null,n=null,g=this;function e(){s.addEventListener("mousemove",r,!1),s.addEventListener("mousedown",i,!1),s.addEventListener("mouseup",v,!1),s.addEventListener("mouseleave",v,!1),s.addEventListener("touchmove",y,!1),s.addEventListener("touchstart",x,!1),s.addEventListener("touchend",b,!1)}function t(){s.removeEventListener("mousemove",r,!1),s.removeEventListener("mousedown",i,!1),s.removeEventListener("mouseup",v,!1),s.removeEventListener("mouseleave",v,!1),s.removeEventListener("touchmove",y,!1),s.removeEventListener("touchstart",x,!1),s.removeEventListener("touchend",b,!1)}function r(e){if(e.preventDefault(),!1!==g.enabled){var t=s.getBoundingClientRect();if(u.x=(e.clientX-t.left)/t.width*2-1,u.y=2*-((e.clientY-t.top)/t.height)+1,c.setFromCamera(u,o),m&&g.enabled)return c.ray.intersectPlane(l,d)&&m.position.copy(d.sub(h).applyMatrix4(f)),void g.dispatchEvent({type:"drag",object:m});c.setFromCamera(u,o),c.intersectObjects(a,!0);t=a[0];l.setFromNormalAndCoplanarPoint(o.getWorldDirection(l.normal),p.setFromMatrixPosition(t.matrixWorld)),n!==t&&(g.dispatchEvent({type:"hoveron",object:t}),n=t)}}function i(e){e.preventDefault(),!1!==g.enabled&&2===e.button&&(c.setFromCamera(u,o),c.intersectObjects(a,!0),m=a[0],c.ray.intersectPlane(l,d)&&(f.getInverse(m.parent.matrixWorld),h.copy(d).sub(p.setFromMatrixPosition(m.matrixWorld))),s.style.cursor="move",g.dispatchEvent({type:"dragstart",object:m}))}function v(e){e.preventDefault(),!1!==g.enabled&&(m&&(g.dispatchEvent({type:"dragend",object:m}),m=null),s.style.cursor=n?"pointer":"auto")}function y(e){var t,n,r,i;e.preventDefault(),!1!==g.enabled&&2===e.touches.length&&(i=s.getBoundingClientRect(),t=(e.touches[0].clientX-i.left)/i.width*2-1,n=2*-((e.touches[0].clientY-i.top)/i.height)+1,r=(e.touches[1].clientX-i.left)/i.width*2-1,i=2*-((e.touches[1].clientY-i.top)/i.height)+1,u.x=(t+r)/2,u.y=(n+i)/2,c.setFromCamera(u,o),m&&g.enabled&&(c.ray.intersectPlane(l,d)&&m.position.copy(d.sub(h).applyMatrix4(f)),g.dispatchEvent({type:"drag",object:m})))}function x(e){var t,n,r,i;e.preventDefault(),!1!==g.enabled&&2===e.touches.length&&(i=s.getBoundingClientRect(),t=(e.touches[0].clientX-i.left)/i.width*2-1,n=2*-((e.touches[0].clientY-i.top)/i.height)+1,r=(e.touches[1].clientX-i.left)/i.width*2-1,i=2*-((e.touches[1].clientY-i.top)/i.height)+1,u.x=(t+r)/2,u.y=(n+i)/2,c.setFromCamera(u,o),c.intersectObjects(a,!0),m=a[0],l.setFromNormalAndCoplanarPoint(o.getWorldDirection(l.normal),p.setFromMatrixPosition(m.matrixWorld)),c.ray.intersectPlane(l,d)&&(f.getInverse(m.parent.matrixWorld),h.copy(d).sub(p.setFromMatrixPosition(m.matrixWorld))),s.style.cursor="move",g.dispatchEvent({type:"dragstart",object:m}))}function b(e){e.preventDefault(),!1!==g.enabled&&(m&&(g.dispatchEvent({type:"dragend",object:m}),m=null),s.style.cursor="auto")}e(),this.enabled=!0,this.activate=e,this.deactivate=t,this.dispose=function(){t()}}(Zp.prototype=Object.create(kt.prototype)).constructor=Zp;qu=function(){this._tweens={},this._tweensAddedDuringUpdate={}};qu.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(e=void 0!==e?e:Kp.now();0<n.length;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]];i&&!1===i.update(e)&&(i._isPlaying=!1,t||delete this._tweens[n[r]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var Jp,Kp=new qu;Kp.Group=qu,Kp._nextId=0,Kp.nextId=function(){return Kp._nextId++},"undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?Kp.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?Kp.now=self.performance.now.bind(self.performance):void 0!==Date.now?Kp.now=Date.now:Kp.now=function(){return(new Date).getTime()},Kp.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=Kp.Easing.Linear.None,this._interpolationFunction=Kp.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||Kp,this._id=Kp.nextId()},Kp.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?Kp.now()+parseFloat(e):e:Kp.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying&&(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens()),this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,n,r,i,a,o;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=0===this._duration||1<n?1:n,r=this._easingFunction(n),this._valuesEnd)void 0!==this._valuesStart[t]&&(i=this._valuesStart[t]||0,(a=this._valuesEnd[t])instanceof Array?this._object[t]=this._interpolationFunction(a,r):"number"==typeof(a="string"==typeof a?"+"===a.charAt(0)||"-"===a.charAt(0)?i+parseFloat(a):parseFloat(a):a)&&(this._object[t]=i+(a-i)*r));if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1!==n)return!0;if(0<this._repeat){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)"string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo&&(o=this._valuesStartRepeat[t],this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o),this._valuesStart[t]=this._valuesStartRepeat[t];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}},Kp.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((1+t)*e-t)*.5:.5*((e-=2)*e*((1+t)*e+t)+2)}},Bounce:{In:function(e){return 1-Kp.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*Kp.Easing.Bounce.In(2*e):.5*Kp.Easing.Bounce.Out(2*e-1)+.5}}},Kp.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=Kp.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],r):1<t?a(e[n],e[n-1],n-r):a(e[i],e[n<i+1?n:i+1],r-i)},Bezier:function(e,t){for(var n=0,r=e.length-1,i=Math.pow,a=Kp.Interpolation.Utils.Bernstein,o=0;o<=r;o++)n+=i(1-t,r-o)*i(t,o)*e[o]*a(r,o);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=Kp.Interpolation.Utils.CatmullRom;return e[0]===e[n]?a(e[((i=t<0?Math.floor(r=n*(1+t)):i)-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):1<t?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=Kp.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(Jp=[1],function(e){var t=1;if(Jp[e])return Jp[e];for(var n=e;1<n;n--)t*=n;return Jp[e]=t}),CatmullRom:function(e,t,n,r,i){var a=.5*(n-e),e=.5*(r-t),r=i*i;return i*r*(2*t-2*n+a+e)+(-3*t+3*n-2*a-e)*r+a*i+t}}},qu=void 0,"function"==typeof define&&define.amd?define([],function(){return Kp}):"undefined"!=typeof module&&"object"==(void 0===e?"undefined":W(e))?module.exports=Kp:void 0!==qu&&(qu.TWEEN=Kp);var $p=function(){this.enabled=!0;var e,t,n,r=navigator.userAgent,i=["Redmi Note 3|红米Note3|高通 骁龙650(MSM8956)|Adreno(TM)510|2G|16G|Android 5.1.1|1920x1080|1","SM-T860|Galaxy Tab S6|高通 骁龙855|Adreno(TM)640|6G|128G|Android 9|2560x1600|4"],a=-1,o=1,s=2,l=3;function c(){return null==t&&(null==e&&((e=document.createElement("canvas")).style.zIndex="-10"),t=e.getContext("experimental-webgl")),t}function u(){var e=-1<r.indexOf("Windows")?"Windows":-1<r.indexOf("Android")||-1<r.indexOf("Adr")?"Android":-1<r.indexOf("Macintosh")?"Mac OS":-1<r.indexOf("iPhone")||-1<r.indexOf("iPad")||1<r.indexOf("like Mac OS X")?"iOS":-1<r.indexOf("Windows Phone")||-1<r.indexOf("IEMobile")?"WP":"Others";return e}function h(){var e=(null==n&&(t=c().getExtension("WEBGL_debug_renderer_info"),n=null==t?"unknown":c().getParameter(t.UNMASKED_RENDERER_WEBGL)),n);if("Android"!==u())return"iOS"===u()?-1<e.indexOf("Apple GPU")?l:-1<e.indexOf("Apple A")?o:a:a;if(-1<e.indexOf("Adreno")){var t=e.split(")")[1];return parseInt(t)<520?o:530<=parseInt(t)&&parseInt(t)<600?s:600<parseInt(t)?l:a}return-1<e.indexOf("PowerVR")?-1<e.indexOf("PowerVR SGX")||-1<e.indexOf("PowerVR 6200")||-1<e.indexOf("PowerVR G")||-1<e.indexOf("PowerVR MBX")||-1<e.indexOf("PowerVR GX")?o:-1<e.indexOf("PowerVR GT")?s:-1<e.indexOf("PowerVR GE")||-1<e.indexOf("PowerVR GM")?l:void 0:-1<e.indexOf("Mali")?-1<e.indexOf("Mali-400")||-1<e.indexOf("Mali-450")||-1<e.indexOf("Mali-T760")||-1<e.indexOf("Mali-T720")||-1<e.indexOf("Mali-T604")||-1<e.indexOf("Mali-T624")||-1<e.indexOf("Mali-T628")?o:-1<e.indexOf("Mali-T830")||-1<e.indexOf("Mali-T860")||-1<e.indexOf("Mali-T880")?s:-1<e.indexOf("Mali-T820")||-1<e.indexOf("PowerVR G")?l:void 0:-1<e.indexOf("Vivante")||-1<e.indexOf("GeForce")?o:a}this.deviceLevel=function(){if("Windows"===u()||"Mac OS"===u())return l;if("iOS"===u())return h();if("Android"!==u())return a;for(var e=function(){var e=r.substring(r.indexOf("(")+1,r.indexOf(")"));if(3<=e.split(";").length){var t=e.split(";")[2];return-1<t.indexOf("Build/")?t.substring(0,t.indexOf("Build/")):t}return e}(),t=0;t<i.length;t++){var n=i[t].split("|");if(-1<e.indexOf(n[0])&&9<=n.length)return n[8]}return h()},this.getOS=u};$p.prototype=Object.create(kt.prototype),$p.prototype.constructor=$p;var ef={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","\tgl_FragColor = sum;","}"].join("\n")},tf={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","\tgl_FragColor = sum;","}"].join("\n")},nf=nf||{},rf=rf||{},af=function(){function h(e,t,n,r,i,a){d(this,h);var o=this;this.hdrUrl=r+"WebHdrs/";var s,l=r+"NormalFiles/",c=r+"BaseMapFiles/",r=i?(s=r+"GlbModels/",r+"design"):(s=r+"PartRes/Glb/",r+"PartRes/shadowImg/");this.divWidth=1920,this.divHeight=1080,this.windowHalfX=0,this.windowHalfY=0,this.domToTop=0,this.domToLeft=0,this.glbUrl="",this.pluginBaseUrl="",this.shadowImgUrl="",this.ctElementId=0,this.MapDictionary=new Map,this.shadowBaker=null,this.renderTargetShadow=null,this.brightnessValue=.1,this.bPartCaputre=!1,this.bStopRender=!1,window.isFrontCamera=!0,this.isFlip=!0,this.varPartInfo,this.partType={Unknown:0,RingArm:1,FlowerHead:2},this.curPartType=this.partType.RingArm,this.bIsPart=!1,this.ringArmFactor=.7,this.flowerCamPos=new Vt(0,90,0),this.flowerHeadScale=1500,this.flowerHeadDiameter=12.68,this.shadowScale,this.shadowPos,this.bLoadNormalMapFinished=!1,this.shakeAimationInterval=null,this.curShakeAngle=0,this.bDefaultHDRLoaded=!1,this.bCabochonHdrsLoaded=!1,this.bStartLoadingCabochon=!1,this.container=null,this.stats=null,this.isMouseDown=!1,this.composer=null,this.dpr=null,this.effectFXAA=null,this.renderScene=null,this.loopAnimation=null,this.camera=null,this.scene=null,this.renderer=null,this.controls=null,this.arcball=null,this.dragControls=null,this.loading=null,this.fontLoading=null,this.fontLoadingState=!1,this.defaultCamereFov=10,this.designLoader=null,this.objects=[],this.zoomMask=null,this.contrastComposer=null,this.contrastPass=null,this.ssaoComposer=null,this.ssaoPass=null,this.effectSSAO=null,this.loadState={UnLoad:0,Loading:1,Loaded:2},this.loadModelState=this.loadState.UnLoad,this.bgRenderer=null,this.backgroundCamera=null,this.sceneBackground=null,this.takeRender=null,this.bgRingComposer=null,this.bgNecklaceComposer=null,this.bgEarringComposer=null,this.bgWatchComposer=null,this.bgGlassComposer=null,this.bBraceletComposer=null,this.saveRingBgPass=null,this.saveNecklaceBgPass=null,this.saveEarringBgPass=null,this.saveWatchBgPass=null,this.saveGlassBgPass=null,this.ringRenderTarget=null,this.necklaceRenderTarget=null,this.earringRenderTarget=null,this.watchRenderTarget=null,this.glassRenderTarget=null,this.braceletRenderTarget=null,this.beautyComposer=null,this.beautyPass=null,this.bEnableSparkles=!1,this.sceneSparkles=null,this.bDrawSparkle=!0,this.sparkleTexture=null,this.sparkleTexture1=null,this.noiseTexture=null,this.sparkle1=null,this.sparkle2=null,this.sparkleArray=[],this.sparkleSize=20,this.sparkleScaleArg=.8,this.sparkleNum=1,this.sparklesOfPart=new Map,this.sparkleBigScale=700,this.sparkleSmallScale=300,this.bBeauty=!1,this.bRotate=!0,this.bDecaling=!1,this.fontClass="仿宋",this.customFont=null,this.isFontReady=!1,this.fontColorScale=2,this.jiguangFontColorScale=.09,this.bContrast=!1,this.AntiAliasing=!0,this.bAllowFXAA=!1,this.canClear=!1,this.canChangeDesign=!0,this.curBackgroundColor=new pr(1,1,1),this.rootNode=new An,this.glbScene=null,this.gltfname=null,this.configParams=null,this.diamondConfiguration=[],this.diamonds=null,this.DesignInformation="",this.designLayers=null,this.params={Diamond:0,Model:1,envMap:"defMetal",MetalColor:[190,190,190],GemColor:[255,255,255],Metalness:1,Roughness:.1,ProcessMetalness:1,ProcessRoughness:.3,MetalHdrIntensity:1,MetalHdrRotate:1,normalMapUV:1,normalScale:1,repeatX:1,repeatY:1,Rotate:!0,Beauty:!0,Contrast:!1,Brightness:-.15,"Contrast Strength":.1,"Anti-Aliasing":!1,refractiveIndex:2.41,squashFactor:.9,rIndexDelta:.001,GemHdrIntensity:1,geometryFactor:.28,GemEnvMap:"defGem",CabochonEnvMap:"humian",CabochonColor:[255,148,186],CabochonMetalness:1,CabochonRoughness:0,CabochonHdrIntensity:1,background:[255,255,255],test:1,ssaoEnable:!0,mainParts:8,parts:6,Scene:0},this.matGui=null,this.bObjectLoaded=!1,this.isModelTryon=!1,this.PartInformation="",this.genCubeUrls=function(e,t){return[e+"px"+t,e+"nx"+t,e+"py"+t,e+"ny"+t,e+"pz"+t,e+"nz"+t]},this.gemHdrUrls="",this.gemHdrCubeRenderTarget=null,this.gemEnvCubeMap=null,this.gemHdrTextureLoader=new wd,this.feicuiHdrUrls="",this.feicuiHdrCubeRenderTarget=null,this.feicuiEnvCubeMap=null,this.humianHdrUrls="",this.humianHdrCubeRenderTarget=null,this.humianEnvCubeMap=null,this.gemHdrs={defGem:null},this.cabochonHdrs={defJade:null,defCabochon:null},this.metalHdrUrls="",this.metalHdrCubeRenderTarget=null,this.metalEnvCubeMap=null,this.hdrTextureLoader=new wd,this.metalHdrs={defMetal:null},this.metalHdrTextures={defMetal:null},this.textureLoader=new Sc,this.leatherMat={large_grain:null,leather_pattern:null,perforated:null,perforated_rectangle:null,small_grain:null},this.fabricMat={brushed:null,coarse_weave:null,herringbone:null,plain_coarse:null,plain_contrast:null,striped:null,suede:null,suede_coarse:null,twill_coars:null,twill_coarse_contrast:null,twill_flecked:null},this.materialType={engrave:-1,metal:0,gem:1,bakingPaint:2,glass:3,fabric:4,leather:5,paint:6,plastic:7,wood:8,enamel:9},this.userMetalMat={},this.userCabochonMat={},this.userGemMat={},this.cabochonMat={"Rose quartz":null,"Grape stone":null,Jade:null,"White jade":null,"Jade 1":null,"Ice Jadeite":null,Rhodochrosite:null,Agate:null,Turquoise:null,"Purple jade":null,"Blue amber":null},this.pearlMat={"White pearl":null,"Black pearl":null,"Gold pearl":null,"Pink Pearl":null},this.commonMat={Metal:null,MetalSandblast:null,MetalBrushed:null,Metalzuojiu:null,Metaldianhei:null,Gem:null,Cabochon:null,Pearl:null},this.userMatInfo={defMetal:null,userMetal:null,defGem:null,userGem:null},this.tryOnMode={TDShow:0,TryOn:1,Capture:2,Share:3},this.styleType={Ring:1,Necklace:2,Earring:3,Bracelet:4,Carving:5,Watch:7,Other:8,Glasses:9},this.bInitBg=!1,this.arToolkitSource=null,this.bgMesh=null,this.webCamVideo=null,this.ringCamPos=new Vt(-30,122,-30),this.ringCamPos_pc=new Vt(-20,95,-25),this.letteringCamPos=new Vt(0,50,-30),this.isRhino5=a,this.isRhino5?this.ringObjRot=new Vt(-Math.PI/2,0,Math.PI):this.ringObjRot=new Vt(0,0,0),this.necklaceCamPos=new Vt(0,0,90),this.necklaceCamPos_pc=new Vt(0,0,70),this.isRhino5?this.necklaceObjRot=new Vt(-Math.PI/2,0,0):this.necklaceObjRot=new Vt(0,0,0),this.earringCamPos=new Vt(0,0,90),this.earringCamPos_pc=new Vt(0,0,70),this.isRhino5?this.earringObjRot=new Vt(-Math.PI/2,0,0):this.earringObjRot=new Vt(0,0,0),this.watchCamPos=new Vt(0,0,90),this.watchCamPos_pc=new Vt(0,0,70),this.isRhino5?this.watchObjRot=new Vt(-Math.PI/2,0,0):this.watchObjRot=new Vt(0,0,0),this.braceletCamPos=new Vt(0,0,90),this.braceletCamPos_pc=new Vt(0,0,70),this.isRhino5?this.braceletObjRot=new Vt(-Math.PI/2,0,0):this.braceletObjRot=new Vt(0,0,0),this.glassCamPos=new Vt(0,30,150),this.glassCamPos_pc=new Vt(0,50,70),this.isRhino5?this.glassObjRot=new Vt(-Math.PI/2,0,0):this.glassObjRot=new Vt(0,0,0),this.objPosition=new Vt(0,0,0),this.objScale=600,this.tryonCamPos=new Vt(0,0,90),this.ringTryonObjRot=new Vt(0,0,0),this.ringOCMesh=null,this.watchOCMesh=null,this.braceletOCMesh=null,this.necklaceTryonObjPos=new Vt(0,-5,0),this.glassTryonObjPos=new Vt(0,-5,0),this.objTryOnScale=80,this.tryOnCache=function(){this.type=null,this.bgTex=null,this.camPos=null,this.ctrlTarget=null,this.objPos=new Vt(0,0,0),this.objRot=new Vt(0,0,0),this.objScale=new Vt(o.objTryOnScale,o.objTryOnScale,o.objTryOnScale),this.bFront=window.isFrontCamera},this.ringTryOnCache=new this.tryOnCache,this.necklaceTryOnCache=new this.tryOnCache,this.earringTryOnCache=new this.tryOnCache,this.watchTryOnCache=new this.tryOnCache,this.braceletTryOnCache=new this.tryOnCache,this.glassTryOnCache=new this.tryOnCache,this.curTryOnMode=o.tryOnMode.TDShow,this.curStyleType=o.styleType.Ring,this.modelTryonInfo={imgUrl:null,camPos:new Vt(0,0,90),ctrlTarget:new Vt(0,0,0),objPos:new Vt(0,0,0),objRot:new Gt(0,0,0,0),objScale:new Vt(o.objTryOnScale,o.objTryOnScale,o.objTryOnScale)},this.bTakePhoto=!1,this.zoomDelta=0,this.dirLight=null,this.dirGroup=null,this.ground=null,this.minY=1e4,this.maxY=-1e4,this.minZ=1e4,this.MaxZ=-1e4,this.sandblastNmTex=null,this.brushedNmTex=null,this.distressNmTex=null,this.loadingPartIds=[],this.bEdit=!1,this.hdrPath="",this.bIsVarDesign=!1,this.VarDesignInfo="",this.assemblyType={Accessories:1,MainPart:2,MultMainPart:3},this.outlinePass=null,this.mapScale=1e3,this.u3dScale=.7,this.raycaster=null,this.textCanvas=null,this.textCanvasWidth=4096,this.textCanvasHeight=512,this.defaultFontSize=480,this.intersection={intersects:!1,point:new Vt,normal:new Vt},this.imageUtils=null,this.decalMaterial=new Xl({specular:0,normalScale:new Ht(50,50),shininess:1,transparent:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-4,wireframe:!1}),this.decals=[],this.engraveLayers=[],this.EngraveLayer=function(){this.layerId="",this.parentLayerId="",this.textAlign="",this.decalMesh=null,this.curMesh=null,this.decalMaterial=null,this.text="",this.letteringType=""},this.mouseHelper=null,this.position=new Vt,this.orientation=new dn,this.size=new Vt(10,10,10),this.curNormal=null,this.ringMeshs=[],this.curMesh=null,this.baseColorScale=1.5,this.ambientLight=null,this.decalMesh=null,this.loadingMetalHdrIds=[],this.bUpdateNormalMapFinished=!0,this.bUpdateBaseMapFinished=!0,e?e+="/":e="",r&&(r+="/"),this.defaultOpenRealRenderingShadow=!0,this.bOpenRealRenderingShadow=!0,this.shadowGroup=null,this.sg_renderTarget=null,this.sg_renderTargetBlur=null,this.PLANE_WIDTH=82.5,this.PLANE_HEIGHT=82.5,this.CAMERA_HEIGHT=4,this.sg_plane=null,this.sg_blurPlane=null,this.sg_fillPlane=null,this.sg_shadowCamera=null,this.cameraHelper=null,this.depthMaterial=null,this.horizontalBlurMaterial=null,this.verticalBlurMaterial=null,this.sg_gui=null,this.sg_state={shadow:{blur:.5,darkness:5,opacity:.6},plane:{color:"#ffffff",opacity:1},showWireframe:!1},this.landmarksPerFace=30,this.lerpedFacesLandmarks=[],this.landmarkFeatures={jaw:{first:0,last:8,fillStyle:"white",closed:!1},nose:{first:15,last:18,fillStyle:"green",closed:!0},mouth:{first:27,last:30,fillStyle:"red",closed:!0},eyeL:{first:19,last:22,fillStyle:"purple",closed:!1},eyeR:{first:23,last:26,fillStyle:"purple",closed:!1},eyeBrowL:{first:9,last:11,fillStyle:"yellow",closed:!1},eyeBrowR:{first:12,last:14,fillStyle:"yellow",closed:!1}},this.faceCanvas=document.createElement("canvas"),this.faceCanvas.style.width="100%",this.faceCanvas.style.height="100%",this.faceContext=this.faceCanvas.getContext("2d"),this.bRefreshGlassTransform=!0,o.faceParameters={landmarkLerpFactor:.7,boundinBoxVisible:!0,jawVisible:!0,eyeBrowLVisible:!0,eyeBrowRVisible:!0,noseVisible:!0,eyeLVisible:!0,eyeRVisible:!0,mouthVisible:!0},this.tracker=null,this.GlassPosition={x:0,y:0,z:0},this.GlassRotation={x:0,y:0,z:0},this.GlassScale={x:1,y:1,z:1},this.jeelizCanvas=null,o.normalMapPathUrl=l,o.baseMapPathUrl=c,o.pluginBaseUrl=e,o.glbUrl=s,o.ctElementId=t,o.shadowImgUrl=r,o.bEdit=n,o.bEdit&&(o.bEnableSparkles=!1),o.bEnableSparkles&&(o.sparkleTexture=Qt.loadTexture("core/textures/sparkle5.png"),o.sparkleTexture1=Qt.loadTexture("core/textures/sparkle3.png"),o.noiseTexture=Qt.loadTexture("core/textures/noiseTexture.jpg"),o.sparkle1=new IJEWEL.Sparkle(o.sparkleTexture,o.noiseTexture),o.sparkle2=new IJEWEL.Sparkle(o.sparkleTexture1,o.noiseTexture),!(n=new $p)||(u=n.deviceLevel())&&(0!=u&&1!=u&&2!=u||(o.bEnableSparkles=!1))),o.container=document.createElement("div"),o.container.style.width="100%",o.container.style.height="100%",o.container.style.backgroundColor="white",o.divWidth=o.container.offsetWidth,o.divHeight=o.container.offsetHeight,o.windowHalfX=o.divWidth/2,o.windowHalfY=o.divHeight/2,o.domToTop=o.container.offsetTop,o.domToLeft=o.container.offsetLeft,nf.Source=rf.ArToolkitSource=function(e){var r=this;this.ready=!1,this.domElement=null,this.parameters={sourceType:"webcam",sourceUrl:null,deviceId:null,sourceWidth:640,sourceHeight:480,displayWidth:640,displayHeight:480},function(e){if(null!=e)for(var t in e){var n=e[t];null!=n?null!=r.parameters[t]?r.parameters[t]=n:console.warn("THREEx.ArToolkitSource: '"+t+"' is not a property of this material."):console.warn("THREEx.ArToolkitSource: '"+t+"' parameter is undefined.")}}(e)},nf.Source.prototype.init=function(e,t){var n,r=this;return"webcam"===this.parameters.sourceType?n=this._initSourceWebcam(function(){document.body.appendChild(r.domElement),window.dispatchEvent(new CustomEvent("arjs-video-loaded",{detail:{component:document.querySelector("#arjs-video")}})),r.ready=!0,e&&e()},t):console.assert(!1),this.domElement=n,this.domElement.style.position="absolute",this.domElement.style.zIndex="-3",this.domElement.style.top=r.domToTop+"px",this.domElement.style.left=r.domToLeft+"px",this.domElement.style.width=r.divWidth+"px",this.domElement.style.height=r.divHeight+"px",this.domElement.style.opacity="0",this.domElement.setAttribute("id","arjs-video"),this},nf.Source.prototype._initSourceWebcam=function(n,e){var r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.setAttribute("playsinline",""),r.style.width=this.parameters.displayWidth+"px",r.style.height=this.parameters.displayHeight+"px",void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(n){var r=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return r?new Promise(function(e,t){r.call(navigator,n,e,t)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))});var t={audio:!1,video:{facingMode:window.isFrontCamera?"user":"environment"}};return navigator.mediaDevices.getUserMedia(t).then(function(e){r.srcObject=e;e=new CustomEvent("camera-init",{stream:e});window.dispatchEvent(e),document.body.addEventListener("click",function(){r.play()});var t=setInterval(function(){r.videoWidth&&(n(),clearInterval(t))},20)}).catch(function(e){console.log(e.name+": "+e.message)}),r},o.initCamera(),o.initControls(),o.initScene(),o.initLoading(),o.initRenderer(),o.initShadowGroup(),o.hdrUrl||(o.hdrUrl="https://design.bavlo.com/WebHdrs/");var u=[];o.gemHdrUrls=o.genCubeUrls(o.hdrUrl+"textures/Hdrs/defGem1/",".hdr"),u.push(new Promise(function(n){o.gemEnvCubeMap=o.gemHdrTextureLoader.load(Le,o.gemHdrUrls,function(){var e=new Cd(o.gemEnvCubeMap);e.update(o.renderer);var t=new Pd(e.cubeLods);t.update(o.renderer),o.gemHdrCubeRenderTarget=t.CubeUVRenderTarget,o.gemEnvCubeMap.minFilter=Ae,o.gemEnvCubeMap.magFilter=Ae,o.gemEnvCubeMap.needsUpdate=!0,e.dispose(),t.dispose(),o.gemHdrs.defGem=o.gemEnvCubeMap,n()})})),o.metalHdrUrls=o.genCubeUrls(o.hdrUrl+"textures/Hdrs/defMetal/",".hdr"),u.push(new Promise(function(n){o.metalEnvCubeMap=o.hdrTextureLoader.load(Le,o.metalHdrUrls,function(){var e=new Cd(o.metalEnvCubeMap);e.update(o.renderer);var t=new Pd(e.cubeLods);t.update(o.renderer),o.metalHdrCubeRenderTarget=t.CubeUVRenderTarget,o.metalEnvCubeMap.minFilter=Ae,o.metalEnvCubeMap.magFilter=Ae,o.metalEnvCubeMap.needsUpdate=!0,e.dispose(),t.dispose(),o.metalHdrs.defMetal=o.metalEnvCubeMap,o.metalHdrTextures.defMetal=o.metalHdrCubeRenderTarget.texture,o.commonMat.Metal=new Wl({color:8947848,envMap:o.metalEnvCubeMap,metalness:1,roughness:0,name:"polishing"}),o.commonMat.Metaldianhei=new Wl({color:0,envMap:o.metalHdrCubeRenderTarget.texture,envMapIntensity:.2,metalness:1,roughness:1,name:"dianhei"}),n()})})),Promise.all(u).then(function(){o.bDefaultHDRLoaded=!0}),o.designLoader=(new rd).setPath(o.glbUrl);u=new ad;u.setDecoderPath(o.pluginBaseUrl+"core/js/draco/gltf/"),o.designLoader.setDRACOLoader(u),o.designLoader.setDDSLoader(new id),o.isSupportFontFamily(o.fontClass)?o.isFontReady=!0:(o.customFont=new FontFace(o.fontClass,"url(https://design.bavlo.com/simfang3D.ttf)"),o.customFont.load().then(function(e){document.fonts.add(e)}).then(function(){o.isFontReady=!0}))}var e,t,n;return e=h,(t=[{key:"copy",value:function(e){return a(i(h.prototype),"copy",this).call(this,e),this}}])&&r(e.prototype,t),n&&r(e,n),h}();af.prototype.isSupportFontFamily=function(e){if("string"!=typeof e)return!1;if(e.toLowerCase()=="Arial".toLowerCase())return!0;var t=document.createElement("canvas"),n=t.getContext("2d");t.width=100,t.height=100,n.textAlign="center",n.fillStyle="black",n.textBaseline="middle";t=function(e){n.clearRect(0,0,100,100),n.font="100px "+e+", Arial",n.fillText("a",50,50);e=n.getImageData(0,0,100,100).data;return[].slice.call(e).filter(function(e){return 0!=e})};return t("Arial").join("")!==t(e).join("")},af.prototype.initCamera=function(){this.camera=new _i(10,this.divWidth/this.divHeight,.3,5e3),this.defaultCamereFov=10,this.camera.position.set(this.ringCamPos.x,this.ringCamPos.y,this.ringCamPos.z)},af.prototype.initControls=function(){var e=this;e.controls=new od(e.camera,e.container),e.controls.screenSpacePanning=!0,e.bEdit,e.controls.enablePan=!0,e.controls.enableDamping=!0,e.controls.dampingFactor=.08,e.bEdit?e.controls.minDistance=.2:e.controls.minDistance=70,e.controls.maxDistance=2500,e.controls.addEventListener("change",e.render.bind(e)),e.arcball=new Qp(e.rootNode,e.container,e.camera),e.arcball.enabled=!1,e.objects.push(e.rootNode),e.dragControls=new Zp(e.objects,e.camera,e.container),e.dragControls.enabled=!1},af.prototype.initRenderer=function(){var e=this;e.renderer=new Bo({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),e.renderer.toneMapping=N,e.renderer.toneMappingExposure=2.3,e.renderer.toneMappingWhitePoint=1,e.renderer.gammaInput=!0,e.renderer.gammaOutput=!0,e.renderer.setSize(e.divWidth,e.divHeight),e.renderer.domElement.id="mainCanvas",e.renderer.domElement.style.position="absolute",e.renderer.domElement.style.top="0px",e.renderer.domElement.style.left="0px",e.ambientLight=new au(16777215),e.ambientLight.intensity=.7,e.scene.add(e.ambientLight);var t=new Vt(0,0,0),n=new Vt(0,-1,0);e.raycaster=new ih(t,n.normalize()),e.mouseHelper=new ii(new pi(1,1,10),new ql),e.mouseHelper.visible=!1,e.scene.add(e.mouseHelper),e.renderer.shadowMap.enabled=!1,e.renderer.shadowMap.type=A,e.zoomMask=document.createElement("div"),e.zoomMask.style.overflow="hidden",e.zoomMask.style.position="absolute",e.zoomMask.style.width=e.divWidth+"px",e.zoomMask.style.height=e.divHeight+"px",e.zoomMask.style.top=e.domToTop+"px",e.zoomMask.style.left=e.domToLeft+"px",e.zoomMask.style.margin="0",e.zoomMask.style.zIndex="0",e.zoomMask.appendChild(e.renderer.domElement),e.jeelizCanvas=document.createElement("canvas"),e.jeelizCanvas.width=e.divWidth,e.jeelizCanvas.height=e.divHeight,e.jeelizCanvas.style.zIndex="-3",e.jeelizCanvas.id="jeelizCanvas",e.zoomMask.appendChild(e.jeelizCanvas),e.container.appendChild(e.zoomMask),e.dpr=1,void 0!==window.devicePixelRatio&&(e.dpr=window.devicePixelRatio),e.renderer.setPixelRatio(e.dpr),e.renderScene=new xd(e.scene,e.camera),e.renderScene.clear=!0,e.effectFXAA=new dd(Ad),e.effectFXAA.uniforms.resolution.value.set(1/(window.innerWidth*e.dpr),1/(window.innerHeight*e.dpr)),e.effectFXAA.renderToScreen=!0,e.composer=new md(e.renderer),e.composer.setSize(window.innerWidth*e.dpr,window.innerHeight*e.dpr),e.composer.addPass(e.renderScene),e.composer.addPass(e.effectFXAA),e.outlinePass=new bd(new Ht(window.innerWidth,window.innerHeight),e.scene,e.camera),e.composer.addPass(e.outlinePass),e.outlinePass.visibleEdgeColor=new pr(1,0,0),e.outlinePass.hiddenEdgeColor=new pr(1,0,0),e.outlinePass.edgeStrength=3,e.outlinePass.edgeThickness=1,e.bEnableSparkles&&(e.sparkle1.material.uniforms.screenTexture.value=e.composer.renderTarget2.texture,e.sparkle2.material.uniforms.screenTexture.value=e.composer.renderTarget2.texture),e.isAntiAliasing()},af.prototype.initShadowGroup=function(){var t=this;t.shadowGroup=new Oo,t.shadowGroup.position.y=-7.8,t.scene.add(t.shadowGroup),t.sg_renderTarget=new $t(512,512),t.sg_renderTarget.texture.generateMipmaps=!1,t.sg_renderTargetBlur=new $t(512,512),t.sg_renderTargetBlur.texture.generateMipmaps=!1;var e=new ki(t.PLANE_WIDTH,t.PLANE_HEIGHT).rotateX(Math.PI/2),n=new br({map:t.sg_renderTarget.texture,opacity:t.sg_state.shadow.opacity,transparent:!0,depthWrite:!1});t.sg_plane=new ii(e,n),t.sg_plane.renderOrder=1,t.shadowGroup.add(t.sg_plane),t.sg_plane.scale.y=-1,t.sg_blurPlane=new ii(e),t.sg_blurPlane.visible=!1,t.shadowGroup.add(t.sg_blurPlane);n=new br({color:t.sg_state.plane.color,opacity:t.sg_state.plane.opacity,transparent:!0,depthWrite:!1});t.sg_fillPlane=new ii(e,n),t.sg_fillPlane.rotateX(Math.PI),t.sg_fillPlane.material.opacity=0,t.shadowGroup.add(t.sg_fillPlane),t.shadowCamera=new nu(-t.PLANE_WIDTH/2,t.PLANE_WIDTH/2,t.PLANE_HEIGHT/2,-t.PLANE_HEIGHT/2,0,t.CAMERA_HEIGHT),t.shadowCamera.rotation.x=Math.PI/2,t.shadowGroup.add(t.shadowCamera),t.cameraHelper=new Vh(t.shadowCamera),t.depthMaterial=new _o,t.depthMaterial.userData.darkness={value:t.sg_state.shadow.darkness},t.depthMaterial.onBeforeCompile=function(e){e.uniforms.darkness=t.depthMaterial.userData.darkness,e.fragmentShader="\n            uniform float darkness;\n            ".concat(e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - gl_FragCoord.z ) * darkness );"),"\n        ")},t.depthMaterial.depthTest=!0,t.depthMaterial.depthWrite=!0,t.horizontalBlurMaterial=new xi(ef),t.horizontalBlurMaterial.depthTest=!1,t.verticalBlurMaterial=new xi(tf),t.verticalBlurMaterial.depthTest=!1},af.prototype.initWebCam=function(){this.arToolkitSource=new rf.ArToolkitSource({sourceType:"webcam"}),this.bInitBg||this.initTryonScene()},af.prototype.initTryonScene=function(){var e=this;null==e.sceneBackground&&(e.sceneBackground=new Cn),null==e.backgroundCamera&&(e.backgroundCamera=new nu(e.divWidth/-2,e.divWidth/2,e.divHeight/2,e.divHeight/-2,.3,2e3)),null==e.bgRenderer&&(e.bgRenderer=new Bo({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),e.bgRenderer.domElement.style.position="absolute",e.bgRenderer.domElement.style.zIndex="-2",e.bgRenderer.domElement.style.top="0",e.bgRenderer.domElement.style.left="0",e.bgRenderer.domElement.id="bgRendererCanvas",e.isFlip&&(e.bgRenderer.domElement.style.transform="rotateY(180deg)",e.bgRenderer.domElement.style.webkitTransform="rotateY(180deg)",e.bgRenderer.domElement.style.mozTransform="rotateY(180deg)",e.bgRenderer.domElement.style.msTransform="rotateY(180deg)"),e.bgRenderer.setSize(e.divWidth,e.divHeight),e.zoomMask.appendChild(e.bgRenderer.domElement),e.bgRingComposer=new md(e.bgRenderer),e.bgRingComposer.addPass(new xd(e.sceneBackground,e.backgroundCamera)),e.ringRenderTarget=new $t(e.divWidth,e.divHeight,{minFilter:Ae,magFilter:Ae,format:He,stencilBuffer:!1}),e.saveRingBgPass=new _d(e.ringRenderTarget),e.bgRingComposer.addPass(e.saveRingBgPass),e.bgNecklaceComposer=new md(e.bgRenderer),e.bgNecklaceComposer.addPass(new xd(e.sceneBackground,e.backgroundCamera)),e.necklaceRenderTarget=new $t(e.divWidth,e.divHeight,{minFilter:Ae,magFilter:Ae,format:He,stencilBuffer:!1}),e.saveNecklaceBgPass=new _d(e.necklaceRenderTarget),e.bgNecklaceComposer.addPass(e.saveNecklaceBgPass),e.bgEarringComposer=new md(e.bgRenderer),e.bgEarringComposer.addPass(new xd(e.sceneBackground,e.backgroundCamera)),e.earringRenderTarget=new $t(e.divWidth,e.divHeight,{minFilter:Ae,magFilter:Ae,format:He,stencilBuffer:!1}),e.saveEarringBgPass=new _d(e.earringRenderTarget),e.bgEarringComposer.addPass(e.saveEarringBgPass),e.bgWatchComposer=new md(e.bgRenderer),e.bgWatchComposer.addPass(new xd(e.sceneBackground,e.backgroundCamera)),e.watchRenderTarget=new $t(e.divWidth,e.divHeight,{minFilter:Ae,magFilter:Ae,format:He,stencilBuffer:!1}),e.saveWatchBgPass=new _d(e.watchRenderTarget),e.bgWatchComposer.addPass(e.saveWatchBgPass),e.bgGlassComposer=new md(e.bgRenderer),e.bgGlassComposer.addPass(new xd(e.sceneBackground,e.backgroundCamera)),e.glassRenderTarget=new $t(e.divWidth,e.divHeight,{minFilter:Ae,magFilter:Ae,format:He,stencilBuffer:!1}),e.saveGlassBgPass=new _d(e.glassRenderTarget),e.bgGlassComposer.addPass(e.saveGlassBgPass),e.beautyComposer=new md(e.bgRenderer),e.beautyComposer.addPass(new xd(e.sceneBackground,e.backgroundCamera)),e.beautyPass=new Yp,e.beautyComposer.addPass(e.beautyPass)),e.bInitBg=!0},af.prototype.initGui=function(){var t=this;t.stats=new Vp;var e=new function(){t.Reset=function(){t.postureReset()}};t.matGui=new Xp,t.matGui.add(t.params,"Rotate").onChange(function(e){t.bRotate=e}),t.matGui.add(e,"Reset"),t.matGui.add(t.params,"mainParts",[8,7]).onChange(function(e){t.changePart(parseInt(e),1)}),t.matGui.add(t.params,"parts",[10,9,6]).onChange(function(e){t.changePart(parseInt(e),2)}),t.matGui.add(t.params,"test",.4,2,.01).onChange(function(e){decalMaterial.map.matrixAutoUpdate=!1,decalMaterial.map.matrix.setUvTransform(0,0,e,e,0,.5,.5)}),t.matGui.add(t.params,"CabochonEnvMap",["春眠不觉晓，处处闻啼鸟","飞流直下三千尺，疑是银河落九天"]).onChange(function(e){printUserText(e)});e=document.getElementsByClassName("dg ac");e[0].id="bavloGui",e[0].style.position="absolute",e[0].style.top=domToTop+"px",e[0].style.left=domToLeft+"px",e[0].removeAttribute("class")},af.prototype.addGround=function(){var e=new Ui(1,1),t=new Wl({});this.ground=new ii(e,t),this.ground.name="ground",this.ground.rotation.set(Math.PI/2,Math.PI,0),this.ground.position.set(1e4,0,0),this.scene.add(this.ground),this.ground.visible=!1},af.prototype.blurShadow=function(e){var t=this;t.sg_blurPlane.visible=!0,t.sg_blurPlane.material=t.horizontalBlurMaterial,t.sg_blurPlane.material.uniforms.tDiffuse.value=t.sg_renderTarget.texture,t.horizontalBlurMaterial.uniforms.h.value=+e/256,t.renderer.setRenderTarget(t.sg_renderTargetBlur),t.renderer.render(t.sg_blurPlane,t.shadowCamera),t.sg_blurPlane.material=t.verticalBlurMaterial,t.sg_blurPlane.material.uniforms.tDiffuse.value=t.sg_renderTargetBlur.texture,t.verticalBlurMaterial.uniforms.v.value=+e/256,t.renderer.setRenderTarget(t.sg_renderTarget),t.renderer.render(t.sg_blurPlane,t.shadowCamera),t.sg_blurPlane.visible=!1},af.prototype.initScene=function(){document.getElementById(this.ctElementId).appendChild(this.container),this.scene=new Cn,this.scene.background=new pr(1,1,1),this.scene.add(this.rootNode),this.addGround(),this.animate()},af.prototype.initLoading=function(){var e=this;e.loading=new Image,e.loading.src=e.pluginBaseUrl+"core/img/loading.gif",e.loading.style.width="100px",e.loading.style.height="100px",e.loading.style.position="absolute",e.loading.style.top=e.domToTop+(e.divHeight-100)/2+"px",e.loading.style.left=e.domToLeft+(e.divWidth-100)/2+"px",e.loading.style.zIndex="5",e.fontLoading=new Image,e.fontLoading.src=e.pluginBaseUrl+"core/img/loading.gif",e.fontLoading.style.width="100px",e.fontLoading.style.height="100px",e.fontLoading.style.position="absolute",e.fontLoading.style.top=e.domToTop+(e.divHeight-100)/2+"px",e.fontLoading.style.left=e.domToLeft+(e.divWidth-100)/2+"px",e.fontLoading.style.zIndex="6"},af.prototype.isAntiAliasing=function(){var e=this;"Others"===e.getOS()?(e.AntiAliasing=!0,e.params["Anti-Aliasing"]=!0,e.isFlip=!0,e.ringCamPos.copy(e.ringCamPos_pc),e.necklaceCamPos.copy(e.necklaceCamPos_pc),e.earringCamPos.copy(e.earringCamPos_pc),e.watchCamPos.copy(e.watchCamPos_pc),e.braceletCamPos.copy(e.braceletCamPos_pc),e.glassCamPos.copy(e.glassCamPos_pc)):e.AntiAliasing=!1},af.prototype.animate=function(){var e,t=this;t.bStopRender||(t.loopAnimation=requestAnimationFrame(t.animate.bind(t)),t.bObjectLoaded&&(t.controls.update(),Kp.update(),t.bIsVarDesign&&t.bOpenRealRenderingShadow?(t.shadowGroup.visible=!0,e=t.scene.background,t.scene.background=null,t.cameraHelper.visible=!1,t.scene.overrideMaterial=t.depthMaterial,t.renderer.setRenderTarget(t.sg_renderTarget),t.renderer.render(t.scene,t.shadowCamera),t.scene.overrideMaterial=null,t.cameraHelper.visible=!0,t.blurShadow(t.sg_state.shadow.blur),t.blurShadow(.4*t.sg_state.shadow.blur),t.renderer.setRenderTarget(null),t.scene.background=e):t.shadowGroup.visible=!1,t.render(),t.bRotate&&t.curTryOnMode===t.tryOnMode.TDShow&&!t.bDecaling?t.controls.autoRotate=!0:t.controls.autoRotate=!1))},af.prototype.render=function(){var e=this;e.AntiAliasing&&e.bAllowFXAA?(e.effectFXAA.enabled=!0,e.composer.setSize(window.innerWidth*e.dpr,window.innerHeight*e.dpr)):(e.effectFXAA.enabled=!1,e.composer.setSize(window.innerWidth,window.innerHeight)),e.composer.render(),e.curTryOnMode!==e.tryOnMode.TDShow&&(e.bBeauty?e.beautyComposer.render():e.bgRenderer.render(e.sceneBackground,e.backgroundCamera)),e.bTakePhoto&&(e.saveTryOnCache(!0),e.createCaptureRender(),e.bTakePhoto=!1),e.bEnableSparkles&&e.bDrawSparkle&&null!=e.sceneSparkles&&(e.renderer.autoClear=!1,e.renderer.render(e.sceneSparkles,e.camera),e.renderer.autoClear=!0)},af.prototype.initSparkles=function(e){this.sceneSparkles=new Cn;for(var t=this.sparkleNum*e,n=0;n<t;n++){var r=(n<t/2?this.sparkle1:this.sparkle2).shallowCopy(),i=Math.random()-.5,a=Math.random()-.5;r.setPositionOffset(i,0,a),r.setScale((.96*Math.random()+.35)*this.sparkleSize),r.setRotation(6*Math.random()),r.setIntensity(1),this.sceneSparkles.add(r.mesh),this.sparkleArray.push(r)}},af.prototype.initPartSparkles=function(e){null==this.sceneSparkles&&(this.sceneSparkles=new Cn);for(var t=[],n=this.sparkleNum*e,r=0;r<n;r++){var i=(r<n/2?this.sparkle1:this.sparkle2).shallowCopy(),a=Math.random()-.5,o=Math.random()-.5;i.setPositionOffset(a,0,o),i.setScale((.96*Math.random()+.35)*this.sparkleSize),i.setRotation(6*Math.random()),i.setIntensity(1),this.sceneSparkles.add(i.mesh),t.push(i)}return t};function of(){this.getNormalMap=function(e,t){function n(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}t|=1;var r=e.width,i=e.height,a=document.createElement("canvas");a.width=r,a.height=i;var o=a.getContext("2d");o.drawImage(e,0,0);for(var s,l,c,u,h=o.getImageData(0,0,r,i).data,e=o.createImageData(r,i),d=e.data,p=0;p<r;p++)for(var f=0;f<i;f++){var m=f-1<0?0:f-1,g=i-1<f+1?i-1:f+1,v=p-1<0?0:p-1,y=r-1<p+1?r-1:p+1,x=[],b=[0,0,h[4*(f*r+p)]/255*t];x.push([-1,0,h[4*(f*r+v)]/255*t]),x.push([-1,-1,h[4*(m*r+v)]/255*t]),x.push([0,-1,h[4*(m*r+p)]/255*t]),x.push([1,-1,h[4*(m*r+y)]/255*t]),x.push([1,0,h[4*(f*r+y)]/255*t]),x.push([1,1,h[4*(g*r+y)]/255*t]),x.push([0,1,h[4*(g*r+p)]/255*t]),x.push([-1,1,h[4*(g*r+v)]/255*t]);for(var _=[],M=x.length,w=0;w<M;w++){var T=x[w],S=x[(w+1)%M],T=n(T,b),S=n(S,b);_.push((u=S,s=[(c=T)[1]*u[2]-c[2]*u[1],c[2]*u[0]-c[0]*u[2],c[0]*u[1]-c[1]*u[0]],l=void 0,l=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),[s[0]/l,s[1]/l,s[2]/l]))}for(var E=[0,0,0],w=0;w<_.length;w++)E[0]-=_[w][0],E[1]-=_[w][1],E[2]+=_[w][2];E[0]/=_.length,E[1]/=_.length,E[2]/=_.length;v=4*(f*r+p);d[v]=(E[0]+1)/2*255|0,d[1+v]=(E[1]+1)/2*255|0,d[2+v]=255*E[2]|0,d[3+v]=255}return o.putImageData(e,0,0),a},this.downloadImage=function(e){!function(e,t){var n=document.createElementNS("http://www.w3.org/1999/xhtml","a");n.href=e,n.download=t;t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(t)}(e.toDataURL("png").replace("image/"+"png".toLocaleLowerCase().replace(/jpg/i,"jpeg").match(/png|jpeg|bmp|gif/)[0],"image/octet-stream"),"图像_"+(new Date).getSeconds()+".png")}}(of.prototype=Object.create(kt.prototype)).constructor=of,af.prototype.printUserTextOfLayer=function(t,e,n){var r=this;if(r.curTryOnMode!==r.tryOnMode.TDShow)return alert("请退出试戴后刻字！"),!1;if(!e)return r.bRotate||r.render(),!1;r.bDecaling=!0,r.imageUtils||(r.imageUtils=new of),0===r.engraveLayers.length&&r.initEngraveLayers();var i=r.engraveLayers.find(function(e){return e.layerId==t});i.text=e;var a,o=r.textCanvasWidth/2,s=r.textCanvasHeight/2;r.textCanvas?((a=r.textCanvas.getContext("2d")).clearRect(0,0,r.textCanvasWidth,r.textCanvasHeight),a.font=r.defaultFontSize*i.letteringSize+"px "+r.fontClass,a.textBaseline="middle",-1!=i.textAlign.indexOf("left")?(o=0,a.textAlign="left"):-1!=i.textAlign.indexOf("right")?(o=r.textCanvasWidth,a.textAlign="right"):-1!=i.textAlign.indexOf("middle")&&(a.textAlign="center"),a.fillText(e,o,s),null!=i.letteringType&&0!=i.letteringType||a.strokeText(e,o,s)):r.initTextCanvasWithAlign(e,i.textAlign,i.letteringSize,i.letteringType);var l=setInterval(function(){if(r.textCanvas){var e=new Fs(r.textCanvas);e.needsUpdate=!0,i.decalMaterial.map=e,i.decalMaterial.map.wrapS=i.decalMaterial.map.wrapT=i.decalMaterial.RepeatWrapping,i.decalMaterial.bumpMap=e,i.decalMaterial.bumpScale=30,i.decalMaterial.bumpMap.wrapS=i.decalMaterial.bumpMap.wrapT=i.decalMaterial.RepeatWrapping;e=new Image;return e.src=r.textCanvas.toDataURL("image/png"),e.onload=function(e){i.decalMaterial.opacity=1,i.decalMaterial.needsUpdate=!0,r.bRotate=!1,r.bRotate||r.render(),r.bDecaling=!1,n&&n()},clearInterval(l),!0}},20)},af.prototype.editTextSizeAndAlignOfLayer=function(t,e,n,r){0===this.engraveLayers.length&&this.initEngraveLayers();var i=this.engraveLayers.find(function(e){return e.layerId==t});i&&(i.textAlign=e,i.letteringSize=n,null==i.letteringType||0==r?(i.decalMaterial.envMap=this.metalEnvCubeMap,i.decalMaterial.color=i.curMesh.material.color.clone().multiplyScalar(this.fontColorScale)):1==r&&(i.decalMaterial.envMap=null,i.decalMaterial.color=i.curMesh.material.color.clone().multiplyScalar(this.jiguangFontColorScale)),this.printUserTextOfLayer(t,i.text))},af.prototype.getDefaultHDRLoadState=function(){return this.bDefaultHDRLoaded},af.prototype.getOS=function(){var e=-1<navigator.userAgent.indexOf("Android")||-1<navigator.userAgent.indexOf("Linux")?"Android":-1<navigator.userAgent.indexOf("iPhone")||-1<navigator.userAgent.indexOf("iPad")||-1<navigator.userAgent.indexOf("iPod")?"iOS":-1<navigator.userAgent.indexOf("Windows Phone")?"WP":"Others";return e},af.prototype.setRenderState=function(){this.bStopRendering=0<arguments.length&&void 0!==arguments[0]&&arguments[0]},af.prototype.setRotationState=function(e){this.bRotate=e},af.prototype.onClose=function(){var t=this;t.scene.children.filter(function(e){return e}).forEach(function(e){t.dispose(t.scene,e)}),t.scene.remove(),t.scene=null,t.renderer.dispose(),t.renderer.forceContextLoss(),t.renderer.content=null,t.renderer.domElement=null,t.renderer=null,cancelAnimationFrame(t.loopAnimation)},af.prototype.onWindowResize=function(e){var t,n=this,r=document.getElementById(n.ctElementId).offsetWidth,i=0;0===e?(i=r/3*4,document.getElementById(n.ctElementId).style.height=i+"px"):1===e?(i=r/4*3,document.getElementById(n.ctElementId).style.height=i+"px"):document.getElementById(n.ctElementId).style.height="100%",n.divWidth=n.container.offsetWidth,n.divHeight=n.container.offsetHeight,n.domToTop=n.container.offsetTop,n.domToLeft=n.container.offsetLeft,n.windowHalfX=n.divWidth/2,n.windowHalfY=n.divHeight/2,n.webCamVideo&&(n.webCamVideo.style.width=n.divWidth+"px",n.webCamVideo.style.height=n.divHeight+"px"),n.takeRender&&(n.takeRender.style.width=n.divWidth+"px",n.takeRender.style.height=n.divHeight+"px"),n.loading.style.top=n.domToTop+(n.divHeight-100)/2+"px",n.loading.style.left=n.domToLeft+(n.divWidth-100)/2+"px",n.fontLoading.style.top=n.domToTop+(n.divHeight-100)/2+"px",n.fontLoading.style.left=n.domToLeft+(n.divWidth-100)/2+"px",n.camera.aspect=n.divWidth/n.divHeight,n.camera.updateProjectionMatrix(),2===n.getTryOnState()?(t=n.divWidth*n.zoomDelta*.01,e=n.divHeight*n.zoomDelta*.01,r=n.divWidth+t,i=n.divHeight+e,n.renderer.setSize(r,i),n.bgRenderer.setSize(r,i),n.renderer.domElement.style.top=0-e/2+"px",n.renderer.domElement.style.left=0-t/2+"px",n.bgRenderer.domElement.style.top=0-e/2+"px",n.bgRenderer.domElement.style.left=0-t/2+"px"):n.renderer.setSize(n.divWidth,n.divHeight),n.zoomMask.style.width=n.divWidth+"px",n.zoomMask.style.height=n.divHeight+"px",n.zoomMask.style.top=n.domToTop+"px",n.zoomMask.style.left=n.domToLeft+"px",n.dpr=1,void 0!==window.devicePixelRatio&&(n.dpr=window.devicePixelRatio),n.effectFXAA.uniforms.resolution.value.set(1/(window.innerWidth*n.dpr),1/(window.innerHeight*n.dpr)),n.composer.setSize(window.innerWidth*n.dpr,window.innerHeight*n.dpr),void 0!==n.bgMesh&&null!==n.bgMesh&&(2!==n.getTryOnState()&&n.bgRenderer.setSize(n.divWidth,n.divHeight),n.backgroundCamera.left=n.divWidth/-2,n.backgroundCamera.right=n.divWidth/2,n.backgroundCamera.top=n.divHeight/2,n.backgroundCamera.bottom=n.divHeight/-2),n.bRotate||n.render()},af.prototype.allowFXAA=function(e){this.bAllowFXAA=e},af.prototype.exposureChanged=function(e){this.renderer.toneMappingExposure=e},af.prototype.initUserMatInfo=function(e,t,n,r){this.userMatInfo.defMetal=e,this.userMatInfo.userMetal=t,this.userMatInfo.defGem=n,this.userMatInfo.userGem=r},af.prototype.customizeGemClass=function(c,u,h){var d=this;if(d.bIsVarDesign){for(var e=0;e<d.designLayers.length;++e){var t=d.designLayers[e];t.name===u&&(0===(t.ogType=c)?t.gem=h:1===c&&(t.otherGem=h))}for(var s=h.webColor.split(","),n=0;n<d.designLayers.length;++n)!function(e){var t=d.designLayers[e];if(u===t.name){var n=0;if(1===t.type)for(var r=0;r<t.meshObjs.length;++r){var i=t.meshObjs[r];i.material.uniforms.refractiveIndex.value=h.refraction,i.material.uniforms.colorCorrection.value=new pr((s[0]/255).toFixed(2),(s[1]/255).toFixed(2),(s[2]/255).toFixed(2));var a,o=void 0;d.userMatInfo.userGem&&(o=d.userMatInfo.userGem.filter(function(e){return 0===c?e.gemId==t.gem.id&&e.ogType==c:e.gemId==t.otherGem.id&&e.ogType==c})[0])&&(a=o.color.toString().split(","),i.material.uniforms.colorCorrection.value=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2)),i.material.uniforms.refractiveIndex.value=o.refractiveIndex,i.material.uniforms.rIndexDelta.value=o.rIndexDelta,i.material.uniforms.envMapIntensity.value=o.envMapIntensity,0===(n=o.hdrId)&&(i.material.uniforms.envMap.value=d.gemEnvCubeMap)),!o&&d.userMatInfo.defGem&&(o=d.userMatInfo.defGem.filter(function(e){return 0===c?e.gemId==t.gem.id&&e.ogType==c:e.gemId==t.otherGem.id&&e.ogType==c})[0])&&(a=o.color.toString().split(","),i.material.uniforms.colorCorrection.value=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2)),i.material.uniforms.refractiveIndex.value=o.refractiveIndex,i.material.uniforms.rIndexDelta.value=o.rIndexDelta,i.material.uniforms.envMapIntensity.value=o.envMapIntensity,0===(n=o.hdrId)&&(i.material.uniforms.envMap.value=d.gemEnvCubeMap))}0!==n&&d.updateGemHdr(n,t.meshNames,t.meshObjs)}}(n)}else{for(var r=0;r<d.designLayers.length;++r){var i=d.designLayers[r];i.name===u&&(0===(i.ogType=c)?i.gem=h:1===c&&(i.otherGem=h))}for(var p=h.webColor.split(","),a=0;a<d.designLayers.length;++a)!function(e){var t=d.designLayers[e];if(u===t.name){var n=0;if(1===t.type)for(var r=0;r<d.diamonds.length;++r)for(var i,a,o=d.diamonds[r].getMesh(),s=t.meshNames.split("/"),l=0;l<s.length;++l)s[l]===o.name&&(o.material.uniforms.refractiveIndex.value=h.refraction,o.material.uniforms.colorCorrection.value=new pr((p[0]/255).toFixed(2),(p[1]/255).toFixed(2),(p[2]/255).toFixed(2)),i=void 0,d.userMatInfo.userGem&&(i=d.userMatInfo.userGem.filter(function(e){return 0===c?e.gemId==t.gem.id&&e.ogType==c:e.gemId==t.otherGem.id&&e.ogType==c})[0])&&(a=i.color.toString().split(","),o.material.uniforms.colorCorrection.value=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2)),o.material.uniforms.refractiveIndex.value=i.refractiveIndex,o.material.uniforms.rIndexDelta.value=i.rIndexDelta,o.material.uniforms.envMapIntensity.value=i.envMapIntensity,0===(n=i.hdrId)&&(o.material.uniforms.envMap.value=d.gemEnvCubeMap)),!i&&d.userMatInfo.defGem&&(i=d.userMatInfo.defGem.filter(function(e){return 0===c?e.gemId==t.gem.id&&e.ogType==c:e.gemId==t.otherGem.id&&e.ogType==c})[0])&&(a=i.color.toString().split(","),o.material.uniforms.colorCorrection.value=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2)),o.material.uniforms.refractiveIndex.value=i.refractiveIndex,o.material.uniforms.rIndexDelta.value=i.rIndexDelta,o.material.uniforms.envMapIntensity.value=i.envMapIntensity,0===(n=i.hdrId)&&(o.material.uniforms.envMap.value=d.gemEnvCubeMap)));0!==n&&d.updateGemHdr(n,t.meshNames)}}(a)}d.render()},af.prototype.customizeMetalClass=function(n,s){var l=this;if(l.bIsVarDesign){for(var e=function(e){var i=l.designLayers[e];if(i.name===n){if(i.metal=s,0===i.type){var a,o=i.metal.color.split(","),e=i.meshNames.split("/");(a=!(a=l.userMatInfo.userMetal?l.userMatInfo.userMetal.filter(function(e){return e.metalId===i.metal.id})[0]:a)&&l.userMatInfo.defMetal?l.userMatInfo.defMetal.filter(function(e){return e.metalId===i.metal.id})[0]:a)&&(o=a.color.split(","));for(var t=0;t<i.meshObjs.length;t++)!function(e){var t,n,r=i.meshObjs[e];r.material,l.userMetalMat[i.metal.id]?null==r.material.normalMap?(n=l.userMetalMat[i.metal.id].clone(),r.material=n,l.updateAllDecalMeterialColor()):t=setInterval(function(){var e;l.bLoadNormalMapFinished&&(e=l.userMetalMat[i.metal.id].clone(),l.SetMaterialMapFromSrc(e,r.material),r.material=e,l.updateAllDecalMeterialColor(),clearInterval(t))},20):(a&&(n=a.color.split(","),r.material.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),r.material.roughness=a.roughness,r.material.metalness=a.metalness,r.material.envMapIntensity=a.envMapIntensity,0!==a.hdrId?l.updateMatHdr("Metal",a.hdrId,r,a.metalId):(r.material.envMap=null,r.material.envMap=l.metalEnvCubeMap,r.material.needsUpdate=!0),l.userMetalMat[i.metal.id]=r.material.clone(),l.clearMaterialMaps(l.userMetalMat[i.metal.id])),l.userMetalMat[i.metal.id]||(r.material.color=new pr((o[0]/255).toFixed(2),(o[1]/255).toFixed(2),(o[2]/255).toFixed(2))))}(t);a&&l.updateMetalLayerHdr(a,e,l.glbScene,i.meshObjs)}return"break"}},t=0;t<l.designLayers.length;++t)if("break"===e(t))break}else for(var r=function(e){var r,i,a,o=l.designLayers[e];if(o.name===n)return o.metal=s,0===o.type&&(r=o.metal.color.split(","),i=o.meshNames.split("/"),(a=!(a=l.userMatInfo.userMetal?l.userMatInfo.userMetal.filter(function(e){return e.metalId===o.metal.id})[0]:a)&&l.userMatInfo.defMetal?l.userMatInfo.defMetal.filter(function(e){return e.metalId===o.metal.id})[0]:a)&&(r=a.color.split(",")),l.glbScene.traverse(function(n){if(n.isMesh)for(var e,t=0;t<i.length;++t)i[t]===n.name&&(l.userMetalMat[o.metal.id]?null==n.material.normalMap?(e=l.userMetalMat[o.metal.id].clone(),n.material=e,l.updateAllDecalMeterialColor()):function(){var t=setInterval(function(){var e;l.bLoadNormalMapFinished&&(e=l.userMetalMat[o.metal.id].clone(),l.SetMaterialMapFromSrc(e,n.material),n.material=e,n.material.needsUpdate=!0,l.render(),l.updateAllDecalMeterialColor(),clearInterval(t))},20)}():(a&&(e=a.color.split(","),n.material=n.material.clone(),n.material.color=new pr((e[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2)),n.material.roughness=a.roughness,n.material.metalness=a.metalness,n.material.envMapIntensity=a.envMapIntensity,0!==a.hdrId?l.updateMatHdr("Metal",a.hdrId,n,a.metalId):(n.material.envMap=null,n.material.envMap=l.metalEnvCubeMap,n.material.needsUpdate=!0),l.userMetalMat[o.metal.id]=n.material.clone(),l.clearMaterialMaps(l.userMetalMat[o.metal.id])),l.userMetalMat[o.metal.id]||(n.material.color=new pr((r[0]/255).toFixed(2),(r[1]/255).toFixed(2),(r[2]/255).toFixed(2)))))}),a&&l.updateMetalLayerHdr(a,i,l.glbScene)),"break"},i=0;i<l.designLayers.length;++i)if("break"===r(i))break;l.updateAllDecalMeterialColor(),l.render()},af.prototype.changeLayerMaterial=function(f,m){var g=this;if(g.bIsVarDesign)for(var e=0;e<g.designLayers.length;++e)!function(e){var t=g.designLayers[e];if(t.name===f)if(t.type===g.materialType.gem)if(0===t.ogType&&t.gem.faceType===m.faceType)for(var n=(t.gem=m).nameEn,r=0;r<t.meshObjs.length;r++){var i,a,o=t.meshObjs[r];"cabochon"===t.gem.faceType?(g.userCabochonMat[n]?o.material=g.userCabochonMat[n]:(o.material=g.cabochonMat[n],i=void 0,g.userMatInfo.userGem&&(i=g.userMatInfo.userGem.filter(function(e){return e.gemId===t.gem.id})[0])&&(o.material.roughness=i.roughness,o.material.metalness=i.metalness,o.material.envMapIntensity=i.envMapIntensity,a=i.color.split(","),o.material.color=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2)),0!==i.hdrId&&g.updateMatHdr("Cabochon",i.hdrId,o)),!i&&g.userMatInfo.defGem&&(i=g.userMatInfo.defGem.filter(function(e){return e.gemId===t.gem.id})[0])&&(o.material.roughness=i.roughness,o.material.metalness=i.metalness,o.material.envMapIntensity=i.envMapIntensity,a=i.color.split(","),o.material.color=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2)),0!==i.hdrId&&g.updateMatHdr("Cabochon",i.hdrId,o)),g.userCabochonMat[n]=o.material.clone()),g.commonMat.Cabochon=o.material):"pearl"===t.gem.faceType?(o.material=g.pearlMat[n],g.commonMat.Pearl=o.material):alert("未初始化此类型宝石！ "+t.gem.faceType)}else alert("无法切换此类型宝石！"+t.gem.faceType);else if(t.type===g.materialType.bakingPaint||t.type===g.materialType.glass||t.type===g.materialType.fabric||t.type===g.materialType.leather||t.type===g.materialType.paint||t.type===g.materialType.plastic||t.type===g.materialType.wood||t.type===g.materialType.enamel){t.materialWeb=m;for(var s=t.materialWeb.color.split(","),l=t.materialWeb.metalness,c=t.materialWeb.roughness,u=t.materialWeb.envMapIntensity,h=t.materialWeb.opacity,d=0;d<t.meshObjs.length;d++){var p=t.meshObjs[d];p.material.color=new pr((s[0]/255).toFixed(2),(s[1]/255).toFixed(2),(s[2]/255).toFixed(2)),p.material.metalness=l,p.material.roughness=c,p.material.envMapIntensity=u,p.material.envMap=g.metalEnvCubeMap,t.type==g.materialType.glass?p.material.transparency=1-h:p.material.opacity=h}}else console.log("The unknown material!!!!!!"+f)}(e);else for(var t=0;t<g.designLayers.length;++t)!function(e){var p=g.designLayers[e];p.name===f&&g.glbScene.traverse(function(e){if(e.isMesh)if(p.type===g.materialType.gem)if(0===p.ogType&&p.gem.faceType===m.faceType)for(var t,n,r=(p.gem=m).nameEn,i=p.meshNames.split("/"),a=0;a<i.length;++a)i[a]===e.name&&("cabochon"===p.gem.faceType?(g.userCabochonMat[r]?e.material=g.userCabochonMat[r]:(e.material=g.cabochonMat[r],t=void 0,g.userMatInfo.userGem&&(t=g.userMatInfo.userGem.filter(function(e){return e.gemId===p.gem.id})[0])&&(e.material.roughness=t.roughness,e.material.metalness=t.metalness,e.material.envMapIntensity=t.envMapIntensity,n=t.color.split(","),e.material.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),0!==t.hdrId&&g.updateMatHdr("Cabochon",t.hdrId,e)),!t&&g.userMatInfo.defGem&&(t=g.userMatInfo.defGem.filter(function(e){return e.gemId===p.gem.id})[0])&&(e.material.roughness=t.roughness,e.material.metalness=t.metalness,e.material.envMapIntensity=t.envMapIntensity,n=t.color.split(","),e.material.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),0!==t.hdrId&&g.updateMatHdr("Cabochon",t.hdrId,e)),g.userCabochonMat[r]=e.material.clone()),g.commonMat.Cabochon=e.material):"pearl"===p.gem.faceType?(e.material=g.pearlMat[r],g.commonMat.Pearl=e.material):alert("未初始化此类型宝石！ "+p.gem.faceType));else alert("无法切换此类型宝石！"+p.gem.faceType);else if(p.type===g.materialType.bakingPaint||p.type===g.materialType.glass||p.type===g.materialType.fabric||p.type===g.materialType.leather||p.type===g.materialType.paint||p.type===g.materialType.plastic||p.type===g.materialType.wood||p.type===g.materialType.enamel){p.materialWeb=m;for(var o=p.materialWeb.color.split(","),s=p.materialWeb.metalness,l=p.materialWeb.roughness,c=p.materialWeb.envMapIntensity,u=p.materialWeb.opacity,h=p.meshNames.split("/"),d=0;d<h.length;++d)h[d]===e.name&&(e.material.color=new pr((o[0]/255).toFixed(2),(o[1]/255).toFixed(2),(o[2]/255).toFixed(2)),e.material.metalness=s,e.material.roughness=l,e.material.envMapIntensity=c,e.material.envMap=g.metalEnvCubeMap,p.type==g.materialType.glass?e.material.transparency=1-u:e.material.opacity=u)}else console.log("The unknown material!!!!!!"+f)})}(t);g.render()},af.prototype.updateLayerMaterialArgs=function(e,i,a,o,s,l){for(var t=this,n=0;n<t.designLayers.length;++n){var c=t.designLayers[n];c.name===e&&function(){var r=c.meshNames.split("/");t.glbScene.traverse(function(e){if(e.isMesh)for(var t,n=0;n<r.length;++n)r[n]===e.name&&(t=i.split(","),e.material.color=new pr((t[0]/255).toFixed(2),(t[1]/255).toFixed(2),(t[2]/255).toFixed(2)),e.material.metalness=a,e.material.roughness=o,e.material.envMapIntensity=s,e.material.opacity=l,e.material.needsUpdate=!0)})}()}t.render()},af.prototype.updateLayerMaterialBaseMap=function(n,c,u,h){for(var d=this,p=[],e=function(e){var l=d.designLayers[e];if(l.name===n){var t=l.meshNames.split("/");return d.glbScene.traverse(function(s){if(s.isMesh)for(var e=0;e<t.length;++e)t[e]===s.name&&function(){var e,t=c,n=u,r=d.baseMapPathUrl+t+"/"+h;if(l.baseMap)for(var i=l.baseMap.length,a=0;a<i;a++){var o=l.baseMap[a];o.id=t,o.defaultMap=h,o.onOff=n}n?d.MapDictionary.has(r)?(e=d.MapDictionary.get(r),s.material.map=e):(d.bUpdateBaseMapFinished=!1,p.push(new Promise(function(t){e=d.textureLoader.load(r,function(e){s.material.map=e,d.MapDictionary.set(r,e),s.material.needsUpdate=!0,d.render(),t()})}))):s.material.map=null,s.material.needsUpdate=!0}()}),"break"}},t=0;t<d.designLayers.length;++t)if("break"===e(t))break;return d.render(),0<p.length&&Promise.all(p).then(function(){d.bUpdateBaseMapFinished=!0}),!0},af.prototype.updateLayerMaterialNormalMap=function(n,u,h,d,p,f,m){for(var g=this,v=[],e=function(e){var c=g.designLayers[e];if(c.name==n){var t=c.meshNames.split("/");return g.glbScene.traverse(function(l){if(l.isMesh)for(var e=0;e<t.length;e++)t[e]==l.name&&function(){var e,t=u,n=h,r=d,i=g.normalMapPathUrl+t+"/"+p;if(c.normal)for(var a=c.normal.length,o=0;o<a;o++){var s=c.normal[o];if(s.sort==h){s.id=t,s.defaultMap=p,s.onOff=r;break}}r?g.MapDictionary.has(i)?(e=g.MapDictionary.get(i),1==n?l.material.normalMap=e:2==n?l.material.normalMap2=e:3==n?l.material.normalMap3=e:4==n?l.material.normalMap4=e:5==n&&(l.material.normalMap5=e)):(g.bUpdateNormalMapFinished=!1,v.push(new Promise(function(t){e=g.textureLoader.load(i,function(e){1==n?l.material.normalMap=e:2==n?l.material.normalMap2=e:3==n?l.material.normalMap3=e:4==n?l.material.normalMap4=e:5==n&&(l.material.normalMap5=e),g.MapDictionary.set(i,e),l.material.needsUpdate=!0,g.render(),t()})}))):1==n?l.material.normalMap=null:2==n?l.material.normalMap2=null:3==n?l.material.normalMap3=null:4==n?l.material.normalMap4=null:5==n&&(l.material.normalMap5=null),l.material.normalScale=new Ht(f,m),l.material.needsUpdate=!0}()}),"break"}},t=0;t<g.designLayers.length;t++)if("break"===e(t))break;return g.render(),0<v.length&&Promise.all(v).then(function(){g.bUpdateNormalMapFinished=!0}),!0},af.prototype.updateSubLayerMaterialArgs=function(t,e,n,r,i,a,o){var s=this.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t})[0];if(s){for(var l=0;l<s.partInfo.layers.length;++l)if(s.partInfo.layers[l].name===e){s.traverse(function(e){var t;e.isMesh&&(t=n.split(","),e.material.color=new pr((t[0]/255).toFixed(2),(t[1]/255).toFixed(2),(t[2]/255).toFixed(2)),e.material.metalness=r,e.material.roughness=i,e.material.envMapIntensity=a,e.material.opacity=o,e.material.needsUpdate=!0)});break}this.render()}},af.prototype.updateSubLayerMaterialBaseMap=function(t,n,u,h,d){var p=this,r=p.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t})[0];if(!r)return!1;var e=function(){for(var c=[],e=0;e<r.partInfo.layers.length;++e)if("break"===function(e){var l=r.partInfo.layers[e];if(l.name===n)return r.traverse(function(n){if(n.isMesh){var e,t=u,r=h,i=p.baseMapPathUrl+t+"/"+d;if(l.baseMap)for(var a=l.baseMap.length,o=0;o<a;o++){var s=l.baseMap[o];s.id=t,s.defaultMap=d,s.onOff=r}r?p.MapDictionary.has(i)?(e=p.MapDictionary.get(i),n.material.map=e,n.material.color.r=+p.baseColorScale,n.material.color.g=+p.baseColorScale,n.material.color.b=+p.baseColorScale):(p.bUpdateBaseMapFinished=!1,c.push(new Promise(function(t){e=p.textureLoader.load(i,function(e){n.material.map=e,n.material.color.r=+p.baseColorScale,n.material.color.g=+p.baseColorScale,n.material.color.b=+p.baseColorScale,p.MapDictionary.set(i,e),n.material.needsUpdate=!0,p.render(),t()})}))):n.material.map=null,n.material.needsUpdate=!0}}),"break"}(e))break;return p.render(),0<c.length&&Promise.all(c).then(function(){p.bUpdateBaseMapFinished=!0}),{v:!0}}();return"object"===W(e)?e.v:void 0},af.prototype.updateSubLayerMaterialNormalMap=function(t,n,h,d,p,f){var m=this,r=m.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t})[0];if(!r)return!1;var e=function(){for(var u=[],e=0;e<r.partInfo.layers.length;++e)if("break"===function(e){var c=r.partInfo.layers[e];if(c.name===n)return r.traverse(function(n){if(n.isMesh){var e,t=h,r=d,i=p,a=m.normalMapPathUrl+t+"/"+f;if(c.normal)for(var o=c.normal.length,s=0;s<o;s++){var l=c.normal[s];if(l.sort==d){l.id=t,l.defaultMap=f,l.onOff=i;break}}i?m.MapDictionary.has(a)?(e=m.MapDictionary.get(a),1==r?n.material.normalMap=e:2==r?n.material.normalMap2=e:3==r?n.material.normalMap3=e:4==r?n.material.normalMap4=e:5==r&&(n.material.normalMap5=e)):(m.bUpdateNormalMapFinished=!1,u.push(new Promise(function(t){e=m.textureLoader.load(a,function(e){1==r?n.material.normalMap=e:2==r?n.material.normalMap2=e:3==r?n.material.normalMap3=e:4==r?n.material.normalMap4=e:5==r&&(n.material.normalMap5=e),m.MapDictionary.set(a,e),n.material.needsUpdate=!0,m.render(),t()})}))):1==r?n.material.normalMap=null:2==r?n.material.normalMap2=null:3==r?n.material.normalMap3=null:4==r?n.material.normalMap4=null:5==r&&(n.material.normalMap5=null),n.material.needsUpdate=!0}}),"break"}(e))break;return m.render(),0<u.length&&Promise.all(u).then(function(){m.bUpdateNormalMapFinished=!0}),{v:!0}}();return"object"===W(e)?e.v:void 0},af.prototype.getLoadBaseMapsState=function(){return this.bUpdateBaseMapFinished},af.prototype.getLoadNormalMapsState=function(){return this.bUpdateNormalMapFinished},af.prototype.removeCustomization=function(){for(var e=0;e<this.DesignInformation.layers.length;e++){var t=this.DesignInformation.layers[e];0===t.type?this.customizeMetalClass(t.name,t.metal):1===t.type?0===t.ogType?"faceted"==t.gem.faceType?this.customizeGemClass(t.ogType,t.name,t.gem):this.changeLayerMaterial(t.name,t.gem):1===t.ogType&&this.customizeGemClass(t.ogType,t.name,t.otherGem):this.changeLayerMaterial(t.name,t.materialWeb)}this.render()},af.prototype.getCustomization=function(){for(var e=this,t=[],n=0;n<e.designLayers.length;++n){var r={};r.customGem=e.designLayers[n].customGem,r.gem=e.designLayers[n].gem,r.id=e.designLayers[n].id,r.materialWeb=e.designLayers[n].materialWeb,r.meshNames=e.designLayers[n].meshNames,r.metal=e.designLayers[n].metal,r.name=e.designLayers[n].name,r.num=e.designLayers[n].num,r.ogType=e.designLayers[n].ogType,r.opacity=e.designLayers[n].opacity,r.otherGem=e.designLayers[n].otherGem,r.otherParameter=e.designLayers[n].otherParameter,r.strength=e.designLayers[n].strength,r.type=e.designLayers[n].type,r.volume=e.designLayers[n].volume,r.weight=e.designLayers[n].weight,r.objects=e.designLayers[n].objects,t.push(r)}return t},af.prototype.editMetalAttributes=function(e,t,n,r){if(null!=e){e=(e=(e=e.toString()).replace(/\s+/g,"")).split(",");return this.editMetalMat(e,n,t,r)}},af.prototype.switchHdr=function(i,e,t){var a=this,n=e.split("/"),o=n[n.length-2];if("Metal"===i){if(a.metalHdrs[o]&&(a.glbScene.traverse(function(e){if(e.isMesh&&null!=a.designLayers)for(var t=0;t<a.designLayers.length;++t){var n=a.designLayers[t];if(0===n.type)for(var r=n.meshNames.split("/"),i=0;i<r.length;++i)r[i]===e.name&&(e.material.envMap=null,e.material.envMap=a.metalHdrs[o],e.material.needsUpdate=!0)}}),null!==a.commonMat.Metal))return a.commonMat.Metal.envMap=a.metalHdrs[o],!0}else if("Gem"===i){if(a.gemHdrs[o]){for(var r=0;r<a.diamonds.length;++r){var s=a.diamonds[r].getMesh().material;s.uniforms.envMap.value=a.gemHdrs[o],s.needsUpdate=!0}return!0}}else if("Cabochon"===i&&a.cabochonHdrs[o]&&null!==a.commonMat.Cabochon)return a.commonMat.Cabochon.envMap=a.cabochonHdrs[o],!0;var l,e=a.genCubeUrls(e,".hdr"),c=a.hdrTextureLoader.load(Le,e,function(){var e=new Cd(c);e.update(a.renderer);var t=new Pd(e.cubeLods);if(t.update(a.renderer),l=t.CubeUVRenderTarget,c.minFilter=Ae,c.magFilter=Ae,c.needsUpdate=!0,e.dispose(),t.dispose(),"Metal"===i)return a.glbScene.traverse(function(e){if(e.isMesh&&null!=a.designLayers)for(var t=0;t<a.designLayers.length;++t){var n=a.designLayers[t];if(0===n.type)for(var r=n.meshNames.split("/"),i=0;i<r.length;++i)r[i]===e.name&&(e.material.envMap=null,e.material.envMap=c,e.material.needsUpdate=!0)}}),!!a.commonMat.Metal&&(a.commonMat.Metal.envMap=c,a.metalHdrs[o]=c,a.metalHdrTextures[o]=l.texture,!0);if("Gem"!==i)return"Cabochon"===i?null!==a.commonMat.Cabochon&&(a.commonMat.Cabochon.envMap=l.texture,a.cabochonHdrs[o]=l.texture,!0):void 0;for(var n=0;n<a.diamonds.length;++n){var r=a.diamonds[n].getMesh().material;r.uniforms.envMap.value=c,r.needsUpdate=!0,a.gemHdrs[o]=c}return!0});return!0},af.prototype.resetHdr=function(e){var a=this;if("Metal"===e)return a.glbScene.traverse(function(e){if(e.isMesh)for(var t=0;t<a.designLayers.length;++t){var n=a.designLayers[t];if(0===n.type)for(var r=n.meshNames.split("/"),i=0;i<r.length;++i)r[i]===e.name&&(e.material.clone(),e.material.envMap=null,e.material.envMap=a.metalHdrs.defMetal,e.material.needsUpdate=!0)}}),null!==a.commonMat.Metal?(a.commonMat.Metal.envMap=a.metalHdrs.defMetal,!0):(alert("未初始化金属材质！"),!1);if("Gem"!==e)return"Cabochon"===e&&(null!==a.commonMat.Cabochon&&(a.commonMat.Cabochon.envMap=a.cabochonHdrs.defCabochon,!0));if(null!=a.diamonds)for(var t=0;t<a.diamonds.length;++t){var n=a.diamonds[t].getMesh().material;n.uniforms.envMap.value=a.gemHdrs.defGem,n.needsUpdate=!0}return!0},af.prototype.editFacetedGemAttrs=function(e,t,n,r){e=(e=(e=e.toString()).replace(/\s+/g,"")).split(",");this.editFacetedGemMat(e,t,n,r)},af.prototype.editCabochonGemAttr=function(e,t,n,r){e=(e=(e=e.toString()).replace(/\s+/g,"")).split(",");this.editCabochonGemMat(e,n,t,r)},af.prototype.editStandardMeshMaterialAttr=function(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,e=(e=(e=e.toString()).replace(/\s+/g,"")).split(",");this.editStandardMeshMaterial(e,t,n,r,i)},af.prototype.changeBackground=function(e){this.curTryOnMode===this.tryOnMode.TDShow&&(e=new pr(((e=(e=(e=e.toString()).replace(/\s+/g,"")).split(","))[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2)),this.scene.background=e,this.curBackgroundColor=e)},af.prototype.editProcessUV=function(n,r,i,a,o,s,l){this.glbScene.traverse(function(e){if(e.isMesh)for(var t=0;t<i.length;++t)i[t]===e.name&&"dianhei"!==e.material.name&&(n&&r&&e.material.normalMap.repeat.set(n,r),o&&(e.material.roughness=o),a&&(e.material.metalness=a),s&&(e.material.envMapIntensity=s),l&&(e.material.normalScale=new Ht(l,l)))})},af.prototype.editElectricBlackColor=function(e){e=new pr((e/255).toFixed(2),(e/255).toFixed(2),(e/255).toFixed(2));this.commonMat.Metaldianhei.color=e},af.prototype.changeTargetLayerMat=function(e,t,n,r){t=JSON.parse(t);0===e?this.changeTargetMetalMat(t,n):1===e?this.changeTargetGemMat(t,n,r):-1==e||this.changeTargetOtherMat(t,n)},af.prototype.changeTargetMeshesMat=function(e,t,n){0==t?this.changeMeshesMetalMat(e,n):1==t?this.changeMeshesGemMat(e,n):-1==t||this.changeMeshesOtherMat(e,n)},af.prototype.getUserDiyInfo=function(){var e=this;if(e.bIsVarDesign){for(var t={layers:[]},n=0;n<e.designLayers.length;++n){var r={};r.gem=e.designLayers[n].gem,r.id=e.designLayers[n].id,r.metal=e.designLayers[n].metal,r.name=e.designLayers[n].name,r.ogType=e.designLayers[n].ogType,r.otherGem=e.designLayers[n].otherGem,r.partLayerIds=e.designLayers[n].partLayerIds,r.type=e.designLayers[n].type,r.variableDesignId=e.designLayers[n].variableDesignId,r.materialWeb=e.designLayers[n].materialWeb,t.layers.push(r)}return t.partIds=e.rootNode.mainPartId+","+e.getPartIds(),t.composeNo=e.VarDesignInfo.id.toString()+"-"+e.rootNode.mainPartId.toString()+"-"+e.getPartIds(),t}},af.prototype.loadDesign=function(t){var n=this,r=setInterval(function(){if(n.bDefaultHDRLoaded){if(n.bIsVarDesign=!1,n.canChangeDesign){n.minY=1e3,n.maxY=0,n.canChangeDesign=!1,n.container.appendChild(n.loading),n.loadModelState=n.loadState.Loading,n.clearSence();var e=JSON.stringify(t);return n.DesignInformation=JSON.parse(e),n.designLayers=JSON.parse(e).layers,n.curTryOnMode===n.tryOnMode.Capture&&n.saveTryOnCache(!1),-1<n.DesignInformation.type.nameEn.indexOf("Ring")?(n.curStyleType=n.styleType.Ring,n.controls.minDistance=20):-1<n.DesignInformation.type.nameEn.indexOf("Necklace")?(n.curStyleType=n.styleType.Necklace,n.controls.minDistance=20):-1<n.DesignInformation.type.nameEn.indexOf("Ear")?(n.curStyleType=n.styleType.Earring,n.controls.minDistance=20):-1<n.DesignInformation.type.nameEn.indexOf("Carving")?(n.curStyleType=n.styleType.Carving,n.controls.minDistance=20):-1<n.DesignInformation.type.nameEn.indexOf("Bracelet")?n.curStyleType=n.styleType.Bracelet:-1<n.DesignInformation.type.nameEn.indexOf("Wrist Watch")?n.curStyleType=n.styleType.Watch:-1<n.DesignInformation.type.nameEn.indexOf("Glasses")?(n.curStyleType=n.styleType.Glasses,n.controls.minDistance=20):console.log("未能识别类型！"),n.arcball.styleType=n.curStyleType,n.checkTryOnMode(),n.loadDiamondConfiguration(),n.loadModel(),clearInterval(r),{code:0,msg:"Success"}}return clearInterval(r),{code:-1,msg:"Loading"}}},100)},af.prototype.loadDesignWithoutMat=function(e){var t=this;if(t.bIsVarDesign=!1,t.canChangeDesign){t.minY=1e3,t.maxY=0,t.canChangeDesign=!1,t.container.appendChild(t.loading),t.loadModelState=t.loadState.Loading,t.clearSence();e=JSON.stringify(e);return t.DesignInformation=JSON.parse(e),t.checkTryOnMode(),t.loadModelWithoutMat(t.DesignInformation.id),{code:0,msg:"Success"}}return{code:-1,msg:"Loading"}},af.prototype.loadPartWithoutMat=function(e){var t=this;if(t.canChangeDesign){t.minY=1e3,t.maxY=0,t.canChangeDesign=!1,t.container.appendChild(t.loading),t.loadModelState=t.loadState.Loading,t.clearSence();e=JSON.stringify(e);return t.PartInformation=JSON.parse(e),t.curTryOnMode===t.tryOnMode.Capture&&t.saveTryOnCache(!1),t.checkTryOnMode(),t.loadModelWithoutMat(t.PartInformation.id),{code:0,msg:"Success"}}return{code:-1,msg:"Loading"}},af.prototype.clearDesignModel=function(){null!==this.rootNode&&this.canClear&&(this.rootNode.visible=!this.rootNode.visible),this.renderer.getContext().fillStyle="rgba(255, 255, 255, 0)"},af.prototype.getLoadModelState=function(){return this.loadModelState},af.prototype.loadVarDesign=function(t,n,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:20,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:180,o=this;o.objPosition.y=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;var s=setInterval(function(){if(o.bDefaultHDRLoaded){if(o.bIsVarDesign=!0,o.canChangeDesign){o.minY=1e3,o.maxY=0,o.canChangeDesign=!1,o.container.appendChild(o.loading),o.loadModelState=o.loadState.Loading,o.clearSence();var e=JSON.stringify(t);return o.VarDesignInfo=JSON.parse(e),o.designLayers=JSON.parse(e).layers,o.curTryOnMode===o.tryOnMode.Capture&&o.saveTryOnCache(!1),null==i&&(i=20),null==a&&(a=180),-1<o.VarDesignInfo.type.nameEn.indexOf("Ring")?(o.curStyleType=o.styleType.Ring,o.controls.minDistance=i,o.controls.maxDistance=a):-1<o.VarDesignInfo.type.nameEn.indexOf("Necklace")?(o.curStyleType=o.styleType.Necklace,o.controls.minDistance=i,o.controls.maxDistance=a):-1<o.VarDesignInfo.type.nameEn.indexOf("Ear")?(o.curStyleType=o.styleType.Earring,o.controls.minDistance=i,o.controls.maxDistance=a):-1<o.VarDesignInfo.type.nameEn.indexOf("Carving")?(o.curStyleType=o.styleType.Carving,o.controls.minDistance=i,o.controls.maxDistance=a):-1<o.VarDesignInfo.type.nameEn.indexOf("Bracelet")?(o.curStyleType=o.styleType.Bracelet,o.controls.minDistance=i,o.controls.maxDistance=a):-1<o.VarDesignInfo.type.nameEn.indexOf("Wrist Watch")?(o.curStyleType=o.styleType.Watch,o.controls.minDistance=i,o.controls.maxDistance=a):-1<o.VarDesignInfo.type.nameEn.indexOf("Glasses")?(o.curStyleType=o.styleType.Glasses,o.controls.minDistance=i,o.controls.maxDistance=a):console.log("未能识别类型！"),o.arcball.styleType=o.curStyleType,o.checkTryOnMode(),o.loadVarDesignPartCommonWithIds(n,r),clearInterval(s),{code:0,msg:"Success"}}return clearInterval(s),{code:-1,msg:"Loading"}}},500)},af.prototype.changeCameraPos=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length?arguments[1]:void 0,n=2<arguments.length?arguments[2]:void 0,r=3<arguments.length?arguments[3]:void 0;if(e)return this.camera.position;this.camera.position.x=t,this.camera.position.y=n,this.camera.position.z=r},af.prototype.switchPart=function(e,t){return this.refreshPart(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,3<arguments.length&&void 0!==arguments[3]?arguments[3]:null)},af.prototype.setPartSelected=function(e,t){this.setPartSelect(e,t)},af.prototype.setMeshSelected=function(e){this.setMeshSelect(e)},af.prototype.setPartRotation=function(e,t,n){this.rotatePart(e,t,n)},af.prototype.setPartShakeAnimation=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"x",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:10,i=this,a=!0,o=2*r,s=200/(4<arguments.length&&void 0!==arguments[4]?arguments[4]:2.5);i.shakeAimationInterval&&(clearInterval(i.shakeAimationInterval),i.shakeAimationInterval=null),null==i.shakeAimationInterval&&(i.shakeAimationInterval=setInterval(function(){return t?void(a?(i.rotatePart(e,n,r),i.curShakeAngle+=r,a=!1):(o=-o,i.rotatePart(e,n,o),i.curShakeAngle+=o)):(clearInterval(i.shakeAimationInterval),i.rotatePart(e,n,-i.curShakeAngle),void(i.curShakeAngle=0))},s))},af.prototype.setPartVisible=function(e,t){this.setPartVisibled(e,t)},af.prototype.loadPartForEditor=function(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=this;r.loadModelState=r.loadState.Loading,r.container.appendChild(r.loading);var i=setInterval(function(){if(r.bDefaultHDRLoaded){if(r.canChangeDesign){r.minY=1e3,r.maxY=0,r.canChangeDesign=!1,r.clearSence();var e=JSON.stringify(t);return r.varPartInfo=JSON.parse(e),r.designLayers=JSON.parse(e).layers,r.bPartCaputre=n,r.setPartDefPosture(),r.loadDiamondConfiguration(),requestAnimationFrame(r.loadVarDesignPart.bind(r)),clearInterval(i),{code:0,msg:"Success"}}return clearInterval(i),{code:-1,msg:"Loading"}}},500)},af.prototype.getShadowImage=function(){return this.getShadowImageFromTexture(this.renderTargetShadow.width,this.renderTargetShadow.height)},af.prototype.getShadowInfo=function(){var e=this.getShadowImageFromTexture(this.renderTargetShadow.width,this.renderTargetShadow.height);return{shadowScale:this.shadowScale,shadowImage:e,shadowPos:this.shadowPos}},af.prototype.CloseRealRenderingShadow=function(){this.defaultOpenRealRenderingShadow=!1},af.prototype.switchCameras=function(){var t=this;window.isFrontCamera=!window.isFrontCamera;var e=t.arToolkitSource.domElement.srcObject;null!=e&&(e.getVideoTracks()[0].stop(),document.getElementById("arjs-video").remove()),t.arToolkitSource.init(function(){var e=document.getElementById("arjs-video");null!==e&&((e=new Is(e)).wrapS=e.wrapT=be,e.minFilter=Ae,t.bgMesh.material.map=e),t.mirrorBkRender(window.isFrontCamera)})},af.prototype.setModelTryonMode=function(e,t){var n,r,i=this;if(i.isModelTryon=!0,e)if(t&&t.imgUrl){if(i.modelTryonInfo.imgUrl=t.imgUrl,t.camPos?(n=t.camPos.split(","),i.modelTryonInfo.camPos=new Vt(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]))):i.modelTryonInfo.camPos=new Vt(0,0,90),t.ctrlTarget?(n=t.ctrlTarget.split(","),i.modelTryonInfo.ctrlTarget=new Vt(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]))):i.modelTryonInfo.ctrlTarget=new Vt(0,0,0),t.objPos?(r=t.objPos.split(","),i.modelTryonInfo.objPos=new Vt(parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2]))):i.curStyleType===i.styleType.Necklace?i.modelTryonInfo.objPos=i.necklaceTryonObjPos:i.modelTryonInfo.objPos=new Vt(0,0,0),t.objRot?(r=t.objRot.split(","),i.modelTryonInfo.objRot=new Gt(parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3]))):i.curStyleType===i.styleType.Ring?i.modelTryonInfo.objRot=new Gt(0,0,0,0):i.modelTryonInfo.objRot=new Gt(-.707,0,0,.707),t.objScale?(t=t.objScale.split(","),i.modelTryonInfo.objScale=new Vt(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))):i.modelTryonInfo.objScale=new Vt(i.objTryOnScale,i.objTryOnScale,i.objTryOnScale),i.scene.background=null,i.bDrawSparkle=!1,void 0!==i.ground&&(i.ground.visible=!1),i.curTryOnMode!==i.tryOnMode.TDShow)return;i.setModelTryOnState(),i.container.style.removeProperty("background-color")}else alert("没有模特试戴信息，不能进入模特试戴！");else i.bDrawSparkle=!0,void 0!==i.ground&&(i.ground.visible=!0),i.quitModelTryOn(),i.camera.fov=i.defaultCamereFov,i.camera.updateProjectionMatrix(),i.backgroundCamera.left=i.divWidth/-2,i.backgroundCamera.right=i.divWidth/2,i.backgroundCamera.top=i.divHeight/2,i.backgroundCamera.bottom=i.divHeight/-2,i.backgroundCamera.updateProjectionMatrix(),i.scene.background=i.curBackgroundColor;i.isAntiAliasing()},af.prototype.getUserTryonInfo=function(){var e=this,t={};return t.camPos=e.camera.position.x.toFixed(3).toString()+","+e.camera.position.y.toFixed(3).toString()+","+e.camera.position.z.toFixed(3).toString(),t.ctrlTarget="0,0,0",t.objPos=e.rootNode.position.x.toFixed(3).toString()+","+e.rootNode.position.y.toFixed(3).toString()+","+e.rootNode.position.z.toFixed(3).toString(),t.objRot=e.rootNode.quaternion.x.toFixed(3).toString()+","+e.rootNode.quaternion.y.toFixed(3).toString()+","+e.rootNode.quaternion.z.toFixed(3).toString()+","+e.rootNode.quaternion.w.toFixed(3).toString(),t.objScale=e.rootNode.scale.x.toString()+","+e.rootNode.scale.y.toString()+","+e.rootNode.scale.z.toString(),t},af.prototype.setMode=function(e){var t=this;if(t.isModelTryon=!1,"3DView"===e){switch(t.bDrawSparkle=!0,void 0!==t.ground&&(t.ground.visible=!0),t.curTryOnMode){case t.tryOnMode.TryOn:case t.tryOnMode.Capture:t.quitTryOn();break;case t.tryOnMode.Share:}t.scene.background=t.curBackgroundColor,t.bIsVarDesign&&t.switchRealRenderingShadowState(!0)}else if("Tryon"===e){if(t.scene.background=null,t.bDrawSparkle=!1,void 0!==t.ground&&(t.ground.visible=!1),t.curTryOnMode!==t.tryOnMode.TDShow)return;t.setTryOnState(),t.container.style.removeProperty("background-color"),t.bIsVarDesign&&t.switchRealRenderingShadowState(!1),t.curStyleType==t.styleType.Glasses&&(t.rootNode.position.z=0)}t.isAntiAliasing()},af.prototype.takePhotos=function(){this.bTakePhoto=!0},af.prototype.reTake=function(){var e,t=this;t.resetRenderSize(),t.curTryOnMode===t.tryOnMode.Capture&&(t.mirrorBkRender(window.isFrontCamera),null!==(e=document.getElementById("arjs-video"))?((e=new Is(e)).wrapS=e.wrapT=be,e.minFilter=Ae,t.bgMesh.material.map=e,t.bgRenderer.domElement.style.display="block",void 0!==t.takeRender&&(t.takeRender.style.display="none")):t.startWebCam(),t.clearCacheByType(),t.curTryOnMode=t.tryOnMode.TryOn)},af.prototype.zoomCamera=function(e){this.zoomDelta=e,this.isModelTryon?this.zoomModelTryon(e):this.photoZoom(e)},af.prototype.setBeautyFilter=function(e){this.bBeauty=e},af.prototype.clearCache=function(){var e=this;e.resetRenderSize(),e.ringTryOnCache=new e.tryOnCache,e.necklaceTryOnCache=new e.tryOnCache,e.earringTryOnCache=new e.tryOnCache,e.watchTryOnCache=new e.tryOnCache,e.braceletTryOnCache=new e.tryOnCache,e.reTake()},af.prototype.getTryImage=function(){var e=this;if(2!==getTryOnState())return"Please take photos after taking photos.";var t=document.createElement("canvas");t.width=e.divWidth,t.height=e.divHeight;var n=t.getContext("2d");return e.isFlip&&(n.translate(e.divWidth,0),n.scale(-1,1)),n.drawImage(e.bgRenderer.domElement,0,0,e.divWidth,e.divHeight),e.isFlip&&(n.translate(e.divWidth,0),n.scale(-1,1)),n.drawImage(e.renderer.domElement,0,0,e.divWidth,e.divHeight),t.toDataURL("image/png")},af.prototype.getTryOnState=function(){var e=this;if(e.curTryOnMode===e.tryOnMode.TDShow)return e.tryOnMode.TDShow;switch(e.curStyleType){case e.styleType.Ring:return null!==e.ringTryOnCache.bgTex?e.tryOnMode.Capture:e.tryOnMode.TryOn;case e.styleType.Necklace:return null!==e.necklaceTryOnCache.bgTex?e.tryOnMode.Capture:e.tryOnMode.TryOn;case e.styleType.Earring:return null!==e.earringTryOnCache.bgTex?e.tryOnMode.Capture:e.tryOnMode.TryOn;case e.styleType.Watch:return null!==e.watchTryOnCache.bgTex?e.tryOnMode.Capture:e.tryOnMode.TryOn;default:return e.tryOnMode.TryOn}},af.prototype.postureReset=function(){var e,t=this;t.controls.reset(),t.curTryOnMode===t.tryOnMode.TDShow?(t.setDefPosture(!1),t.bIsVarDesign?t.curStyleType!==t.styleType.Ring||(e=t.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id!=t.rootNode.mainPartId})[0])&&(t.rootNode.position.y=-e.boundingBoxMaxY/10):t.curStyleType===t.styleType.Ring&&(e=((t.maxY+t.minY)/2).toFixed(2),t.rootNode.position.y-=e),t.curStyleType===t.styleType.Glasses&&(t.rootNode.position.z=(t.maxZ-t.minZ)/2)):(t.setDefPosture(!0),t.curStyleType===t.styleType.Glasses&&(t.rootNode.position.z=0))},af.prototype.getDesignImage=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:130,i=this;e=e||i.divWidth,t=t||i.divHeight;var a=new Vt(i.camera.position.x,i.camera.position.y,i.camera.position.z);n&&(i.camera.position.set(0,0,r),i.controls.update());var o=new $t(e,t);o.texture.generateMipmaps=!1,i.renderer.setRenderTarget(o),i.renderer.render(i.scene,i.camera);var s=new Uint8Array(e*t*4),n=new Uint8ClampedArray(s.buffer);i.renderer.readRenderTargetPixels(o,0,0,e,t,s);r=new ImageData(n,e,t),s=document.createElement("canvas");s.width=e,s.height=t;n=s.getContext("2d");n.putImageData(r,0,0);t=n.getImageData(0,0,e,t);return n.putImageData(i.imageDataVRevert(r,t),0,0),o=null,i.camera.position.set(a.x,a.y,a.z),i.renderer.setRenderTarget(null),s.toDataURL("image/png")},af.prototype.imageDataVRevert=function(e,t){for(var n=0,r=e.height;n<r;n++)for(var i=0,a=e.width;i<a;i++)t.data[n*a*4+4*i]=e.data[(r-n)*a*4+4*i],t.data[n*a*4+4*i+1]=e.data[(r-n)*a*4+4*i+1],t.data[n*a*4+4*i+2]=e.data[(r-n)*a*4+4*i+2],t.data[n*a*4+4*i+3]=e.data[(r-n)*a*4+4*i+3];return t},af.prototype.initTextCanvasWithAlign=function(i,a,o,s){var l=this;l.isFontReady||(console.log("append FontLoading..."),l.fontLoadingState||(l.container.appendChild(l.fontLoading),l.fontLoadingState=!0));var c=setInterval(function(){if(l.isFontReady){var e=l.textCanvasWidth,t=l.textCanvasHeight;l.textCanvas=document.createElement("canvas"),l.textCanvas.width=e,l.textCanvas.height=t;var n=l.textCanvas.getContext("2d");n.font=l.defaultFontSize*o+"px "+l.fontClass,n.fillStyle="#ffffff",n.textBaseline="middle";var r=e/2,t=t/2;return-1!=a.indexOf("left")?(r=0,n.textAlign="left"):-1!=a.indexOf("right")?(r=e,n.textAlign="right"):-1!=a.indexOf("middle")&&(n.textAlign="center"),i&&n.fillText(i,r,t),n.strokeStyle="#aaaaaa",n.lineWidth=7,i&&0==s&&n.strokeText(i,r,t),clearInterval(c),l.container.contains(l.fontLoading)&&(l.container.removeChild(l.fontLoading),console.log("remove FontLoading...")),l.textCanvas}},20)},af.prototype.initEngraveLayers=function(){var l=this;l.engraveLayers=[];for(var e=0;e<l.designLayers.length;++e){var c=l.designLayers[e];-1==c.type&&function(){var t=new l.EngraveLayer;if(t.layerId=c.id,t.parentLayerId=c.parentLayerId,t.textAlign=c.textAlign,t.letteringSize=c.letteringSize,t.letteringType=c.letteringType,c.meshNames){var n=c.meshNames.split("/")[0];if(l.bIsVarDesign){if(null!=c.meshObjs)for(var e=0;e<c.meshObjs.length;e++){var r=c.meshObjs[e];t.decalMesh=r}}else l.glbScene.traverse(function(e){e.isMesh&&n==e.name&&(t.decalMesh=e)});for(var i,a=0;a<l.designLayers.length;++a){var o=l.designLayers[a];if(o.id==t.parentLayerId&&null!=o.meshObjs){for(var s=0;s<o.meshObjs.length;s++){t.curMesh=o.meshObjs[s];break}break}}t.curMesh&&(null==t.decalMaterial&&((i=null)==t.letteringType||0==t.letteringType?i=l.metalEnvCubeMap:1==t.letteringType&&(i=null),t.decalMaterial=new THREE.MeshPhongMaterial({specular:0,envMap:i,reflectivity:.9,transparent:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-4,wireframe:!1})),null==t.letteringType||0==t.letteringType?t.decalMaterial.color=t.curMesh.material.color.clone().multiplyScalar(l.fontColorScale):1==t.letteringType&&(t.decalMaterial.color=t.curMesh.material.color.clone().multiplyScalar(l.jiguangFontColorScale)),t.decalMaterial.opacity=0,t.decalMesh&&(t.decalMesh.material=t.decalMaterial)),l.engraveLayers.push(t)}}()}};var sf,lf=["test","split","length","toString","replace","sort","Sparkle","DiamondUtils","processScene"];sf=lf,function(e){for(;--e;)sf.push(sf.shift())}(448);function cf(e,t){return lf[e=+e]}function uf(e,t,n){return IJEWEL[cf("0x1")][cf("0x2")](e,t,n)}String.prototype.colorHex=function(){if(/^(rgb|RGB)/[cf("0x3")](this)){for(var e=this.replace(/(?:\(|\)|rgb|RGB)*/g,"")[cf("0x4")](","),t="#",n=0;n<e[cf("0x5")];n++){var r=Number(e[n])[cf("0x6")](16);t+=r=r.length<2?"0"+r:r}return t=7!==t.length?this:t}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/[cf("0x3")](this)){var i=this[cf("0x7")](/#/,"")[cf("0x4")]("");if(6===i[cf("0x5")])return this;if(3===i[cf("0x5")]){for(var a="#",n=0;n<i[cf("0x5")];n+=1)a+=i[n]+i[n];return a}}return this};function hf(e,t,n){n={irradianceProbe:{value:e},radianceProbe:{value:t},iridescenceLookUp:{value:n},color:{value:new THREE.Color(1,1,1)},color2:{value:new THREE.Color(1,1,1)},boost:{value:1},roughness:{value:1}},THREE.ShaderMaterial.call(this,{uniforms:n,vertexShader:"varying vec3 vWorldPosition;\nvarying vec3 vWorldNormal;\n\nvoid main() {\n    vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n    // normalMatrix is view space... we need world space which is okay here since we're using uniform scaling only\n    vec4 viewPos = modelViewMatrix * vec4(position,1.0);\n    vWorldNormal = mat3(modelMatrix) * normalize(normal);\n    gl_Position = projectionMatrix * viewPos;\n}",fragmentShader:"varying vec3 vWorldPosition;\nvarying vec3 vWorldNormal;\n\nuniform vec3 color;\nuniform vec3 color2;\nuniform float boost;\nuniform float roughness;\nuniform samplerCube radianceProbe;\nuniform samplerCube irradianceProbe;\nuniform sampler2D iridescenceLookUp;\n\nvoid main() {\n\n    vec3 viewWorldDir = normalize(vWorldPosition - cameraPosition);\n\n    vec3 normal = normalize(vWorldNormal); //getNormal(normalSample.xy);\n    vec3 viewNormal = mat3(viewMatrix) * normal;\n\n    vec3 albedo = color;\n    vec3 diffuseLight = vec3(0.0);\n    vec3 specularLight = vec3(0.0);\n\n    vec3 reflectedView = reflect(viewWorldDir, normal);\n    float NdotV = max(-dot(viewWorldDir, normal), 0.0);\n    float fresnelFactor = pow(1.0 - NdotV, 5.0);\n\n    // * .99 to remove the glossy bit\n    vec3 airy = texture2D(iridescenceLookUp, vec2(NdotV * .99, 0.0)).xyz;\n    airy *= airy;\n\n    vec4 reflectionSample = textureCube(radianceProbe, reflectedView, roughness) ;\n\n    specularLight = reflectionSample.xyz * reflectionSample.xyz * airy * boost;\n\n    vec4 diffuseSample = textureCube(irradianceProbe, normal);\n    diffuseLight = diffuseSample.xyz * diffuseSample.xyz;\n\n    vec3 final = color2 *(albedo * diffuseLight + specularLight);\n\n    gl_FragColor = vec4(sqrt(final), 1.0);\n}\n"}),this.extensions.derivatives=!0}hf.prototype=Object.create(THREE.ShaderMaterial.prototype,{radianceProbe:{get:function(){return this.uniforms.radianceProbe.value},set:function(e){this.uniforms.radianceProbe.value=e}},irradianceProbe:{get:function(){return this.uniforms.irradianceProbe.value},set:function(e){this.uniforms.irradianceProbe.value=e}},iridescenceLookUp:{get:function(){return this.uniforms.iridescenceLookUp.value},set:function(e){this.uniforms.iridescenceLookUp.value=e}},color:{get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},color2:{get:function(){return this.uniforms.color2.value},set:function(e){this.uniforms.color2.value=e}},boost:{get:function(){return this.uniforms.boost.value},set:function(e){this.uniforms.boost.value=e}},roughness:{get:function(){return this.uniforms.roughness.value},set:function(e){this.uniforms.roughness.value=e}}});function df(e,t,n,r){this._filmThickness=e||380,this._refractiveIndexFilm=t||2,this._refractiveIndexBase=n||3,this._size=r||64,this._data=new Uint8Array(4*this._size),this._updateData(),THREE.DataTexture.call(this,this._data,this._size,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.LinearFilter,THREE.LinearMipMapLinearFilter),this.generateMipmaps=!0,this.needsUpdate=!0}function pf(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ff(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ff(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,t=function(){};return{s:t,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function ff(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(df.prototype=Object.create(THREE.DataTexture.prototype,{filmThickness:{get:function(){return this._filmThickness},set:function(e){this._filmThickness=e,this.updateSettings(this._filmThickness,this._refractiveIndexFilm,this._refractiveIndexBase)}},refractiveIndexFilm:{get:function(){return this._refractiveIndexFilm},set:function(e){this._refractiveIndexFilm=e,this.updateSettings(this._filmThickness,this._refractiveIndexFilm,this._refractiveIndexBase)}},refractiveIndexBase:{get:function(){return this._refractiveIndexBase},set:function(e){this._refractiveIndexBase=e,this.updateSettings(this._filmThickness,this._refractiveIndexFilm,this._refractiveIndexBase)}}})).updateSettings=function(e,t,n){this._filmThickness=e||380,this._refractiveIndexFilm=t||2,this._refractiveIndexBase=n||3,this._updateData()},df.prototype._fresnelRefl=function(e,t,n,r,i,a){var o,s=1-n*n,l=e/t;1<l*l*s?(i.x=1,i.y=1,o=l*l,a.x=2*Math.atan(-o*Math.sqrt(s-1/o)/n),a.y=2*Math.atan(-Math.sqrt(s-1/o)/n)):(o=(e*n-t*r)/(e*n+t*r),a.x=(r=(t*n-e*r)/(t*n+e*r))<0?Math.PI:0,a.y=o<0?Math.PI:0,i.x=r*r,i.y=o*o)},df.prototype._updateData=function(){var e=this._filmThickness,t=this._refractiveIndexFilm,n=this._refractiveIndexBase,r=this._size;for(var i,a,o,s,l,c,u,h=this._data,d=new THREE.Vector2,p=new THREE.Vector2,f=new THREE.Vector2,m=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,x=new THREE.Vector2,b=new THREE.Vector2,_=new THREE.Vector2,M=new THREE.Vector2,w=new THREE.Vector2,T=1/(t*t),S=t*t/(n*n),E=0;E<r;++E){var A=E/r,C=Math.sqrt(1-T*(1-A*A)),P=Math.sqrt(1-S*(1-C*C)),L=2*Math.PI*(2*t*e*C);this._fresnelRefl(1,t,A,C,m,d),g.x=1-m.x,g.y=1-m.y,p.x=Math.PI-d.x,p.y=Math.PI-d.y,this._fresnelRefl(t,n,C,P,v,f),y.x=Math.sqrt(v.x*m.x),y.y=Math.sqrt(v.y*m.y),x.x=Math.sqrt(g.x*g.x),x.y=Math.sqrt(g.y*g.y),b.x=g.x*g.x*v.x/(1-v.x*m.x),b.y=g.y*g.y*v.y/(1-v.y*m.y),_.x=y.x*y.x,_.y=y.y*y.y,M.x=m.x+b.x,M.y=m.y+b.y,w.x=b.x-x.x,w.y=b.y-x.y;for(var O=0,I=0,R=0,F=0,N=0,D=0,k=0;k<64;++k){var U=380+k/63*400,B=L/U,z=Math.cos(B+f.x+p.x),H=Math.cos(B+f.y+p.y),G=.5*(M.x+2*(y.x*z-_.x)/(1-2*y.x*z+_.x)*w.x+(M.y+2*(y.y*H-_.y)/(1-2*y.y*H+_.y)*w.y)),B=(u=c=void 0,c=((l=U)-442)*(l<442?.0624:.0374),u=(l-599.8)*(l<599.8?.0264:.0323),l=(l-501.1)*(l<501.1?.049:.0382),.362*Math.exp(-.5*c*c)+1.056*Math.exp(-.5*u*u)-.065*Math.exp(-.5*l*l)),z=(s=void 0,s=((o=U)-568.8)*(o<568.8?.0213:.0247),o=(o-530.9)*(o<530.9?.0613:.0322),.821*Math.exp(-.5*s*s)+.286*Math.exp(-.5*o*o)),H=(a=void 0,a=((i=U)-437)*(i<437?.0845:.0278),i=(i-459)*(i<459?.0385:.0725),1.217*Math.exp(-.5*a*a)+.681*Math.exp(-.5*i*i));F+=B,N+=z,D+=H,O+=B*G,I+=z*G,R+=H*G}var j=3.2406*(O/=F)-1.5372*(I/=N)-.4986*(R/=D),A=-.9689*O+1.8758*I+.0415*R,C=.0557*O-.204*I+1.057*R,j=THREE.Math.clamp(j,0,1),A=THREE.Math.clamp(A,0,1),C=THREE.Math.clamp(C,0,1);j=Math.sqrt(j),A=Math.sqrt(A),C=Math.sqrt(C);P=E<<2;h[P]=Math.floor(255*j),h[1+P]=Math.floor(255*A),h[2+P]=Math.floor(255*C),h[3+P]=255}this.needsUpdate=!0},af.prototype.loadProcessTex=function(){var t=this;this.textureLoader.load(this.pluginBaseUrl+"core/textures/Process/sandblast1.jpg",function(e){t.sandblastNmTex=e,t.sandblastNmTex.wrapS=t.sandblastNmTex.wrapT=xe,t.sandblastNmTex.repeat.set(2,2),t.commonMat.MetalSandblast=new Wl({color:16777215,envMap:t.metalEnvCubeMap,normalMap:t.sandblastNmTex,metalness:1,roughness:.3,name:"sandblast"})}),this.textureLoader.load(this.pluginBaseUrl+"core/textures/Process/brushedheng_nrm.png",function(e){t.brushedNmTex=e,t.brushedNmTex.wrapS=t.brushedNmTex.wrapT=xe,t.brushedNmTex.repeat.set(.01,20),t.commonMat.MetalBrushed=new Wl({color:16777215,envMap:t.metalEnvCubeMap,normalMap:t.brushedNmTex,metalness:1,roughness:.3,name:"brushed"})}),this.textureLoader.load(this.pluginBaseUrl+"core/textures/Process/tex_zuojiu_nrm.png",function(e){t.distressNmTex=e,t.distressNmTex.wrapS=t.distressNmTex.wrapT=xe,t.distressNmTex.repeat.set(1,1),t.commonMat.Metalzuojiu=new Wl({color:16777215,envMap:t.metalEnvCubeMap,envMapIntensity:.7,normalMap:t.distressNmTex,metalness:1,roughness:.3,name:"zuojiu"})})},af.prototype.createCabochonMat=function(){var e,r=this;r.bCabochonHdrsLoaded||r.bStartLoadingCabochon||(r.bStartLoadingCabochon=!0,r.feicuiHdrUrls=r.genCubeUrls(r.hdrUrl+"textures/Hdrs/feicui/",".hdr"),r.humianHdrUrls=r.genCubeUrls(r.hdrUrl+"textures/Hdrs/humian/",".hdr"),(e=[]).push(new Promise(function(n){r.feicuiEnvCubeMap=r.hdrTextureLoader.load(Le,r.feicuiHdrUrls,function(){var e=new Cd(r.feicuiEnvCubeMap);e.update(r.renderer);var t=new Pd(e.cubeLods);t.update(r.renderer),r.feicuiHdrCubeRenderTarget=t.CubeUVRenderTarget,r.feicuiEnvCubeMap.minFilter=Ae,r.feicuiEnvCubeMap.magFilter=Ae,r.feicuiEnvCubeMap.needsUpdate=!0,e.dispose(),t.dispose(),r.cabochonMat.Jade=new Wl({color:65280,envMap:r.feicuiHdrCubeRenderTarget.texture,envMapIntensity:.9,metalness:1.4,roughness:.78,name:"Jade"}),r.cabochonHdrs.defJade=r.feicuiHdrCubeRenderTarget.texture,n()})})),e.push(new Promise(function(n){r.humianEnvCubeMap=r.gemHdrTextureLoader.load(Le,r.humianHdrUrls,function(){var e=new Cd(r.humianEnvCubeMap);e.update(r.renderer);var t=new Pd(e.cubeLods);t.update(r.renderer),r.humianHdrCubeRenderTarget=t.CubeUVRenderTarget,r.humianEnvCubeMap.minFilter=Ae,r.humianEnvCubeMap.magFilter=Ae,r.humianEnvCubeMap.needsUpdate=!0,e.dispose(),t.dispose(),r.cabochonMat["Rose quartz"]=new Wl({color:16749754,envMap:r.humianEnvCubeMap,envMapIntensity:1.7,metalness:.8,roughness:.17,name:"Rose quartz"});t=new pr((225/255).toFixed(2),(115/255).toFixed(2),.6.toFixed(2));r.cabochonMat["Rose quartz"]=new Wl({color:t,envMap:r.humianHdrCubeRenderTarget.texture,envMapIntensity:1.2,metalness:1.1,roughness:.28,name:"Rose quartz"}),t=new pr((17/255).toFixed(2),(235/255).toFixed(2),(132/255).toFixed(2)),r.cabochonMat["Grape stone"]=new Wl({color:t,envMap:r.humianHdrCubeRenderTarget.texture,envMapIntensity:1.1,metalness:1,roughness:.3,name:"Grape stone"}),r.cabochonMat["White jade"]=new Wl({color:16777215,envMap:r.humianHdrCubeRenderTarget.texture,envMapIntensity:1.4,metalness:1,roughness:.58,name:"White jade"}),t=new pr(0,(160/255).toFixed(2),0),r.cabochonMat["Jade 1"]=new Wl({color:t,envMap:r.humianHdrCubeRenderTarget.texture,envMapIntensity:.8,metalness:.8,roughness:.46,name:"Jade 1"}),r.cabochonMat["Ice Jadeite"]=new Wl({color:16777215,envMap:r.humianHdrCubeRenderTarget.texture,envMapIntensity:1.4,metalness:1,roughness:.6,name:"Ice Jadeite"}),r.cabochonMat.Rhodochrosite=new Wl({color:16711680,envMap:r.humianHdrCubeRenderTarget.texture,envMapIntensity:1.3,metalness:1,roughness:.53,name:"Rhodochrosite"}),t=new pr((115/255).toFixed(2),0,0),r.cabochonMat.Agate=new Wl({color:t,envMap:r.humianHdrCubeRenderTarget.texture,envMapIntensity:1.4,metalness:1.3,roughness:.38,name:"Agate"}),t=new pr(0,(122/255).toFixed(2),(238/255).toFixed(2)),r.cabochonMat.Turquoise=new Wl({color:t,envMap:r.humianHdrCubeRenderTarget.texture,envMapIntensity:1,metalness:.9,roughness:.66,name:"Turquoise"}),t=new pr((136/255).toFixed(2),(60/255).toFixed(2),(218/255).toFixed(2)),r.cabochonMat["Purple jade"]=new Wl({color:t,envMap:r.humianHdrCubeRenderTarget.texture,envMapIntensity:1.1,metalness:1,roughness:.44,name:"Purple jade"}),t=new pr((5/255).toFixed(2),(18/255).toFixed(2),(248/255).toFixed(2)),r.cabochonMat["Blue amber"]=new Wl({color:t,envMap:r.humianHdrCubeRenderTarget.texture,envMapIntensity:1.5,metalness:1.2,roughness:.66,name:"Blue amber"}),r.cabochonHdrs.defCabochon=r.humianHdrCubeRenderTarget.texture,n()})})),Promise.all(e).then(function(){r.bCabochonHdrsLoaded=!0}))},af.prototype.createPearlMat=function(){var e=this,t=new df,n=e.loadCubeMap(e.hdrUrl+"textures/Hdrs/pearl/radiance6",".jpg"),r=e.loadCubeMap(e.hdrUrl+"textures/Hdrs/pearl/irradiance",".jpg");t.filmThickness=527.2708749149073,t.refractiveIndexFilm=1.034684077066024,t.refractiveIndexBase=4.1996544029553045,e.pearlMat["White pearl"]=new hf(r,n,t),e.pearlMat["White pearl"].boost=5,e.pearlMat["White pearl"].roughness=1;var i=new pr((238/255).toFixed(2),(226/255).toFixed(2),(37/255).toFixed(2));e.pearlMat["White pearl"].color=i,i=new pr((150/255).toFixed(2),(177/255).toFixed(2),(183/255).toFixed(2)),e.pearlMat["White pearl"].color2=i;n=new df,t=e.loadCubeMap(e.hdrUrl+"textures/Hdrs/pearl/radiance6",".jpg");n.filmThickness=1e3,n.refractiveIndexFilm=1.034684077066024,n.refractiveIndexBase=3.6360295503996793,e.pearlMat["Gold pearl"]=new hf(r,t,n),e.pearlMat["Gold pearl"].boost=4.243010160844198,i=new pr(e.pearlMat["Gold pearl"].roughness=1,1,1),e.pearlMat["Gold pearl"].color=i,i=new pr((223/255).toFixed(2),(203/255).toFixed(2),(60/255).toFixed(2)),e.pearlMat["Gold pearl"].color2=i;t=new df,n=e.loadCubeMap(e.hdrUrl+"textures/Hdrs/pearl/radiance6",".jpg");t.filmThickness=400.4552830898916,t.refractiveIndexFilm=1.4248858980660724,t.refractiveIndexBase=5,e.pearlMat["Black pearl"]=new hf(r,n,t),e.pearlMat["Black pearl"].boost=5,e.pearlMat["Black pearl"].roughness=1,i=new pr(0,0,0),e.pearlMat["Black pearl"].color=i,i=new pr((64/255).toFixed(2),(81/255).toFixed(2),(85/255).toFixed(2)),e.pearlMat["Black pearl"].color2=i;n=new df,t=e.loadCubeMap(e.hdrUrl+"textures/Hdrs/pearl/radiance6",".jpg");n.filmThickness=527.2708749149073,n.refractiveIndexFilm=1.034684077066024,n.refractiveIndexBase=4.1996544029553045,e.pearlMat["Pink pearl"]=new hf(r,t,n),e.pearlMat["Pink pearl"].boost=4,e.pearlMat["Pink pearl"].roughness=1,i=new pr((237/255).toFixed(2),(228/255).toFixed(2),(227/255).toFixed(2)),e.pearlMat["Pink pearl"].color=i,i=new pr((237/255).toFixed(2),(228/255).toFixed(2),(227/255).toFixed(2)),e.pearlMat["Pink pearl"].color2=i},af.prototype.loadCubeMap=function(e,t){t=[e+"/posX"+t,e+"/negX"+t,e+"/posY"+t,e+"/negY"+t,e+"/posZ"+t,e+"/negZ"+t];return(new Tc).load(t)},af.prototype.editMetalMat=function(e,a,o,s){var l=this,c=new pr((e[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2));l.glbScene.traverse(function(e){if(e.isMesh&&null!=l.designLayers)for(var t=0;t<l.designLayers.length;++t){var n=l.designLayers[t];if(0===n.type)for(var r=n.meshNames.split("/"),i=0;i<r.length;++i)r[i]===e.name&&(e.material.color=c,e.material.metalness=a,e.material.roughness=o,e.material.envMapIntensity=s)}}),l.updateAllDecalMeterialColor()},af.prototype.updateAllDecalMeterialColor=function(){for(var e=0;e<this.engraveLayers.length;e++){var t=this.engraveLayers[e];null==t.letteringType||0==t.letteringType?(t.decalMaterial.envMap=this.metalEnvCubeMap,t.decalMaterial.color=t.curMesh.material.color.clone().multiplyScalar(this.fontColorScale)):1==t.letteringType&&(t.decalMaterial.envMap=null,t.decalMaterial.color=t.curMesh.material.color.clone().multiplyScalar(this.jiguangFontColorScale)),t.decalMaterial.needsUpdate=!0}this.render()},af.prototype.editFacetedGemMat=function(e,t,n,r,i,a,o){var s=new pr((e[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2));if(null!=this.diamonds)for(var l=0;l<this.diamonds.length;++l){var c=this.diamonds[l].getMesh().material;c.uniforms.refractiveIndex.value=t,c.uniforms.colorCorrection.value=s,c.uniforms.rIndexDelta.value=n,c.uniforms.envMapIntensity.value=r,c.needsUpdate=!0}},af.prototype.editCabochonGemMat=function(e,t,n,r){if(null===this.commonMat.Cabochon)return console.log("未初始化材质"),!1;e=new pr((e[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2));return this.commonMat.Cabochon.color=e,this.commonMat.Cabochon.metalness=t,this.commonMat.Cabochon.roughness=n,this.commonMat.Cabochon.envMapIntensity=r,!0},af.prototype.editStandardMeshMaterial=function(e,i,a,o,s){var l=this,c=new pr((e[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2));l.glbScene.traverse(function(e){if(e.isMesh&&null!=l.designLayers)for(var t=0;t<l.designLayers.length;++t)for(var n=l.designLayers[t].meshNames.split("/"),r=0;r<n.length;++r)n[r]===e.name&&(e.material.color=c,e.material.metalness=i,e.material.roughness=a,e.material.envMapIntensity=o,e.material.envMap=l.metalEnvCubeMap,e.material.opacity=s)})},af.prototype.SaveLayerObjs=function(e,t){e.meshObjs||(e.meshObjs=[]),-1==e.meshObjs.indexOf(t)&&e.meshObjs.push(t)},af.prototype.processMeshNames=function(e){-1!=e.meshNames.indexOf(" ")&&(e.meshNames=e.meshNames.replace(/ /g,"_")),-1!=e.meshNames.indexOf(".")&&(e.meshNames=e.meshNames.replace(/./g,""))},af.prototype.assignLayerMat=function(i){var s=this,e=i.scene.partInfo.layers,e={quality:"medium",envCubeMap:s.gemEnvCubeMap,diamondConfiguration:s.getDiamondConfig(e)},t=uf(s.renderer,i.scene,e);if(s.bEnableSparkles&&0<t.length){var n=s.initPartSparkles(t.length);s.sparklesOfPart.set(i.scene.partInfo.id,n);for(var r=0;r<t.length;++r)for(var a=r*s.sparkleNum;a<r*s.sparkleNum+s.sparkleNum;++a){var o=t[r].getCentreOffset(),l=t[r].getBoundingRadius(),c=o.y,u=o.x+(Math.random()-.5)*l*s.sparkleScaleArg,o=o.z+(Math.random()-.5)*l*s.sparkleScaleArg;n[a].setPositionOffset(u,c,o),s.curStyleType==s.styleType.Necklace?n[a].setScale((Math.random()*l/5+l/5*.35)*t[r].t.scale.x*s.sparkleSmallScale):n[a].setScale((Math.random()*l/5+l/5*.35)*t[r].t.scale.x*s.sparkleBigScale),t[r].addSparkle(n[a])}}var h=s.designLayers.length;if(0<h){for(var d=function(e){var o=s.designLayers[e],r=o.partLayerIds.filter(function(e){return e.id==i.scene.partInfo.id})[0];r&&function(){for(var n=r.layerIds.split(","),e=function(t){var e,a=i.scene.partInfo.layers.filter(function(e){return e.id==parseInt(n[t])})[0];a&&(s.processMeshNames(a),e=a.meshNames,null==o.meshNames?o.meshNames=e:o.meshNames+="/"+e,o.type==s.materialType.metal?s.assignMetalLayerMat(o,i.scene,a):o.type==s.materialType.gem?1===o.ogType||0===o.ogType&&"faceted"===o.gem.faceType?s.assignDiamondLayerMat(o,i,a):0===o.ogType&&"cabochon"===o.gem.faceType?i.scene.traverse(function(i){i.isMesh&&function(){for(var r=o.gem.nameEn,e=a.meshNames.split("/"),t=0;t<e.length;++t)e[t]===i.name&&function(){var n=setInterval(function(){var e,t;s.bCabochonHdrsLoaded?(null!==s.cabochonMat[r]?(s.userCabochonMat[r]?i.material=s.userCabochonMat[r]:(i.material=s.cabochonMat[r],s.userMatInfo.userGem&&(e=s.userMatInfo.userGem.filter(function(e){return e.gemId===o.gem.id})[0])&&(i.material.roughness=e.roughness,i.material.metalness=e.metalness,i.material.envMapIntensity=e.envMapIntensity,t=e.color.split(","),i.material.color=new pr((t[0]/255).toFixed(2),(t[1]/255).toFixed(2),(t[2]/255).toFixed(2)),0!==e.hdrId&&s.updateMatHdr("Cabochon",e.hdrId,i)),!e&&s.userMatInfo.defGem&&(e=s.userMatInfo.defGem.filter(function(e){return e.gemId===o.gem.id})[0])&&(i.material.roughness=e.roughness,i.material.metalness=e.metalness,i.material.envMapIntensity=e.envMapIntensity,t=e.color.split(","),i.material.color=new pr((t[0]/255).toFixed(2),(t[1]/255).toFixed(2),(t[2]/255).toFixed(2)),0!==e.hdrId&&s.updateMatHdr("Cabochon",e.hdrId,i)),s.userCabochonMat[r]=i.material.clone()),s.commonMat.Cabochon=i.material):alert("未初始化此材质！"+o.gem.name),clearInterval(n)):s.createCabochonMat()},20);s.SaveLayerObjs(o,i)}()}()}):"pearl"===o.gem.faceType?i.scene.traverse(function(e){if(e.isMesh)for(var t=o.gem.nameEn,n=a.meshNames.split("/"),r=0;r<n.length;++r)n[r]===e.name&&(null==s.pearlMat[t]&&s.createPearlMat(),e.material=s.pearlMat[t],s.commonMat.Pearl=e.material,s.SaveLayerObjs(o,e))}):alert("暂没有此类型宝石！"+o.gem.faceType):o.type==s.materialType.glass?i.scene.traverse(function(e){if(e.isMesh){o.materialWeb.id;for(var t,n,r=a.meshNames.split("/"),i=0;i<r.length;++i)r[i]===e.name&&(t=new Vl({color:16777215,metalness:.9,roughness:.5,envMap:s.metalEnvCubeMap,refractionRatio:2,transparent:!0,transmission:.99,side:Q,clearcoat:1,clearcoatRoughness:.39,depthTest:!0,depthWrite:!1}),n=o.materialWeb.color.split(","),t.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),t.metalness=o.materialWeb.metalness,t.roughness=o.materialWeb.roughness,t.envMapIntensity=o.materialWeb.envMapIntensity,t.transparency=1-o.materialWeb.opacity,e.material=t,e.renderOrder=10,s.SaveLayerObjs(o,e))}}):o.type==s.materialType.paint?i.scene.traverse(function(e){if(e.isMesh){o.materialWeb.id;for(var t,n,r=a.meshNames.split("/"),i=0;i<r.length;++i)r[i]===e.name&&(t=new Vl({color:16777215,metalness:.9,roughness:.5,envMap:s.metalEnvCubeMap,refractionRatio:1,clearcoat:1,clearcoatRoughness:.39}),n=o.materialWeb.color.split(","),t.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),t.metalness=o.materialWeb.metalness,t.roughness=o.materialWeb.roughness,t.envMapIntensity=o.materialWeb.envMapIntensity,t.opacity=o.materialWeb.opacity,e.material=t,s.SaveLayerObjs(o,e))}}):o.type===s.materialType.bakingPaint||o.type===s.materialType.fabric||o.type===s.materialType.leather||o.type===s.materialType.plastic||o.type===s.materialType.wood?i.scene.traverse(function(e){if(e.isMesh){o.materialWeb.id;for(var t,n,r=a.meshNames.split("/"),i=0;i<r.length;++i)r[i]===e.name&&(t=new Wl({color:16777215,envMap:s.metalEnvCubeMap,metalness:.9,roughness:.2,transparent:!0,side:Q,depthWrite:!1,depthTest:!0,name:"Plastic"}),n=o.materialWeb.color.split(","),t.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),t.metalness=o.materialWeb.metalness,t.roughness=o.materialWeb.roughness,t.envMapIntensity=o.materialWeb.envMapIntensity,t.opacity=o.materialWeb.opacity,e.material=t,s.SaveLayerObjs(o,e))}}):o.type==s.materialType.enamel?i.scene.traverse(function(e){if(e.isMesh){o.materialWeb.id;for(var t,n,r=a.meshNames.split("/"),i=0;i<r.length;++i)r[i]===e.name&&(t=new Wl({color:16777215,envMap:s.metalEnvCubeMap,metalness:.8,roughness:.5,envMapIntensity:.4,opacity:1,name:"enamel",transparent:!0}),n=o.materialWeb.color.split(","),t.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),t.metalness=o.materialWeb.metalness,t.roughness=o.materialWeb.roughness,t.envMapIntensity=o.materialWeb.envMapIntensity,t.opacity=o.materialWeb.opacity,e.material=t,s.SaveLayerObjs(o,e))}}):o.type==s.materialType.engrave?i.scene.traverse(function(e){if(e.isMesh)for(var t=a.meshNames.split("/"),n=0;n<t.length;++n)t[n]===e.name&&s.SaveLayerObjs(o,e)}):console.log("The unknown material!!!!!!"+layerName))},t=0;t<n.length;++t)e(t)}()},p=0;p<h;++p)d(p);s.setMapsForStyleWhenChangeMat()}else s.bEdit&&s.initVarStylePartMat(i)},af.prototype.initVarStylePartMat=function(t){var s=this,n=t.scene.partInfo.layers,e={quality:"medium",envCubeMap:s.gemEnvCubeMap,diamondConfiguration:s.getDiamondConfig(n)},r=uf(s.renderer,t.scene,e);if(s.bEnableSparkles){var i=s.initPartSparkles(r.length);s.sparklesOfPart.set(t.scene.partInfo.id,i);for(var a=0;a<r.length;++a)for(var o=a*s.sparkleNum;o<a*s.sparkleNum+s.sparkleNum;++o){var l=r[a].getCentreOffset(),c=r[a].getBoundingRadius(),u=l.y,h=l.x+(Math.random()-.5)*c*s.sparkleScaleArg,l=l.z+(Math.random()-.5)*c*s.sparkleScaleArg;i[o].setPositionOffset(h,u,l),s.curStyleType==styleType.Necklace?i[o].setScale((Math.random()*c/5+c/5*.35)*r[a].t.scale.x*s.sparkleSmallScale):i[o].setScale((Math.random()*c/5+c/5*.35)*r[a].t.scale.x*s.sparkleBigScale),r[a].addSparkle(i[o])}}for(var d=0;d<n.length;d++)!function(e){var a=n[e];a.meshNames=a.meshNames.replace(/ /g,"_");var o=a.meshNames.split("/");0===a.type?t.scene.traverse(function(e){e.isMesh&&-1!=o.indexOf(e.name)&&(e.material=s.commonMat.Metal.clone())}):a.type===s.materialType.gem?1===a.ogType||0===a.ogType&&"faceted"===a.gem.faceType||(0===a.ogType&&"cabochon"===a.gem.faceType?t.scene.traverse(function(n){var r,i;n.isMesh&&(r=a.gem.nameEn,-1!=o.indexOf(n.name)&&(i=setInterval(function(){var e,t;s.bCabochonHdrsLoaded?(null!==s.cabochonMat[r]?s.userCabochonMat[r]?n.material=s.userCabochonMat[r]:(n.material=s.cabochonMat[r],s.userMatInfo.userGem&&(t=s.userMatInfo.userGem.filter(function(e){return e.gemId===a.gem.id})[0])&&(n.material.roughness=t.roughness,n.material.metalness=t.metalness,n.material.envMapIntensity=t.envMapIntensity,e=t.color.split(","),n.material.color=new pr((e[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2))),!t&&s.userMatInfo.defGem&&(t=s.userMatInfo.defGem.filter(function(e){return e.gemId===a.gem.id})[0])&&(n.material.roughness=t.roughness,n.material.metalness=t.metalness,n.material.envMapIntensity=t.envMapIntensity,t=t.color.split(","),n.material.color=new pr((t[0]/255).toFixed(2),(t[1]/255).toFixed(2),(t[2]/255).toFixed(2)))):alert("未初始化此材质！"+a.gem.name),clearInterval(i)):s.createCabochonMat()},20)))}):"pearl"===a.gem.faceType?t.scene.traverse(function(e){var t;e.isMesh&&(t=a.gem.nameEn,-1!=o.indexOf(e.name)&&(null==s.pearlMat[t]&&s.createPearlMat(),e.material=s.pearlMat[t],s.commonMat.Pearl=e.material))}):alert("暂没有此类型宝石！"+a.gem.faceType)):a.type==s.materialType.bakingPaint||a.type===s.materialType.fabric||a.type===s.materialType.leather||a.type===s.materialType.plastic||a.type===s.materialType.wood?t.scene.traverse(function(e){var t,n;e.isMesh&&-1!=o.indexOf(e.name)&&(t=new Wl({color:16777215,envMap:s.metalEnvCubeMap,metalness:.9,roughness:.2,transparent:!0,side:Q,depthWrite:!1,depthTest:!0,name:"Plastic"}),n=a.materialWeb.color.split(","),t.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),t.metalness=a.materialWeb.metalness,t.roughness=a.materialWeb.roughness,t.envMapIntensity=a.materialWeb.envMapIntensity,t.opacity=a.materialWeb.opacity,e.material=t)}):a.type==s.materialType.paint?t.scene.traverse(function(e){var t,n;e.isMesh&&-1!=o.indexOf(e.name)&&(t=new Vl({color:16777215,metalness:.9,roughness:.5,envMap:s.metalEnvCubeMap,refractionRatio:1,clearcoat:1,clearcoatRoughness:.39}),n=a.materialWeb.color.split(","),t.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),t.metalness=a.materialWeb.metalness,t.roughness=a.materialWeb.roughness,t.envMapIntensity=a.materialWeb.envMapIntensity,t.opacity=a.materialWeb.opacity,e.material=t)}):a.type==s.materialType.glass?t.scene.traverse(function(e){var t,n;e.isMesh&&-1!=o.indexOf(e.name)&&(t=new Vl({color:16777215,metalness:.9,roughness:.5,envMap:s.metalEnvCubeMap,refractionRatio:2,transparent:!0,transparency:.99,side:Q,clearcoat:1,clearcoatRoughness:.39,depthTest:!0,depthWrite:!1}),n=a.materialWeb.color.split(","),t.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),t.metalness=a.materialWeb.metalness,t.roughness=a.materialWeb.roughness,t.envMapIntensity=a.materialWeb.envMapIntensity,t.transparency=1-a.materialWeb.opacity,e.material=t)}):a.type==s.materialType.enamel?t.scene.traverse(function(e){var t,n;e.isMesh&&(a.materialWeb.id,-1!=o.indexOf(e.name)&&(t=new Wl({color:16711680,envMap:s.metalEnvCubeMap,metalness:.8,roughness:.5,envMapIntensity:.4,opacity:1,name:"enamel",transparent:!0}),n=a.materialWeb.color.split(","),t.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),t.metalness=a.materialWeb.metalness,t.roughness=a.materialWeb.roughness,t.envMapIntensity=a.materialWeb.envMapIntensity,t.opacity=a.materialWeb.opacity,e.material=t))}):a.type==s.materialType.engrave?t.scene.traverse(function(e){e.isMesh&&-1!=o.indexOf(e.name)&&(e.material=s.decalMaterial)}):console.log("The unknown material!!!!!!"+a.type)}(d);s.setMapsForStyleWhenChangeMat()},af.prototype.getDiamondConfig=function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];if(1===r.type&&(1===r.ogType||0===r.ogType&&"faceted"===r.gem.faceType)){this.processMeshNames(r);for(var i=r.meshNames.split("/"),a=r.gem.refraction,o=new pr(1,1,1),s=0;s<i.length;++s){var l={name:i[s],color:o,squashFactor:.9,refractiveIndex:a,boostFactors:new Vt(1,1,1),envMapIntensity:1,rIndexDelta:.001,geometryFactor:.28};t.push(l)}}}return t},af.prototype.changeTargetMetalMat=function(i,o){var s,l=this;!(s=l.userMatInfo.userMetal?l.userMatInfo.userMetal.filter(function(e){return e.metalId===o.id})[0]:s)&&l.userMatInfo.defMetal&&(s=l.userMatInfo.defMetal.filter(function(e){return e.metalId===o.id})[0]);var c=o.color.split(",");s&&(c=s.color.split(","));for(var e=function(e){var t=i[e].id,n=i[e].layerIds.split(","),a=l.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t})[0];if(a)for(var r=0;r<n.length;r++)!function(t){var r,i=a.partInfo.layers.filter(function(e){return e.id==parseInt(n[t])})[0];i&&(r=i.meshNames.split("/"),a.traverse(function(e){if(e.isMesh)for(var t,n=0;n<r.length;n++)r[n]===e.name&&(l.userMetalMat[o.id]?e.material=l.userMetalMat[o.id].clone():(e.material=l.commonMat.Metal.clone(),e.material.color=new pr((c[0]/255).toFixed(2),(c[1]/255).toFixed(2),(c[2]/255).toFixed(2)),s&&(t=s.color.split(","),e.material.color=new pr((t[0]/255).toFixed(2),(t[1]/255).toFixed(2),(t[2]/255).toFixed(2)),e.material.roughness=s.roughness,e.material.metalness=s.metalness,e.material.envMapIntensity=s.envMapIntensity),l.userMetalMat[o.id]||(l.userMetalMat[o.id]=e.material.clone())),l.setLayerMaterialMaps(i,e.material))}),s&&0!==s.hdrId&&l.updateMetalLayerHdr(s,r,a))}(r)},t=0;t<i.length;t++)e(t);return!0},af.prototype.changeMeshesMetalMat=function(e,r){var i,a=this;!(i=a.userMatInfo.userMetal?a.userMatInfo.userMetal.filter(function(e){return e.metalId===r.id})[0]:i)&&a.userMatInfo.defMetal&&(i=a.userMatInfo.defMetal.filter(function(e){return e.metalId===r.id})[0]);var o=r.color.split(",");i&&(o=i.color.split(","));for(var s=e.split(","),t=a.rootNode.children.length,n=0;n<t;n++){var l=a.rootNode.children[n];l&&l.traverse(function(e){if(e.isMesh)for(var t,n=0;n<s.length;n++)s[n]===e.name&&(a.userMetalMat[r.id]?e.material=a.userMetalMat[r.id].clone():(e.material=a.commonMat.Metal.clone(),e.material.color=new pr((o[0]/255).toFixed(2),(o[1]/255).toFixed(2),(o[2]/255).toFixed(2)),i&&(t=i.color.split(","),e.material.color=new pr((t[0]/255).toFixed(2),(t[1]/255).toFixed(2),(t[2]/255).toFixed(2)),e.material.roughness=i.roughness,e.material.metalness=i.metalness,e.material.envMapIntensity=i.envMapIntensity),a.userMetalMat[r.id]||(a.userMetalMat[r.id]=e.material.clone())))})}return!0},af.prototype.changeTargetGemMat=function(o,s,t){var l,c=this,u=s.webColor.split(",");!(l=c.userMatInfo.userGem?c.userMatInfo.userGem.filter(function(e){return e.gemId==s.id&&e.ogType==t})[0]:l)&&c.userMatInfo.defGem&&(l=c.userMatInfo.defGem.filter(function(e){return e.gemId==s.id&&e.ogType==t})[0]);for(var e=function(e){var t=o[e].id,n=o[e].layerIds.split(","),r=c.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t})[0];if(r)for(var i=0;i<n.length;i++){var a=function(t){var i=r.partInfo.layers.filter(function(e){return e.id==parseInt(n[t])})[0];if(i){var a=i.meshNames.split("/"),o="faceted";if(s.faceType&&(o=s.faceType),0===i.ogType){var e=i.gem.faceType;if(o!=e)return alert("faceType 不一致，请重新选择材质！"),{v:{v:void 0}}}r.traverse(function(t){var n,r,e;t.isMesh&&-1!==a.indexOf(t.name)&&("faceted"==o?(t.material.uniforms.refractiveIndex.value=s.refraction,t.material.uniforms.colorCorrection.value=new pr((u[0]/255).toFixed(2),(u[1]/255).toFixed(2),(u[2]/255).toFixed(2)),l&&(e=l.color.toString().split(","),t.material.uniforms.colorCorrection.value=new pr((e[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2)),t.material.uniforms.refractiveIndex.value=l.refractiveIndex,t.material.uniforms.rIndexDelta.value=l.rIndexDelta,t.material.uniforms.envMapIntensity.value=l.envMapIntensity,0===l.hdrId&&(t.material.uniforms.envMap.value=c.gemEnvCubeMap))):"cabochon"==o?(n=s.nameEn,r=setInterval(function(){var e;c.bCabochonHdrsLoaded?(c.cabochonMat[n]&&(c.userCabochonMat[n]?t.material=c.userCabochonMat[n]:(t.material=c.cabochonMat[n],l&&(t.material.roughness=l.roughness,t.material.metalness=l.metalness,t.material.envMapIntensity=l.envMapIntensity,e=l.color.split(","),t.material.color=new pr((e[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2)))),c.setLayerMaterialMaps(i,t.material)),clearInterval(r)):c.createCabochonMat()},20)):"pearl"==o&&(e=s.nameEn,null==c.pearlMat[e]&&c.createPearlMat(),t.material=c.pearlMat[e],c.commonMat.Pearl=t.material))})}}(i);if("object"===W(a))return a.v}},n=0;n<o.length;n++){var r=e(n);if("object"===W(r))return r.v}},af.prototype.changeMeshesGemMat=function(e,i){var a,o=this,n=i.webColor.split(",");!(a=o.userMatInfo.userGem?o.userMatInfo.userGem.filter(function(e){return e.gemId==i.id&&e.ogType==i.ogType})[0]:a)&&o.userMatInfo.defGem&&(a=o.userMatInfo.defGem.filter(function(e){return e.gemId==i.id&&e.ogType==i.ogType})[0]);var s=e.split(","),l="faceted";i.faceType&&(l=i.faceType);for(var t=o.rootNode.children.length,r=0;r<t;r++){var c=o.rootNode.children[r];c&&c.traverse(function(r){if(r.isMesh)for(var e,t=0;t<s.length;t++)s[t]===r.name&&("faceted"==l?(r.material.uniforms.refractiveIndex.value=i.refraction,r.material.uniforms.colorCorrection.value=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),a&&(e=a.color.toString().split(","),r.material.uniforms.colorCorrection.value=new pr((e[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2)),r.material.uniforms.refractiveIndex.value=a.refractiveIndex,r.material.uniforms.rIndexDelta.value=a.rIndexDelta,r.material.uniforms.envMapIntensity.value=a.envMapIntensity,0===a.hdrId&&(r.material.uniforms.envMap.value=o.gemEnvCubeMap))):"cabochon"==l?function(){var t=i.nameEn,n=setInterval(function(){var e;o.bCabochonHdrsLoaded?(o.cabochonMat[t]&&(o.userCabochonMat[t]?r.material=o.userCabochonMat[t]:(r.material=o.cabochonMat[t],a&&(r.material.roughness=a.roughness,r.material.metalness=a.metalness,r.material.envMapIntensity=a.envMapIntensity,e=a.color.split(","),r.material.color=new pr((e[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2))))),clearInterval(n)):o.createCabochonMat()},20)}():"pearl"==l&&(e=i.nameEn,null==o.pearlMat[e]&&o.createPearlMat(),r.material=o.pearlMat[e],o.commonMat.Pearl=r.material))})}},af.prototype.changeTargetOtherMat=function(i,e){for(var o=this,s=e.color.split(","),l=e.metalness,c=e.roughness,u=e.hdrIntensity,h=e.opacity,t=function(e){var t=i[e].id,n=i[e].layerIds.split(","),a=o.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t})[0];if(a)for(var r=0;r<n.length;r++)!function(t){var r,i=a.partInfo.layers.filter(function(e){return e.id==parseInt(n[t])})[0];i&&(r=i.meshNames.split("/"),a.traverse(function(e){if(e.isMesh)for(var t,n=0;n<r.length;n++)r[n]===e.name&&((t=new Wl({color:16711680,envMap:o.metalEnvCubeMap,metalness:.8,roughness:.5,envMapIntensity:.4,side:Q,opacity:1,transparent:!1})).color=new pr((s[0]/255).toFixed(2),(s[1]/255).toFixed(2),(s[2]/255).toFixed(2)),t.metalness=l,t.roughness=c,t.hdrIntensity=u,t.opacity=h,e.material=t,o.setLayerMaterialMaps(i,e.material))}))}(r)},n=0;n<i.length;n++)t(n);return!0},af.prototype.changeMeshesOtherMat=function(e,t){for(var n=t.color.split(","),r=t.metalness,i=t.roughness,a=t.hdrIntensity,o=t.opacity,s=e.split(","),l=this.rootNode.children.length,c=0;c<l;c++){var u=this.rootNode.children[c];u&&u.traverse(function(e){if(e.isMesh)for(var t=0;t<s.length;t++)s[t]===e.name&&(e.material.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),e.material.metalness=r,e.material.roughness=i,e.material.hdrIntensity=a,e.material.opacity=o)})}return!0},af.prototype.loadDiamondConfiguration=function(){if(this.designLayers){this.diamondConfiguration=[];for(var e=0;e<this.designLayers.length;++e){var t=this.designLayers[e];if(1===t.type&&(1===t.ogType||2===t.ogType||0===t.ogType&&"faceted"===t.gem.faceType)){this.processMeshNames(t);for(var n=t.meshNames.split("/"),r=t.gem.refraction,i=new pr(1,1,1),a=0;a<n.length;++a){var o={name:n[a],color:i,squashFactor:.9,refractiveIndex:r,boostFactors:new Vt(1,1,1),envMapIntensity:1,rIndexDelta:.001,geometryFactor:.28};this.diamondConfiguration.push(o)}}}}},af.prototype.assignDiamondLayerMat=function(r,e,t){var i,a=this;0===r.ogType?i=r.gem:1===r.ogType&&((i=r.otherGem).refraction=r.otherGem.gemType.refraction);var o=i.webColor.split(","),s=t.meshNames.split("/"),l=0;e.scene.traverse(function(e){var t,n;e.isMesh&&-1!==s.indexOf(e.name)&&(e.material.uniforms.refractiveIndex.value=i.refraction,e.material.uniforms.colorCorrection.value=new pr((o[0]/255).toFixed(2),(o[1]/255).toFixed(2),(o[2]/255).toFixed(2)),a.userMatInfo.userGem&&(t=a.userMatInfo.userGem.filter(function(e){return 0===r.ogType?e.gemId==r.gem.id&&e.ogType==r.ogType:e.gemId==r.otherGem.id&&e.ogType==r.ogType})[0])&&(n=t.color.toString().split(","),e.material.uniforms.colorCorrection.value=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),e.material.uniforms.refractiveIndex.value=t.refractiveIndex,e.material.uniforms.rIndexDelta.value=t.rIndexDelta,e.material.uniforms.envMapIntensity.value=t.envMapIntensity,0===(l=t.hdrId)&&(e.material.uniforms.envMap.value=a.gemEnvCubeMap)),!t&&a.userMatInfo.defGem&&(t=a.userMatInfo.defGem.filter(function(e){return 0===r.ogType?e.gemId==r.gem.id&&e.ogType==r.ogType:e.gemId==r.otherGem.id&&e.ogType==r.ogType})[0])&&(n=t.color.toString().split(","),e.material.uniforms.colorCorrection.value=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),e.material.uniforms.refractiveIndex.value=t.refractiveIndex,e.material.uniforms.rIndexDelta.value=t.rIndexDelta,e.material.uniforms.envMapIntensity.value=t.envMapIntensity,0===(l=t.hdrId)&&(e.material.uniforms.envMap.value=a.gemEnvCubeMap)),a.SaveLayerObjs(r,e))}),0!==l&&a.updateGemHdr(l,r.meshNames,r.meshObjs)},af.prototype.setLayerMaterialMaps=function(e,t){this.setLayerMaterialBaseMap(e,t),this.setLayerMaterialNormalMap(e,t)},af.prototype.updateOwnMaterial=function(e,t){this.setLayerMaterialMaps(e,t)},af.prototype.setLayerMaterialBaseMap=function(e,a){var t=!1,o=this;if(e.hasOwnProperty("baseMap")){var n=e.baseMap.length;if(0<n){t=!0;for(var r=0;r<n;r++){var t=!0,s=e.baseMap[r];s.hasOwnProperty("id")&&function(){var e,t=s.id,n=s.onOff,r=s.defaultMap,i=o.baseMapPathUrl+t+"/"+r;n?o.MapDictionary.has(i)?(e=o.MapDictionary.get(i),a.map=e,a.color.r=+o.baseColorScale,a.color.g=+o.baseColorScale,a.color.b=+o.baseColorScale,a.needsUpdate=!0):e=o.textureLoader.load(i,function(e){a.map=e,a.color.r=+o.baseColorScale,a.color.g=+o.baseColorScale,a.color.b=+o.baseColorScale,a.needsUpdate=!0,o.MapDictionary.set(i,e),o.render()}):a.map=null,a.needsUpdate=!0}()}}else a.map=null}return o.render(),t},af.prototype.setLayerMaterialNormalMap=function(s,l){var e=!1,c=this;if(s.hasOwnProperty("normal")){var t=s.normal.length;if(0<t){for(var e=!0,u=[],n=0;n<t;n++)!function(e){var n=s.normal[e];if(n.hasOwnProperty("id")){var r,t=n.id,i=parseInt(n.sort),a=n.onOff,e=n.defaultMap,o=c.normalMapPathUrl+t+"/"+e;if(a)if(c.MapDictionary.has(o)){switch(r=c.MapDictionary.get(o),i){case 1:l.normalMap=r;break;case 2:l.normalMap2=r;break;case 3:l.normalMap3=r;break;case 4:l.normalMap4=r;break;case 5:l.normalMap5=r}l.normalScale.set(n.scaleX,n.scaleY),l.needsUpdate=!0}else u.push(new Promise(function(t){r=c.textureLoader.load(o,function(e){switch(i){case 1:l.normalMap=e;break;case 2:l.normalMap2=e;break;case 3:l.normalMap3=e;break;case 4:l.normalMap4=e;break;case 5:l.normalMap5=e}l.normalScale.set(n.scaleX,n.scaleY),l.needsUpdate=!0,c.MapDictionary.set(o,e),c.render(),t()})}));else switch(i){case 1:l.normalMap=null;break;case 2:l.normalMap2=null;break;case 3:l.normalMap3=null;break;case 4:l.normalMap4=null;break;case 5:l.normalMap5=null}l.needsUpdate=!0}}(n);Promise.all(u).then(function(){c.bLoadNormalMapFinished=!0})}else l.normalMap=null,l.normalMap2=null,l.normalMap3=null,l.normalMap4=null,l.normalMap5=null}return c.render(),e},af.prototype.isStandardMaterialWithMap=function(e){var t=!0;switch(e.type){case-1:t=!1;break;case 1:(1===e.ogType||0===e.ogType&&"faceted"===e.gem.faceType||"pearl"===e.gem.faceType)&&(t=!1)}if(t){if(e.hasOwnProperty("baseMap")&&0<e.baseMap.length)return t;if(e.hasOwnProperty("normal")&&0<e.normal.length)return t;t=!1}return t},af.prototype.getCloneMaterial=function(e,t){var n=null;this.processMeshNames(t);for(var r=t.meshNames.split("/"),i=!1,a=0;a<r.length;a++)if("break"===function(t){if(i)return"break";e.traverse(function(e){if(e.isMesh&&e.name==r[t]){if(e.material.map||e.material.normalMap)return null;n=e.material.clone(),i=!0}})}(a))break;return n},af.prototype.clearMaterialMaps=function(e){e.map=null,e.normalMap=null,e.normalMap2=null,e.normalMap3=null,e.normalMap4=null,e.normalMap5=null},af.prototype.setMapsForStyleWhenChangeMat=function(){for(var t=this,e=t.rootNode.children.length,n=0;n<e;n++){var i=t.rootNode.children[n];if(t.bIsVarDesign){if(i.partInfo)for(var r=i.partInfo.layers.length,a=0;a<r;a++){var o=i.partInfo.layers[a];t.isStandardMaterialWithMap(o)&&function(){var r=t.getCloneMaterial(i,o);r&&function(){t.setLayerMaterialMaps(o,r),t.processMeshNames(o);for(var n=o.meshNames.split("/"),e=0;e<n.length;e++)!function(t){i.traverse(function(e){e.isMesh&&e.name==n[t]&&(e.material=r)})}(e)}()}()}}else for(var s=t.designLayers.length,l=0;l<s;l++){var c=t.designLayers[l];t.isStandardMaterialWithMap(c)&&function(){var r=t.getCloneMaterial(i,c);r&&function(){t.setLayerMaterialMaps(c,r),t.processMeshNames(c);for(var n=c.meshNames.split("/"),e=0;e<n.length;e++)!function(t){i.traverse(function(e){e.isMesh&&e.name==n[t]&&(e.material=r)})}(e)}()}()}}},af.prototype.SetMaterialMapFromSrc=function(e,t){e.map=t.map,e.normalMap=t.normalMap,e.normalMap2=t.normalMap2,e.normalMap3=t.normalMap3,e.normalMap4=t.normalMap4,e.normalMap5=t.normalMap5},af.prototype.setOwnMatForStyleWhenChangeMat=function(){for(var t=this,e=t.rootNode.children.length,n=0;n<e;n++){var i=t.rootNode.children[n];if(t.bIsVarDesign){if(i.partInfo)for(var r=i.partInfo.layers.length,a=0;a<r;a++){var o=i.partInfo.layers[a];o.bDirty&&t.isStandardMaterialWithMap(o)&&function(){var r=t.getCloneMaterial(i,o);r&&function(){t.updateOwnMaterial(o,r),t.processMeshNames(o);for(var n=o.meshNames.split("/"),e=0;e<n.length;e++)!function(t){i.traverse(function(e){e.isMesh&&e.name==n[t]&&(e.material=r)})}(e)}()}()}}else for(var s=t.designLayers.length,l=0;l<s;l++){var c=t.designLayers[l];c.bDirty&&t.isStandardMaterialWithMap(c)&&function(){var r=t.getCloneMaterial(i,c);r&&function(){t.updateOwnMaterial(c,r),t.processMeshNames(c);for(var n=c.meshNames.split("/"),e=0;e<n.length;e++)!function(t){i.traverse(function(e){e.isMesh&&e.name==n[t]&&(e.material=r)})}(e)}()}()}}},af.prototype.hasMapsInLayer=function(e){var t=!1;return e.hasOwnProperty("normal")&&0<e.normal.length&&(t=!0),t=e.hasOwnProperty("baseMap")&&0<e.baseMap.length?!0:t},af.prototype.assignMetalLayerMat=function(r,e,t){var i,a=this,o=r.metal.color.split(","),s=r.meshNames.split("/");return a.bIsVarDesign&&(s=t.meshNames.split("/")),(i=!(i=a.userMatInfo.userMetal?a.userMatInfo.userMetal.filter(function(e){return 1==r.metal.type?e.metalId===r.metal.parentId:e.metalId===r.metal.id})[0]:i)&&a.userMatInfo.defMetal?a.userMatInfo.defMetal.filter(function(e){return 1==r.metal.type?e.metalId===r.metal.parentId:e.metalId===r.metal.id})[0]:i)&&(o=i.color.split(",")),e.traverse(function(e){if(e.isMesh)for(var t,n=0;n<s.length;++n)s[n]===e.name&&(a.userMetalMat[r.metal.id]?e.material=a.userMetalMat[r.metal.id]:(e.material=a.commonMat.Metal.clone(),e.material.color=new pr((o[0]/255).toFixed(2),(o[1]/255).toFixed(2),(o[2]/255).toFixed(2)),i&&(t=i.color.split(","),e.material.color=new pr((t[0]/255).toFixed(2),(t[1]/255).toFixed(2),(t[2]/255).toFixed(2)),e.material.roughness=i.roughness,e.material.metalness=i.metalness,e.material.envMapIntensity=i.envMapIntensity),a.userMetalMat[r.metal.id]=e.material.clone()),a.SaveLayerObjs(r,e))}),!(!i||0===i.hdrId)&&(a.updateMetalLayerHdr(i,s,e),!0)},af.prototype.assignOtherMat=function(e,t,n){var r=this;e.name;var i=e.materialWeb.name,a=e.materialWeb.color.split(",");if(e.materialWeb.type==r.materialType.fabric)for(var o,s=(r.bIsVarDesign?n:e).meshNames.split("/"),l=0;l<s.length;++l)s[l]===t.name&&(null!=r.fabricMat[i]?(t.material=r.fabricMat[i],t.material.color=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2))):((o=new Wl({color:16777215,envMap:r.metalEnvCubeMap,metalness:.8,roughness:.36,name:"Fabric"})).needsUpdate=!0,t.material=o,t.material.color=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2)),r.fabricMat[i]=o),e.meshObjs||(e.meshObjs=[]),e.meshObjs.push(t));else if(e.materialWeb.type==r.materialType.leather)for(var c,u=(r.bIsVarDesign?n:e).meshNames.split("/"),h=0;h<u.length;++h)u[h]===t.name&&(null!=r.leatherMat[i]?t.material=r.leatherMat[i]:(c=new Wl({color:16777215,envMap:r.metalEnvCubeMap,metalness:0,roughness:.9,name:"Leather"}),t.material=c,r.leatherMat[i]=c),t.material.color=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2)),e.meshObjs||(e.meshObjs=[]),e.meshObjs.push(t));else if(e.materialWeb.type==r.materialType.paint)for(var d,p=(r.bIsVarDesign?n:e).meshNames.split("/"),f=0;f<p.length;++f)p[f]===t.name&&((d=new Vl({color:16777215,metalness:.9,roughness:.5,envMap:r.metalEnvCubeMap,refractionRatio:1,clearcoat:1,clearcoatRoughness:.39})).color=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2)),t.material=d,e.meshObjs||(e.meshObjs=[]),e.meshObjs.push(t));else if(e.materialWeb.type==r.materialType.plastic)for(var m,g=(r.bIsVarDesign?n:e).meshNames.split("/"),v=0;v<g.length;++v)g[v]===t.name&&((m=new Wl({color:16777215,envMap:r.metalEnvCubeMap,metalness:.9,roughness:.2,transparent:!0,side:Q,depthWrite:!1,depthTest:!0,name:"Plastic"})).color=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2)),m.opacity=e.materialWeb.opacity,t.material=m,e.meshObjs||(e.meshObjs=[]),e.meshObjs.push(t));else if(e.materialWeb.type==r.materialType.wood)for(var y,x=(r.bIsVarDesign?n:e).meshNames.split("/"),b=0;b<x.length;++b)x[b]===t.name&&((y=new Wl({color:16777215,envMap:r.metalEnvCubeMap,metalness:1,roughness:.6,envMapIntensity:2.5,name:"Wood"})).color=new pr((a[0]/255).toFixed(2),(a[1]/255).toFixed(2),(a[2]/255).toFixed(2)),t.material=y,e.meshObjs||(e.meshObjs=[]),e.meshObjs.push(t))},af.prototype.updateMatHdr=function(n,r,i,e){var a=this;if(a.hdrUrl){var t=a.hdrUrl;if("Metal"===n){if(a.metalHdrs[r]&&i)return i.material.envMap=null,i.material.envMap=a.metalHdrs[r],i.material.needsUpdate=!0}else if("Cabochon"===n&&a.cabochonHdrs[r]&&i)return i.material.envMap=a.cabochonHdrs[r],!0;var o,t=a.genCubeUrls(t+r+"/",".hdr"),s=a.hdrTextureLoader.load(Le,t,function(){var e=new Cd(s);e.update(a.renderer);var t=new Pd(e.cubeLods);t.update(a.renderer),o=t.CubeUVRenderTarget,s.minFilter=Ae,s.magFilter=Ae,s.needsUpdate=!0,e.dispose(),t.dispose(),"Metal"==n?(i&&(i.material.envMap=null,i.material.envMap=s,i.material.needsUpdate=!0),a.metalHdrs[r]=s,a.metalHdrTextures[r]=o.texture):"Cabochon"===n&&(a.cabochonHdrs[r]=o.texture,i&&(i.material.envMap=a.cabochonHdrs[r])),a.bRotate||a.render()})}else alert("hdrPath is undefined!")},af.prototype.updateGemHdr=function(l,c,u){var h=this;if(h.hdrUrl){var e=h.hdrUrl;if(h.gemHdrs[l])if(h.bIsVarDesign)for(var t=0;t<u.length;++t){var n=u[t];n.material.uniforms.envMap.value=h.gemHdrs[l],n.material.needsUpdate=!0}else for(var r=0;r<h.diamonds.length;++r)for(var i=h.diamonds[r].getMesh(),a=c.split("/"),o=0;o<a.length;o++)a[o]===i.name&&(i.material.uniforms.envMap.value=h.gemHdrs[l],i.material.needsUpdate=!0);else var e=h.genCubeUrls(e+l+"/",".hdr"),d=h.hdrTextureLoader.load(Le,e,function(){var e=new Cd(d);e.update(h.renderer);var t=new Pd(e.cubeLods);if(t.update(h.renderer),d.minFilter=Ae,d.magFilter=Ae,d.needsUpdate=!0,e.dispose(),t.dispose(),h.bIsVarDesign)for(var n=0;n<u.length;++n){var r=u[n];r.material.uniforms.envMap.value=d,r.material.needsUpdate=!0}else for(var i=0;i<h.diamonds.length;++i)for(var a=h.diamonds[i].getMesh(),o=c.split("/"),s=0;s<o.length;s++)o[s]===a.name&&(a.material.uniforms.envMap.value=d,a.material.needsUpdate=!0);h.gemHdrs[l]=d,h.bRotate||h.render()})}else alert("hdrPath is undefined!")},af.prototype.updateMetalLayerHdr=function(r,i,a,o){var s=this;if(s.hdrUrl){var t,l,c,e=s.hdrUrl;if(s.metalHdrs[r.hdrId]||0==r.hdrId){if(o)for(var n=0;n<o.length;n++)0==r.hdrId?(o[n].material.envMap=null,o[n].material.envMap=s.metalHdrs.defMetal):(o[n].material.envMap=null,o[n].material.envMap=s.metalHdrs[r.hdrId]),o[n].material.needsUpdate=!0;else a.traverse(function(e){if(e.isMesh)for(var t=0;t<i.length;++t)i[t]===e.name&&(0==r.hdrId?(e.material.envMap=null,e.material.envMap=s.metalHdrs.defMetal):(e.material.envMap=null,e.material.envMap=s.metalHdrs[r.hdrId]),e.material.needsUpdate=!0)});s.rootNode.visible||(s.rootNode.visible=!0,s.container.removeChild(s.loading),s.loadModelState=s.loadState.Loaded,s.setGround())}else null==s.metalHdrs[r.hdrId]&&-1!=s.loadingMetalHdrIds.indexOf(r.hdrId)?t=setInterval(function(){if(s.metalHdrs[r.hdrId]){if(o)for(var e=0;e<o.length;e++)0==r.hdrId?(o[e].material.envMap=null,o[e].material.envMap=s.metalHdrs.defMetal):(o[e].material.envMap=null,o[e].material.envMap=s.metalHdrs[r.hdrId]),o[e].material.needsUpdate=!0;else a.traverse(function(e){if(e.isMesh)for(var t=0;t<i.length;++t)i[t]===e.name&&(0==r.hdrId?(e.material.envMap=null,e.material.envMap=s.metalHdrs.defMetal):(e.material.envMap=null,e.material.envMap=s.metalHdrs[r.hdrId]),e.material.needsUpdate=!0)});s.rootNode.visible||(s.rootNode.visible=!0,s.container.removeChild(s.loading),s.loadModelState=s.loadState.Loaded,s.setGround()),clearInterval(t)}},2):(s.loadingMetalHdrIds.push(r.hdrId),e=s.genCubeUrls(e+r.hdrId+"/",".hdr"),l=null,c=s.hdrTextureLoader.load(Le,e,function(){var e=new Cd(c);e.update(s.renderer);var t=new Pd(e.cubeLods);if(t.update(s.renderer),l=t.CubeUVRenderTarget,c.minFilter=Ae,c.magFilter=Ae,c.needsUpdate=!0,e.dispose(),t.dispose(),o)for(var n=0;n<o.length;n++)o[n].material.envMap=null,o[n].material.envMap=c,o[n].material.needsUpdate=!0;else a.traverse(function(e){if(e.isMesh)for(var t=0;t<i.length;t++)i[t]===e.name&&(e.material.envMap=null,e.material.envMap=c,e.material.needsUpdate=!0)});s.rootNode.visible||(s.rootNode.visible=!0,s.container.removeChild(s.loading),s.loadModelState=s.loadState.Loaded,s.setGround()),s.metalHdrTextures[r.hdrId]=l.texture,s.metalHdrs[r.hdrId]=c;t=s.loadingMetalHdrIds.indexOf(r.hdrId);-1<t&&s.loadingMetalHdrIds.splice(t,1),s.bRotate||s.render()}))}else alert("hdrPath is undefined!")},af.prototype.clearOldModel=function(o){var t=this;if(t.sparklesOfPart){var e=t.sparklesOfPart.get(o.partInfo.id);if(e){for(var n=0;n<e.length;n++)t.sceneSparkles.remove(e[n].mesh);t.sparklesOfPart.delete(o.partInfo.id)}}for(var r=0;r<t.designLayers.length;++r){var s=t.designLayers[r],i=s.partLayerIds.filter(function(e){return e.id==o.partInfo.id})[0];if(i)for(var l=i.layerIds.split(","),a=0;a<l.length;++a)!function(e){var t=l[e],e=o.partInfo.layers.filter(function(e){return e.id==t})[0];if(e)for(var n=e.meshNames.split("/"),r=0;r<n.length;r++){var i,a=n[r];s.meshNames&&(-1<(a=(i=s.meshNames.split("/")).indexOf(a))&&i.splice(a,1),s.meshNames=i.join("/"))}}(a)}o.traverse(function(n){if(n.isMesh)for(var e=0;e<t.designLayers.length;++e){var r=t.designLayers[e];if(r.meshObjs)if("break"===function(){var t=r.meshObjs.filter(function(e){return e.uuid===n.uuid})[0];if(t)return r.meshObjs=r.meshObjs.filter(function(e){return e!=t}),"break"}())break}}),o.children.filter(function(e){return e}).forEach(function(e){t.dispose(o,e)}),t.rootNode.children.forEach(function(e,t,n){e==o&&n.splice(t,1)}),o=null,fc.clear()},af.prototype.dispose=function(e,t){var n=this;t.children.length&&t.children.filter(function(e){return e}).forEach(function(e){n.dispose(t,e)}),t instanceof ii||t instanceof bs?(t.material.map&&t.material.map.dispose(),t.material.dispose(),t.material=null,t.geometry.dispose(),t.geometry=null,delete t.geometry):t.material&&(t.material.dispose(),t.material=null),t.remove(),e.remove(t)},af.prototype.clearSence=function(){var e=this;if(e.bIsVarDesign){if(e.rootNode&&e.canClear)for(var t,n=0;n<e.rootNode.children.length;n++)"Scene"==e.rootNode.children[n].type&&((t=e.rootNode.children[n])&&e.scene.traverse(function(e){e instanceof ii&&(e.geometry.dispose(),e.material.map&&e.material.map.dispose(),e.material.dispose())}),e.rootNode.remove(t))}else e.scene&&e.scene.traverse(function(e){e instanceof ii&&(e.geometry.dispose(),e.material.map&&e.material.map.dispose(),e.material.dispose())}),e.rootNode.remove(e.glbScene)},af.prototype.loadVarDesignPartCommonWithIds=function(s,l){var f=this;f.designLoader.load(s+".glb",function(r){f.rootNode.add(r.scene),f.rootNode.ConstraintsToParts=new Map,f.rootNode.mainPartId=s,r.scene.name=s,r.scene.partInfo=f.VarDesignInfo.mainParts.filter(function(e){return e.id==s})[0],r.scene.constraints=new Map;for(var e=0;e<r.scene.partInfo.constraints.length;e++){var t=r.scene.partInfo.constraints[e],n=t.constraintId;r.scene.constraints.has(n)||r.scene.constraints.set(n,t.transform),f.rootNode.ConstraintsToParts.has(n)||f.rootNode.ConstraintsToParts.set(n,[]),-1===f.rootNode.ConstraintsToParts.get(n).indexOf(s)&&f.rootNode.ConstraintsToParts.get(n).push(Number(s))}if(f.getMaxMinY(r),f.assignLayerMat(r),""!=l){for(var i=[],a=l.split(","),o=0;o<a.length;o++)!function(e){var h=a[e],d=null,p=null;-1!=h.indexOf("-")&&((e=h.split("-"))[0]&&(h=e[0]),e[1]&&(d=e[1]),e[2]&&(p=e[2])),i.push(new Promise(function(u){f.designLoader.load(h+".glb",function(e){f.rootNode.add(e.scene),e.scene.name=h;for(var t=null,n=0;n<f.VarDesignInfo.parts.length;n++){for(var r=!1,i=f.VarDesignInfo.parts[n],a=0;a<i.length;a++){var o=i[a];if(o.id==h){t=o,r=!0;break}}if(r)break}null!=d&&null!=p&&(t.rotAxis=d,t.rotAngle=p),e.scene.partInfo=t,e.scene.constraints=new Map;for(var s=0;s<t.constraints.length;s++){var l=t.constraints[s],c=l.constraintId;e.scene.constraints.has(c)||e.scene.constraints.set(c,l.transform),f.rootNode.ConstraintsToParts.has(c)||f.rootNode.ConstraintsToParts.set(c,[]),-1===f.rootNode.ConstraintsToParts.get(c).indexOf(h)&&f.rootNode.ConstraintsToParts.get(c).push(Number(h))}f.getMaxMinY(e),f.assignLayerMat(e),f.curStyleType===f.styleType.Ring&&f.curTryOnMode===f.tryOnMode.TDShow&&(f.rootNode.position.y=-e.scene.boundingBoxMaxY/10),u()})}))}(o);Promise.all(i).then(function(){var e,t=pf(r.scene.constraints.keys());try{for(t.s();!(e=t.n()).done;){var n=e.value;f.assemblePartsFromConstraintID(r.scene.name,n)}}catch(e){t.e(e)}finally{t.f()}f.initEngraveLayers(),f.loadModelFinish()})}})},af.prototype.getWebGLMatrixFromRhinoMatrix=function(e){var t=new Array;if(16==(t=e.split(",")).length){var n=new cn;n.set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3]),Number(t[4]),Number(t[5]),Number(t[6]),Number(t[7]),Number(t[8]),Number(t[9]),Number(t[10]),Number(t[11]),Number(t[12]),Number(t[13]),Number(t[14]),Number(t[15]));var r=new cn;this.isRhino5&&(r.makeRotationX(3*Math.PI/2),n.multiply(r));var i=new Vt,a=new Gt,e=new Vt;n.decompose(i,a,e),this.isRhino5||(t=i.y,i.y=i.z,i.z=-t,(r=new dn).setFromQuaternion(a),(t=new Gt).setFromAxisAngle(new Vt(0,1,0),r.z),(a=new Gt).setFromAxisAngle(new Vt(0,0,1),r.y),t.multiply(a),n.compose(i,t,e));i=i.multiplyScalar(.001),e=new cn;return e.makeTranslation(i.x,i.y,i.z),n.copyPosition(e),n}},af.prototype.rotateCurPart=function(e,t,n){var r,i,a,o,s;e&&(o=e.parentConstraintId,r=e.parentPartId,i=this.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==r})[0],a=this.getWebGLMatrixFromRhinoMatrix(i.constraints.get(o)),(o=new cn).copy(i.matrixWorld),o.multiply(a),a=new An,this.scene.add(a),o.decompose(a.position,a.quaternion,a.scale),a.updateMatrixWorld(!0),a.add(e),(o=new cn).getInverse(a.matrixWorld),o.multiply(e.matrixWorld),o.decompose(e.position,e.quaternion,e.scale),"x"==t?s=new Vt(1,0,0):"y"==t?this.isRhino5?s=new Vt(0,1,0):(s=new Vt(0,0,1),n=-n):"z"==t&&(this.isRhino5?s=new Vt(0,0,1):(s=new Vt(0,1,0),n=-n)),a.rotateOnAxis(s,n/180*Math.PI),a.updateMatrixWorld(!0),this.rootNode.add(e),(n=new cn).getInverse(this.rootNode.matrixWorld),n.multiply(e.matrixWorld),n.decompose(e.position,e.quaternion,e.scale),this.scene.remove(a),this.render())},af.prototype.rotatePart=function(t,e,n){var r,i,a,o,s,l=this,c=l.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t})[0];c&&(o=c.parentConstraintId,r=c.parentPartId,i=l.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==r})[0],a=l.getWebGLMatrixFromRhinoMatrix(i.constraints.get(o)),(o=new cn).copy(i.matrixWorld),o.multiply(a),a=new An,l.scene.add(a),o.decompose(a.position,a.quaternion,a.scale),a.updateMatrixWorld(!0),a.add(c),(o=new cn).getInverse(a.matrixWorld),o.multiply(c.matrixWorld),o.decompose(c.position,c.quaternion,c.scale),"x"==e?s=new Vt(1,0,0):"y"==e?l.isRhino5?s=new Vt(0,1,0):(s=new Vt(0,0,1),n=-n):"z"==e&&(l.isRhino5?s=new Vt(0,0,1):(s=new Vt(0,1,0),n=-n)),a.rotateOnAxis(s,n/180*Math.PI),a.updateMatrixWorld(!0),l.rootNode.add(c),(n=new cn).getInverse(l.rootNode.matrixWorld),n.multiply(c.matrixWorld),n.decompose(c.position,c.quaternion,c.scale),l.scene.remove(a),l.render())},af.prototype.setPartVisibled=function(t,n){var e=this.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t})[0];e&&e.traverse(function(e){e.isMesh&&(e.material.visible=n)})},af.prototype.assemblePartToConstraint=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,o=6<arguments.length&&void 0!==arguments[6]&&arguments[6],s=new cn;s.copy(e.matrixWorld);var l=this.getWebGLMatrixFromRhinoMatrix(e.constraints.get(n)),c=null;if(o){var u,h=pf(t.constraints.keys());try{for(h.s();!(u=h.n()).done;){var d=u.value;break}}catch(e){h.e(e)}finally{h.f()}c=this.getWebGLMatrixFromRhinoMatrix(t.constraints.get(d))}else c=this.getWebGLMatrixFromRhinoMatrix(t.constraints.get(n));o=new cn;o.getInverse(c),s.multiply(l),s.multiply(o);o=new cn;o.getInverse(this.rootNode.matrixWorld),o.multiply(s).decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.parentPartId=e.partInfo.id,t.parentConstraintId=n,r||null==t.partInfo.rotAxis||null==t.partInfo.rotAngle||this.rotateCurPart(t,t.partInfo.rotAxis,t.partInfo.rotAngle),r&&null!=i&&null!=a&&this.rotateCurPart(t,i,a)},af.prototype.assemblePartsFromConstraintID=function(t,e){var n,r=this.rootNode.ConstraintsToParts.get(e),i=this.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t})[0],a=pf(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o!=t){var s=this.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==o})[0];this.assemblePartToConstraint(i,s,e);var l,c=pf(s.constraints.keys());try{for(c.s();!(l=c.n()).done;){var u=l.value;u!=e&&this.assemblePartsFromConstraintID(s.name,u)}}catch(e){c.e(e)}finally{c.f()}}}}catch(e){a.e(e)}finally{a.f()}},af.prototype.loadPart=function(n,r){var i=this;i.container.appendChild(i.loading),i.canChangeDesign=!1,i.loadModelState=i.loadState.Loading,i.designLoader.load(n+".glb",function(e){i.rootNode.add(e.scene),i.container.removeChild(i.loading),setTimeout(function(){i.updateLoadState()},500);var t=i.getPartInfoById(n,r);return t?(e.scene.name=t.id,e.scene.partInfo=t,i.getMaxMinY(e),i.assignLayerMat(e),r=r||t.partType.id,i.changePart(n,r,!0),!0):(i.rootNode.children.remove(e.scene),alert("加载模型失败，未获取到零件信息！"+n),!1)})},af.prototype.updateLoadState=function(){this.canChangeDesign=!0,this.loadModelState=this.loadState.Loaded},af.prototype.getPartInfoById=function(t,e){var n=this;if(1==e){var r=n.VarDesignInfo.mainParts.filter(function(e){return e.id==t})[0];if(r)return r}else if(2==e)if(n.VarDesignInfo.parts&&0<n.VarDesignInfo.parts.length){var i=n.VarDesignInfo.parts.filter(function(e){return e.id==t})[0];if(i)return i;for(var a=0;a<n.VarDesignInfo.partGroups.length;a++){var o=n.VarDesignInfo.partGroups[a].parts.filter(function(e){return e.id==t})[0];if(o)return o}}else for(var s=0;s<n.VarDesignInfo.partGroups.length;s++){var l=n.VarDesignInfo.partGroups[s].parts.filter(function(e){return e.id==t})[0];if(l)return l}else{i=n.VarDesignInfo.mainParts.filter(function(e){return e.id==t})[0];if(i)return e=1,i;if(n.VarDesignInfo.parts&&0<n.VarDesignInfo.parts.length){i=n.VarDesignInfo.parts.filter(function(e){return e.id==t})[0];if(i)return e=2,i;for(var c=0;c<n.VarDesignInfo.partGroups.length;c++){var u=n.VarDesignInfo.partGroups[c].parts.filter(function(e){return e.id==t})[0];if(u)return e=2,u}}else for(var h=0;h<n.VarDesignInfo.partGroups.length;h++){var d=n.VarDesignInfo.partGroups[h].parts.filter(function(e){return e.id==t})[0];if(d)return e=2,d}}},af.prototype.loadModelFinish=function(){var e=this;e.bObjectLoaded=!0,e.canClear=!0,e.canChangeDesign=!0,e.rootNode.visible=!0,e.loadModelState=e.loadState.Loaded,e.curTryOnMode===e.tryOnMode.TDShow&&e.setGround(),null!=e.loading&&e.container.removeChild(e.loading),e.render()},af.prototype.refreshPart=function(e,L){for(var O=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,I=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,R=this,t=!1,n=0;n<R.loadingPartIds.length;n++)if(R.loadingPartIds[n]==L){t=!0;break}if(t){var r=R.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==L})[0];r&&r.traverse(function(e){e.isMesh&&(e.material.visible=!0)})}else{R.loadingPartIds=[],R.loadingPartIds.push(L);r=R.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==L})[0];if(null==r){e=2==e?!0:!1;if(R.loadModelState=R.loadState.Loading,e){var i,d=R.rootNode.mainPartId,p=R.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==d})[0],a=pf(R.rootNode.ConstraintsToParts.keys());try{for(a.s();!(i=a.n()).done;){var o,s,l=i.value;p.constraints.has(l)&&(-1<(s=(o=R.rootNode.ConstraintsToParts.get(l)).indexOf(d))&&o.splice(s,1),o.push(L))}}catch(e){a.e(e)}finally{a.f()}R.designLoader.load(L+".glb",function(e){var t=e.scene;t.name=L,R.rootNode.mainPartId=L,R.rootNode.add(e.scene);for(var n=0;n<R.VarDesignInfo.mainParts.length;n++){var r=R.VarDesignInfo.mainParts[n];if(r.id==L){e.scene.partInfo=r,e.scene.constraints=new Map;for(var i=0;i<r.constraints.length;i++){var a=r.constraints[i];e.scene.constraints.has(a.constraintId)||e.scene.constraints.set(a.constraintId,a.transform)}break}}R.getMaxMinY(e),R.assignLayerMat(e);for(var o=0;o<R.rootNode.children.length;o++){var s=R.rootNode.children[o];s.parentPartId==d&&(s.parentPartId=L)}var l,c=pf(t.constraints.keys());try{for(c.s();!(l=c.n()).done;){var u=l.value;u!==p.parentConstraintId&&R.adjustTransformOfPart(u,L)}}catch(e){c.e(e)}finally{c.f()}R.clearOldModel(p),R.initEngraveLayers();for(var h=0;h<R.loadingPartIds.length;h++)R.loadingPartIds[h]==L&&R.loadingPartIds.splice(h,1);R.loadModelFinish(),R.render()})}else R.designLoader.load(L+".glb",function(e){var t=e.scene;t.name=L,R.rootNode.add(e.scene);for(var n=0,r=0;r<R.VarDesignInfo.parts.length;r++){for(var i=!1,a=R.VarDesignInfo.parts[r],o=0;o<a.length;o++){var s=a[o];if(s.id==L){e.scene.name=s.id,e.scene.partInfo=s,i=!0,n=r;break}}if(i)break}e.scene.constraints=new Map;for(var l,c=0;c<e.scene.partInfo.constraints.length;c++){var u=e.scene.partInfo.constraints[c];e.scene.constraints.has(u.constraintId)||e.scene.constraints.set(u.constraintId,u.transform)}R.getMaxMinY(e),R.assignLayerMat(e),R.curStyleType===R.styleType.Ring&&R.curTryOnMode===R.tryOnMode.TDShow&&(R.rootNode.position.y=-e.scene.boundingBoxMaxY/10);for(var h=null,d=R.VarDesignInfo.parts[n],p=0;p<d.length;p++){var f=function(e){var t=d[e];return t.id==L?"continue":null!=(h=R.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t.id})[0])?(l=t.id,"break"):void 0}(p);if("continue"!==f&&"break"===f)break}if(null!=h){var m,g=pf(R.rootNode.ConstraintsToParts.keys());try{for(g.s();!(m=g.n()).done;){var v,y,x=m.value;h.constraints.has(x)&&(-1<(y=(v=R.rootNode.ConstraintsToParts.get(x)).indexOf(l))&&v.splice(y,1),v.push(L))}}catch(e){g.e(e)}finally{g.f()}var b=R.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==h.parentPartId})[0];R.assemblePartToConstraint(b,t,h.parentConstraintId,!0,O,I);for(var _=0;_<R.rootNode.children.length;_++){var M=R.rootNode.children[_];M.parentPartId==l&&(M.parentPartId=L)}var w,T=pf(t.constraints.keys());try{for(T.s();!(w=T.n()).done;){var S=w.value;S!==h.parentConstraintId&&R.adjustTransformOfPart(S,L)}}catch(e){T.e(e)}finally{T.f()}R.clearOldModel(h);for(var E=!1,A=t.partInfo.layers.length,C=0;C<A;C++)if(-1==t.partInfo.layers[C].type){E=!0;break}E&&R.initEngraveLayers();for(var P=0;P<R.loadingPartIds.length;P++)R.loadingPartIds[P]==L&&R.loadingPartIds.splice(P,1);R.loadModelFinish(),R.render()}})}else r&&r.traverse(function(e){e.isMesh&&(e.material.visible=!0)})}},af.prototype.adjustTransformOfPart=function(e,t){var n=this.rootNode.ConstraintsToParts.get(e),r=this.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t})[0];if(r&&n){var i,a=pf(n);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o!==t){var s=this.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==o})[0];this.assemblePartToConstraint(r,s,e);var l,c=pf(s.constraints.keys());try{for(c.s();!(l=c.n()).done;){var u=l.value;u!==e&&this.adjustTransformOfPart(u,o)}}catch(e){c.e(e)}finally{c.f()}}}}catch(e){a.e(e)}finally{a.f()}}},af.prototype.setPartSelect=function(t,n){var r=this;r.outlinePass.selectedObjects=[];var e,i,a=r.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==t})[0];a&&((e=a.partInfo.layers.filter(function(e){return e.id==n})[0])&&(i=e.meshNames.split("/")),a.traverse(function(e){e.isMesh&&-1!=i.indexOf(e.name)&&r.outlinePass.selectedObjects.push(e)}))},af.prototype.setMeshSelect=function(e){var t=this,n=e.split("/");t.outlinePass.selectedObjects=[];for(var r=0;r<t.rootNode.children.length;r++)t.rootNode.children[r].traverse(function(e){e.isMesh&&-1!=n.indexOf(e.name)&&t.outlinePass.selectedObjects.push(e)})},af.prototype.loadModel=function(){var u=this;u.designLoader.load(u.DesignInformation.id+".glb",function(n){if(u.glbScene=n.scene,u.gltfname=n.scene.name,u.configParams={quality:"medium",envCubeMap:u.gemEnvCubeMap,diamondConfiguration:u.diamondConfiguration},u.bEdit,u.diamonds=uf(u.renderer,n.scene,u.configParams),u.rootNode.visible=!1,n.scene.name=u.DesignInformation.id,u.rootNode.add(n.scene),n.scene.traverse(function(e){var t,n;e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1,e.material.needsUpdate=!0,e.geometry.computeBoundingBox(),(t=new Hn).copy(e.geometry.boundingBox),e.updateMatrixWorld(!0),n=u.rootNode.scale.x,n=e.matrixWorld.multiply((new cn).makeScale(n,n,n)),t.applyMatrix4(n),u.minY>t.min.z&&(u.minY=t.min.z),u.maxY<t.max.z&&(u.maxY=t.max.z))}),u.bEnableSparkles){u.initSparkles(u.diamonds.length);for(var e=0;e<u.diamonds.length;++e)for(var t=e*u.sparkleNum;t<e*u.sparkleNum+u.sparkleNum;++t){var r=u.diamonds[e].getCentreOffset(),i=u.diamonds[e].getBoundingRadius(),a=r.y,o=r.x+(Math.random()-.5)*i*u.sparkleScaleArg,r=r.z+(Math.random()-.5)*i*u.sparkleScaleArg;u.sparkleArray[t].setPositionOffset(o,a,r),u.curStyleType==u.styleType.Necklace?u.sparkleArray[t].setScale((Math.random()*i/5+i/5*.35)*u.diamonds[e].t.scale.x*u.sparkleSmallScale):u.sparkleArray[t].setScale((Math.random()*i/5+i/5*.35)*u.diamonds[e].t.scale.x*u.sparkleBigScale),u.diamonds[e].addSparkle(u.sparkleArray[t])}}for(var s=!1,l=function(e){var t,o=u.designLayers[e];u.processMeshNames(o),o.type===u.materialType.metal?(s=u.assignMetalLayerMat(o,n.scene),u.customizeMetalClass(o.name,o.metal)):o.type===u.materialType.gem?1===o.ogType||2===o.ogType||0===o.ogType&&"faceted"===o.gem.faceType?(0===o.ogType?t=o.gem:1===o.ogType?(t=o.otherGem).refraction=o.otherGem.gemType.refraction:2===o.ogType&&((t=o.customGem).refraction=o.customGem.refraction),u.customizeGemClass(o.ogType,o.name,t)):0===o.ogType&&"cabochon"===o.gem.faceType?n.scene.traverse(function(a){a.isMesh&&function(){for(var i=o.gem.nameEn,e=o.meshNames.split("/"),t=0;t<e.length;++t)e[t]===a.name&&function(){var r=setInterval(function(){var e,t,n;u.bCabochonHdrsLoaded?(u.userCabochonMat[i]?a.material=u.userCabochonMat[i]:(u.cabochonMat[i]?a.material=u.cabochonMat[i]:(e=new pr(((e=o.gem.color.split(","))[0]/255).toFixed(2),(e[1]/255).toFixed(2),(e[2]/255).toFixed(2)),a.material=new Wl({color:e,envMap:u.humianHdrCubeRenderTarget.texture,envMapIntensity:1.2,metalness:1,roughness:0,name:i})),u.userMatInfo.userGem&&(t=u.userMatInfo.userGem.filter(function(e){return e.ogType===o.ogType&&e.gemId===o.gem.id})[0])&&(a.material.roughness=t.roughness,a.material.metalness=t.metalness,a.material.envMapIntensity=t.envMapIntensity,n=t.color.split(","),a.material.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),0!==t.hdrId&&u.updateMatHdr("Cabochon",t.hdrId,a)),!t&&u.userMatInfo.defGem&&(t=u.userMatInfo.defGem.filter(function(e){return e.ogType===o.ogType&&e.gemId===o.gem.id})[0])&&(a.material.roughness=t.roughness,a.material.metalness=t.metalness,a.material.envMapIntensity=t.envMapIntensity,n=t.color.split(","),a.material.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),0!==t.hdrId&&u.updateMatHdr("Cabochon",t.hdrId,a)),u.userCabochonMat[i]=a.material.clone(),u.commonMat.Cabochon=a.material),clearInterval(r)):u.createCabochonMat()},20)}()}()}):"pearl"===o.gem.faceType?n.scene.traverse(function(e){if(e.isMesh)for(var t=o.gem.nameEn,n=o.meshNames.split("/"),r=0;r<n.length;++r)n[r]===e.name&&(null==u.pearlMat[t]&&u.createPearlMat(),e.material=u.pearlMat[t],u.commonMat.Pearl=e.material)}):alert("暂没有此类型宝石！"+o.gem.faceType):o.type==u.materialType.bakingPaint||o.type===u.materialType.fabric||o.type===u.materialType.leather||o.type===u.materialType.plastic||o.type===u.materialType.wood?n.scene.traverse(function(e){if(e.isMesh){o.lacquer.id,o.lacquer.color.split(",");for(var t,n,r=o.meshNames.split("/"),i=0;i<r.length;++i)r[i]===e.name&&(t=new Wl({color:0,envMap:u.metalHdrCubeRenderTarget.texture,metalness:.9,roughness:.2,name:"lacquer"}),n=o.materialWeb.color.split(","),t.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),t.metalness=o.materialWeb.metalness,t.roughness=o.materialWeb.roughness,t.envMapIntensity=o.materialWeb.envMapIntensity,t.opacity=o.materialWeb.opacity,e.material=t)}}):o.type===u.materialType.glass?n.scene.traverse(function(e){if(e.isMesh){o.materialWeb.id;for(var t,n=o.meshNames.split("/"),r=0;r<n.length;++r)n[r]===e.name&&(t=new Vl({color:16777215,metalness:.9,roughness:.5,envMap:u.metalEnvCubeMap,refractionRatio:2,transparent:!0,transparency:.99,side:Q,clearcoat:1,clearcoatRoughness:.39,depthTest:!0,depthWrite:!1}),e.material=t,e.renderOrder=10)}}):o.type==u.materialType.paint?n.scene.traverse(function(e){if(e.isMesh)for(var t,n,r=o.meshNames.split("/"),i=0;i<r.length;++i)r[i]===e.name&&(t=new Vl({color:16777215,metalness:.9,roughness:.5,envMap:u.metalEnvCubeMap,refractionRatio:1,clearcoat:1,clearcoatRoughness:.39}),n=o.materialWeb.color.split(","),t.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),t.metalness=o.materialWeb.metalness,t.roughness=o.materialWeb.roughness,t.envMapIntensity=o.materialWeb.envMapIntensity,t.opacity=o.materialWeb.opacity,e.material=t)}):o.type===u.materialType.enamel?n.scene.traverse(function(e){if(e.isMesh)for(var t,n,r=o.meshNames.split("/"),i=0;i<r.length;++i)r[i]===e.name&&(t=new Wl({color:16711680,envMap:u.metalEnvCubeMap,metalness:.8,roughness:.5,envMapIntensity:.4,opacity:1,name:"enamel",transparent:!0}),n=o.materialWeb.color.split(","),t.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),t.metalness=o.materialWeb.metalness,t.roughness=o.materialWeb.roughness,t.envMapIntensity=o.materialWeb.envMapIntensity,t.opacity=o.materialWeb.opacity,e.material=t)}):o.type===u.materialType.engrave||console.log("The unknown material!!!!!!"+o.type)},c=0;c<u.designLayers.length;++c)l(c);u.setMapsForStyleWhenChangeMat(),u.initEngraveLayers(),u.bObjectLoaded=!0,u.canClear=!0,u.canChangeDesign=!0,s||(u.rootNode.visible=!0,u.container.removeChild(u.loading),u.loadModelState=u.loadState.Loaded,u.curTryOnMode===u.tryOnMode.TDShow&&u.setGround())})},af.prototype.loadModelWithoutMat=function(t){var r=this;r.designLoader.load(t+".glb",function(e){r.glbScene=e.scene,r.gltfname=e.scene.name,r.rootNode.visible=!1,e.scene.name=t,r.rootNode.add(e.scene),e.scene.traverse(function(e){var t,n;e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1,n=new Xl({color:1118481,specular:1118481,shininess:5}),e.material=n,e.material.needsUpdate=!0,e.geometry.computeBoundingBox(),(t=new Hn).copy(e.geometry.boundingBox),e.updateMatrixWorld(!0),n=r.rootNode.scale.x,n=e.matrixWorld.multiply((new cn).makeScale(n,n,n)),t.applyMatrix4(n),r.minY>t.min.z&&(r.minY=t.min.z),r.maxY<t.max.z&&(r.maxY=t.max.z))}),r.bObjectLoaded=!0,r.canClear=!0,r.canChangeDesign=!0,r.rootNode.visible=!0,r.container.removeChild(r.loading),r.loadModelState=r.loadState.Loaded})},af.prototype.getPartIds=function(){for(var e="",t=this.rootNode.children.length,n=0;n<t;n++){var r=this.rootNode.children[n];r.partInfo&&r.partInfo.id!=this.rootNode.mainPartId&&(""!=e&&(e+=","),e+=r.partInfo.id.toString())}return e},af.prototype.setPartDefPosture=function(){this.controls.reset(),this.setCamAndObj(this.necklaceCamPos,this.objPosition,this.necklaceObjRot,this.objScale)},af.prototype.loadVarDesignPart=function(){var F=this;F.designLoader.load(F.varPartInfo.id+".glb",function(e){F.glbScene=e.scene,F.gltfname=e.scene.name;var t={quality:"medium",envCubeMap:F.gemEnvCubeMap,diamondConfiguration:F.diamondConfiguration};F.diamonds=uf(F.renderer,e.scene,t),F.rootNode.visible=!1,F.rootNode.add(e.scene),e.scene.name=F.varPartInfo.id;var n,i=1e3,a=-1e3,o=1e3,s=-1e3;e.scene.traverse(function(R){if(R.isMesh){R.castShadow=!0,R.receiveShadow=!0,R.material.needsUpdate=!0,R.geometry.computeBoundingBox();var e=new Hn;e.copy(R.geometry.boundingBox),R.updateMatrixWorld(!0);var t=F.rootNode.scale.x,t=R.matrixWorld.multiply((new cn).makeScale(t,t,t));e.applyMatrix4(t),F.minY>e.min.z&&(F.minY=e.min.z),F.maxY<e.max.z&&(F.maxY=e.max.z),i>e.min.x&&(i=e.min.x),a<e.max.x&&(a=e.max.x),o>e.min.y&&(o=e.min.y),s<e.max.y&&(s=e.max.y);for(var n=function(e){var r=F.designLayers[e];if(F.processMeshNames(r),r.type===F.materialType.metal)for(var t,n,i=r.meshNames.split("/"),a=0;a<i.length;++a)i[a]===R.name&&(n=null,!(n=F.userMatInfo.userMetal?F.userMatInfo.userMetal.filter(function(e){return e.metalId===r.metal.id})[0]:n)&&F.userMatInfo.defMetal&&(n=F.userMatInfo.defMetal.filter(function(e){return e.metalId===r.metal.id})[0]),F.userMetalMat[r.metal.id]?R.material=F.userMetalMat[r.metal.id]:(F.commonMat.Metal.envMap=F.metalEnvCubeMap,R.material=F.commonMat.Metal.clone(),n?(t=n.color.split(","),R.material.color=new pr((t[0]/255).toFixed(2),(t[1]/255).toFixed(2),(t[2]/255).toFixed(2)),R.material.roughness=n.roughness,R.material.metalness=n.metalness,R.material.envMapIntensity=n.envMapIntensity):(n=r.metal.color.split(","),R.material.color=new pr((n[0]/255).toFixed(2),(n[1]/255).toFixed(2),(n[2]/255).toFixed(2)),R.material.roughness=r.metal.fSmoothness,R.material.metalness=r.metal.fMetallic,R.material.envMapIntensity=r.metal.density)));else if(r.type===F.materialType.gem)if(1===r.ogType||0===r.ogType&&"faceted"===r.gem.faceType)for(var o,s,l=r.meshNames.split("/"),c=0;c<l.length;++c)l[c]===R.name&&(o=void 0,s=(o=!(o=F.userMatInfo.userGem?F.userMatInfo.userGem.filter(function(e){return 0==r.ogType?e.gemId==r.gem.id&&e.ogType==r.ogType:1==r.ogType?e.gemId==r.otherGem.id&&e.ogType==r.ogType:void 0})[0]:o)&&F.userMatInfo.defGem?F.userMatInfo.defGem.filter(function(e){return 0==r.ogType?e.gemId==r.gem.id&&e.ogType==r.ogType:1==r.ogType?e.gemId==r.otherGem.id&&e.ogType==r.ogType:void 0})[0]:o).color.toString().split(","),R.material.uniforms.colorCorrection.value=new pr((s[0]/255).toFixed(2),(s[1]/255).toFixed(2),(s[2]/255).toFixed(2)),R.material.uniforms.refractiveIndex.value=o.refractiveIndex,R.material.uniforms.rIndexDelta.value=o.rIndexDelta,R.material.uniforms.envMapIntensity.value=o.envMapIntensity);else if(0===r.ogType&&"cabochon"===r.gem.faceType)!function(){for(var t=r.gem.nameEn,e=r.meshNames.split("/"),n=0;n<e.length;++n)e[n]===R.name&&function(){var e=setInterval(function(){F.bCabochonHdrsLoaded?(null!==F.cabochonMat[t]?(F.userCabochonMat[t]?R.material=F.userCabochonMat[t]:R.material=F.cabochonMat[t],F.commonMat.Cabochon=R.material):alert("未初始化此材质！"+r.gem.name),clearInterval(e)):F.createCabochonMat()},20)}()}();else if("pearl"===r.gem.faceType)for(var u=r.gem.nameEn,h=r.meshNames.split("/"),d=0;d<h.length;++d)h[d]===R.name&&(null==F.pearlMat[u]&&F.createPearlMat(),R.material=F.pearlMat[u],F.commonMat.Pearl=R.material);else alert("暂没有此类型宝石！"+r.gem.faceType);else if(r.type==F.materialType.bakingPaint||r.type===F.materialType.fabric||r.type===F.materialType.leather||r.type===F.materialType.plastic||r.type===F.materialType.wood)for(var p,f,m=r.meshNames.split("/"),g=0;g<m.length;++g)m[g]===R.name&&(p=new Wl({color:0,envMap:F.metalHdrCubeRenderTarget.texture,metalness:.9,roughness:.2,name:"lacquer"}),f=r.materialWeb.color.split(","),p.color=new pr((f[0]/255).toFixed(2),(f[1]/255).toFixed(2),(f[2]/255).toFixed(2)),p.metalness=r.materialWeb.metalness,p.roughness=r.materialWeb.roughness,p.envMapIntensity=r.materialWeb.envMapIntensity,p.opacity=r.materialWeb.opacity,R.material=p);else if(r.type===F.materialType.glass)for(var v,y,x=r.meshNames.split("/"),b=0;b<x.length;++b)x[b]===R.name&&(v=new Vl({color:16777215,metalness:.9,roughness:.5,envMap:F.metalEnvCubeMap,refractionRatio:2,transparent:!0,transparency:.99,side:Q,clearcoat:1,clearcoatRoughness:.39,depthTest:!0,depthWrite:!1}),y=r.materialWeb.color.split(","),v.color=new pr((y[0]/255).toFixed(2),(y[1]/255).toFixed(2),(y[2]/255).toFixed(2)),v.metalness=r.materialWeb.metalness,v.roughness=r.materialWeb.roughness,v.envMapIntensity=r.materialWeb.envMapIntensity,v.transparency=1-r.materialWeb.opacity,R.material=v);else if(r.type==F.materialType.enamel)for(var _,M,w=r.meshNames.split("/"),T=0;T<w.length;++T)w[T]===R.name&&(_=new Wl({color:16711680,envMap:F.metalEnvCubeMap,metalness:.9,side:Q,roughness:1,envMapIntensity:.3,opacity:1,name:"enamel",transparent:!0}),M=r.materialWeb.color.split(","),_.color=new pr((M[0]/255).toFixed(2),(M[1]/255).toFixed(2),(M[2]/255).toFixed(2)),_.metalness=r.materialWeb.metalness,_.roughness=r.materialWeb.roughness,_.envMapIntensity=r.materialWeb.envMapIntensity,_.opacity=r.materialWeb.opacity,R.material=_,R.material.needsUpdate=!0);else if(r.type==F.materialType.paint)for(var S,E,A=r.meshNames.split("/"),C=0;C<A.length;++C)A[C]===R.name&&(S=new Vl({color:16777215,metalness:.9,roughness:.5,envMap:F.metalEnvCubeMap,refractionRatio:1,clearcoat:1,clearcoatRoughness:.39}),E=r.materialWeb.color.split(","),S.color=new pr((E[0]/255).toFixed(2),(E[1]/255).toFixed(2),(E[2]/255).toFixed(2)),S.metalness=r.materialWeb.metalness,S.roughness=r.materialWeb.roughness,S.envMapIntensity=r.materialWeb.envMapIntensity,S.opacity=r.materialWeb.opacity,R.material=S);else if(r.type==F.materialType.engrave)for(var P,L,O=r.meshNames.split("/"),I=0;I<O.length;++I)O[I]===R.name&&(L=null,!(L=F.userMatInfo.userMetal?F.userMatInfo.userMetal.filter(function(e){return e.metalId===r.metal.id})[0]:L)&&F.userMatInfo.defMetal&&(L=F.userMatInfo.defMetal.filter(function(e){return e.metalId===r.metal.id})[0]),F.userMetalMat[r.metal.id]?R.material=F.userMetalMat[r.metal.id]:(F.commonMat.Metal.envMap=F.metalEnvCubeMap,R.material=F.commonMat.Metal.clone(),L?((P=[])[0]=190,P[1]=190,P[2]=190,R.material.color=new pr((P[0]/255).toFixed(2),(P[1]/255).toFixed(2),(P[2]/255).toFixed(2)),R.material.roughness=L.roughness,R.material.metalness=L.metalness,R.material.envMapIntensity=L.envMapIntensity):((L=[])[0]=190,L[1]=190,L[2]=190,R.material.color=new pr((L[0]/255).toFixed(2),(L[1]/255).toFixed(2),(L[2]/255).toFixed(2)),R.material.roughness=r.metal.fSmoothness,R.material.metalness=r.metal.fMetallic,R.material.envMapIntensity=r.metal.density)));else console.log("The unknown material!!!!!!"+r.type)},r=0;r<F.designLayers.length;++r)n(r)}}),e.scene.boxMinX=i,e.scene.boxMaxX=a,e.scene.boxMinY=F.minY,e.scene.boxMaxY=F.maxY,e.scene.boxMinZ=o,e.scene.boxMaxZ=s,F.setMapsForStyleWhenChangeMat(),F.bPartCaputre&&(e=4/F.maxY,F.rootNode.scale.set(F.objScale*e,F.objScale*e,F.objScale*e)),setTimeout(function(){F.loadModelFinish()},1e3),F.curPartType==F.partType.RingArm?(F.renderTargetShadow=new $t(512,512,{format:Ge,minFilter:Ae,magFilter:Ae}),n=new br({color:16777215,transparent:!0,map:F.renderTargetShadow}),new ii(new Ui(1,1),n),F.shadowBaker.onBeforeStart(function(){var e,t,n;e=new Vt,t=new Gt,n=new Vt,F.shadowBaker.getShadowPlaneTransform(e,t,n),F.shadowPlane.position.copy(e),F.shadowPlane.quaternion.copy(t),F.shadowPlane.scale.copy(n),F.shadowScale=n.x,F.shadowPos=e.x+","+e.y+","+e.z,F.shadowPlane.material.needsUpdate=!0,F.shadowPlane.updateMatrixWorld()}),F.shadowBaker.onComplete(function(){scene.add(F.shadowPlane),setTimeout(function(){bakeComplete()},500)}),F.shadowBaker.onProgress(function(e){}),F.shadowBaker.startBake(F.renderer,F.scene,F.camera,F.renderTargetShadow)):F.curPartType===F.partType.FlowerHead&&(n=F.flowerHeadDiameter/(n=(n=a-i)<s-o?s-o:n)*F.flowerHeadScale,F.rootNode.scale.set(n,n,n))})},af.prototype.getMaxMinY=function(e){var r=this,i=1e3,a=0;e.scene.traverse(function(e){var t,n;e.isMesh&&(e.castShadow=!0,e.receiveShadow=!1,e.material.needsUpdate=!0,e.geometry.computeBoundingBox(),(t=new Hn).copy(e.geometry.boundingBox),e.updateMatrixWorld(!0),n=r.rootNode.scale.x,r.bIsVarDesign&&(n=r.objScale),n=e.matrixWorld.multiply((new cn).makeScale(n,n,n)),t.applyMatrix4(n),i>t.min.y&&(i=t.min.y),a<t.max.y&&(a=t.max.y))}),1e3!=i&&0!=a&&(e.scene.boundingBoxMinY=i,e.scene.boundingBoxMaxY=a),r.controls.update()},af.prototype.setGround=function(){var n=this;if(n.bIsVarDesign){n.minY=1e4,n.maxY=-1e4,n.minZ=1e4,n.maxZ=-1e4,n.render();for(var e=0;e<n.rootNode.children.length;e++)n.rootNode.children[e].traverse(function(e){var t;e.isMesh&&(e.castShadow=!0,e.geometry.computeBoundingBox(),(t=new Hn).copy(e.geometry.boundingBox),e.updateMatrixWorld(!0),t.applyMatrix4(e.matrixWorld),n.minY>t.min.y&&(n.minY=t.min.y),n.maxY<t.max.y&&(n.maxY=t.max.y),n.minZ>t.min.z&&(n.minZ=t.min.z),n.maxZ<t.max.z&&(n.maxZ=t.max.z))});((n.maxY+n.minY)/2).toFixed(2),n.rootNode.scale.x,n.curStyleType===n.styleType.Ring&&(n.curTryOnMode,n.tryOnMode.TDShow),n.curStyleType===n.styleType.Glasses&&n.curTryOnMode===n.tryOnMode.TDShow&&(n.rootNode.position.z=(n.maxZ-n.minZ)/2),null!=n.ground&&null!==n.ground&&(n.ground.visible=!1),n.switchRealRenderingShadowState(!0),n.shadowGroup&&(n.shadowGroup.position.y=n.minY)}else{var t=((n.maxY+n.minY)/2).toFixed(2);n.curStyleType===n.styleType.Ring&&n.curTryOnMode===n.tryOnMode.TDShow&&(n.rootNode.position.y-=t),null!=n.ground&&null!==n.ground&&(t=n.shadowImgUrl+n.DesignInformation.id+"/shadow.png",n.textureLoader.load(t,function(e){e.wrapS=e.wrapT=xe,n.ground.material.map=e;var t=new Vt(0,0,0),e=n.DesignInformation.shadowPos.split(",");t.setX(parseFloat(e[0])),t.setY(parseFloat(e[1])),t.setZ(parseFloat(e[2])),n.curStyleType===n.styleType.Ring&&n.curTryOnMode===n.tryOnMode.TDShow?n.ground.position.set(t.x,t.y,t.z):n.ground.position.copy(t),n.bEdit?n.ground.scale.set(n.DesignInformation.shadowScale*(n.objScale/600),n.DesignInformation.shadowScale*(n.objScale/600),n.DesignInformation.shadowScale*(n.objScale/600)):n.ground.scale.set(n.DesignInformation.shadowScale,n.DesignInformation.shadowScale,n.DesignInformation.shadowScale),n.ground.receiveShadow=!1,n.ground.material.transparent=!0,n.ground.material.needsUpdate=!0,n.ground.updateMatrixWorld(),n.ground.visible=!0,n.bRotate||n.render()})),n.switchRealRenderingShadowState(!1)}},af.prototype.resetVarDesignGround=function(){var e,t,n=this,r=n.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id==n.rootNode.mainPartId})[0],i=0;r&&(i=r.boundingBoxMinY/10,n.curStyleType!==n.styleType.Ring||(t=n.rootNode.children.filter(function(e){return e.partInfo&&e.partInfo.id!=n.rootNode.mainPartId})[0])&&(i-=t.boundingBoxMaxY/10,n.rootNode.position.y=-t.boundingBoxMaxY/10),n.curStyleType==n.styleType.Glasses&&(n.rootNode.position.z=(n.maxZ-n.minZ)/2),n.ground&&(e=new Vt(0,0,0),r.partInfo.shadowPos&&(t=r.partInfo.shadowPos.split(","),e.setX(parseFloat(t[0])),e.setZ(parseFloat(t[2]))),n.ground.position.set(e.x,i,e.z),n.bEdit?n.ground.scale.set(r.partInfo.shadowScale*(n.objScale/600),r.partInfo.shadowScale*(n.objScale/600),r.partInfo.shadowScale*(n.objScale/600)):n.ground.scale.set(r.partInfo.shadowScale,r.partInfo.shadowScale,r.partInfo.shadowScale),n.ground.visible=!0))},af.prototype.switchRealRenderingShadowState=function(e){this.defaultOpenRealRenderingShadow?this.bOpenRealRenderingShadow=e:this.bOpenRealRenderingShadow=!1},af.prototype.downloadImage=function(e){!function(e,t){var n=document.createElementNS("http://www.w3.org/1999/xhtml","a");n.href=e,n.download=t;t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(t)}(e.toDataURL("png").replace("image/"+"png".toLocaleLowerCase().replace(/jpg/i,"jpeg").match(/png|jpeg|bmp|gif/)[0],"image/octet-stream"),"图像_"+(new Date).getSeconds()+".png")},af.prototype.getShadowImageFromTexture=function(e,t){var n=new Uint8Array(e*t*4);this.renderer.readRenderTargetPixels(this.renderTargetShadow,0,0,e,t,n);var r=document.createElement("canvas");r.width=e,r.height=t;var i=r.getContext("2d"),t=i.createImageData(e,t);return t.data.set(n),i.putImageData(t,0,0),this.downloadImage(r),r.toDataURL("image/png")},af.prototype.setDefPosture=function(e){var t=this;switch(t.curStyleType){case t.styleType.Ring:e?t.setCamAndObj(t.tryonCamPos,t.objPosition,t.ringTryonObjRot,t.objTryOnScale):(t.controls.reset(),t.setCamAndObj(t.ringCamPos,t.objPosition,t.ringObjRot,t.objScale));break;case t.styleType.Necklace:e?t.setCamAndObj(t.tryonCamPos,t.necklaceTryonObjPos,t.necklaceObjRot,t.objTryOnScale):(t.controls.reset(),t.setCamAndObj(t.necklaceCamPos,t.objPosition,t.necklaceObjRot,t.objScale-300));break;case t.styleType.Earring:e?t.setCamAndObj(t.tryonCamPos,t.objPosition,t.earringObjRot,t.objTryOnScale):(t.controls.reset(),t.setCamAndObj(t.earringCamPos,t.objPosition,t.earringObjRot,t.objScale-200));break;case t.styleType.Bracelet:e?t.setCamAndObj(t.tryonCamPos,t.objPosition,t.braceletObjRot,t.objTryOnScale):(t.controls.reset(),t.setCamAndObj(t.braceletCamPos,t.objPosition,t.braceletObjRot,t.objScale-450));break;case t.styleType.Watch:e?t.setCamAndObj(t.tryonCamPos,t.objPosition,t.watchObjRot,t.objTryOnScale):(t.controls.reset(),t.setCamAndObj(t.watchCamPos,t.objPosition,t.watchObjRot,t.objScale-450));break;case t.styleType.Carving:e?t.setCamAndObj(t.tryonCamPos,t.necklaceTryonObjPos,t.necklaceObjRot,t.objTryOnScale):(t.controls.reset(),t.setCamAndObj(t.necklaceCamPos,t.objPosition,t.necklaceObjRot,t.objScale-550));break;case t.styleType.Glasses:e?t.setCamAndObj(t.tryonCamPos,t.glassTryonObjPos,t.glassObjRot,t.objTryOnScale):(t.controls.reset(),t.setCamAndObj(t.glassCamPos,t.objPosition,t.glassObjRot,t.objScale-480));break;default:e?t.setCamAndObj(t.tryonCamPos,t.necklaceTryonObjPos,t.necklaceObjRot,t.objTryOnScale):(t.controls.reset(),t.setCamAndObj(t.necklaceCamPos,t.objPosition,t.necklaceObjRot,t.objScale-300))}},af.prototype.setCamAndObj=function(e,t,n,r){this.camera.position.set(e.x,e.y,e.z),this.rootNode.position.set(t.x,t.y,t.z),this.rootNode.rotation.set(n.x,n.y,n.z),this.rootNode.scale.set(r,r,r)},af.prototype.loadModelImage=function(){var n=this;n.bInitBg||n.initTryonScene();var e=n.modelTryonInfo.imgUrl;n.textureLoader.load(e,function(e){var t;e.wrapS=e.wrapT=xe,n.sceneBackground.getChildByName("bgPlane")?(n.bgMesh.visible=!0,n.bgMesh.material.map=e):(n.backgroundCamera.left=n.divWidth/-2,n.backgroundCamera.right=n.divWidth/2,n.backgroundCamera.top=n.divHeight/2,n.backgroundCamera.bottom=n.divHeight/-2,t=new br({map:e}),e=new Ui(1,1),n.bgMesh=new ii(e,t),n.bgMesh.position.set(0,0,-10),n.bgMesh.name="bgPlane",n.bgMesh.scale.set(n.divWidth,n.divHeight,1),n.sceneBackground.add(n.bgMesh)),n.controls.reset(),n.setOcclusion(),n.camera.position.copy(n.modelTryonInfo.camPos),n.controls.target.copy(n.modelTryonInfo.ctrlTarget),n.rootNode.position.copy(n.modelTryonInfo.objPos),n.rootNode.quaternion.copy(n.modelTryonInfo.objRot),n.rootNode.scale.copy(n.modelTryonInfo.objScale),n.curTryOnMode=n.tryOnMode.TryOn}),n.zoomDelta=0,n.bgRenderer&&(n.bgRenderer.domElement.style.display="block",n.bgRenderer.domElement.style.transform&&n.bgRenderer.domElement.style.removeProperty("transform")),null!=n.takeRender&&(n.takeRender.style.display="none"),n.controls.enabled=!1,n.controls.enableDamping=!1,n.arcball.enabled=!0,n.dragControls.enabled=!0},af.prototype.startWebCam=function(){var e,n=this;n.webCamVideo=document.getElementById("arjs-video"),null!==n.webCamVideo&&(null!=(e=n.arToolkitSource.domElement.srcObject)&&e.getVideoTracks()[0].stop(),webCamVideo.remove()),n.initWebCam(),n.webCamVideo=document.getElementById("arjs-video"),null===n.webCamVideo?n.arToolkitSource.init(function(){n.webCamVideo=document.getElementById("arjs-video");var e,t=new Is(n.webCamVideo);t.wrapS=t.wrapT=be,t.minFilter=Ae,n.sceneBackground.getChildByName("bgPlane")?(n.bgMesh.visible=!0,n.bgMesh.material.map=t):(n.backgroundCamera.left=n.divWidth/-2,n.backgroundCamera.right=n.divWidth/2,n.backgroundCamera.top=n.divHeight/2,n.backgroundCamera.bottom=n.divHeight/-2,e=new br({map:t}),t=new Ui(n.divWidth,n.divHeight),n.bgMesh=new ii(t,e),n.bgMesh.position.set(0,0,-172),n.bgMesh.name="bgPlane",n.sceneBackground.add(n.bgMesh)),n.controls.reset(),n.setOcclusion(),n.curTryOnMode=n.tryOnMode.TryOn,n.init_faceFilter()}):(null!==(e=document.getElementById("arjs-video"))&&((e=new Is(e)).wrapS=e.wrapT=be,e.minFilter=Ae,n.bgMesh.material.map=e),n.controls.reset(),n.setOcclusion(),n.curTryOnMode=n.tryOnMode.TryOn),n.zoomDelta=0,n.bgRenderer.domElement.style.display="block",null!=n.takeRender&&(n.takeRender.style.display="none"),n.controls.enabled=!1,n.controls.enableDamping=!1,n.arcball.enabled=!0,n.dragControls.enabled=!0},af.prototype.init_faceFilter=function(){var t=this,e=document.getElementById("arjs-video");t.jeelizCanvas.width=t.divWidth,t.jeelizCanvas.height=t.divHeight,JEELIZFACEFILTER.init({followZRot:!0,canvasId:"jeelizCanvas",NNCPath:t.pluginBaseUrl+"core/js/neuralNets/",maxFacesDetected:1,videoSettings:{videoElement:e,facingMode:"user",minWidth:480,maxWidth:1920,minHeight:480,maxHeight:1920,rotate:0,flipX:!1},callbackReady:function(e,t){e?console.log("AN ERROR HAPPENS. ERR =",e):console.log("INFO: JEELIZFACEFILTER IS READY")},callbackTrack:function(e){t.jeelizRender(e)}})},af.prototype.detect=function(e){var t=.8,n=.02,e=e;e.detected<t-n?(console.log("DETECTION LOST"),this.rootNode.visible=!1):e.detected>t+n&&(console.log("FACE DETECTED"),this.rootNode.visible=!0)},af.prototype.update_poses=function(e){var t=this;Math.tan(t.camera.aspect*t.camera.fov*Math.PI/360);var n=e;n.s,n.x,n.y,t.divWidth,t.divHeight;var r=t.rootNode.position.project(t.camera),i=.5;"Others"!=t.getOS()&&(i=.3);e=new Vt(-n.x,n.y+2*n.s*i,r.z).unproject(t.camera);t.rootNode.position.x=e.x,t.rootNode.position.y=e.y,t.rootNode.position.z=e.z,t.glassOCMesh.position.x=e.x,t.glassOCMesh.position.y=e.y;for(var a=1e4,o=0,s=0;s<t.rootNode.children.length;s++)t.rootNode.children[s].traverse(function(e){var t;e.isMesh&&(e.geometry.computeBoundingBox(),(t=new Hn).copy(e.geometry.boundingBox),e.updateMatrixWorld(!0),t.applyMatrix4(e.matrixWorld),a>t.min.z&&(a=t.min.z),o<t.max.z&&(o=t.max.z))});t.glassOCMesh.position.z=t.rootNode.position.z-.5*(o-a),t.rootNode.rotation.set(n.rx+0-Math.PI/2,-n.ry,-n.rz,"ZYX");i=new Vt(1,0,0),r=new Vt(0,0,1),e=-n.rz;i.applyAxisAngle(r,e);r=3.4,e=(r="Others"!=t.getOS()?2:r)*e*n.s*2,e=new Vt(i.x*e,i.y*e,i.z*e);t.rootNode.position.x-=e.x,t.rootNode.position.y-=e.y,t.rootNode.position.z-=e.z;e=90*n.s*2;"Others"!=t.getOS()&&(e=50*n.s*2),t.rootNode.scale.set(e,e,e);e=t.rootNode.scale.x;t.glassOCMesh.scale.set(e,e,e)},af.prototype.jeelizRender=function(e){this.curTryOnMode==this.tryOnMode.TryOn&&(this.detect(e),this.update_poses(e))},af.prototype.screenToWorld=function(e,t){return new Vt((e=this.divWidth-e)/this.divWidth*2-1,2*-(t/this.divHeight)+1,this.rootNode.position.project(this.camera).z).unproject(this.camera)},af.prototype.AngleBetween=function(e,t){var n=e.x*t.y-t.x*e.y,t=e.x*t.x+e.y*t.y;return Math.atan2(n,t)},af.prototype.setOcclusion=function(){var e,t,n,r,i=this;i.setDefPosture(!0),i.curStyleType===i.styleType.Ring?(null==i.rootNode.getChildByName("ringOC")?(t=new br({colorWrite:!1}),e=new Dl(.008,.008,.03,40,40),i.ringOCMesh=new ii(e,t),i.ringOCMesh.name="ringOC",i.ringOCMesh.renderOrder=-1/0,i.isRhino5||i.ringOCMesh.rotation.set(Math.PI/2,0,0),i.rootNode.add(i.ringOCMesh)):i.ringOCMesh.visible=!0,null!=i.watchOCMesh&&(i.watchOCMesh.visible=!1),null!=i.braceletOCMesh&&(i.braceletOCMesh.visible=!1),i.glassOCMesh&&(i.glassOCMesh.visible=!1)):i.curStyleType===i.styleType.Watch?(null==i.rootNode.getChildByName("watchOC")?(e=new br({colorWrite:!1}),t=new Dl(.026,.026,.08,40,40),i.watchOCMesh=new ii(t,e),i.watchOCMesh.name="watchOC",i.watchOCMesh.renderOrder=-1/0,i.watchOCMesh.position.set(0,.005,0),i.watchOCMesh.rotation.set(0,0,Math.PI/2),i.isRhino5||i.watchOCMesh.rotation.set(Math.PI/2,0,Math.PI/2),i.rootNode.add(i.watchOCMesh)):i.watchOCMesh.visible=!0,null!=i.ringOCMesh&&(i.ringOCMesh.visible=!1),null!=i.braceletOCMesh&&(i.braceletOCMesh.visible=!1),i.glassOCMesh&&(i.glassOCMesh.visible=!1)):i.curStyleType===i.styleType.Bracelet?(i.rootNode.getChildByName("braceletOC")?i.braceletOCMesh.visible=!0:(r=new br({colorWrite:!1}),n=new Dl(.023,.023,.06,40,40),i.braceletOCMesh=new ii(n,r),i.braceletOCMesh.name="braceletOC",i.braceletOCMesh.renderOrder=-1/0,i.braceletOCMesh.position.set(0,.003,0),i.braceletOCMesh.rotation.set(Math.PI/2,0,0),i.isRhino5||i.braceletOCMesh.rotation.set(Math.PI/2,0,Math.PI/2),i.rootNode.add(i.braceletOCMesh)),i.ringOCMesh&&(i.ringOCMesh.visible=!1),i.watchOCMesh&&(i.watchOCMesh.visible=!1),i.glassOCMesh&&(i.glassOCMesh.visible=!1)):i.curStyleType===i.styleType.Glasses?(i.rootNode.getChildByName("glassOC")?i.glassOCMesh.visible=!0:(n=new br({colorWrite:!1}),r=new di(.4,.05,.4),i.glassOCMesh=new ii(r,n),i.glassOCMesh.name="glassOC",i.glassOCMesh.renderOrder=-1/0,i.glassOCMesh.position.set(0,.14,0),i.glassOCMesh.rotation.set(Math.PI/2,0,0),i.isRhino5||i.glassOCMesh.rotation.set(Math.PI/2,0,Math.PI/2),i.scene.add(i.glassOCMesh)),i.ringOCMesh&&(i.ringOCMesh.visible=!1),i.watchOCMesh&&(i.watchOCMesh.visible=!1),i.braceletOCMesh&&(i.braceletOCMesh.visible=!1)):(null!=i.ringOCMesh&&(i.ringOCMesh.visible=!1),null!=i.watchOCMesh&&(i.watchOCMesh.visible=!1),i.braceletOCMesh&&(i.braceletOCMesh.visible=!1),i.glassOCMesh&&(i.glassOCMesh.visible=!1))},af.prototype.quitTryOn=function(){var e=this;e.resetRenderSize(),e.container.style.backgroundColor="white";var t=e.arToolkitSource.domElement.srcObject;t&&t.getVideoTracks()[0].stop();t=document.getElementById("arjs-video");null!=t&&t.remove(),JEELIZFACEFILTER.destroy(),e.rootNode.visible=!0,e.bgMesh&&(e.bgMesh.visible=!1,e.bgRenderer.clear(),null!=e.ringOCMesh&&e.ringOCMesh.visible&&(e.ringOCMesh.visible=!1),null!=e.watchOCMesh&&e.watchOCMesh.visible&&(e.watchOCMesh.visible=!1),null!=e.braceletOCMesh&&e.braceletOCMesh.visible&&(e.braceletOCMesh.visible=!1),null!=e.glassOCMesh&&e.glassOCMesh.visible&&(e.glassOCMesh.visible=!1)),e.curTryOnMode===e.tryOnMode.Capture&&e.saveTryOnCache(!1),e.setDefPosture(!1),e.curStyleType===e.styleType.Ring&&(t=((e.maxY+e.minY)/2).toFixed(2),e.rootNode.position.y-=t),e.zoomDelta=0,e.bgRenderer.domElement.style.display="none",null!=e.takeRender&&(e.takeRender.style.display="none"),e.controls.enabled=!0,e.controls.enableDamping=!0,e.arcball.enabled=!1,e.dragControls.enabled=!1,e.curTryOnMode=e.tryOnMode.TDShow,e.resetVarDesignGround()},af.prototype.quitModelTryOn=function(){var e,t=this;t.resetRenderSize(),t.bgMesh.visible=!1,t.bgRenderer.clear(),null!=t.ringOCMesh&&t.ringOCMesh.visible&&(t.ringOCMesh.visible=!1),null!=t.watchOCMesh&&t.watchOCMesh.visible&&(t.watchOCMesh.visible=!1),null!=t.braceletOCMesh&&t.braceletOCMesh.visible&&(t.braceletOCMesh.visible=!1),null!=t.glassOCMesh&&t.glassOCMesh.visible&&(t.glassOCMesh.visible=!1),t.setDefPosture(!1),t.zoomDelta=0,t.bgRenderer.domElement.style.display="none",null!=t.takeRender&&(t.takeRender.style.display="none"),t.controls.enabled=!0,t.controls.enableDamping=!0,t.arcball.enabled=!1,t.dragControls.enabled=!1,t.curTryOnMode=t.tryOnMode.TDShow,t.bIsVarDesign?t.resetVarDesignGround():t.curStyleType===t.styleType.Ring&&(e=((t.maxY+t.minY)/2).toFixed(2),t.rootNode.position.y-=e),setTimeout(function(){t.render()},50),t.bIsVarDesign&&t.switchRealRenderingShadowState(!0)},af.prototype.createCaptureRender=function(){var e=this;null==e.takeRender&&(e.takeRender=document.createElement("canvas"),e.zoomMask.appendChild(e.takeRender),e.takeRender.style.position="absolute",e.takeRender.style.zIndex="-1",e.takeRender.id="_this.takeRender"),e.takeRender.width=e.divWidth,e.takeRender.height=e.divHeight,e.takeRender.style.display="block",e.bgRenderer.domElement.style.display="none",e.takeRender.getContext("2d").drawImage(e.bgRenderer.domElement,0,0,e.divWidth,e.divHeight),e.takeRender.style.transform=e.bgRenderer.domElement.style.transform},af.prototype.photoZoom=function(e){var t=this,n=t.divWidth*e*.01,r=t.divHeight*e*.01,i=t.divWidth+n,e=t.divHeight+r;t.renderer.setSize(i,e),t.renderer.domElement.style.top=0-r/2+"px",t.renderer.domElement.style.left=0-n/2+"px",t.bgRenderer.domElement.style.display="none",t.takeRender.getContext("2d").drawImage(t.bgRenderer.domElement,-n/2,-r/2,i,e),t.takeRender.style.transform=t.bgRenderer.domElement.style.transform},af.prototype.zoomModelTryon=function(e){var t=this;t.camera.fov=t.defaultCamereFov-.05*e,t.camera.updateProjectionMatrix();var n=t.divWidth*e*.005,e=t.divHeight*e*.005,n=t.divWidth-n,e=t.divHeight-e;t.backgroundCamera.left=n/-2,t.backgroundCamera.right=n/2,t.backgroundCamera.top=e/2,t.backgroundCamera.bottom=e/-2,t.backgroundCamera.updateProjectionMatrix()},af.prototype.saveTryOnCache=function(e){var t=this;switch(t.curStyleType){case t.styleType.Ring:e&&(t.bgRingComposer.render(),t.ringTryOnCache.bgTex=t.ringRenderTarget.texture,t.ringTryOnCache.bFront=window.isFrontCamera),t.ringTryOnCache.camPos=t.camera.position.clone(),t.ringTryOnCache.ctrlTarget=t.controls.target.clone(),t.ringTryOnCache.objPos=t.rootNode.position.clone(),t.ringTryOnCache.objRot=t.rootNode.rotation.clone(),t.ringTryOnCache.objScale=t.rootNode.scale.clone(),t.bgMesh.material.map=t.ringTryOnCache.bgTex;break;case t.styleType.Necklace:e&&(t.bgNecklaceComposer.render(),t.necklaceTryOnCache.bgTex=t.necklaceRenderTarget.texture,t.necklaceTryOnCache.bFront=window.isFrontCamera),t.necklaceTryOnCache.camPos=t.camera.position.clone(),t.necklaceTryOnCache.ctrlTarget=t.controls.target.clone(),t.necklaceTryOnCache.objPos=t.rootNode.position.clone(),t.necklaceTryOnCache.objRot=t.rootNode.rotation.clone(),t.necklaceTryOnCache.objScale=t.rootNode.scale.clone(),t.bgMesh.material.map=t.necklaceTryOnCache.bgTex;break;case t.styleType.Earring:e&&(t.bgEarringComposer.render(),t.earringTryOnCache.bgTex=t.earringRenderTarget.texture,t.earringTryOnCache.bFront=window.isFrontCamera),t.earringTryOnCache.camPos=t.camera.position.clone(),t.earringTryOnCache.ctrlTarget=t.controls.target.clone(),t.earringTryOnCache.objPos=t.rootNode.position.clone(),t.earringTryOnCache.objRot=t.rootNode.rotation.clone(),t.earringTryOnCache.objScale=t.rootNode.scale.clone(),t.bgMesh.material.map=t.earringTryOnCache.bgTex;break;case t.styleType.Watch:e&&(t.bgWatchComposer.render(),t.watchTryOnCache.bgTex=t.watchRenderTarget.texture,t.watchTryOnCache.bFront=window.isFrontCamera),t.watchTryOnCache.camPos=t.camera.position.clone(),t.watchTryOnCache.ctrlTarget=t.controls.target.clone(),t.watchTryOnCache.objPos=t.rootNode.position.clone(),t.watchTryOnCache.objRot=t.rootNode.rotation.clone(),t.watchTryOnCache.objScale=t.rootNode.scale.clone(),t.bgMesh.material.map=t.watchTryOnCache.bgTex;break;case t.styleType.Glasses:e&&(t.bgGlassComposer.render(),t.glassTryOnCache.bgTex=t.glassRenderTarget.texture,t.glassTryOnCache.bFront=window.isFrontCamera),t.glassTryOnCache.camPos=t.camera.position.clone(),t.glassTryOnCache.ctrlTarget=t.controls.target.clone(),t.glassTryOnCache.objPos=t.rootNode.position.clone(),t.glassTryOnCache.objRot=t.rootNode.rotation.clone(),t.glassTryOnCache.objScale=t.rootNode.scale.clone(),t.bgMesh.material.map=t.glassTryOnCache.bgTex;break;case t.styleType.Bracelet:e&&(t.bgBraceletComposer.render(),t.braceletTryOnCache.bgTex=t.braceletRenderTarget.texture,t.braceletTryOnCache.bFront=window.isFrontCamera),t.braceletTryOnCache.camPos=t.camera.position.clone(),t.braceletTryOnCache.ctrlTarget=t.controls.target.clone(),t.braceletTryOnCache.objPos=t.rootNode.position.clone(),t.braceletTryOnCache.objRot=t.rootNode.rotation.clone(),t.braceletTryOnCache.objScale=t.rootNode.scale.clone(),t.bgMesh.material.map=t.braceletTryOnCache.bgTex}t.curTryOnMode=t.tryOnMode.Capture},af.prototype.clearCacheByType=function(){var e=this;switch(e.curStyleType){case e.styleType.Ring:e.ringTryOnCache=new e.tryOnCache;break;case e.styleType.Necklace:e.necklaceTryOnCache=new e.tryOnCache;break;case e.styleType.Earring:e.earringTryOnCache=new e.tryOnCache;break;case e.styleType.Watch:e.watchTryOnCache=new e.tryOnCache;break;case e.styleType.Bracelet:e.braceletTryOnCache=new e.tryOnCache}},af.prototype.setModelTryOnState=function(){var e=this;switch(e.bgRenderer&&(e.bgRenderer.domElement.style.display="block"),e.bIsVarDesign&&e.switchRealRenderingShadowState(!1),e.curStyleType){case e.styleType.Ring:null!==e.ringTryOnCache.bgTex?(e.setOcclusion(),e.mirrorBkRender(e.ringTryOnCache.bFront),e.bgMesh.visible=!1,e.bgMesh.material.map=e.ringTryOnCache.bgTex,e.camera.position.set(e.ringTryOnCache.camPos.x,e.ringTryOnCache.camPos.y,e.ringTryOnCache.camPos.z),e.controls.target.copy(e.ringTryOnCache.ctrlTarget),e.rootNode.position.copy(e.ringTryOnCache.objPos),e.rootNode.rotation.copy(e.ringTryOnCache.objRot),e.rootNode.scale.copy(e.ringTryOnCache._this.objScale),e.resetRenderSize(),e.curTryOnMode=e.tryOnMode.Capture,requestAnimationFrame(e.showBkMesh.bind(e))):e.switchModelTryOnPose();break;case e.styleType.Necklace:null!==e.necklaceTryOnCache.bgTex?(e.setOcclusion(),e.mirrorBkRender(e.necklaceTryOnCache.bFront),e.bgMesh.visible=!1,e.bgMesh.material.map=e.necklaceTryOnCache.bgTex,e.camera.position.set(e.necklaceTryOnCache.camPos.x,e.necklaceTryOnCache.camPos.y,e.necklaceTryOnCache.camPos.z),e.controls.target.copy(e.necklaceTryOnCache.ctrlTarget),e.rootNode.position.copy(e.necklaceTryOnCache.objPos),e.rootNode.rotation.copy(e.necklaceTryOnCache.objRot),e.rootNode.scale.copy(e.necklaceTryOnCache._this.objScale),e.resetRenderSize(),e.curTryOnMode=e.tryOnMode.Capture,requestAnimationFrame(e.showBkMesh.bind(e))):e.switchModelTryOnPose();break;case e.styleType.Earring:null!==e.earringTryOnCache.bgTex?(e.setOcclusion(),e.mirrorBkRender(e.earringTryOnCache.bFront),e.bgMesh.visible=!1,e.bgMesh.material.map=e.earringTryOnCache.bgTex,e.camera.position.set(e.earringTryOnCache.camPos.x,e.earringTryOnCache.camPos.y,e.earringTryOnCache.camPos.z),e.controls.target.copy(e.earringTryOnCache.ctrlTarget),e.rootNode.position.copy(e.earringTryOnCache.objPos),e.rootNode.rotation.copy(e.earringTryOnCache.objRot),e.rootNode.scale.copy(e.earringTryOnCache._this.objScale),e.resetRenderSize(),e.curTryOnMode=e.tryOnMode.Capture,requestAnimationFrame(e.showBkMesh.bind(e))):e.switchModelTryOnPose();break;case e.styleType.Watch:null!==e.watchTryOnCache.bgTex?(e.setOcclusion(),e.mirrorBkRender(e.watchTryOnCache.bFront),e.bgMesh.visible=!1,e.bgMesh.material.map=e.watchTryOnCache.bgTex,e.camera.position.set(e.watchTryOnCache.camPos.x,e.watchTryOnCache.camPos.y,e.watchTryOnCache.camPos.z),e.controls.target.copy(e.watchTryOnCache.ctrlTarget),e.rootNode.position.copy(e.watchTryOnCache.objPos),e.rootNode.rotation.copy(e.watchTryOnCache.objRot),e.rootNode.scale.copy(e.watchTryOnCache._this.objScale),e.resetRenderSize(),e.curTryOnMode=e.tryOnMode.Capture,requestAnimationFrame(e.showBkMesh.bind(e))):e.switchModelTryOnPose();break;case e.styleType.Bracelet:null!==e.braceletTryOnCache.bgTex?(e.setOcclusion(),e.mirrorBkRender(e.braceletTryOnCache.bFront),e.bgMesh.visible=!1,e.bgMesh.material.map=e.braceletTryOnCache.bgTex,e.camera.position.set(e.braceletTryOnCache.camPos.x,e.braceletTryOnCache.camPos.y,e.braceletTryOnCache.camPos.z),e.controls.target.copy(e.braceletTryOnCache.ctrlTarget),e.rootNode.position.copy(e.braceletTryOnCache.objPos),e.rootNode.rotation.copy(e.braceletTryOnCache.objRot),e.rootNode.scale.copy(e.braceletTryOnCache._this.objScale),e.resetRenderSize(),e.curTryOnMode=e.tryOnMode.Capture,requestAnimationFrame(e.showBkMesh.bind(e))):e.switchModelTryOnPose()}},af.prototype.setTryOnState=function(){var e=this;switch(e.bgRenderer&&(e.bgRenderer.domElement.style.display="block"),e.curStyleType){case e.styleType.Ring:null!==e.ringTryOnCache.bgTex?(e.setOcclusion(),e.mirrorBkRender(e.ringTryOnCache.bFront),e.bgMesh.visible=!1,e.bgMesh.material.map=e.ringTryOnCache.bgTex,e.camera.position.set(e.ringTryOnCache.camPos.x,e.ringTryOnCache.camPos.y,e.ringTryOnCache.camPos.z),e.controls.target.copy(e.ringTryOnCache.ctrlTarget),e.rootNode.position.copy(e.ringTryOnCache.objPos),e.rootNode.rotation.copy(e.ringTryOnCache.objRot),e.rootNode.scale.copy(e.ringTryOnCache._this.objScale),e.resetRenderSize(),e.curTryOnMode=e.tryOnMode.Capture,requestAnimationFrame(e.showBkMesh.bind(e))):(e.switchTryOnPose(),e.mirrorBkRender(window.isFrontCamera));break;case e.styleType.Necklace:null!==e.necklaceTryOnCache.bgTex?(e.setOcclusion(),e.mirrorBkRender(e.necklaceTryOnCache.bFront),e.bgMesh.visible=!1,e.bgMesh.material.map=e.necklaceTryOnCache.bgTex,e.camera.position.set(e.necklaceTryOnCache.camPos.x,e.necklaceTryOnCache.camPos.y,e.necklaceTryOnCache.camPos.z),e.controls.target.copy(e.necklaceTryOnCache.ctrlTarget),e.rootNode.position.copy(e.necklaceTryOnCache.objPos),e.rootNode.rotation.copy(e.necklaceTryOnCache.objRot),e.rootNode.scale.copy(e.necklaceTryOnCache._this.objScale),e.resetRenderSize(),e.curTryOnMode=e.tryOnMode.Capture,requestAnimationFrame(e.showBkMesh.bind(e))):(e.switchTryOnPose(),e.mirrorBkRender(window.isFrontCamera));break;case e.styleType.Earring:null!==e.earringTryOnCache.bgTex?(e.setOcclusion(),e.mirrorBkRender(e.earringTryOnCache.bFront),e.bgMesh.visible=!1,e.bgMesh.material.map=e.earringTryOnCache.bgTex,e.camera.position.set(e.earringTryOnCache.camPos.x,e.earringTryOnCache.camPos.y,e.earringTryOnCache.camPos.z),e.controls.target.copy(e.earringTryOnCache.ctrlTarget),e.rootNode.position.copy(e.earringTryOnCache.objPos),e.rootNode.rotation.copy(e.earringTryOnCache.objRot),e.rootNode.scale.copy(e.earringTryOnCache._this.objScale),e.resetRenderSize(),e.curTryOnMode=e.tryOnMode.Capture,requestAnimationFrame(e.showBkMesh.bind(e))):(e.switchTryOnPose(),e.mirrorBkRender(window.isFrontCamera));break;case e.styleType.Watch:null!==e.watchTryOnCache.bgTex?(e.setOcclusion(),e.mirrorBkRender(e.watchTryOnCache.bFront),e.bgMesh.visible=!1,e.bgMesh.material.map=e.watchTryOnCache.bgTex,e.camera.position.set(e.watchTryOnCache.camPos.x,e.watchTryOnCache.camPos.y,e.watchTryOnCache.camPos.z),e.controls.target.copy(e.watchTryOnCache.ctrlTarget),e.rootNode.position.copy(e.watchTryOnCache.objPos),e.rootNode.rotation.copy(e.watchTryOnCache.objRot),e.rootNode.scale.copy(e.watchTryOnCache._this.objScale),e.resetRenderSize(),e.curTryOnMode=e.tryOnMode.Capture,requestAnimationFrame(e.showBkMesh.bind(e))):(e.switchTryOnPose(),e.mirrorBkRender(window.isFrontCamera));break;case e.styleType.Bracelet:null!==e.braceletTryOnCache.bgTex?(e.setOcclusion(),e.mirrorBkRender(e.braceletTryOnCache.bFront),e.bgMesh.visible=!1,e.bgMesh.material.map=e.braceletTryOnCache.bgTex,e.camera.position.set(e.braceletTryOnCache.camPos.x,e.braceletTryOnCache.camPos.y,e.braceletTryOnCache.camPos.z),e.controls.target.copy(e.braceletTryOnCache.ctrlTarget),e.rootNode.position.copy(e.braceletTryOnCache.objPos),e.rootNode.rotation.copy(e.braceletTryOnCache.objRot),e.rootNode.scale.copy(e.braceletTryOnCache._this.objScale),e.resetRenderSize(),e.curTryOnMode=e.tryOnMode.Capture,requestAnimationFrame(e.showBkMesh.bind(e))):(e.switchTryOnPose(),e.mirrorBkRender(window.isFrontCamera));break;case e.styleType.Glasses:null!==e.glassTryOnCache.bgTex?(e.setOcclusion(),e.mirrorBkRender(e.glassTryOnCache.bFront),e.bgMesh.visible=!1,e.bgMesh.material.map=e.glassTryOnCache.bgTex,e.camera.position.set(e.glassTryOnCache.camPos.x,e.glassTryOnCache.camPos.y,e.glassTryOnCache.camPos.z),e.controls.target.copy(e.glassTryOnCache.ctrlTarget),e.rootNode.position.copy(e.glassTryOnCache.objPos),e.rootNode.rotation.copy(e.glassTryOnCache.objRot),e.rootNode.scale.copy(e.glassTryOnCache._this.objScale),e.resetRenderSize(),e.curTryOnMode=e.tryOnMode.Capture,requestAnimationFrame(e.showBkMesh.bind(e))):(e.switchTryOnPose(),e.mirrorBkRender(window.isFrontCamera))}},af.prototype.showBkMesh=function(){this.bgMesh.visible=!0,requestAnimationFrame(this.createCaptureRender.bind(this))},af.prototype.switchModelTryOnPose=function(){var e=this;e.curTryOnMode===e.tryOnMode.TDShow?e.loadModelImage():e.curTryOnMode===e.tryOnMode.TryOn?(e.controls.reset(),e.setOcclusion()):e.curTryOnMode!==e.tryOnMode.Capture&&e.curTryOnMode!==e.tryOnMode.Share||(e.resetRenderSize(),e.loadModelImage(),e.curTryOnMode=e.tryOnMode.TryOn)},af.prototype.switchTryOnPose=function(){var e,t=this;t.curTryOnMode===t.tryOnMode.TDShow?t.startWebCam():t.curTryOnMode===t.tryOnMode.TryOn?(t.controls.reset(),t.setOcclusion()):t.curTryOnMode!==t.tryOnMode.Capture&&t.curTryOnMode!==t.tryOnMode.Share||(t.resetRenderSize(),null!==(e=document.getElementById("arjs-video"))?((e=new Is(e)).wrapS=e.wrapT=be,e.minFilter=Ae,t.bgMesh.material.map=e,t.bgRenderer.domElement.style.display="block",null!=t.takeRender&&(t.takeRender.style.display="none"),t.controls.reset(),t.setOcclusion()):t.startWebCam(),t.mirrorBkRender(window.isFrontCamera),t.curTryOnMode=t.tryOnMode.TryOn)},af.prototype.resetRenderSize=function(){var e=this;e.renderer.domElement.style.top="0px",e.renderer.domElement.style.left="0px",e.renderer.setSize(e.divWidth,e.divHeight),e.bgRenderer.domElement.style.top="0px",e.bgRenderer.domElement.style.left="0px",e.bgRenderer.setSize(e.divWidth,e.divHeight),e.zoomDelta=0},af.prototype.checkTryOnMode=function(){this.curTryOnMode!==this.tryOnMode.TDShow?this.isModelTryon?this.setModelTryOnState():this.setTryOnState():this.setDefPosture(!1)},af.prototype.mirrorBkRender=function(e){e?(this.isFlip=!0,this.bgRenderer.domElement.style.transform="rotateY(180deg)",this.bgRenderer.domElement.style.webkitTransform="rotateY(180deg)",this.bgRenderer.domElement.style.mozTransform="rotateY(180deg)",this.bgRenderer.domElement.style.msTransform="rotateY(180deg)"):(this.isFlip=!1,this.bgRenderer.domElement.style.transform&&this.bgRenderer.domElement.style.removeProperty("transform"))},e.initWeb3D=function(e,t,n,r,i){return new af(e,t,n,r,i,!(5<arguments.length&&void 0!==arguments[5])||arguments[5])},e.web3DApplication=af,Object.defineProperty(e,"__esModule",{value:!0})});
