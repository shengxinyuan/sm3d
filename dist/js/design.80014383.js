(function(t){function a(a){for(var s,o,c=a[0],r=a[1],d=a[2],m=0,u=[];m<c.length;m++)o=c[m],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&u.push(i[o][0]),i[o]=0;for(s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s]);l&&l(a);while(u.length)u.shift()();return n.push.apply(n,d||[]),e()}function e(){for(var t,a=0;a<n.length;a++){for(var e=n[a],s=!0,c=1;c<e.length;c++){var r=e[c];0!==i[r]&&(s=!1)}s&&(n.splice(a--,1),t=o(o.s=e[0]))}return t}var s={},i={design:0},n=[];function o(a){if(s[a])return s[a].exports;var e=s[a]={i:a,l:!1,exports:{}};return t[a].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=t,o.c=s,o.d=function(t,a,e){o.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:e})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,a){if(1&a&&(t=o(t)),8&a)return t;if(4&a&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var s in t)o.d(e,s,function(a){return t[a]}.bind(null,s));return e},o.n=function(t){var a=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(a,"a",a),a},o.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},o.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],r=c.push.bind(c);c.push=a,c=c.slice();for(var d=0;d<c.length;d++)a(c[d]);var l=r;n.push([0,"chunk-vendors","chunk-common"]),e()})({0:function(t,a,e){t.exports=e("6ce0")},"1c85":function(t,a,e){t.exports=e.p+"img/diamond.eb705317.webp"},"6ce0":function(t,a,e){"use strict";e.r(a);e("5246");var s=e("6b41"),i=(e("e17f"),e("2241")),n=(e("5f5f"),e("f253")),o=(e("8a58"),e("e41f")),c=(e("c3a6"),e("ad06")),r=(e("e7e5"),e("d399")),d=(e("e260"),e("e6cf"),e("cca6"),e("a79d"),e("2b0e")),l=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"design"},[s("title-bar",{attrs:{title:"3D设计"}}),t.loading?s("Loading"):t._e(),s("img",{staticClass:"img2",attrs:{src:e("f923"),alt:""}}),t._m(0),"design"===t.footerTabId?s("section",{staticClass:"page-footer"},[s("div",{staticClass:"design-tabs-title"},[s("div",{staticClass:"back",on:{click:function(){return t.footerTabId="default"}}},[s("van-icon",{attrs:{name:"arrow-left"}}),t._v("返回 ")],1),s("a",{class:1===t.designTab?"active":"",on:{click:function(){t.designTab=1,t.edit3dPartType=1}}},[t._v("花头款式")]),s("a",{class:2===t.designTab?"active":"",on:{click:function(){t.designTab=2,t.edit3dPartType=2}}},[t._v("戒托款式")]),s("a",{class:3===t.designTab?"active":"",on:{click:function(){return t.designTab=3}}},[t._v("戒托材质")]),s("a",{class:4===t.designTab?"active":"",on:{click:function(){t.designTab=4,t.edit3dPartType=4}}},[t._v("固定款式")])]),s("div",{staticClass:"design-tabs-cont"},[1===t.designTab?s("div",{staticClass:"list"},t._l(t.$store.state.design.parts,(function(a,e){return s("div",{key:e,staticClass:"item",class:t.isCombo||t.$store.state.design.partId!==a.id?"":"active",on:{click:function(){t.changePartId(a.id)}}},[s("div",{staticClass:"img-box"},[s("i",{staticClass:"img-border"}),s("i",{staticClass:"parts-img img",style:{backgroundImage:"url(https://design.bavlo.com/PartRes/webImg/"+a.defaultImg+"!600)"}})]),s("div",{staticClass:"txt"},[t._v("花头"+t._s(a.id))])])})),0):t._e(),2===t.designTab?s("div",{staticClass:"list"},t._l(t.$store.state.design.mainParts,(function(a,e){return s("div",{key:e,staticClass:"item",class:t.isCombo||t.$store.state.design.mainPartId!==a.id?"":"active",on:{click:function(){t.changeMainPartId(a.id)}}},[s("div",{staticClass:"img-box"},[s("i",{staticClass:"img-border"}),s("i",{staticClass:"main-parts-img img",style:{backgroundImage:"url(https://design.bavlo.com/PartRes/webImg/"+a.defaultImg+"!600)"}})]),s("div",{staticClass:"txt"},[t._v("戒托"+t._s(a.id))])])})),0):t._e(),3===t.designTab?s("div",{staticClass:"list"},t._l(t.$store.state.design.metals,(function(a,e){return s("div",{key:e,staticClass:"item",class:t.$store.state.design.metalId===a.id?"active":"",on:{click:function(){t.changeMetalId(a.id)}}},[s("div",{staticClass:"img-box"},[s("i",{staticClass:"img-border"}),s("i",{staticClass:"metals-img img",style:{backgroundImage:"url(https://design.bavlo.com/IconRes/RoundMetalIcons/"+a.id+".png)"}})]),s("div",{staticClass:"txt"},[t._v(t._s(a.nameCn))])])})),0):t._e(),4===t.designTab?s("div",{staticClass:"list"},t._l(t.$store.state.design.comboList,(function(a,e){return s("div",{key:e,staticClass:"item",class:t.isCombo&&t.$store.state.design.comboId===a.id?"active":"",on:{click:function(){t.changeComboId(a.id)}}},[s("div",{staticClass:"img-box"},[s("i",{staticClass:"img-border"}),s("i",{staticClass:"main-parts-img img",style:{backgroundImage:"url(https://design.bavlo.com/design/"+a.id+"/web.png!600"}})]),s("div",{staticClass:"txt"},[t._v("款式"+t._s(a.id))])])})),0):t._e()])]):"diamond"===t.footerTabId?s("section",{staticClass:"page-footer"},[s("div",{staticClass:"design-tabs-title"},[s("div",{staticClass:"back",on:{click:function(){return t.footerTabId="default"}}},[s("van-icon",{attrs:{name:"arrow-left"}}),t._v("返回 ")],1),s("a",{staticClass:"active"},[t._v("选择主钻")])]),s("div",{staticClass:"design-tabs-cont"},[this.$store.state.design.diamondId?s("div",{staticClass:"diamond-detail"},[s("div",{staticClass:"diamond-info-cont"},[s("img",{staticClass:"diamond-img",attrs:{src:e("1c85"),alt:""}}),s("div",{staticClass:"diamond-info"},[s("p",[t._v("GIA "+t._s(t.$store.state.design.diamondInfo.size))]),s("p",[t._v("详情: "+t._s(t.$store.state.design.diamondInfo.detail||"_"))]),s("p",[t._v("售价 ¥ "+t._s(t.$store.state.design.diamondInfo.price||"-")+"元")])])]),s("a",{staticClass:"change-btn",on:{click:t.selectDiamond}},[s("van-icon",{attrs:{name:"exchange"}}),s("span",{staticClass:"txt"},[t._v("更换")])],1)]):s("div",{staticClass:"design-add-diamond",on:{click:t.selectDiamond}},[t._v("添加钻石")])])]):"mark"===t.footerTabId?s("section",{staticClass:"page-footer"},[s("div",{staticClass:"design-tabs-title"},[s("div",{staticClass:"back",on:{click:t.markBack}},[s("van-icon",{attrs:{name:"arrow-left"}}),t._v("返回 ")],1),s("a",{staticClass:"active"},[t._v("文字印记")])]),s("div",{staticClass:"design-tabs-cont"},[s("div",{staticClass:"mark-cont"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.mark,expression:"mark"}],staticClass:"mark-input",attrs:{type:"text",maxlength:"16",placeholder:"印刻彼此名字或誓言(16字内)"},domProps:{value:t.mark},on:{keyup:t.onKeyup,input:function(a){a.target.composing||(t.mark=a.target.value)}}}),s("a",{staticClass:"mark-btn",on:{click:t.saveMark}},[t._v("确认")])])])]):s("section",{staticClass:"page-footer"},[s("div",{staticClass:"btns-group"},[s("a",{staticClass:"option",on:{click:function(){return t.footerTabId="design"}}},[s("i",{staticClass:"icon-design"}),s("span",{staticClass:"txt"},[t._v("设计")])]),s("a",{staticClass:"option",on:{click:function(){return t.footerTabId="diamond"}}},[s("i",{staticClass:"icon-diamond"}),s("span",{staticClass:"txt"},[t._v("选钻")])]),s("a",{staticClass:"option",on:{click:t.openMark}},[s("i",{staticClass:"icon-mark"}),s("span",{staticClass:"txt"},[t._v("印记")])]),s("a",{staticClass:"option",on:{click:t.openHandInch}},[s("i",{staticClass:"icon-hand"}),s("span",{staticClass:"txt"},[t._v("手寸")])]),s("a",{staticClass:"option",on:{click:t.tryOn}},[s("i",{staticClass:"icon-try"}),s("span",{staticClass:"txt"},[t._v("试戴")])])]),s("div",{staticClass:"buy-group"},[s("div",{staticClass:"cost"},[t._v("¥ "+t._s(t._f("formatCost")(t.price)))]),s("div",{staticClass:"buy-btn",on:{click:t.confirmDesign}},[t._v("确认设计")])])]),s("van-popup",{attrs:{round:"",position:"bottom"},model:{value:t.handPicker,callback:function(a){t.handPicker=a},expression:"handPicker"}},[s("van-picker",{ref:"picker",attrs:{"show-toolbar":"",columns:[{values:t.handInch,defaultIndex:8}]},on:{cancel:function(a){t.handPicker=!1},confirm:t.changeHandInch}})],1)],1)},m=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"web3d-cont"},[e("div",{staticStyle:{},attrs:{id:"web3d"}})])}],u=e("1da1"),f=(e("96cf"),e("d3b7"),e("fb6a"),e("159b"),e("a9e3"),e("b0c0"),e("25f0"),e("9e2c")),g=e("65a7"),v={mixins:[g["a"]],props:[],data:function(){return{handInch:f["d"],handPicker:!1,mark:"",footerTabId:"default",designTab:1,edit3dPartType:1,imgUrl:""}},mounted:function(){},methods:{confirmDesign:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function a(){var e,s,i,n,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e=t.$store.state.design,s=e.currentHandInch,i=e.diamondId,s){a.next=4;break}return t.$dialog.alert({title:"请选择手寸",message:"您未选择手寸，请选择戒指手寸大小"}).then((function(){t.handPicker=!0})),a.abrupt("return");case 4:if(i){a.next=7;break}return t.$dialog.alert({title:"请选择钻石",message:"您未选择钻石，请选择钻石"}).then((function(){t.footerTabId="diamond"})),a.abrupt("return");case 7:return n=t.my3d.getTryOnState(),0!==n&&(t.my3d.setModelTryonMode(!1,null),t.my3d.onWindowResize(2)),a.next=11,new Promise((function(t){return setTimeout(t,200)}));case 11:return t.loading=!0,t.my3d.changeBackground("72,72,79"),t.setInitCameraPos(),a.next=16,new Promise((function(t){return setTimeout(t,200)}));case 16:o=document.querySelector("#mainCanvas"),t.imgUrl=t.my3d.getDesignImage(2*o.offsetWidth,2*o.offsetHeight),t.$store.dispatch("submitDesign",{image:t.imgUrl,bn:t.design_bn,isCombo:t.isCombo}).then((function(t){var a=t.data;location.href="/order/?bn=".concat(a)})).catch((function(t){var a=t.message;console.log(a)}));case 19:case"end":return a.stop()}}),a)})))()},selectDiamond:function(){var t=this.$store.state.design,a=t.mark,e=t.mainPartId,s=t.partId,i=t.metalId,n=t.diamondId,o=t.currentHandInch,c=t.comboId,r={};r.mark=a,r.mainPartId=e,r.partId=s,r.metalId=i,r.diamondId=n,r.currentHandInch=o,r.bn=this.design_bn,r.comboId=c,r.isCombo=this.isCombo?"1":"0";var d="//"+location.host+location.pathname+"?";for(var l in r)r[l]&&(d+=l+"="+r[l]+"&");d=d.slice(0,d.length-1),location.href="/diamondList/?backUrl=".concat(encodeURIComponent(d))},openMark:function(){this.footerTabId="mark",this.my3d.setRotationState(!1),this.my3d.changeCameraPos(!1,0,80,-60)},saveMark:function(){this.$store.commit("setState",{mark:this.mark}),this.printUserMark(!0)},markBack:function(){this.footerTabId="default",this.setInitCameraPos(),this.my3d.setRotationState(!0)},onKeyup:function(t){"13"==t.keyCode&&this.saveMark()},changeHandInch:function(t){this.$store.commit("setState",{currentHandInch:t[0]}),this.handPicker=!1,this.getPrice()},openHandInch:function(){var t=this;this.handPicker=!0;var a=this.$store.state.design.currentHandInch;this.$nextTick((function(){if(a){var e=8;f["d"].forEach((function(t,s){+t===+a&&(e=s)})),t.$refs.picker.setIndexes([e])}}))},changePartId:function(t){var a=this;this.checkFromComboDesign().then((function(){console.log("partId",t);var e=a.my3d.getLoadModelState();2==e&&(a.my3d.switchPart(a.edit3dPartType,Number(t)),a.$store.commit("setState",{partId:t})),a.getPrice()}))},changeMainPartId:function(t){var a=this;this.checkFromComboDesign().then((function(){console.log("mainPartId",t);var e=a.my3d.getLoadModelState();2==e&&(a.my3d.switchPart(a.edit3dPartType,Number(t)),a.$store.commit("setState",{mainPartId:t}),setTimeout((function(){a.mark&&(a.printUserMark(),setTimeout((function(){a.my3d.setRotationState(!0)}),200))}),1e3)),a.getPrice()}))},checkFromComboDesign:function(){var t=this;return new Promise((function(a,e){t.isCombo&&t.$dialog.confirm({title:"提示",message:"是否以当前设计款式覆盖固定款式方案？"}).then((function(){t.init3D(),a()})).catch(e),a()}))},tryOn:function(){var t=this,a=this.$store.state.design.webModelPics;a&&a.length?this.hasModeltryOn():this.$store.dispatch("loadModelPicList").then((function(){t.hasModeltryOn()}))},hasModeltryOn:function(){var t=this.$store.state.design,a=t.webModelPics,e=t.userNo,s=this.my3d.getTryOnState();if(0===s){this.my3d.onWindowResize(0);var i=a[0];i.imgUrl="https://design.bavlo.com/WebModelPics/"+e+"/"+i.name,this.my3d.setModelTryonMode(!0,i)}else this.my3d.setModelTryonMode(!1,null),this.my3d.onWindowResize(2)}},filters:{formatIndex:function(t){return t+=1,t<10?"0"+t:t},formatCost:function(t){if("number"===typeof t&&!isNaN(t))return t.toString()+".00"}}},b=v,h=(e("8fe9"),e("2877")),p=Object(h["a"])(b,l,m,!1,null,"13cf21b2",null),C=p.exports,k=e("4360"),y=e("a1e1");d["a"].use(r["a"]),d["a"].use(c["a"]),d["a"].use(o["a"]),d["a"].use(n["a"]),d["a"].use(i["a"]),d["a"].use(s["a"]),d["a"].component("title-bar",y["a"]),d["a"].config.productionTip=!1,new d["a"]({store:k["a"],render:function(t){return t(C)}}).$mount("#app")},"8fe9":function(t,a,e){"use strict";e("b7bc")},b7bc:function(t,a,e){}});
//# sourceMappingURL=design.80014383.js.map