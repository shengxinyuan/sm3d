(function(t){function e(e){for(var s,o,c=e[0],r=e[1],d=e[2],m=0,u=[];m<c.length;m++)o=c[m],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&u.push(i[o][0]),i[o]=0;for(s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s]);l&&l(e);while(u.length)u.shift()();return n.push.apply(n,d||[]),a()}function a(){for(var t,e=0;e<n.length;e++){for(var a=n[e],s=!0,c=1;c<a.length;c++){var r=a[c];0!==i[r]&&(s=!1)}s&&(n.splice(e--,1),t=o(o.s=a[0]))}return t}var s={},i={design:0},n=[];function o(e){if(s[e])return s[e].exports;var a=s[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=t,o.c=s,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(a,s,function(e){return t[e]}.bind(null,s));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],r=c.push.bind(c);c.push=e,c=c.slice();for(var d=0;d<c.length;d++)e(c[d]);var l=r;n.push([0,"chunk-vendors","chunk-common"]),a()})({0:function(t,e,a){t.exports=a("6ce0")},"1c85":function(t,e,a){t.exports=a.p+"img/diamond.eb705317.webp"},"6ce0":function(t,e,a){"use strict";a.r(e);a("5246");var s=a("6b41"),i=(a("e17f"),a("2241")),n=(a("5f5f"),a("f253")),o=(a("8a58"),a("e41f")),c=(a("c3a6"),a("ad06")),r=(a("e7e5"),a("d399")),d=(a("e260"),a("e6cf"),a("cca6"),a("a79d"),a("2b0e")),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"design"},[s("title-bar",{attrs:{title:"3D设计"}}),t.loading?s("Loading"):t._e(),s("img",{staticClass:"img2",attrs:{src:a("f923"),alt:""}}),t._m(0),"design"===t.footerTabId?s("section",{staticClass:"page-footer"},[s("div",{staticClass:"design-tabs-title"},[s("div",{staticClass:"back",on:{click:function(){return t.footerTabId="default"}}},[s("van-icon",{attrs:{name:"arrow-left"}}),t._v("返回 ")],1),t.isCombo?t._e():s("a",{class:1===t.designTab?"active":"",on:{click:function(){t.designTab=1,t.edit3dPartType=1}}},[t._v("花头款式")]),t.isCombo?t._e():s("a",{class:2===t.designTab?"active":"",on:{click:function(){t.designTab=2,t.edit3dPartType=2}}},[t._v("戒托款式")]),t.isCombo?s("a",{class:4===t.designTab?"active":"",on:{click:function(){t.designTab=4,t.edit3dPartType=4}}},[t._v("固定款式")]):t._e(),s("a",{class:3===t.designTab?"active":"",on:{click:function(){return t.designTab=3}}},[t._v("戒托材质")])]),s("div",{staticClass:"design-tabs-cont"},[1===t.designTab?s("div",{staticClass:"list"},t._l(t.$store.state.design.parts,(function(e,a){return s("div",{key:a,staticClass:"item",class:t.isCombo||t.$store.state.design.partId!==e.id?"":"active",on:{click:function(){t.changePartId(e.id)}}},[s("div",{staticClass:"img-box"},[s("i",{staticClass:"img-border"}),s("i",{staticClass:"parts-img img",style:{backgroundImage:"url(https://design.bavlo.com/PartRes/webImg/"+e.defaultImg+"!600)"}})]),s("div",{staticClass:"txt"},[t._v("花头"+t._s(e.id))])])})),0):t._e(),2===t.designTab?s("div",{staticClass:"list"},t._l(t.$store.state.design.mainParts,(function(e,a){return s("div",{key:a,staticClass:"item",class:t.isCombo||t.$store.state.design.mainPartId!==e.id?"":"active",on:{click:function(){t.changeMainPartId(e.id)}}},[s("div",{staticClass:"img-box"},[s("i",{staticClass:"img-border"}),s("i",{staticClass:"main-parts-img img",style:{backgroundImage:"url(https://design.bavlo.com/PartRes/webImg/"+e.defaultImg+"!600)"}})]),s("div",{staticClass:"txt"},[t._v("戒托"+t._s(e.id))])])})),0):t._e(),3===t.designTab?s("div",{staticClass:"list"},t._l(t.$store.state.design.metals,(function(e,a){return s("div",{key:a,staticClass:"item",class:t.$store.state.design.metalId===e.id?"active":"",on:{click:function(){t.changeMetalId(e.id)}}},[s("div",{staticClass:"img-box"},[s("i",{staticClass:"img-border"}),s("i",{staticClass:"metals-img img",style:{backgroundImage:"url(https://design.bavlo.com/IconRes/RoundMetalIcons/"+e.id+".png)"}})]),s("div",{staticClass:"txt"},[t._v(t._s(e.nameCn))])])})),0):t._e(),4===t.designTab?s("div",{staticClass:"list"},t._l(t.$store.state.design.comboList,(function(e,a){return s("div",{key:a,staticClass:"item",class:t.isCombo&&t.$store.state.design.comboId===e.id?"active":"",on:{click:function(){t.changeComboId(e.id)}}},[s("div",{staticClass:"img-box"},[s("i",{staticClass:"img-border"}),s("i",{staticClass:"main-parts-img img",style:{backgroundImage:"url(https://design.bavlo.com/design/"+e.id+"/web.png!600"}})]),s("div",{staticClass:"txt"},[t._v("款式"+t._s(e.id))])])})),0):t._e()])]):"diamond"===t.footerTabId?s("section",{staticClass:"page-footer"},[s("div",{staticClass:"design-tabs-title"},[s("div",{staticClass:"back",on:{click:function(){return t.footerTabId="default"}}},[s("van-icon",{attrs:{name:"arrow-left"}}),t._v("返回 ")],1),s("a",{staticClass:"active"},[t._v("选择主钻")])]),s("div",{staticClass:"design-tabs-cont"},[this.$store.state.design.diamondId?s("div",{staticClass:"diamond-detail"},[s("div",{staticClass:"diamond-info-cont"},[s("img",{staticClass:"diamond-img",attrs:{src:a("1c85"),alt:""}}),s("div",{staticClass:"diamond-info"},[s("p",[t._v("GIA "+t._s(t.$store.state.design.diamondInfo.size))]),s("p",[t._v("详情: "+t._s(t.$store.state.design.diamondInfo.detail||"_"))]),s("p",[t._v("售价 ¥ "+t._s(t.$store.state.design.diamondInfo.price||"-")+"元")])])]),s("a",{staticClass:"change-btn",on:{click:t.selectDiamond}},[s("van-icon",{attrs:{name:"exchange"}}),s("span",{staticClass:"txt"},[t._v("更换")])],1)]):s("div",{staticClass:"design-add-diamond",on:{click:t.selectDiamond}},[t._v("添加钻石")])])]):"mark"===t.footerTabId?s("section",{staticClass:"page-footer"},[s("div",{staticClass:"design-tabs-title"},[s("div",{staticClass:"back",on:{click:t.markBack}},[s("van-icon",{attrs:{name:"arrow-left"}}),t._v("返回 ")],1),s("a",{staticClass:"active"},[t._v("文字印记")])]),s("div",{staticClass:"design-tabs-cont"},[s("div",{staticClass:"mark-cont"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.mark,expression:"mark"}],staticClass:"mark-input",attrs:{type:"text",maxlength:"16",placeholder:"印刻彼此名字或誓言(16字内)"},domProps:{value:t.mark},on:{keyup:t.onKeyup,input:function(e){e.target.composing||(t.mark=e.target.value)}}}),s("a",{staticClass:"mark-btn",on:{click:t.saveMark}},[t._v("确认")])])])]):s("section",{staticClass:"page-footer"},[s("div",{staticClass:"btns-group"},[s("a",{staticClass:"option",on:{click:t.openDesign}},[s("i",{staticClass:"icon-design"}),s("span",{staticClass:"txt"},[t._v("设计")])]),s("a",{staticClass:"option",on:{click:function(){return t.footerTabId="diamond"}}},[s("i",{staticClass:"icon-diamond"}),s("span",{staticClass:"txt"},[t._v("选钻")])]),s("a",{staticClass:"option",on:{click:t.openMark}},[s("i",{staticClass:"icon-mark"}),s("span",{staticClass:"txt"},[t._v("印记")])]),s("a",{staticClass:"option",on:{click:t.openHandInch}},[s("i",{staticClass:"icon-hand"}),s("span",{staticClass:"txt"},[t._v("手寸")])]),s("a",{staticClass:"option",on:{click:t.tryOn}},[s("i",{staticClass:"icon-try"}),s("span",{staticClass:"txt"},[t._v("试戴")])])]),s("div",{staticClass:"buy-group"},[s("div",{staticClass:"cost"},[t._v("¥ "+t._s(t._f("formatCost")(t.price)))]),s("div",{staticClass:"buy-btn",on:{click:t.confirmDesign}},[t._v("确认设计")])])]),s("van-popup",{attrs:{round:"",position:"bottom"},model:{value:t.handPicker,callback:function(e){t.handPicker=e},expression:"handPicker"}},[s("van-picker",{ref:"picker",attrs:{"show-toolbar":"",columns:[{values:t.handInch,defaultIndex:8}]},on:{cancel:function(e){t.handPicker=!1},confirm:t.changeHandInch}})],1)],1)},m=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"web3d-cont"},[a("div",{staticStyle:{},attrs:{id:"web3d"}})])}],u=a("1da1"),f=(a("96cf"),a("d3b7"),a("fb6a"),a("159b"),a("a9e3"),a("b0c0"),a("25f0"),a("9e2c")),g=a("65a7"),b={mixins:[g["a"]],props:[],data:function(){return{handInch:f["d"],handPicker:!1,mark:"",footerTabId:"default",designTab:1,edit3dPartType:1,imgUrl:""}},mounted:function(){},methods:{confirmDesign:function(){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){var a,s,i,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.$store.state.design,s=a.currentHandInch,i=a.diamondId,s){e.next=4;break}return t.$dialog.alert({title:"请选择手寸",message:"您未选择手寸，请选择戒指手寸大小"}).then((function(){t.handPicker=!0})),e.abrupt("return");case 4:if(i){e.next=7;break}return t.$dialog.alert({title:"请选择钻石",message:"您未选择钻石，请选择钻石"}).then((function(){t.footerTabId="diamond"})),e.abrupt("return");case 7:return n=t.my3d.getTryOnState(),0!==n&&(t.my3d.setModelTryonMode(!1,null),t.my3d.onWindowResize(2)),e.next=11,new Promise((function(t){return setTimeout(t,200)}));case 11:return t.loading=!0,t.my3d.changeBackground("72,72,79"),t.setInitCameraPos(),e.next=16,new Promise((function(t){return setTimeout(t,200)}));case 16:o=document.querySelector("#mainCanvas"),t.imgUrl=t.my3d.getDesignImage(2*o.offsetWidth,2*o.offsetHeight),t.$store.dispatch("submitDesign",{image:t.imgUrl,bn:t.design_bn,isCombo:t.isCombo}).then((function(t){var e=t.data;location.href="/#/order/?bn=".concat(e)})).catch((function(t){var e=t.message;console.log(e)}));case 19:case"end":return e.stop()}}),e)})))()},selectDiamond:function(){var t=this.$store.state.design,e=t.mark,a=t.mainPartId,s=t.partId,i=t.metalId,n=t.diamondId,o=t.currentHandInch,c=t.comboId,r={};r.mark=e,r.mainPartId=a,r.partId=s,r.metalId=i,r.diamondId=n,r.currentHandInch=o,r.bn=this.design_bn,r.comboId=c,r.isCombo=this.isCombo?"1":"0";var d="//"+location.host+location.pathname+"?";for(var l in r)r[l]&&(d+=l+"="+r[l]+"&");d=d.slice(0,d.length-1),location.href="/#/diamondList/?backUrl=".concat(encodeURIComponent(d))},openDesign:function(){this.footerTabId="design",this.designTab=this.isCombo?4:1},openMark:function(){this.footerTabId="mark",this.my3d.setRotationState(!1),this.my3d.changeCameraPos(!1,0,80,-60)},saveMark:function(){this.$store.commit("setState",{mark:this.mark}),this.printUserMark(!0)},markBack:function(){this.footerTabId="default",this.setInitCameraPos(),this.my3d.setRotationState(!0)},onKeyup:function(t){"13"==t.keyCode&&this.saveMark()},changeHandInch:function(t){this.$store.commit("setState",{currentHandInch:t[0]}),this.handPicker=!1,this.getPrice()},openHandInch:function(){var t=this;this.handPicker=!0;var e=this.$store.state.design.currentHandInch;this.$nextTick((function(){if(e){var a=8;f["d"].forEach((function(t,s){+t===+e&&(a=s)})),t.$refs.picker.setIndexes([a])}}))},changePartId:function(t){var e=this;this.checkFromComboDesign().then((function(){console.log("partId",t);var a=e.my3d.getLoadModelState();2==a&&(e.my3d.switchPart(e.edit3dPartType,Number(t)),e.$store.commit("setState",{partId:t})),e.getPrice()}))},changeMainPartId:function(t){var e=this;this.checkFromComboDesign().then((function(){console.log("mainPartId",t);var a=e.my3d.getLoadModelState();2==a&&(e.my3d.switchPart(e.edit3dPartType,Number(t)),e.$store.commit("setState",{mainPartId:t}),setTimeout((function(){e.mark&&(e.printUserMark(),setTimeout((function(){e.my3d.setRotationState(!0)}),200))}),1e3)),e.getPrice()}))},checkFromComboDesign:function(){var t=this;return new Promise((function(e,a){t.isCombo&&t.$dialog.confirm({title:"提示",message:"是否以当前设计款式覆盖固定款式方案？"}).then((function(){t.init3D(),e()})).catch(a),e()}))},tryOn:function(){var t=this,e=this.$store.state.design.webModelPics;e&&e.length?this.hasModeltryOn():this.$store.dispatch("loadModelPicList").then((function(){t.hasModeltryOn()}))},hasModeltryOn:function(){var t=this.$store.state.design,e=t.webModelPics,a=t.userNo,s=this.my3d.getTryOnState();if(0===s){this.my3d.onWindowResize(0);var i=e[0];i.imgUrl="https://design.bavlo.com/WebModelPics/"+a+"/"+i.name,this.my3d.setModelTryonMode(!0,i)}else this.my3d.setModelTryonMode(!1,null),this.my3d.onWindowResize(2)}},filters:{formatIndex:function(t){return t+=1,t<10?"0"+t:t},formatCost:function(t){if("number"===typeof t&&!isNaN(t))return t.toString()+".00"}}},v=b,h=(a("d3a1"),a("2877")),p=Object(h["a"])(v,l,m,!1,null,"ab79ebae",null),C=p.exports,k=a("4360"),y=a("a1e1");d["a"].use(r["a"]),d["a"].use(c["a"]),d["a"].use(o["a"]),d["a"].use(n["a"]),d["a"].use(i["a"]),d["a"].use(s["a"]),d["a"].component("title-bar",y["a"]),d["a"].config.productionTip=!1,new d["a"]({store:k["a"],render:function(t){return t(C)}}).$mount("#app")},"880f":function(t,e,a){},d3a1:function(t,e,a){"use strict";a("880f")}});
//# sourceMappingURL=design.6c33d859.js.map